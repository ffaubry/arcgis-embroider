(window.webpackJsonp=window.webpackJsonp||[]).push([[38,8,9,10,55,63,95],{387:function(e,t,r){"use strict";r.r(t),r.d(t,"WhereClause",(function(){return j})),r.d(t,"defaultAttributeAdapter",(function(){return P}));var i=r(4),s=r(125);const n={min:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.min.apply(Math,e[0])},max:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.max.apply(Math,e[0])},avg:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:a(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sqrt(o(e[0]))},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:o(e[0])}};function a(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}function o(e){const t=a(e),r=e.length;let i=0;for(const r of e)i+=Math.pow(r-t,2);return r>1?i/(r-1):0}var l=r(73);class c{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(e){const t=new c;return t.second=e/1e3,t}static createFromValueAndQualifer(e,t,r){let i=null;const s=new c;if(s.op="-"===r?"-":"+","interval-period"===t.type){c.fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new Error("Year-Month Intervals not supported");if(!r.test(e))throw new Error("Illegal Interval");s[t.period]=parseFloat(e)}else{if(c.fixDefaults(t.start),c.fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period)throw new Error("Year-Month Intervals not supported");if("year"===t.end.period||"month"===t.end.period)throw new Error("Year-Month Intervals not supported");switch(t.start.period){case"day":switch(t.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(e))throw new Error("Illegal Interval");s[t.start.period]=parseFloat(e.split(" ")[0]),s[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(e))throw new Error("Illegal Interval");{s[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");s.hour=parseFloat(r[0]),s.minute=parseFloat(r[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new Error("Illegal Interval");{s[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");s.hour=parseFloat(r[0]),s.minute=parseFloat(r[1]),s.second=parseFloat(r[2])}break;default:throw"Invalid Interval."}break;case"hour":switch(t.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(e))throw new Error("Illegal Interval");s.hour=parseFloat(e.split(":")[0]),s.minute=parseFloat(e.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new Error("Illegal Interval");{const t=e.split(":");s.hour=parseFloat(t[0]),s.minute=parseFloat(t[1]),s.second=parseFloat(t[2])}break;default:throw"Invalid Interval."}break;case"minute":switch(t.end.period){case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new Error("Illegal Interval");{const t=e.split(":");s.minute=parseFloat(t[0]),s.second=parseFloat(t[1])}break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return s}valueInMilliseconds(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function u(e,t){const r=h[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)}const h={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(t instanceof Date)switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,i]=e;return null==t||null==r||null==i?null:i<=0?"":t.toString().substring(r-1,r+i-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",i=t?e[2]:e[1];if(null==r||null==i)return null;const s=`(${Object(l.a)(r)})`;switch(e[0]){case"BOTH":return i.replace(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return i.replace(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return i.replace(new RegExp(s+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>"string"==typeof e[0]||e[0]instanceof String?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()}};var d=r(211),p=Object(d.b)((function(e){e.exports&&(e.exports=function(){function e(t,r,i,s){this.message=t,this.expected=r,this.found=i,this.location=s,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?n(e.parts[t][0])+"-"+n(e.parts[t][1]):n(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=a(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var i,s={},n={start:Qe},a=Qe,o=function(e,t){var r={type:"expr_list"},i=function(e,t,r){return function(e,t){for(var r=[e],i=0;i<t.length;i++)r.push(t[i][3]);return r}(e,t)}(e,t);return r.value=i,r},l=function(e,t){return fr(e,t)},c=qe("!",!1),u=qe("=",!1),h=qe(">=",!1),d=qe(">",!1),p=qe("<=",!1),f=qe("<>",!1),b=qe("<",!1),y=qe("!=",!1),m=function(e){return e[0]+" "+e[2]},g=qe("+",!1),O=qe("-",!1),_=qe("*",!1),v=qe("/",!1),j=function(e,t){return e+t.join("")},x=/^[A-Za-z_\x80-\uFFFF]/,w=Ge([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),S=/^[A-Za-z0-9_]/,I=Ge([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),T=/^[A-Za-z0-9_.\x80-\uFFFF]/,F=Ge([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),E=qe("@",!1),M=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},R=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},C=function(e){return parseFloat(e)},A=qe("'",!1),N=qe("N'",!1),D=qe("''",!1),L=/^[^']/,P=Ge(["'"],!0,!1),k=function(e,t){return{type:"when_clause",operand:e,value:t}},z=qe(".",!1),q=/^[0-9]/,G=Ge([["0","9"]],!1,!1),V=/^[eE]/,B=Ge(["e","E"],!1,!1),U=/^[+\-]/,Q=Ge(["+","-"],!1,!1),J=qe("NULL",!0),$=qe("TRUE",!0),Y=qe("FALSE",!0),H=qe("IN",!0),Z=qe("IS",!0),W=qe("LIKE",!0),X=qe("ESCAPE",!0),K=qe("NOT",!0),ee=qe("AND",!0),te=qe("OR",!0),re=qe("BETWEEN",!0),ie=qe("FROM",!0),se=qe("FOR",!0),ne=qe("SUBSTRING",!0),ae=qe("EXTRACT",!0),oe=qe("TRIM",!0),le=qe("POSITION",!0),ce=qe("TIMESTAMP",!0),ue=qe("DATE",!0),he=qe("LEADING",!0),de=qe("TRAILING",!0),pe=qe("BOTH",!0),fe=qe("TO",!0),be=qe("INTERVAL",!0),ye=qe("YEAR",!0),me=qe("MONTH",!0),ge=qe("DAY",!0),Oe=qe("HOUR",!0),_e=qe("MINUTE",!0),ve=qe("SECOND",!0),je=qe("CASE",!0),xe=qe("END",!0),we=qe("WHEN",!0),Se=qe("THEN",!0),Ie=qe("ELSE",!0),Te=qe(",",!1),Fe=qe("(",!1),Ee=qe(")",!1),Me=/^[ \t\n\r]/,Re=Ge([" ","\t","\n","\r"],!1,!1),Ce=qe("`",!1),Ae=/^[^`]/,Ne=Ge(["`"],!0,!1),De=0,Le=[{line:1,column:1}],Pe=0,ke=[],ze=0;if("startRule"in r){if(!(r.startRule in n))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=n[r.startRule]}function qe(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ge(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ve(e){var r,i=Le[e];if(i)return i;for(r=e-1;!Le[r];)r--;for(i={line:(i=Le[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Le[e]=i,i}function Be(e,t){var r=Ve(e),i=Ve(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function Ue(e){De<Pe||(De>Pe&&(Pe=De,ke=[]),ke.push(e))}function Qe(){var e,t;return e=De,ur()!==s&&(t=$e())!==s&&ur()!==s?e=t:(De=e,e=s),e}function Je(){var e,t,r,i,n,a,l,c;if(e=De,(t=$e())!==s){for(r=[],i=De,(n=ur())!==s&&(a=or())!==s&&(l=ur())!==s&&(c=$e())!==s?i=n=[n,a,l,c]:(De=i,i=s);i!==s;)r.push(i),i=De,(n=ur())!==s&&(a=or())!==s&&(l=ur())!==s&&(c=$e())!==s?i=n=[n,a,l,c]:(De=i,i=s);r!==s?e=t=o(t,r):(De=e,e=s)}else De=e,e=s;return e}function $e(){var e,t,r,i,n,a,o,c;if(e=De,(t=Ye())!==s){for(r=[],i=De,(n=ur())!==s&&(a=Dt())!==s&&(o=ur())!==s&&(c=Ye())!==s?i=n=[n,a,o,c]:(De=i,i=s);i!==s;)r.push(i),i=De,(n=ur())!==s&&(a=Dt())!==s&&(o=ur())!==s&&(c=Ye())!==s?i=n=[n,a,o,c]:(De=i,i=s);r!==s?e=t=l(t,r):(De=e,e=s)}else De=e,e=s;return e}function Ye(){var e,t,r,i,n,a,o,c;if(e=De,(t=He())!==s){for(r=[],i=De,(n=ur())!==s&&(a=Nt())!==s&&(o=ur())!==s&&(c=He())!==s?i=n=[n,a,o,c]:(De=i,i=s);i!==s;)r.push(i),i=De,(n=ur())!==s&&(a=Nt())!==s&&(o=ur())!==s&&(c=He())!==s?i=n=[n,a,o,c]:(De=i,i=s);r!==s?e=t=l(t,r):(De=e,e=s)}else De=e,e=s;return e}function He(){var e,r,i,n,a;return e=De,(r=At())===s&&(r=De,33===t.charCodeAt(De)?(i="!",De++):(i=s,0===ze&&Ue(c)),i!==s?(n=De,ze++,61===t.charCodeAt(De)?(a="=",De++):(a=s,0===ze&&Ue(u)),ze--,a===s?n=void 0:(De=n,n=s),n!==s?r=i=[i,n]:(De=r,r=s)):(De=r,r=s)),r!==s&&(i=ur())!==s&&(n=He())!==s?e=r=function(e){return function(e,t){return{type:"unary_expr",operator:e,expr:t}}("NOT",e)}(n):(De=e,e=s),e===s&&(e=function(){var e,t,r;return e=De,(t=Ke())!==s&&ur()!==s?((r=function(){var e;return(e=function(){var e,t,r,i,n,a;if(e=[],t=De,(r=ur())!==s&&(i=Ze())!==s&&(n=ur())!==s&&(a=Ke())!==s?t=r=[r,i,n,a]:(De=t,t=s),t!==s)for(;t!==s;)e.push(t),t=De,(r=ur())!==s&&(i=Ze())!==s&&(n=ur())!==s&&(a=Ke())!==s?t=r=[r,i,n,a]:(De=t,t=s);else e=s;return e!==s&&(e=function(e){return{type:"arithmetic",tail:e}}(e)),e}())===s&&(e=function(){var e,t,r,i;return e=De,(t=Xe())!==s&&ur()!==s&&(r=lr())!==s&&ur()!==s&&(i=Je())!==s&&ur()!==s&&cr()!==s?e=t=function(e,t){return{op:e,right:t}}(t,i):(De=e,e=s),e===s&&(e=De,(t=Xe())!==s&&ur()!==s&&(r=lr())!==s&&ur()!==s&&(i=cr())!==s?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(De=e,e=s),e===s&&(e=De,(t=Xe())!==s&&ur()!==s&&(r=lt())!==s?e=t=function(e,t){return{op:e,right:t}}(t,r):(De=e,e=s))),e}())===s&&(e=function(){var e,t,r,i,n,a;return e=De,(t=At())!==s&&ur()!==s&&(r=Lt())!==s&&ur()!==s&&(i=Ke())!==s&&ur()!==s&&(n=Nt())!==s&&ur()!==s&&(a=Ke())!==s?e=t=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}}(r,i,a):(De=e,e=s),e===s&&(e=De,(t=Lt())!==s&&ur()!==s&&(r=Ke())!==s&&ur()!==s&&(i=Nt())!==s&&ur()!==s&&(n=Ke())!==s?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,n):(De=e,e=s)),e}())===s&&(e=function(){var e,t,r,i;return e=De,(t=Mt())!==s&&ur()!==s&&(r=At())!==s&&ur()!==s&&(i=Ke())!==s?e=t=function(e,t){return{op:e+"NOT",right:t}}(t,i):(De=e,e=s),e===s&&(e=De,(t=Mt())!==s&&ur()!==s&&(r=Ke())!==s?e=t=function(e,t){return{op:e,right:t}}(t,r):(De=e,e=s)),e}())===s&&(e=function(){var e,t,r,i;return e=De,(t=We())!==s&&ur()!==s&&(r=bt())!==s&&ur()!==s&&Ct()!==s&&ur()!==s&&(i=yt())!==s?e=t=function(e,t,r){return{op:e,right:t,escape:r.value}}(t,r,i):(De=e,e=s),e===s&&(e=De,(t=We())!==s&&ur()!==s&&(r=bt())!==s?e=t=function(e,t){return{op:e,right:t,escape:""}}(t,r):(De=e,e=s)),e}()),e}())===s&&(r=null),r!==s?e=t=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?fr(e,t.tail):pr(t.op,e,t.right,t.escape)}(t,r):(De=e,e=s)):(De=e,e=s),e}()),e}function Ze(){var e;return">="===t.substr(De,2)?(e=">=",De+=2):(e=s,0===ze&&Ue(h)),e===s&&(62===t.charCodeAt(De)?(e=">",De++):(e=s,0===ze&&Ue(d)),e===s&&("<="===t.substr(De,2)?(e="<=",De+=2):(e=s,0===ze&&Ue(p)),e===s&&("<>"===t.substr(De,2)?(e="<>",De+=2):(e=s,0===ze&&Ue(f)),e===s&&(60===t.charCodeAt(De)?(e="<",De++):(e=s,0===ze&&Ue(b)),e===s&&(61===t.charCodeAt(De)?(e="=",De++):(e=s,0===ze&&Ue(u)),e===s&&("!="===t.substr(De,2)?(e="!=",De+=2):(e=s,0===ze&&Ue(y)))))))),e}function We(){var e,t,r,i,n;return e=De,t=De,(r=At())!==s&&(i=ur())!==s&&(n=Rt())!==s?t=r=[r,i,n]:(De=t,t=s),t!==s&&(t=m(t)),(e=t)===s&&(e=Rt()),e}function Xe(){var e,t,r,i,n;return e=De,t=De,(r=At())!==s&&(i=ur())!==s&&(n=Et())!==s?t=r=[r,i,n]:(De=t,t=s),t!==s&&(t=m(t)),(e=t)===s&&(e=Et()),e}function Ke(){var e,t,r,i,n,a,o,c;if(e=De,(t=tt())!==s){for(r=[],i=De,(n=ur())!==s&&(a=et())!==s&&(o=ur())!==s&&(c=tt())!==s?i=n=[n,a,o,c]:(De=i,i=s);i!==s;)r.push(i),i=De,(n=ur())!==s&&(a=et())!==s&&(o=ur())!==s&&(c=tt())!==s?i=n=[n,a,o,c]:(De=i,i=s);r!==s?e=t=l(t,r):(De=e,e=s)}else De=e,e=s;return e}function et(){var e;return 43===t.charCodeAt(De)?(e="+",De++):(e=s,0===ze&&Ue(g)),e===s&&(45===t.charCodeAt(De)?(e="-",De++):(e=s,0===ze&&Ue(O))),e}function tt(){var e,t,r,i,n,a,o,l;if(e=De,(t=it())!==s){for(r=[],i=De,(n=ur())!==s&&(a=rt())!==s&&(o=ur())!==s&&(l=it())!==s?i=n=[n,a,o,l]:(De=i,i=s);i!==s;)r.push(i),i=De,(n=ur())!==s&&(a=rt())!==s&&(o=ur())!==s&&(l=it())!==s?i=n=[n,a,o,l]:(De=i,i=s);r!==s?e=t=function(e,t){return fr(e,t)}(t,r):(De=e,e=s)}else De=e,e=s;return e}function rt(){var e;return 42===t.charCodeAt(De)?(e="*",De++):(e=s,0===ze&&Ue(_)),e===s&&(47===t.charCodeAt(De)?(e="/",De++):(e=s,0===ze&&Ue(v))),e}function it(){var e,t;return(e=function(){var e;return(e=yt())===s&&(e=function(){var e,t,r,i;return e=De,(t=function(){var e,t,r,i;return e=De,(t=_t())!==s&&(r=vt())!==s&&(i=jt())!==s?e=t=function(e,t,r){return parseFloat(e+t+r)}(t,r,i):(De=e,e=s),e===s&&(e=De,(t=_t())!==s&&(r=vt())!==s?e=t=function(e,t){return parseFloat(e+t)}(t,r):(De=e,e=s),e===s&&(e=De,(t=_t())!==s&&(r=jt())!==s?e=t=function(e,t){return parseFloat(e+t)}(t,r):(De=e,e=s),e===s&&(e=De,(t=_t())!==s&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==s?(r=De,ze++,i=nt(),ze--,i===s?r=void 0:(De=r,r=s),r!==s?e=t=function(e){return{type:"number",value:e}}(t):(De=e,e=s)):(De=e,e=s),e}())===s&&(e=function(){var e,t;return e=De,(t=Tt())!==s&&(t={type:"bool",value:!0}),(e=t)===s&&(e=De,(t=Ft())!==s&&(t={type:"bool",value:!1}),e=t),e}())===s&&(e=function(){var e;return(e=It())!==s&&(e={type:"null",value:null}),e}())===s&&(e=function(){var e,t;return e=De,Ut()!==s&&ur()!==s&&(t=bt())!==s?e=function(e){return{type:"date",value:e.value}}(t):(De=e,e=s),e}())===s&&(e=function(){var e,t;return e=De,Bt()!==s&&ur()!==s&&(t=bt())!==s?e=function(e){return{type:"timestamp",value:e.value}}(t):(De=e,e=s),e}())===s&&(e=ut()),e}())===s&&(e=function(){var e,t,r;return e=De,qt()!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(t=function(){var e;return(e=Zt())===s&&(e=Wt())===s&&(e=Xt())===s&&(e=Kt())===s&&(e=er())===s&&(e=tr()),e}())!==s&&ur()!==s&&Pt()!==s&&ur()!==s&&(r=$e())!==s&&ur()!==s&&cr()!==s?e=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}}(t,r):(De=e,e=s),e}())===s&&(e=function(){var e,t,r,i,n,a,o,l;return e=De,zt()!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(t=$e())!==s&&ur()!==s&&Pt()!==s&&ur()!==s&&(r=$e())!==s&&ur()!==s?(i=De,(n=kt())!==s&&(a=ur())!==s&&(o=$e())!==s&&(l=ur())!==s?i=n=[n,a,o,l]:(De=i,i=s),i===s&&(i=null),i!==s&&(n=cr())!==s?e=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}}(t,r,i):(De=e,e=s)):(De=e,e=s),e}())===s&&(e=function(){var e,t,r,i;return e=De,Gt()!==s&&ur()!==s&&lr()!==s&&ur()!==s?((t=ct())===s&&(t=null),t!==s&&ur()!==s&&(r=$e())!==s&&ur()!==s&&Pt()!==s&&ur()!==s&&(i=$e())!==s&&ur()!==s&&cr()!==s?e=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}}(t,r,i):(De=e,e=s)):(De=e,e=s),e===s&&(e=De,Gt()!==s&&ur()!==s&&lr()!==s&&ur()!==s?((t=ct())===s&&(t=null),t!==s&&ur()!==s&&(r=$e())!==s&&ur()!==s&&cr()!==s?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(De=e,e=s)):(De=e,e=s)),e}())===s&&(e=function(){var e,t,r;return e=De,Vt()!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(t=$e())!==s&&ur()!==s&&Et()!==s&&ur()!==s&&(r=$e())!==s&&ur()!==s&&cr()!==s?e=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}}(t,r):(De=e,e=s),e}())===s&&(e=function(){var e,t,r;return e=De,(t=dr())!==s&&ur()!==s&&lr()!==s&&ur()!==s?((r=Je())===s&&(r=null),r!==s&&ur()!==s&&cr()!==s?e=t=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}}(t,r):(De=e,e=s)):(De=e,e=s),e}())===s&&(e=function(){var e;return(e=function(){var e,t,r,i,n;if(e=De,rr()!==s)if(ur()!==s)if((t=$e())!==s)if(ur()!==s){for(r=[],i=gt();i!==s;)r.push(i),i=gt();r!==s&&(i=ur())!==s&&(n=ir())!==s?e=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}}(t,r):(De=e,e=s)}else De=e,e=s;else De=e,e=s;else De=e,e=s;else De=e,e=s;if(e===s)if(e=De,rr()!==s)if(ur()!==s)if((t=$e())!==s)if(ur()!==s){for(r=[],i=gt();i!==s;)r.push(i),i=gt();r!==s&&(i=ur())!==s&&(n=Ot())!==s&&ur()!==s&&ir()!==s?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,n):(De=e,e=s)}else De=e,e=s;else De=e,e=s;else De=e,e=s;else De=e,e=s;return e}())===s&&(e=function(){var e,t,r,i;if(e=De,rr()!==s)if(ur()!==s){for(t=[],r=mt();r!==s;)t.push(r),r=mt();t!==s&&(r=ur())!==s&&(i=ir())!==s?e=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}}(t):(De=e,e=s)}else De=e,e=s;else De=e,e=s;if(e===s)if(e=De,rr()!==s)if(ur()!==s){for(t=[],r=mt();r!==s;)t.push(r),r=mt();t!==s&&(r=ur())!==s&&(i=Ot())!==s&&ur()!==s&&ir()!==s?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,i):(De=e,e=s)}else De=e,e=s;else De=e,e=s;return e}()),e}())===s&&(e=function(){var e;return(e=function(){var e;return(e=function(){var e,t,r,i;if(e=De,(t=nt())!==s){for(r=[],i=ot();i!==s;)r.push(i),i=ot();r!==s?e=t=j(t,r):(De=e,e=s)}else De=e,e=s;return e}())!==s&&(e=e),e}())!==s&&(e=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}}(e)),e}())===s&&(e=lt())===s&&(e=De,lr()!==s&&ur()!==s&&(t=$e())!==s&&ur()!==s&&cr()!==s?e=function(e){return e.paren=!0,e}(t):(De=e,e=s)),e}function st(){var e,t,r,i;if(e=De,(t=nt())!==s){for(r=[],i=at();i!==s;)r.push(i),i=at();r!==s?e=t=j(t,r):(De=e,e=s)}else De=e,e=s;return e}function nt(){var e;return x.test(t.charAt(De))?(e=t.charAt(De),De++):(e=s,0===ze&&Ue(w)),e}function at(){var e;return S.test(t.charAt(De))?(e=t.charAt(De),De++):(e=s,0===ze&&Ue(I)),e}function ot(){var e;return T.test(t.charAt(De))?(e=t.charAt(De),De++):(e=s,0===ze&&Ue(F)),e}function lt(){var e,r,i;return e=De,64===t.charCodeAt(De)?(r="@",De++):(r=s,0===ze&&Ue(E)),r!==s&&(i=st())!==s?e=r=[r,i]:(De=e,e=s),e!==s&&(e=function(e){return{type:"param",value:e[1]}}(e)),e}function ct(){var e;return(e=Qt())===s&&(e=Jt())===s&&(e=$t()),e}function ut(){var e,r,i,n;return e=De,Ht()!==s&&ur()!==s?(45===t.charCodeAt(De)?(r="-",De++):(r=s,0===ze&&Ue(O)),r===s&&(43===t.charCodeAt(De)?(r="+",De++):(r=s,0===ze&&Ue(g))),r!==s&&ur()!==s&&(i=bt())!==s&&ur()!==s&&(n=ht())!==s?e=function(e,t,r){return{type:"interval",value:t,qualifier:r,op:e}}(r,i,n):(De=e,e=s)):(De=e,e=s),e===s&&(e=De,Ht()!==s&&ur()!==s&&(r=bt())!==s&&ur()!==s&&(i=ht())!==s?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,i):(De=e,e=s)),e}function ht(){var e,t,r;return e=De,(t=function(){var e,t,r;return e=De,(t=dt())!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(r=ft())!==s&&ur()!==s&&cr()!==s?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(De=e,e=s),e===s&&(e=De,(t=dt())!==s&&(t=M(t)),e=t),e}())!==s&&ur()!==s&&Yt()!==s&&ur()!==s&&(r=function(){var e,t,r,i;return e=De,(t=dt())!==s&&(t=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}}(t)),(e=t)===s&&(e=De,(t=tr())!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(r=ft())!==s&&ur()!==s&&or()!==s&&ur()!==s&&(i=pt())!==s&&ur()!==s&&cr()!==s?e=t=R(r,i):(De=e,e=s),e===s&&(e=De,(t=tr())!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(r=ft())!==s&&ur()!==s&&cr()!==s?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(De=e,e=s),e===s&&(e=De,(t=tr())!==s&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==s?e=t=function(e,t){return{type:"interval-qualifier",start:e,end:t}}(t,r):(De=e,e=s),e===s&&(e=function(){var e,t,r,i;return e=De,(t=dt())!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(r=pt())!==s&&ur()!==s&&cr()!==s?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(De=e,e=s),e===s&&(e=De,(t=dt())!==s&&(t=M(t)),(e=t)===s&&(e=De,(t=tr())!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(r=ft())!==s&&ur()!==s&&or()!==s&&ur()!==s&&(i=pt())!==s&&ur()!==s&&cr()!==s?e=t=R(r,i):(De=e,e=s),e===s&&(e=De,(t=tr())!==s&&ur()!==s&&lr()!==s&&ur()!==s&&(r=pt())!==s&&ur()!==s&&cr()!==s?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(De=e,e=s),e===s&&(e=De,(t=tr())!==s&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function dt(){var e,t;return e=De,(t=Xt())!==s&&(t={type:"string",value:"day"}),(e=t)===s&&(e=De,(t=Kt())!==s&&(t={type:"string",value:"hour"}),(e=t)===s&&(e=De,(t=er())!==s&&(t={type:"string",value:"minute"}),(e=t)===s&&(e=De,(t=Wt())!==s&&(t={type:"string",value:"month"}),(e=t)===s&&(e=De,(t=Zt())!==s&&(t={type:"string",value:"year"}),e=t)))),e}function pt(){var e;return(e=xt())!==s&&(e=C(e)),e}function ft(){var e;return(e=xt())!==s&&(e=C(e)),e}function bt(){var e;return(e=yt())===s&&(e=lt()),e}function yt(){var e,r,i,n,a;if(e=De,39===t.charCodeAt(De)?(r="'",De++):(r=s,0===ze&&Ue(A)),r===s&&("N'"===t.substr(De,2)?(r="N'",De+=2):(r=s,0===ze&&Ue(N))),r!==s){for(i=[],n=De,"''"===t.substr(De,2)?(a="''",De+=2):(a=s,0===ze&&Ue(D)),a!==s&&(a="'"),(n=a)===s&&(L.test(t.charAt(De))?(n=t.charAt(De),De++):(n=s,0===ze&&Ue(P)));n!==s;)i.push(n),n=De,"''"===t.substr(De,2)?(a="''",De+=2):(a=s,0===ze&&Ue(D)),a!==s&&(a="'"),(n=a)===s&&(L.test(t.charAt(De))?(n=t.charAt(De),De++):(n=s,0===ze&&Ue(P)));i!==s?(39===t.charCodeAt(De)?(n="'",De++):(n=s,0===ze&&Ue(A)),n!==s?e=r=function(e){return{type:"string",value:e.join("")}}(i):(De=e,e=s)):(De=e,e=s)}else De=e,e=s;return e}function mt(){var e,t,r;return e=De,sr()!==s&&ur()!==s&&(t=$e())!==s&&ur()!==s&&nr()!==s&&ur()!==s&&(r=$e())!==s?e=k(t,r):(De=e,e=s),e}function gt(){var e,t,r;return e=De,sr()!==s&&ur()!==s&&(t=$e())!==s&&ur()!==s&&nr()!==s&&ur()!==s&&(r=$e())!==s?e=k(t,r):(De=e,e=s),e}function Ot(){var e,t;return e=De,ar()!==s&&ur()!==s&&(t=$e())!==s?e=function(e){return{type:"else_clause",value:e}}(t):(De=e,e=s),e}function _t(){var e,r,i;return(e=xt())===s&&(e=De,45===t.charCodeAt(De)?(r="-",De++):(r=s,0===ze&&Ue(O)),r===s&&(43===t.charCodeAt(De)?(r="+",De++):(r=s,0===ze&&Ue(g))),r!==s&&(i=xt())!==s?e=r=function(e,t){return e[0]+t}(r,i):(De=e,e=s)),e}function vt(){var e,r,i;return e=De,46===t.charCodeAt(De)?(r=".",De++):(r=s,0===ze&&Ue(z)),r!==s?((i=xt())===s&&(i=null),i!==s?e=r=function(e){return"."+(null!=e?e:"")}(i):(De=e,e=s)):(De=e,e=s),e}function jt(){var e,t,r;return e=De,(t=St())!==s&&(r=xt())!==s?e=t=function(e,t){return e+t}(t,r):(De=e,e=s),e}function xt(){var e,t;if(e=[],(t=wt())!==s)for(;t!==s;)e.push(t),t=wt();else e=s;return e!==s&&(e=function(e){return e.join("")}(e)),e}function wt(){var e;return q.test(t.charAt(De))?(e=t.charAt(De),De++):(e=s,0===ze&&Ue(G)),e}function St(){var e,r,i;return e=De,V.test(t.charAt(De))?(r=t.charAt(De),De++):(r=s,0===ze&&Ue(B)),r!==s?(U.test(t.charAt(De))?(i=t.charAt(De),De++):(i=s,0===ze&&Ue(Q)),i===s&&(i=null),i!==s?e=r=function(e,t){return"e"+(null===t?"":t)}(0,i):(De=e,e=s)):(De=e,e=s),e}function It(){var e,r,i,n;return e=De,"null"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(J)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r=[r,i]:(De=e,e=s)):(De=e,e=s),e}function Tt(){var e,r,i,n;return e=De,"true"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue($)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r=[r,i]:(De=e,e=s)):(De=e,e=s),e}function Ft(){var e,r,i,n;return e=De,"false"===t.substr(De,5).toLowerCase()?(r=t.substr(De,5),De+=5):(r=s,0===ze&&Ue(Y)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r=[r,i]:(De=e,e=s)):(De=e,e=s),e}function Et(){var e,r,i,n;return e=De,"in"===t.substr(De,2).toLowerCase()?(r=t.substr(De,2),De+=2):(r=s,0===ze&&Ue(H)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="IN":(De=e,e=s)):(De=e,e=s),e}function Mt(){var e,r,i,n;return e=De,"is"===t.substr(De,2).toLowerCase()?(r=t.substr(De,2),De+=2):(r=s,0===ze&&Ue(Z)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="IS":(De=e,e=s)):(De=e,e=s),e}function Rt(){var e,r,i,n;return e=De,"like"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(W)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="LIKE":(De=e,e=s)):(De=e,e=s),e}function Ct(){var e,r,i,n;return e=De,"escape"===t.substr(De,6).toLowerCase()?(r=t.substr(De,6),De+=6):(r=s,0===ze&&Ue(X)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="ESCAPE":(De=e,e=s)):(De=e,e=s),e}function At(){var e,r,i,n;return e=De,"not"===t.substr(De,3).toLowerCase()?(r=t.substr(De,3),De+=3):(r=s,0===ze&&Ue(K)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="NOT":(De=e,e=s)):(De=e,e=s),e}function Nt(){var e,r,i,n;return e=De,"and"===t.substr(De,3).toLowerCase()?(r=t.substr(De,3),De+=3):(r=s,0===ze&&Ue(ee)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="AND":(De=e,e=s)):(De=e,e=s),e}function Dt(){var e,r,i,n;return e=De,"or"===t.substr(De,2).toLowerCase()?(r=t.substr(De,2),De+=2):(r=s,0===ze&&Ue(te)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="OR":(De=e,e=s)):(De=e,e=s),e}function Lt(){var e,r,i,n;return e=De,"between"===t.substr(De,7).toLowerCase()?(r=t.substr(De,7),De+=7):(r=s,0===ze&&Ue(re)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="BETWEEN":(De=e,e=s)):(De=e,e=s),e}function Pt(){var e,r,i,n;return e=De,"from"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(ie)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="FROM":(De=e,e=s)):(De=e,e=s),e}function kt(){var e,r,i,n;return e=De,"for"===t.substr(De,3).toLowerCase()?(r=t.substr(De,3),De+=3):(r=s,0===ze&&Ue(se)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="FOR":(De=e,e=s)):(De=e,e=s),e}function zt(){var e,r,i,n;return e=De,"substring"===t.substr(De,9).toLowerCase()?(r=t.substr(De,9),De+=9):(r=s,0===ze&&Ue(ne)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="SUBSTRING":(De=e,e=s)):(De=e,e=s),e}function qt(){var e,r,i,n;return e=De,"extract"===t.substr(De,7).toLowerCase()?(r=t.substr(De,7),De+=7):(r=s,0===ze&&Ue(ae)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="EXTRACT":(De=e,e=s)):(De=e,e=s),e}function Gt(){var e,r,i,n;return e=De,"trim"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(oe)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="TRIM":(De=e,e=s)):(De=e,e=s),e}function Vt(){var e,r,i,n;return e=De,"position"===t.substr(De,8).toLowerCase()?(r=t.substr(De,8),De+=8):(r=s,0===ze&&Ue(le)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="POSITION":(De=e,e=s)):(De=e,e=s),e}function Bt(){var e,r,i,n;return e=De,"timestamp"===t.substr(De,9).toLowerCase()?(r=t.substr(De,9),De+=9):(r=s,0===ze&&Ue(ce)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="TIMESTAMP":(De=e,e=s)):(De=e,e=s),e}function Ut(){var e,r,i,n;return e=De,"date"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(ue)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="DATE":(De=e,e=s)):(De=e,e=s),e}function Qt(){var e,r,i,n;return e=De,"leading"===t.substr(De,7).toLowerCase()?(r=t.substr(De,7),De+=7):(r=s,0===ze&&Ue(he)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="LEADING":(De=e,e=s)):(De=e,e=s),e}function Jt(){var e,r,i,n;return e=De,"trailing"===t.substr(De,8).toLowerCase()?(r=t.substr(De,8),De+=8):(r=s,0===ze&&Ue(de)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="TRAILING":(De=e,e=s)):(De=e,e=s),e}function $t(){var e,r,i,n;return e=De,"both"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(pe)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="BOTH":(De=e,e=s)):(De=e,e=s),e}function Yt(){var e,r,i,n;return e=De,"to"===t.substr(De,2).toLowerCase()?(r=t.substr(De,2),De+=2):(r=s,0===ze&&Ue(fe)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="TO":(De=e,e=s)):(De=e,e=s),e}function Ht(){var e,r,i,n;return e=De,"interval"===t.substr(De,8).toLowerCase()?(r=t.substr(De,8),De+=8):(r=s,0===ze&&Ue(be)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="INTERVAL":(De=e,e=s)):(De=e,e=s),e}function Zt(){var e,r,i,n;return e=De,"year"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(ye)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="YEAR":(De=e,e=s)):(De=e,e=s),e}function Wt(){var e,r,i,n;return e=De,"month"===t.substr(De,5).toLowerCase()?(r=t.substr(De,5),De+=5):(r=s,0===ze&&Ue(me)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="MONTH":(De=e,e=s)):(De=e,e=s),e}function Xt(){var e,r,i,n;return e=De,"day"===t.substr(De,3).toLowerCase()?(r=t.substr(De,3),De+=3):(r=s,0===ze&&Ue(ge)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="DAY":(De=e,e=s)):(De=e,e=s),e}function Kt(){var e,r,i,n;return e=De,"hour"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(Oe)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="HOUR":(De=e,e=s)):(De=e,e=s),e}function er(){var e,r,i,n;return e=De,"minute"===t.substr(De,6).toLowerCase()?(r=t.substr(De,6),De+=6):(r=s,0===ze&&Ue(_e)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="MINUTE":(De=e,e=s)):(De=e,e=s),e}function tr(){var e,r,i,n;return e=De,"second"===t.substr(De,6).toLowerCase()?(r=t.substr(De,6),De+=6):(r=s,0===ze&&Ue(ve)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="SECOND":(De=e,e=s)):(De=e,e=s),e}function rr(){var e,r,i,n;return e=De,"case"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(je)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="CASE":(De=e,e=s)):(De=e,e=s),e}function ir(){var e,r,i,n;return e=De,"end"===t.substr(De,3).toLowerCase()?(r=t.substr(De,3),De+=3):(r=s,0===ze&&Ue(xe)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="END":(De=e,e=s)):(De=e,e=s),e}function sr(){var e,r,i,n;return e=De,"when"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(we)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="WHEN":(De=e,e=s)):(De=e,e=s),e}function nr(){var e,r,i,n;return e=De,"then"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(Se)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="THEN":(De=e,e=s)):(De=e,e=s),e}function ar(){var e,r,i,n;return e=De,"else"===t.substr(De,4).toLowerCase()?(r=t.substr(De,4),De+=4):(r=s,0===ze&&Ue(Ie)),r!==s?(i=De,ze++,n=at(),ze--,n===s?i=void 0:(De=i,i=s),i!==s?e=r="ELSE":(De=e,e=s)):(De=e,e=s),e}function or(){var e;return 44===t.charCodeAt(De)?(e=",",De++):(e=s,0===ze&&Ue(Te)),e}function lr(){var e;return 40===t.charCodeAt(De)?(e="(",De++):(e=s,0===ze&&Ue(Fe)),e}function cr(){var e;return 41===t.charCodeAt(De)?(e=")",De++):(e=s,0===ze&&Ue(Ee)),e}function ur(){var e,t;for(e=[],t=hr();t!==s;)e.push(t),t=hr();return e}function hr(){var e;return Me.test(t.charAt(De))?(e=t.charAt(De),De++):(e=s,0===ze&&Ue(Re)),e}function dr(){var e,r,i,n;if(e=De,(r=st())!==s&&(r=r),(e=r)===s)if(e=De,96===t.charCodeAt(De)?(r="`",De++):(r=s,0===ze&&Ue(Ce)),r!==s){if(i=[],Ae.test(t.charAt(De))?(n=t.charAt(De),De++):(n=s,0===ze&&Ue(Ne)),n!==s)for(;n!==s;)i.push(n),Ae.test(t.charAt(De))?(n=t.charAt(De),De++):(n=s,0===ze&&Ue(Ne));else i=s;i!==s?(96===t.charCodeAt(De)?(n="`",De++):(n=s,0===ze&&Ue(Ce)),n!==s?e=r=function(e){return e.join("")}(i):(De=e,e=s)):(De=e,e=s)}else De=e,e=s;return e}function pr(e,t,r,i){var s={type:"binary_expr",operator:e,left:t,right:r};return void 0!==i&&(s.escape=i),s}function fr(e,t){for(var r=e,i=0;i<t.length;i++)r=pr(t[i][1],r,t[i][3]);return r}if((i=a())!==s&&De===t.length)return i;throw i!==s&&De<t.length&&Ue({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(ke,Pe<t.length?t.charAt(Pe):null,Pe<t.length?Be(Pe,Pe+1):Be(Pe,Pe))}}}())}));const f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,b=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function O(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function _(e,t,r="0",i="0",s="0",n="0",a="",o="0",l="0"){if("+"===a||"-"===a){const c=`${O(parseInt(e,10),4)}-${O(parseInt(t,10),2)}-${O(parseInt(r,10),2)}`;let u="";parseFloat(n)<10&&(u="0");const h=`${O(parseInt(i,10),2)}:${O(parseInt(s,10),2)}:${u+parseFloat(n).toString()}`,d=`${a}${O(parseInt(o,10),2)}:${O(parseInt(l,10),2)}`;return new Date(c+"T"+h+d)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(i,10),parseInt(s,10),parseFloat(n))}class v{static makeBool(e){return S(e)}static featureValue(e,t,r,i){return L(e,t,r,i)}static equalsNull(e){return null===e}static applyLike(e,t,r){return R(e,t,r)}static ensureArray(e){return I(e)}static applyIn(e,t){return M(e,t)}static currentDate(){const e=new Date;return e.setHours(0,0,0,0),e}static makeSqlInterval(e,t,r){return c.createFromValueAndQualifer(e,t,r)}static convertInterval(e){return e instanceof c?e.valueInMilliseconds():e}static currentTimestamp(){return new Date}static compare(e,t,r){return A(e,t,r)}static calculate(e,t,r){return D(e,t,r)}static makeComparable(e){return C(e)}static evaluateFunction(e,t){return u(e,t)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}static notbetween(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}static ternaryNot(e){return T(e)}static ternaryAnd(e,t){return F(e,t)}static ternaryOr(e,t){return E(e,t)}}class j{constructor(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=class{static parse(e){return p.parse(e)}}.parse(e);const{isStandardized:r,isAggregate:i,referencedFieldNames:s}=this.extractExpressionInfo(t);this.referencedFieldNames=s,this.isStandardized=r,this.isAggregate=i}static create(e,t){return new j(e,t)}get fieldNames(){return this.referencedFieldNames}testSet(e,t=P){const r={};for(const i of this.fieldNames)r[i]=e.map(e=>t.getAttribute(e,i));return!!this.evaluateNode(this.parseTree,{attributes:r},P)}calculateValue(e,t=P){const r=this.evaluateNode(this.parseTree,e,t);return r instanceof c?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(e,t=P){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(i.a)("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}testFeature(e,t=P){return!!this.evaluateNode(this.parseTree,e,t)}testFeatureCompiled(e,t=P){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(i.a)("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}getFunctions(){const e=[];return this.visitAll(this.parseTree,t=>{"function"===t.type&&e.push(t.name.toLowerCase())}),N(e)}getExpressions(){const e=new Map;return this.visitAll(this.parseTree,t=>{if("function"===t.type){const r=t.name.toLowerCase(),i=t.args.value[0];if("column_ref"===i.type){const t=i.column,s=`${r}-${t}`;e.has(s)||e.set(s,{aggregateType:r,field:t})}}}),Object(s.e)(e)}getVariables(){const e=[];return this.visitAll(this.parseTree,t=>{"param"===t.type&&e.push(t.value.toLowerCase())}),N(e)}compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(v)}extractExpressionInfo(e){const t=[];let r=!0,i=!0;return this.visitAll(this.parseTree,s=>{switch(s.type){case"column_ref":{const r=e.get(s.column),i=r&&r.name;!r||"date"!==r.type&&"esriFieldTypeDate"!==r.type||(this.datefields[r.name]=1),void 0!==i?(t.push(i),s.column=i):t.push(s.column);break}case"function":{const{name:e,args:t}=s,a=t.value.length;r&&(r=function(e,t){const r=h[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,a)),i&&(i=function(e,t){const r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,a));break}}}),{referencedFieldNames:N(t),isStandardized:r,isAggregate:i}}visitAll(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(const r of e.clauses)this.visitAll(r,t);"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(const r of e.value)this.visitAll(r,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":{let t="";if("simple"===e.format){const r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(let i=0;i<e.clauses.length;i++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[i].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+w(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+x(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}evaluateNode(e,t,r){switch(e.type){case"interval":{const i=this.evaluateNode(e.value,t,r);return c.createFromValueAndQualifer(i,e.qualifier,e.op)}case"case_expression":if("simple"===e.format){const i=C(this.evaluateNode(e.operand,t,r));for(let s=0;s<e.clauses.length;s++)if(i===C(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(let i=0;i<e.clauses.length;i++)if(S(this.evaluateNode(e.clauses[i].operand,t,r)))return this.evaluateNode(e.clauses[i].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":{const i=[];for(const s of e.value)i.push(this.evaluateNode(s,t,r));return i}case"unary_expr":return T(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return F(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return E(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":{const i=I(this.evaluateNode(e.right,t,r));return M(this.evaluateNode(e.left,t,r),i)}case"NOT IN":{const i=I(this.evaluateNode(e.right,t,r));return T(M(this.evaluateNode(e.left,t,r),i))}case"BETWEEN":{const i=this.evaluateNode(e.left,t,r),s=this.evaluateNode(e.right,t,r);return null==i||null==s[0]||null==s[1]?null:i>=C(s[0])&&i<=C(s[1])}case"NOTBETWEEN":{const i=this.evaluateNode(e.left,t,r),s=this.evaluateNode(e.right,t,r);return null==i||null==s[0]||null==s[1]?null:i<C(s[0])||i>C(s[1])}case"LIKE":return R(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return T(R(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return A(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return D(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}case"null":case"bool":case"string":case"number":return e.value;case"date":return w(e.value);case"timestamp":return x(e.value);case"current_time":{const t=new Date;return"date"===e.mode&&t.setHours(0,0,0,0),t}case"column_ref":return L(t,e.column,this.datefields,r);case"function":{const i=this.evaluateNode(e.args,t,r);return this.isAggregate?function(e,t){const r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)}(e.name,i):u(e.name,i)}}throw new Error("Unsupported sql syntax "+e.type)}}function x(e){let t=b.exec(e);if(null!==t){const[,e,r,i,s,n,a]=t;return _(e,r,i,s,n,a)}if(t=y.exec(e),null!==t){const[,e,r,i,s,n,a,o,l,c]=t;return _(e,r,i,s,n,a,o,l,c)}if(t=m.exec(e),null!==t){const[,e,r,i,s,n,a,o,l]=t;return _(e,r,i,s,n,"0",a,o,l)}if(t=g.exec(e),null!==t){const[,e,r,i,s,n]=t;return _(e,r,i,s,n)}if(t=f.exec(e),null!==t){const[,e,r,i]=t;return _(e,r,i)}throw new Error("SQL Invalid Timestamp")}function w(e){const t=f.exec(e);if(null===t)throw new Error("SQL Invalid Date");const[,r,i,s]=t;return new Date(parseInt(r,10),parseInt(i,10)-1,parseInt(s,10))}function S(e){return!0===e}function I(e){return Array.isArray(e)?e:[e]}function T(e){return null!==e?!0!==e:null}function F(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function E(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function M(e,t){if(null==e)return null;let r=!1;for(const i of t)if(null==i)r=null;else if(e===i){r=!0;break}return r}function R(e,t,r){if(null==e)return null;const i=t,s=r;let n="";const a="-[]/{}()*+?.\\^$|";let o=0;for(let e=0;e<i.length;e++){const t=i.charAt(e);switch(o){case 0:t===s?o=1:a.indexOf(t)>=0?n+="\\"+t:n+="%"===t?".*":"_"===t?".":t;break;case 1:a.indexOf(t)>=0?n+="\\"+t:n+=t,o=0}}return new RegExp("^"+n+"$").test(e)}function C(e){return e instanceof Date?e.valueOf():e}function A(e,t,r){if(null==t||null==r)return null;const i=C(t),s=C(r);switch(e){case"<>":return i!==s;case"=":return i===s;case">":return i>s;case"<":return i<s;case">=":return i>=s;case"<=":return i<=s}}function N(e){const t=[],r={};for(const i of e){const e=i.toLowerCase();void 0===r[e]&&(t.push(i),r[e]=1)}return t}function D(e,t,r){if(t instanceof c)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof c)switch(e){case"+":return c.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return c.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof c)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function L(e,t,r,i){const s=i.getAttribute(e,t);return null!=s&&1===r[t]?new Date(s):s}const P={getAttribute(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}}},403:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(5),s=(r(82),r(70)),n=r(50);r(414),r(55),r(66),r(85),r(111);i.a.getLogger("esri.renderers.support.utils");const a={inches:Object(n.a)(1,"meters","inches"),feet:Object(n.a)(1,"meters","feet"),"us-feet":Object(n.a)(1,"meters","us-feet"),yards:Object(n.a)(1,"meters","yards"),miles:Object(n.a)(1,"meters","miles"),"nautical-miles":Object(n.a)(1,"meters","nautical-miles"),millimeters:Object(n.a)(1,"meters","millimeters"),centimeters:Object(n.a)(1,"meters","centimeters"),decimeters:Object(n.a)(1,"meters","decimeters"),meters:Object(n.a)(1,"meters","meters"),kilometers:Object(n.a)(1,"meters","kilometers"),"decimal-degrees":1/Object(n.h)(1,"meters")};Object(s.a)("short-date")},412:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return u})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return c})),r.d(t,"j",(function(){return d}));var i=r(44),s=r(75),n=r(299),a=r(166),o=r(212),l=r(447);const c={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;Object(i.a)(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer(e,t,r,i){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||Object(n.a)(this,"screenSizePerspectiveEnabled",{},i))&&(t[r]=e)}}}}}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},h={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},d={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:s.f}}},p={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},f={value:null,type:l.a,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function b(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const y={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},m={...y,json:{...y.json,origins:{"web-document":{...y.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?Object(a.b)(t.layerDefinition.drawingInfo.transparency):void 0:Object(a.b)(t.drawingInfo.transparency)}}},g={type:o.a,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get(){var e,t;if(!(null==(e=this.layer)?void 0:e.timeInfo))return null;const r=null==(t=this.view)?void 0:t.timeExtent,i=this.layer.timeExtent,s=this.layer.useViewTime?r&&i?r.intersection(i):r||i:i;if(!s||s.isEmpty)return s;const n=this.layer.timeOffset,a=n?s.offset(-n.value,n.unit):s,o=this._get("timeExtent");return a.equals(o)?o:a}}},413:function(e,t,r){"use strict";r.d(t,"a",(function(){return U})),r.d(t,"b",(function(){return X})),r.d(t,"c",(function(){return Q})),r.d(t,"d",(function(){return Y})),r.d(t,"e",(function(){return J})),r.d(t,"f",(function(){return G})),r.d(t,"g",(function(){return q})),r.d(t,"h",(function(){return P})),r.d(t,"i",(function(){return $})),r.d(t,"j",(function(){return W})),r.d(t,"k",(function(){return H})),r.d(t,"l",(function(){return C})),r.d(t,"m",(function(){return v})),r.d(t,"n",(function(){return k})),r.d(t,"o",(function(){return D})),r.d(t,"p",(function(){return ce})),r.d(t,"q",(function(){return te})),r.d(t,"r",(function(){return se})),r.d(t,"s",(function(){return le})),r.d(t,"t",(function(){return K})),r.d(t,"u",(function(){return ee})),r.d(t,"v",(function(){return m})),r.d(t,"w",(function(){return g})),r.d(t,"x",(function(){return ae})),r.d(t,"y",(function(){return ne}));var i=r(5),s=r(14),n=r(59),a=r(529),o=r(558),l=r(418);function c(e,t){return e?t?4:3:t?3:2}const u=i.a.getLogger("esri.tasks.support.optimizedFeatureSet"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},d=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n},p=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2]},f=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+3]},b=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2],e[r+3]=t[i+3]};function y(e,t,r,i){if(e){if(r)return t&&i?b:p;if(t&&i)return f}else if(t&&i)return p;return d}function m({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function g({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function O({scale:e,translate:t},r){return r*e[0]+t[0]}function _({scale:e,translate:t},r){return t[1]-r*e[1]}function v(e,t,r){return e?t?r?F(e):w(e):r?I(e):j(e):null}function j(e){const t=e.coords;return{x:t[0],y:t[1]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function w(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function F(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function M(e,t){return e&&t?E:e?S:t?T:x}function R(e,t,r,i,s){const n=M(r,i);for(const r of t){const{geometry:t,attributes:i}=r;let o;t&&(o=n(new l.a,t)),e.push(new a.a(o,i,null,i[s]))}return e}function C(e,t,r){if(!e)return null;const i=c(t,r),s=[];for(let t=0;t<e.coords.length;t+=i){const r=[];for(let s=0;s<i;s++)r.push(e.coords[t+s]);s.push(r)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function A(e,t,r,i,s){const n=c(r,i);for(const r of t){const t=r.geometry,i=r.attributes;let o;t&&(o=N(new l.a,t,n)),e.push(new a.a(o,i,null,i[s]))}return e}function N(e,t,r=c(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let s=0;for(const e of t.points)for(let t=0;t<r;t++)i[s++]=e[t];return e}function D(e,t,r){if(!e)return null;const i=c(t,r),{coords:s,lengths:n}=e,a=[];let o=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(s[o++]);t.push(e)}a.push(t)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function L(e,t,r,i,s){const n=c(r,i);for(const r of t){const t=r.geometry,i=r.attributes;let o;t&&(o=P(new l.a,t,n)),e.push(new a.a(o,i,null,i[s]))}return e}function P(e,t,r=c(t.hasZ,t.hasM)){const{lengths:i,coords:s}=e;let n=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)s[n++]=t[e];i.push(e.length)}return e}function k(e,t,r){if(!e)return null;const i=c(t,r),{coords:s,lengths:n}=e,a=[];let o=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(s[o++]);t.push(e)}a.push(t)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function z(e,t,r,i,s){for(const n of t){const t=n.geometry,o=n.centroid,c=n.attributes;let u;t&&(u=q(new l.a,t,r,i)),o?e.push(new a.a(u,c,x(new l.a,o),c[s])):e.push(new a.a(u,c,null,c[s]))}return e}function q(e,t,r=t.hasZ,i=t.hasM){return G(e,t.rings,r,i),e}function G(e,t,r,i){const s=c(r,i),{lengths:n,coords:a}=e;let o=0;n.length=a.length=0;for(const e of t){for(const t of e)for(let e=0;e<s;e++)a[o++]=t[e];n.push(e.length)}return e}const V=[],B=[];function U(e,t,r,i,s){V[0]=e;const[n]=Q(B,V,t,r,i,s);return V.length=B.length=0,n}function Q(e,t,r,i,n,o){if(e.length=0,!r){for(const r of t){const t=r.attributes[o];e.push(new a.a(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return R(e,t,i,n,o);case"esriGeometryMultipoint":return A(e,t,i,n,o);case"esriGeometryPolyline":return L(e,t,i,n,o);case"esriGeometryPolygon":return z(e,t,i,n,o);default:u.error("convertToFeatureSet:unknown-geometry",new s.a(`Unable to parse unknown geometry type '${r}'`)),e.length=0}return e}function J(e,t,r,i,n,a){const o=e.length;switch(r){case"esriGeometryPoint":R(e,t,i,n,a);break;case"esriGeometryMultipoint":A(e,t,i,n,a);break;case"esriGeometryPolyline":L(e,t,i,n,a);break;case"esriGeometryPolygon":z(e,t,i,n,a);break;default:u.error("convertToFeatureSet:unknown-geometry",new s.a(`Unable to parse unknown geometry type '${r}'`))}for(let i=0;i<t.length;i++)e[i+o].geometryType=r,e[i+o].insertAfter=t[i].insertAfter,e[i+o].groupId=t[i].groupId;return e}function $(e,t,r,i){B[0]=e,Z(V,B,t,r,i);const s=V[0];return V.length=B.length=0,s}function Y(e,t,r){if(!e)return null;const i=new l.a;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),Object(n.f)(e)?M(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(i,e):Object(n.g)(e)?q(i,e,t,r):Object(n.h)(e)?P(i,e,c(t,r)):Object(n.e)(e)?N(i,e,c(t,r)):void u.error("convertFromGeometry:unknown-geometry",new s.a(`Unable to parse unknown geometry type '${e}'`))}function H(e,t,r,i){const n=e&&("coords"in e?e:e.geometry);if(!n)return null;switch(t){case"esriGeometryPoint":{let e=j;return r&&i?e=F:r?e=w:i&&(e=I),e(n)}case"esriGeometryMultipoint":return C(n,r,i);case"esriGeometryPolyline":return D(n,r,i);case"esriGeometryPolygon":return k(n,r,i);default:return void u.error("convertToGeometry:unknown-geometry",new s.a(`Unable to parse unknown geometry type '${t}'`))}}function Z(e,t,r,i,n){switch(e.length=0,r){case"esriGeometryPoint":return function(e,t,r,i){let s=j;r&&i?s=F:r?s=w:i&&(s=I);for(const r of t){const{geometry:t,attributes:i}=r,n=t?s(t):null;e.push({attributes:i,geometry:n})}return e}(e,t,i,n);case"esriGeometryMultipoint":return function(e,t,r,i){for(const s of t){const{geometry:t,attributes:n}=s;let a;t&&(a=C(t,r,i)),e.push({attributes:n,geometry:a})}return e}(e,t,i,n);case"esriGeometryPolyline":return function(e,t,r,i){for(const s of t){const{geometry:t,attributes:n}=s;let a;t&&(a=D(t,r,i)),e.push({attributes:n,geometry:a})}return e}(e,t,i,n);case"esriGeometryPolygon":return function(e,t,r,i){for(const s of t){const{geometry:t,attributes:n,centroid:a}=s;let o;if(t&&(o=k(t,r,i)),a){const t=j(a);e.push({attributes:n,centroid:t,geometry:o})}else e.push({attributes:n,geometry:o})}return e}(e,t,i,n);default:u.error("convertToFeatureSet:unknown-geometry",new s.a(`Unable to parse unknown geometry type '${r}'`))}return e}function W(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:a,features:o,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,p={features:Z([],o,l,a,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:H(h,d,!1,!1)};return i&&(p.transform=i),c&&(p.exceededTransferLimit=c),n&&(p.hasM=n),a&&(p.hasZ=a),p}function X(e,t){const r=new o.a,{hasM:i,hasZ:n,features:a,objectIdFieldName:l,spatialReference:c,geometryType:h,exceededTransferLimit:d,transform:p}=e;return r.fields=e.fields,r.geometryType=h,r.objectIdFieldName=l||t,r.spatialReference=c,r.objectIdFieldName?(a&&Q(r.features,a,h,n,i,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),i&&(r.hasM=i),n&&(r.hasZ=n),p&&(r.transform=p),r):(u.error(new s.a("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function K(e,t){const{geometryType:r,features:i,hasM:s,hasZ:n}=t;if(!e)return t;for(let t=0;t<i.length;t++){const a=i[t],o=a.weakClone();o.geometry=new l.a,ee(o.geometry,a.geometry,s,n,r,e),a.centroid&&(o.centroid=new l.a,ee(o.centroid,a.centroid,s,n,"esriGeometryPoint",e)),i[t]=o}return t.transform=e,t}function ee(e,t,r,i,s,n,a=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=h[s],{coords:u,lengths:d}=t,p=c(r,i),f=c(r&&a,i&&o),b=y(r,i,a,o);if(!d.length)return b(e.coords,u,0,0,m(n,u[0]),g(n,u[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let O,_,v,j,x=0,w=0,S=w;for(const t of d){if(t<l)continue;let r=0;w=S,v=O=m(n,u[x]),j=_=g(n,u[x+1]),b(e.coords,u,w,x,v,j),r++,x+=p,w+=f;for(let i=1;i<t;i++,x+=p)v=m(n,u[x]),j=g(n,u[x+1]),v===O&&j===_||(b(e.coords,u,w,x,v-O,j-_),w+=f,r++,O=v,_=j);r>=l&&(e.lengths.push(r),S=w)}return e.coords.length=S,e.coords.length?e:null}function te(e,t,r,i,s,n,a=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=h[s],{coords:u,lengths:d}=t,p=c(r,i),f=c(r&&a,i&&o),b=y(r,i,a,o);if(!d.length)return b(e.coords,u,0,0,u[0],u[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let m=0;const g=n*n;for(const t of d){if(t<l){m+=t*p;continue}const r=e.coords.length/f,i=m,s=m+(t-1)*p;b(e.coords,u,e.coords.length,i,u[i],u[i+1]),ie(e.coords,u,p,g,b,i,s),b(e.coords,u,e.coords.length,s,u[s],u[s+1]);const n=e.coords.length/f-r;n>=l?e.lengths.push(n):e.coords.length=r*f,m+=t*p}return e.coords.length?e:null}function re(e,t,r,i){const s=e[t],n=e[t+1],a=e[r],o=e[r+1],l=e[i],c=e[i+1];let u=a,h=o,d=l-u,p=c-h;if(0!==d||0!==p){const e=((s-u)*d+(n-h)*p)/(d*d+p*p);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=p*e)}return d=s-u,p=n-h,d*d+p*p}function ie(e,t,r,i,s,n,a){let o,l=i,c=0;for(let e=n+r;e<a;e+=r)o=re(t,e,n,a),o>l&&(c=e,l=o);l>i&&(c-n>r&&ie(e,t,r,i,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),a-c>r&&ie(e,t,r,i,s,c,a))}function se(e,t,r,i){if(!t||!t.coords||!t.coords.length)return null;const s=c(r,i);let n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=s){const r=e[t],i=e[t+1];n=Math.min(n,r),o=Math.max(o,r),a=Math.min(a,i),l=Math.max(l,i)}}return e[0]=n,e[1]=a,e[2]=o,e[3]=l,e}function ne(e,t,r,i,s){const{coords:n,lengths:a}=t,o=r?i?b:p:i?p:d,l=c(r,i);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return o(e.coords,n,0,0,O(s,n[0]),_(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[u,h]=s.scale;let f=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;let i=O(s,n[f]),c=_(s,n[f+1]);o(e.coords,n,f,f,i,c),f+=l;for(let t=1;t<r;t++,f+=l)i+=n[f]*u,c-=n[f+1]*h,o(e.coords,n,f,f,i,c)}return e!==t&&(e.lengths.length=a.length,e.coords.length=n.length),e}function ae(e,t,r,i,s,n){const a=c(r,i),o=y(r,i,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let t=0;t<l.length;t+=a)o(e.coords,l,e.coords.length,t,l[t],l[t+1]);return e}function oe(e,t,r,i){let s=0,n=e[i*t],a=e[i*(t+1)];for(let o=1;o<r;o++){const r=n+e[i*(t+o)],l=a+e[i*(t+o)+1],c=(r-n)*(l+a);n=r,a=l,s+=c}return.5*s}function le(e,t){const{coords:r,lengths:i}=e;let s=0,n=0;for(let e=0;e<i.length;e++)n+=oe(r,s,i[e],t),s+=e;return Math.abs(n)}function ce(e,t){const r=e.clone(),i=e.coords,s=e.lengths;let n=0;for(let e=0;e<s.length;e++){const a=s[e];let o=i[t*n],l=i[t*n+1];for(let e=1;e<a;e++){const s=o+i[t*(n+e)],a=l+i[t*(n+e)+1];r.coords[t*(n+e)]=s,r.coords[t*(n+e)+1]=a,o=s,l=a}n+=a}return r}},414:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(5),r(6)),a=r(1),o=r(2),l=r(22),c=(r(3),r(10),r(11),r(15)),u=r(35);let h=i=class extends c.a{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=null==e?0:e}clone(){return new i({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};Object(s.a)([Object(a.b)({type:u.a,json:{type:[n.a],write:!0}})],h.prototype,"color",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],h.prototype,"label",void 0),Object(s.a)([Object(a.b)({type:Number,json:{write:{allowNull:!0}}})],h.prototype,"value",void 0),Object(s.a)([Object(l.a)("value")],h.prototype,"writeValue",null),h=i=Object(s.a)([Object(o.a)("esri.renderers.visualVariables.support.ColorStop")],h);var d=h;t.a=d},416:function(e,t,r){"use strict";function i(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function s(e){return null!=e&&!isNaN(e)&&isFinite(e)}function n(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function a(e,t){const r=t||n(e),i=e.valueUnit||"unknown";return"unknown"===r?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===i?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return s}))},417:function(e,t,r){"use strict";function i(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function s(e){return e.toLowerCase().trim()}t.a=class{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],!e)return;const t=[];for(const r of e){const e=r&&r.name;if(e){const n=s(e);this._fieldsMap.set(e,r),this._fieldsMap.set(n,r),t.push(n),i(r)&&(this.dateFields.push(r),this._dateFieldsSet.add(r))}}t.sort(),this.uid=t.join(",")}destroy(){this._fieldsMap.clear()}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(s(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}normalizeFieldName(e){const t=this.get(e);if(t)return t.name}}},418:function(e,t,r){"use strict";class i{constructor(e=[],t=[],r=!1){this.lengths=e,this.coords=t,this.hasIndeterminateRingOrder=r}get isPoint(){return 0===this.lengths.length}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}clone(){return new i(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}t.a=i},419:function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return v}));var i=r(0),s=r(44),n=r(2),a=r(145),o=r(18),l=r(299),c=r(8),u=r(306),h=r(12),d=r(82);class p{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.a),this._values=new Map}clone(e){const t=new p,r=this._originStores[0];r&&r.forEach((e,r)=>{t.set(r,Object(h.a)(e),0)});for(let r=2;r<a.a;r++){const i=this._originStores[r];i&&i.forEach((i,s)=>{e&&e.has(s)||t.set(s,Object(h.a)(i),r)})}return t}get(e,t){const r=void 0===t?this._values:this._originStores[t];return r?r.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?Object(d.g)(t):[]}set(e,t,r=6){let i=this._originStores[r];if(i||(i=new Map,this._originStores[r]=i),i.set(e,t),!this._values.has(e)||Object(c.c)(this._propertyOriginMap.get(e))<=r){const i=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,r),i!==t}return!1}delete(e,t=6){const r=this._originStores[t];if(!r)return;const i=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let r=t-1;r>=0;r--){const t=this._originStores[r];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,r);break}}}return i}has(e,t){const r=void 0===t?this._values:this._originStores[t];return!!r&&r.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const r=this._originStores[t],i=r&&r.get(e),s=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,t),s!==i}originOf(e){return this._propertyOriginMap.get(e)||0}forEach(e){this._values.forEach(e)}}var f=p;const b=e=>{let t=class extends e{constructor(...e){super(...e);const t=Object(c.c)(Object(s.a)(this)),r=t.metadatas,i=t.store,n=new f;t.store=n,i.keys().forEach(e=>{n.set(e,i.get(e),0)}),Object.keys(r).forEach(e=>{t.internalGet(e)&&n.set(e,t.internalGet(e),0)})}read(e,t){Object(u.a)(this,e,t)}getAtOrigin(e,t){const r=y(this),i=Object(a.d)(t);if("string"==typeof e)return r.get(e,i);const s={};return e.forEach(e=>{s[e]=r.get(e,i)}),s}originOf(e){return Object(a.b)(this.originIdOf(e))}originIdOf(e){return y(this).originOf(e)}revert(e,t){const r=y(this),i=Object(a.d)(t),n=Object(s.a)(this);let o;o="string"==typeof e?"*"===e?r.keys(i):[e]:e,o.forEach(e=>{n.propertyInvalidated(e),r.revert(e,i),n.propertyCommitted(e)})}};return t=Object(i.a)([Object(n.a)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function y(e){return Object(s.a)(e).store}let m=class extends(b(o.a)){};m=Object(i.a)([Object(n.a)("esri.core.ReadOnlyMultiOriginJSONSupport")],m);const g=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return O(this).delete(e,Object(a.d)(t))}write(e={},t){return Object(l.b)(this,e=e||{},t),e}setAtOrigin(e,t,r){Object(s.a)(this).setAtOrigin(e,t,Object(a.d)(r))}removeOrigin(e){const t=O(this),r=Object(a.d)(e),i=t.keys(r);for(const e of i)t.originOf(e)===r&&t.set(e,t.get(e,r),6)}updateOrigin(e,t){const r=O(this),i=Object(a.d)(t),s=this.get(e);for(let t=i+1;t<a.a;++t)r.delete(e,t);r.set(e,s,i)}toJSON(e){return this.write({},e)}};return t=Object(i.a)([Object(n.a)("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function O(e){return Object(s.a)(e).store}const _=e=>{let t=class extends(g(b(e))){constructor(...e){super(...e)}};return t=Object(i.a)([Object(n.a)("esri.core.MultiOriginJSONSupport")],t),t};let v=class extends(_(o.a)){};v=Object(i.a)([Object(n.a)("esri.core.MultiOriginJSONSupport")],v)},423:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(5),r(6),r(1)),a=r(2),o=(r(3),r(10),r(11),r(15)),l=r(146);let c=i=class extends o.a{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return this.value*l.b[this.unit]}clone(){return new i({value:this.value,unit:this.unit})}};Object(s.a)([Object(n.b)({type:Number,json:{write:!0},nonNullable:!0})],c.prototype,"value",void 0),Object(s.a)([Object(n.b)({type:l.d.apiValues,json:{type:l.d.jsonValues,read:l.d.read,write:l.d.write},nonNullable:!0})],c.prototype,"unit",void 0),c=i=Object(s.a)([Object(a.a)("esri.TimeInterval")],c);var u=c;t.a=u},425:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i=r(0),s=(r(4),r(9),r(5)),n=(r(6),r(1)),a=r(33),o=r(2),l=r(22),c=r(14),u=r(3),h=(r(10),r(7)),d=(r(11),r(100)),p=r(305);const f=s.a.getLogger("esri.layers.mixins.PortalLayer"),b=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]}}destroy(){var e;null==(e=this.portalItem)||e.destroy(),this.portalItem=null}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,r){if(t.itemId)return new p.default({id:t.itemId,portal:r&&r.portal})}writePortalItem(e,t){e&&e.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem&&this.portalItem.id)try{const i=await r.e(82).then(r.bind(null,565));return Object(h.t)(t),await i.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)}catch(e){throw f.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t&&t.portal,i=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||d.a.getDefault());return r&&i&&!Object(u.q)(i.restUrl,r.restUrl)?(t.messages&&t.messages.push(new c.a("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return Object(i.a)([Object(n.b)({type:p.default})],t.prototype,"portalItem",null),Object(i.a)([Object(a.a)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),Object(i.a)([Object(l.a)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),Object(i.a)([Object(n.b)()],t.prototype,"resourceReferences",void 0),t=Object(i.a)([Object(o.a)("esri.layers.mixins.PortalLayer")],t),t}},427:function(e,t,r){"use strict";var i=r(0),s=(r(4),r(9),r(5),r(6),r(1)),n=r(2),a=(r(3),r(10),r(11),r(15));let o=class extends a.a{constructor(){super(...arguments),this.type=null}};Object(i.a)([Object(s.b)({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],o.prototype,"type",void 0),o=Object(i.a)([Object(n.a)("esri.layers.support.FeatureReduction")],o);var l=o;t.a=l},429:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(0),s=(r(4),r(9),r(5),r(6),r(1)),n=r(2),a=r(22),o=r(14),l=(r(3),r(10),r(11),r(306)),c=r(299);const u={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,VectorTileLayer:!0,WMS:!0,KML:!0,RasterDataLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,ArcGISFeatureLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0,CSV:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,VectorTileLayer:!0,WFS:!0,SubtypeGroupLayer:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};var h=r(412);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.title="Layer"}writeListMode(e,t,r,i){(i&&"ground"===i.layerContainerType||e&&Object(c.a)(this,r,{},i))&&(t[r]=e)}writeOperationalLayerType(e,t,r,i){!e||i&&"tables"===i.layerContainerType||(t.layerType=e)}writeTitle(e,t){t.title=e||"Layer"}read(e,t){t&&(t.layer=this),Object(l.b)(this,e,t=>super.read(e,t),t)}write(e,t){if(t&&t.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,r=u[e];let i=r&&r[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(i=!1),!i)return t.messages&&t.messages.push(new o.a("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const r=super.write(e,{...t,layer:this}),i=!!t&&!!t.messages&&!!t.messages.filter(e=>e instanceof o.a&&"web-document-write:property-required"===e.name).length;return!this.url&&i?null:r}beforeSave(){}};return Object(i.a)([Object(s.b)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),Object(i.a)([Object(s.b)({json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}})],t.prototype,"listMode",void 0),Object(i.a)([Object(a.a)("listMode")],t.prototype,"writeListMode",null),Object(i.a)([Object(s.b)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),Object(i.a)([Object(a.a)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),Object(i.a)([Object(s.b)(h.e)],t.prototype,"opacity",void 0),Object(i.a)([Object(s.b)({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,allowNull:!0}},"portal-item":{write:!1}}}})],t.prototype,"title",void 0),Object(i.a)([Object(a.a)("title")],t.prototype,"writeTitle",null),Object(i.a)([Object(s.b)({type:Boolean,json:{name:"visibility",origins:{"web-document":{name:"visibility",default:!0},"portal-item":{name:"visibility",read:{source:["visible","visibility"]}}}}})],t.prototype,"visible",void 0),t=Object(i.a)([Object(n.a)("esri.layers.mixins.OperationalLayer")],t),t}},432:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(12)),a=(r(5),r(6),r(1)),o=r(33),l=r(2),c=r(22),u=(r(3),r(10),r(11),r(15)),h=r(146),d=r(212),p=r(423);let f=i=class extends u.a{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new i({respectsDaylightSaving:e,timezone:t})}};Object(s.a)([Object(a.b)({type:Boolean,json:{write:!0}})],f.prototype,"respectsDaylightSaving",void 0),Object(s.a)([Object(o.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],f.prototype,"readRespectsDaylightSaving",null),Object(s.a)([Object(a.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],f.prototype,"timezone",void 0),f=i=Object(s.a)([Object(l.a)("esri.layers.support.TimeReference")],f);var b,y=f;let m=b=class extends u.a{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const r=new Date(t.timeExtent[0]),i=new Date(t.timeExtent[1]);return new d.a({start:r,end:i})}writeFullTimeExtent(e,t){e&&e.start&&e.end?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new p.a({value:t.timeInterval,unit:h.d.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new p.a({value:t.defaultTimeInterval,unit:h.d.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:r,interval:i,startField:s,timeReference:a,fullTimeExtent:o,trackIdField:l,useTime:c}=this;return new b({cumulative:e,endField:t,hasLiveData:r,interval:i,startField:s,timeReference:Object(n.a)(a),fullTimeExtent:Object(n.a)(o),trackIdField:l,useTime:c})}};Object(s.a)([Object(a.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],m.prototype,"cumulative",void 0),Object(s.a)([Object(a.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],m.prototype,"endField",void 0),Object(s.a)([Object(a.b)({type:d.a,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"fullTimeExtent",void 0),Object(s.a)([Object(o.a)("fullTimeExtent",["timeExtent"])],m.prototype,"readFullTimeExtent",null),Object(s.a)([Object(c.a)("fullTimeExtent")],m.prototype,"writeFullTimeExtent",null),Object(s.a)([Object(a.b)({type:Boolean,json:{write:!0}})],m.prototype,"hasLiveData",void 0),Object(s.a)([Object(a.b)({type:p.a,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"interval",void 0),Object(s.a)([Object(o.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],m.prototype,"readInterval",null),Object(s.a)([Object(c.a)("interval")],m.prototype,"writeInterval",null),Object(s.a)([Object(a.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],m.prototype,"startField",void 0),Object(s.a)([Object(a.b)({type:y,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"timeReference",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],m.prototype,"trackIdField",void 0),Object(s.a)([Object(a.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],m.prototype,"useTime",void 0),m=b=Object(s.a)([Object(l.a)("esri.layers.support.TimeInfo")],m);var g=m;t.a=g},434:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(12)),a=(r(5),r(6),r(1)),o=r(32),l=r(33),c=r(2),u=r(22),h=(r(3),r(10),r(11),r(15)),d=r(214),p=r(592);let f=i=class extends h.a{constructor(){super(...arguments),this.value=null,this.expression=null}readExpression(e,t){return t.value?Object(p.a)(t.value):e}writeExpression(e,t,r){null!=this.value&&(e=Object(p.a)(this.value)),t[r]=e}clone(){return new i({value:this.value,expression:this.expression})}};Object(s.a)([Object(a.b)({json:{read:!1,write:!1}})],f.prototype,"value",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:{allowNull:!0}}})],f.prototype,"expression",void 0),Object(s.a)([Object(l.a)("expression",["expression","value"])],f.prototype,"readExpression",null),Object(s.a)([Object(u.a)("expression")],f.prototype,"writeExpression",null),f=i=Object(s.a)([Object(c.a)("esri.layers.support.LabelExpressionInfo")],f);var b,y=f,m=r(479);const g=new o.a({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function O(e){return!e||"service"!==e.origin&&!(e.layer&&"map-image"===e.layer.type)}let _=b=class extends h.a{constructor(e){super(e),this.type="label",this.name=null,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.maxScale=0,this.minScale=0,this.symbol=m.a,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;const i=e.split(" ");if(3===i.length)return r(t[i[0]],i[1],i[2]);if(7===i.length){const e=r(t[i[0]],i[1],i[2]),s=i[3],n=r(t[i[4]],i[5],i[6]);switch(s){case"AND":return e&&n;case"OR":return e||n}}return!1}catch(t){console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r,i){if(this.labelExpressionInfo&&(O(i)||i&&"service"===i.origin))if(null!=this.labelExpressionInfo.value)e=Object(p.f)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=Object(p.e)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(null==e&&null!=this.labelExpression&&O(i))e=new y({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(i);s.expression&&(t[r]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return Object(p.b)(this)}getLabelExpressionArcade(){return Object(p.c)(this)}getLabelExpressionSingleField(){return Object(p.d)(this)}hash(){return JSON.stringify(this)}clone(){return new b({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Object(n.a)(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:Object(n.a)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],_.prototype,"name",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],_.prototype,"deconflictionStrategy",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:{allowNull:!0}}})],_.prototype,"labelExpression",void 0),Object(s.a)([Object(l.a)("labelExpression")],_.prototype,"readLabelExpression",null),Object(s.a)([Object(u.a)("labelExpression")],_.prototype,"writeLabelExpression",null),Object(s.a)([Object(a.b)({type:y,json:{write:{overridePolicy:(e,t,r)=>O(r)?{allowNull:!0}:{enabled:!1}}}})],_.prototype,"labelExpressionInfo",void 0),Object(s.a)([Object(u.a)("labelExpressionInfo")],_.prototype,"writeLabelExpressionInfo",null),Object(s.a)([Object(a.b)({type:g.apiValues,json:{type:g.jsonValues,read:g.read,write:g.write}})],_.prototype,"labelPlacement",void 0),Object(s.a)([Object(a.b)({type:Number})],_.prototype,"maxScale",void 0),Object(s.a)([Object(u.a)("maxScale")],_.prototype,"writeMaxScale",null),Object(s.a)([Object(a.b)({type:Number})],_.prototype,"minScale",void 0),Object(s.a)([Object(u.a)("minScale")],_.prototype,"writeMinScale",null),Object(s.a)([Object(a.b)({types:d.d,json:{origins:{"web-scene":{types:d.g,write:d.j,default:null}},write:d.j,default:null}})],_.prototype,"symbol",void 0),Object(s.a)([Object(a.b)({type:Boolean,json:{write:!0}})],_.prototype,"useCodedValues",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],_.prototype,"where",void 0),_=b=Object(s.a)([Object(c.a)("esri.layers.support.LabelClass")],_);var v=_;t.a=v},435:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),s=(r(4),r(9),r(5),r(6),r(1)),n=r(2);r(3),r(10),r(11);const a=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Object(i.a)([Object(s.b)({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{default:"normal",read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),Object(i.a)([Object(s.b)({type:String})],t.prototype,"effect",void 0),t=Object(i.a)([Object(n.a)("esri.layers.mixins.BlendLayer")],t),t}},437:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),s=(r(4),r(9),r(5),r(6),r(1)),n=r(2);r(3),r(10),r(11);const a=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get scaleRangeId(){return`${this.minScale},${this.maxScale}`}};return Object(i.a)([Object(s.b)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),Object(i.a)([Object(s.b)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),Object(i.a)([Object(s.b)({readOnly:!0,dependsOn:["minScale","maxScale"]})],t.prototype,"scaleRangeId",null),t=Object(i.a)([Object(n.a)("esri.layers.mixins.ScaleRangeLayer")],t),t}},438:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return p}));var i=r(49),s=r(8),n=r(5),a=r(35),o=r(94),l=r(416),c=r(403);const u=n.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),h=new o.a,d=Math.PI,p=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function f(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"color"===e.type)[0]:e;if(!i)return;if("esri.renderers.visualVariables.ColorVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n="number"==typeof t,o=n?null:t,l=o&&o.attributes;let c=n?t:null;const h=i.field,{ipData:d,hasExpression:p}=i.cache;let f=i.cache.compiledFunc;if(!h&&!p){const e=i.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(p){if(!Object(s.h)(r)||!Object(s.h)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),a=t.createExecContext(o,n);if(!f){const e=t.createSyntaxTree(i.valueExpression);f=t.createFunction(e),i.cache.compiledFunc=f}c=t.executeFunction(f,a)}else l&&(c=l[h]);const b=i.normalizationField,y=l?parseFloat(l[b]):void 0;if(null!=c&&(!b||n||!isNaN(y)&&0!==y)){isNaN(y)||n||(c/=y);const e=v(c,d);if(e){const t=e[0],n=e[1],o=t===n?i.stops[t].color:a.a.blendColors(i.stops[t].color,i.stops[n].color,e[2],Object(s.h)(r)?r.color:void 0);return new a.a(o)}}}function b(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"opacity"===e.type)[0]:e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n="number"==typeof t,a=n?null:t,o=a&&a.attributes;let l=n?t:null;const c=i.field,{ipData:h,hasExpression:d}=i.cache;let p=i.cache.compiledFunc;if(!c&&!d){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof l)if(d){if(Object(s.g)(r)||Object(s.g)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),o=t.createExecContext(a,n);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}l=t.executeFunction(p,o)}else o&&(l=o[c]);const f=i.normalizationField,b=o?parseFloat(o[f]):void 0;if(null!=l&&(!f||n||!isNaN(b)&&0!==b)){isNaN(b)||n||(l/=b);const e=v(l,h);if(e){const t=e[0],r=e[1];if(t===r)return i.stops[t].opacity;{const s=i.stops[t].opacity;return s+(i.stops[r].opacity-s)*e[2]}}}}function y(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"rotation"===e.type)[0]:e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",a="heading"===n&&"arithmetic"===i.rotationType?90:0,o="heading"===n&&"arithmetic"===i.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,h=i.field,{hasExpression:d}=i.cache;let p=i.cache.compiledFunc,f=0;if(!h&&!d)return f;if(d){if(Object(s.g)(r)||Object(s.g)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),a=t.createExecContext(l,n);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}f=t.executeFunction(p,a)}else c&&(f=c[h]||0);return f="number"!=typeof f||isNaN(f)?null:a+o*f,f}function m(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"size"===e.type)[0]:e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=function(e,t,r,i,n){switch(t.transformationType){case"additive":return function(e,t,r,i){return e+(g(t.minSize,r,i)||t.minDataValue)}(e,t,r,i);case"constant":return function(e,t,r){const i=e.stops;let s=i&&i.length&&i[0].size;return null==s&&(s=e.minSize),g(s,t,r)}(t,r,i);case"clamped-linear":return function(e,t,r,i){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),a=g(t.minSize,r,i),o=g(t.maxSize,r,i),l=Object(s.h)(i)?i.shape:void 0;if(e<=t.minDataValue)return a;if(e>=t.maxDataValue)return o;if("area"===t.scaleBy&&l){const e="circle"===l,t=e?d*Math.pow(a/2,2):a*a,r=t+n*((e?d*Math.pow(o/2,2):o*o)-t);return e?2*Math.sqrt(r/d):Math.sqrt(r)}return a+n*(o-a)}(e,t,r,i);case"proportional":return function(e,t,r,i){const n=Object(s.h)(i)?i.shape:void 0,a=e/t.minDataValue,o=g(t.minSize,r,i),l=g(t.maxSize,r,i);let c=null;return c="circle"===n?2*Math.sqrt(a*Math.pow(o/2,2)):"square"===n||"diamond"===n||"image"===n?Math.sqrt(a*Math.pow(o,2)):a*o,O(c,o,l)}(e,t,r,i);case"stops":return function(e,t,r,i,s){const[n,a,o]=v(e,s);if(n===a)return g(t.stops[n].size,r,i);{const e=g(t.stops[n].size,r,i);return e+(g(t.stops[a].size,r,i)-e)*o}}(e,t,r,i,n);case"real-world-size":return function(e,t,r,i){const n=(Object(s.h)(i)&&i.resolution?i.resolution:1)*c.a[t.valueUnit],a=g(t.minSize,r,i),o=g(t.maxSize,r,i),{valueRepresentation:l}=t;let u=null;return u="area"===l?2*Math.sqrt(e/d)/n:"radius"===l||"distance"===l?2*e/n:e/n,O(u,a,o)}(e,t,r,i);case"identity":return e;case"unknown":return null}}(function(e,t,r){const i="number"==typeof t,n=i?null:t,a=n&&n.attributes;let o=i?t:null;const{isScaleDriven:c}=e.cache;let h=e.cache.compiledFunc;if(c){const t=Object(s.h)(r)?r.scale:void 0,i=Object(s.h)(r)?r.view:void 0;o=null==t||i&&"3d"===i.type?function(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!i)switch(e.inputValueType){case"expression":{if(Object(s.g)(r)||Object(s.g)(r.arcade))return void u.error("Use of arcade expressions requires an arcade context");const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,a=i.getViewInfo(t),l=i.createExecContext(n,a);if(!h){const t=i.createSyntaxTree(e.valueExpression);h=i.createFunction(t),e.cache.compiledFunc=h}o=i.executeFunction(h,l);break}case"field":a&&(o=a[e.field]);break;case"unknown":o=null}if(!Object(l.d)(o))return null;if(i||!e.normalizationField)return o;const d=a?parseFloat(a[e.normalizationField]):null;return Object(l.d)(d)&&0!==d?o/d:null}(i,t,r),i,t,r,i.cache.ipData);return null==n||isNaN(n)?0:n}function g(e,t,r){return null==e?null:Object(l.c)(e)?m(e,t,r):Object(l.d)(e)?e:null}function O(e,t,r){return Object(l.d)(r)&&e>r?r:Object(l.d)(t)&&e<t?t:e}function _(e,t,r){const{isScaleDriven:i}=e.cache,s=r&&"3d"===r.type;if(!(i&&s||t))return null;const n={scale:t,view:r};let a=g(e.minSize,h,n),o=g(e.maxSize,h,n);if(null!=a||null!=o){if(a>o){const e=o;o=a,a=e}return{minSize:a,maxSize:o}}}function v(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((t,s)=>e<t?(i=s,!0):(r=s,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}function j(e,t,r){const s=["proportional","proportional","proportional"];for(const n of e){const e=n.useSymbolValue?"symbol-value":m(n,t,r);switch(n.axis){case"width":s[0]=e;break;case"depth":s[1]=e;break;case"height":s[2]=e;break;case"width-and-depth":s[0]=e,s[1]=e;break;case"all":case void 0:case null:s[0]=e,s[1]=e,s[2]=e;break;default:Object(i.a)(n.axis)}}return s}},442:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return _}));var i=r(14),s=r(7),n=r(34),a=r(30),o=r(461),l=r(262);const c=[0,0];function u(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,c),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,c),[r.xmax,r.ymax]=e(t.xmax,t.ymax,c),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:h(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:d(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function h(e,t){const r=[];for(const i of e)r.push(d(i,t));return r}function d(e,t){const r=[];for(const i of e){const e=t(i[0],i[1],[0,0]);r.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return r}function p(e,t){return!b(e,t)||Object(l.b)()}async function f(e,t){if(t)if(Array.isArray(e)){for(const r of e)if(b(r.geometry&&r.geometry.spatialReference,t)){if(Object(l.b)())return Object(l.c)();throw new i.a("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}}else if(b(e,t)){if(Object(l.b)())return Object(l.c)();throw new i.a("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}}function b(e,t){return!(!Object(n.f)(e)||!Object(n.f)(t)||Object(n.c)(e,t)||Object(a.a)(e,t))}const y=u.bind(null,a.c),m=u.bind(null,a.f);function g(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(n.f)(t)&&Object(n.f)(r)&&!Object(n.c)(t,r)?Object(a.a)(t,r)?Object(n.h)(r)?y(e):m(e):Object(l.e)(o.a,[e],t,r,null)[0]:e):e}const O=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,r){!e||!e.length||!t||!r||Object(n.c)(t,r);const i={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return this._jobs.push(i),Object(s.f)(e=>{i.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:s}=e;Object(a.a)(r,i)?Object(n.h)(i)?s(t.map(y)):s(t.map(m)):s(Object(l.e)(o.a,t,r,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function _(e,t,r){return O.push(e,t,r)}},444:function(e,t,r){"use strict";var i=r(0),s=(r(4),r(9),r(12)),n=(r(5),r(6),r(1)),a=r(32),o=r(2),l=r(22),c=(r(3),r(10),r(11),r(15));const u=new a.a({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let h=class extends c.a{constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}writeDrawingTool(e,t){t.drawingTool=u.toJSON(e)}writePrototype(e,t){t.prototype=Object(s.c)(Object(s.a)(e),!0)}writeThumbnail(e,t){t.thumbnail=Object(s.c)(Object(s.a)(e))}};Object(i.a)([Object(n.b)({json:{write:!0}})],h.prototype,"name",void 0),Object(i.a)([Object(n.b)({json:{write:!0}})],h.prototype,"description",void 0),Object(i.a)([Object(n.b)({json:{read:u.read,write:u.write}})],h.prototype,"drawingTool",void 0),Object(i.a)([Object(l.a)("drawingTool")],h.prototype,"writeDrawingTool",null),Object(i.a)([Object(n.b)({json:{write:!0}})],h.prototype,"prototype",void 0),Object(i.a)([Object(l.a)("prototype")],h.prototype,"writePrototype",null),Object(i.a)([Object(n.b)({json:{write:!0}})],h.prototype,"thumbnail",void 0),Object(i.a)([Object(l.a)("thumbnail")],h.prototype,"writeThumbnail",null),h=Object(i.a)([Object(o.a)("esri.layers.support.FeatureTemplate")],h);var d=h;t.a=d},447:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(8)),a=(r(5),r(6),r(1)),o=r(32),l=r(33),c=r(2),u=r(22),h=(r(3),r(10),r(11),r(15)),d=r(144);let p=i=class extends h.a{async collectRequiredFields(e,t){return Object(d.a)(e,t,this.expression)}clone(){return new i({expression:this.expression,title:this.title})}};Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],p.prototype,"expression",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],p.prototype,"title",void 0),p=i=Object(s.a)([Object(c.a)("esri.layers.support.FeatureExpressionInfo")],p);var f=p,b=r(403);const y=function(){const e=Object.keys(b.a);return e.sort(),e}();var m;const g=Object(o.b)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),O=new o.a({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let _=m=class extends h.a{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write(null,i),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){return this._isOverridden("mode")?this._get("mode"):Object(n.h)(this.offset)||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};Object(s.a)([Object(a.b)({type:f,json:{write:!0}})],_.prototype,"featureExpressionInfo",void 0),Object(s.a)([Object(l.a)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],_.prototype,"readFeatureExpressionInfo",null),Object(s.a)([Object(u.a)("featureExpressionInfo",{featureExpressionInfo:{type:f},"featureExpression.value":{type:[0]}})],_.prototype,"writeFeatureExpressionInfo",null),Object(s.a)([Object(a.b)({type:g.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:g.jsonValues,read:g.read,write:{writer:g.write,isRequired:!0}}})],_.prototype,"mode",null),Object(s.a)([Object(a.b)({type:Number,json:{write:!0}})],_.prototype,"offset",void 0),Object(s.a)([Object(a.b)({type:y,json:{type:String,read:O.read,write:O.write}})],_.prototype,"unit",null),_=m=Object(s.a)([Object(c.a)("esri.layers.support.ElevationInfo")],_);var v=_;t.a=v},449:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(5),r(6),r(1)),a=r(2),o=(r(3),r(10),r(11),r(427));let l=i=class extends o.a{constructor(e){super(e),this.type="selection"}clone(){return new i}};Object(s.a)([Object(n.b)({type:["selection"]})],l.prototype,"type",void 0),l=i=Object(s.a)([Object(a.a)("esri.layers.support.FeatureReductionSelection")],l);var c=l;t.a=c},454:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(12)),a=(r(5),r(6),r(1)),o=r(2),l=(r(3),r(10),r(11),r(15)),c=r(300),u=r(23),h=r(412);let d=i=class extends l.a{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new i({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],d.prototype,"statisticType",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],d.prototype,"onStatisticField",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],d.prototype,"onStatisticValueExpression",void 0),d=i=Object(s.a)([Object(o.a)("esri.layers.support.OutStatistic")],d);var p,f=d;let b=p=class extends l.a{constructor(){super(...arguments),this.name=null}clone(){return new p({name:this.name,outStatistic:this.outStatistic.clone()})}};Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],b.prototype,"name",void 0),Object(s.a)([Object(a.b)({type:f,json:{write:!0}})],b.prototype,"outStatistic",void 0),b=p=Object(s.a)([Object(o.a)("esri.layers.support.AggregateField")],b);var y,m=b,g=r(434);let O=y=class extends l.a{constructor(e){super(e),this.type="cluster",this.clusterRadius=Object(u.j)("80px"),this.clusterMinSize=Object(u.j)("12px"),this.clusterMaxSize=Object(u.j)("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new y({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Object(n.a)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Object(n.a)(this.fields),popupEnabled:this.popupEnabled,popupTemplate:Object(n.a)(this.popupTemplate)})}};Object(s.a)([Object(a.b)({type:["cluster"],readOnly:!0,json:{write:!0}})],O.prototype,"type",void 0),Object(s.a)([Object(a.b)({type:Number,cast:e=>"auto"===e?e:Object(u.j)(e),json:{write:!0}})],O.prototype,"clusterRadius",void 0),Object(s.a)([Object(a.b)({type:Number,cast:u.j,json:{write:!0}})],O.prototype,"clusterMinSize",void 0),Object(s.a)([Object(a.b)({type:Number,cast:u.j,json:{write:!0}})],O.prototype,"clusterMaxSize",void 0),Object(s.a)([Object(a.b)(h.g)],O.prototype,"popupEnabled",void 0),Object(s.a)([Object(a.b)({type:c.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],O.prototype,"popupTemplate",void 0),Object(s.a)([Object(a.b)({type:[g.a],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],O.prototype,"labelingInfo",void 0),Object(s.a)([Object(a.b)(h.c)],O.prototype,"labelsVisible",void 0),Object(s.a)([Object(a.b)({type:[m],json:{write:!0}})],O.prototype,"fields",void 0),O=y=Object(s.a)([Object(o.a)("esri.layers.support.FeatureReductionCluster")],O);var _=O;t.a=_},456:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(0),s=(r(4),r(9),r(5),r(6),r(1)),n=r(2);r(3),r(10),r(11);const a=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshInterval=0}refresh(){this.emit("refresh")}};return Object(i.a)([Object(s.b)({type:Number,cast:e=>e>=.1?e:e<=0?0:.1,json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),t=Object(i.a)([Object(n.a)("esri.layers.mixins.RefreshableLayer")],t),t}},457:function(e,t,r){"use strict";r.r(t);var i,s=r(0),n=r(4),a=(r(9),r(52)),o=r(8),l=r(5),c=r(1),u=r(38),h=r(32),d=r(33),p=r(149),f=r(2),b=r(22),y=r(14),m=r(3),g=(r(10),r(7)),O=r(65),_=(r(11),r(28)),v=r(36),j=r(21),x=r(144),w=r(300),S=r(214),I=r(43),T=r(215),F=r(419),E=r(302),M=r(150),R=(r(424),r(475),r(484)),C=(r(476),r(486),r(487),r(477)),A=r(485),N=r(510),D=r(417),L=r(12),P=r(15),k=r(6);let z=i=class extends P.a{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new i({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],z.prototype,"expression",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],z.prototype,"name",void 0),Object(s.a)([Object(c.b)({type:["boolean"],json:{write:!0}})],z.prototype,"returnType",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],z.prototype,"title",void 0),z=i=Object(s.a)([Object(f.a)("esri.form.ExpressionInfo")],z);var q=z;const G=e=>{let t=class extends e{constructor(){super(...arguments),this.description=null,this.label=null,this.visibilityExpression=null}};return Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],t.prototype,"description",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],t.prototype,"label",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],t.prototype,"visibilityExpression",void 0),t=Object(s.a)([Object(f.a)("esri.form.elements.ElementMixin")],t),t};let V=class extends(G(P.a)){constructor(e){super(e),this.type=null}};var B;Object(s.a)([Object(c.b)()],V.prototype,"type",void 0),V=Object(s.a)([Object(f.a)("esri.form.elements.Element")],V);let U=B=class extends P.a{constructor(e){super(e),this.type=null}clone(){return new B({type:this.type})}};Object(s.a)([Object(c.b)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],U.prototype,"type",void 0),U=B=Object(s.a)([Object(f.a)("esri.form.elements.inputs.AttachmentInput")],U);var Q,J=U;let $=Q=class extends V{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new Q({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],$.prototype,"attachmentKeyword",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{default:!0,write:!0}})],$.prototype,"editable",void 0),Object(s.a)([Object(c.b)({type:J,json:{read:{source:"inputType"},write:{target:"inputType"}}})],$.prototype,"input",void 0),Object(s.a)([Object(c.b)({type:["attachment"],json:{read:!1,write:!0}})],$.prototype,"type",void 0),$=Q=Object(s.a)([Object(f.a)("esri.form.elements.AttachmentElement")],$);var Y=$,H=r(134);let Z=class extends P.a{constructor(e){super(e),this.type=null}};Object(s.a)([Object(c.b)()],Z.prototype,"type",void 0),Z=Object(s.a)([Object(f.a)("esri.form.elements.inputs.Input")],Z);var W,X=Z;let K=W=class extends X{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new W}};Object(s.a)([Object(c.b)({type:["barcode-scanner"],json:{read:!1,write:!0}})],K.prototype,"type",void 0),K=W=Object(s.a)([Object(f.a)("esri.form.elements.inputs.BarcodeScannerInput")],K);var ee,te=K;let re=ee=class extends X{constructor(e){super(e),this.type="combo-box"}clone(){return new ee}};Object(s.a)([Object(c.b)({type:["combo-box"],json:{read:!1,write:!0}})],re.prototype,"type",void 0),re=ee=Object(s.a)([Object(f.a)("esri.form.elements.inputs.ComboBoxInput")],re);var ie,se=re;function ne(e){return null!=e?new Date(e):null}function ae(e){return e?e.getTime():null}let oe=ie=class extends X{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return ne(t.max)}writeMax(e,t){t.max=ae(e)}readMin(e,t){return ne(t.min)}writeMin(e,t){t.min=ae(e)}clone(){return new ie({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};Object(s.a)([Object(c.b)({type:Boolean,json:{write:!0,default:!1}})],oe.prototype,"includeTime",void 0),Object(s.a)([Object(c.b)({type:Date,json:{type:Number,write:!0}})],oe.prototype,"max",void 0),Object(s.a)([Object(d.a)("max")],oe.prototype,"readMax",null),Object(s.a)([Object(b.a)("max")],oe.prototype,"writeMax",null),Object(s.a)([Object(c.b)({type:Date,json:{type:Number,write:!0}})],oe.prototype,"min",void 0),Object(s.a)([Object(d.a)("min")],oe.prototype,"readMin",null),Object(s.a)([Object(b.a)("min")],oe.prototype,"writeMin",null),Object(s.a)([Object(c.b)({type:["datetime-picker"],json:{read:!1,write:!0}})],oe.prototype,"type",void 0),oe=ie=Object(s.a)([Object(f.a)("esri.form.elements.inputs.DateTimePickerInput")],oe);var le,ce=oe;let ue=le=class extends X{constructor(e){super(e),this.type="radio-buttons"}clone(){return new le}};Object(s.a)([Object(c.b)({type:["radio-buttons"],json:{read:!1,write:!0}})],ue.prototype,"type",void 0),ue=le=Object(s.a)([Object(f.a)("esri.form.elements.inputs.RadioButtonsInput")],ue);var he,de=ue;let pe=he=class extends X{constructor(e){super(e),this.maxLength=null,this.minLength=0,this.type=null}clone(){return new he({maxLength:this.maxLength,minLength:this.minLength,type:this.type})}};Object(s.a)([Object(c.b)({type:Number,json:{write:!0}})],pe.prototype,"maxLength",void 0),Object(s.a)([Object(c.b)({type:Number,json:{default:0,write:!0}})],pe.prototype,"minLength",void 0),Object(s.a)([Object(c.b)()],pe.prototype,"type",void 0),pe=he=Object(s.a)([Object(f.a)("esri.form.elements.inputs.support.TextInput")],pe);var fe=pe;let be=class extends fe{constructor(e){super(e),this.type="text-area"}};Object(s.a)([Object(c.b)({type:["text-area"],json:{read:!1,write:!0}})],be.prototype,"type",void 0),be=Object(s.a)([Object(f.a)("esri.form.elements.inputs.TextAreaInput")],be);var ye=be;let me=class extends fe{constructor(e){super(e),this.type="text-box"}};Object(s.a)([Object(c.b)({type:["text-box"],json:{read:!1,write:!0}})],me.prototype,"type",void 0),me=Object(s.a)([Object(f.a)("esri.form.elements.inputs.TextBoxInput")],me);const ge={base:X,key:"type",typeMap:{"barcode-scanner":te,"combo-box":se,"datetime-picker":ce,"radio-buttons":de,"text-area":ye,"text-box":me}};var Oe;let _e=Oe=class extends V{constructor(e){super(e),this.domain=null,this.editable=!0,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field"}clone(){return new Oe({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({types:H.d,json:{read:{reader:H.b},write:!0}})],_e.prototype,"domain",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{default:!0,write:!0}})],_e.prototype,"editable",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],_e.prototype,"fieldName",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],_e.prototype,"hint",void 0),Object(s.a)([Object(c.b)({types:ge,json:{read:{source:"inputType"},write:{target:"inputType"}}})],_e.prototype,"input",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],_e.prototype,"requiredExpression",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:!1,write:!0}})],_e.prototype,"type",void 0),_e=Oe=Object(s.a)([Object(f.a)("esri.form.elements.FieldElement")],_e);var ve,je=_e,xe=r(308);let we=ve=class extends V{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new ve({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Object(L.a)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({type:Number,json:{write:!0}})],we.prototype,"displayCount",void 0),Object(s.a)([Object(c.b)({type:["list"],json:{write:!0}})],we.prototype,"displayType",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{default:!0,write:!0}})],we.prototype,"editable",void 0),Object(s.a)([Object(c.b)({type:[xe.a],json:{write:!0}})],we.prototype,"orderByFields",void 0),Object(s.a)([Object(c.b)({type:Number,json:{write:!0}})],we.prototype,"relationshipId",void 0),Object(s.a)([Object(c.b)({type:["relationship"],json:{read:!1,write:!0}})],we.prototype,"type",void 0),we=ve=Object(s.a)([Object(f.a)("esri.form.elements.RelationshipElement")],we);var Se,Ie=we;function Te(e){return{typesWithGroup:{base:V,key:"type",typeMap:{attachment:Y,field:je,group:e,relationship:Ie}},typesWithoutGroup:{base:V,key:"type",typeMap:{attachment:Y,field:je,relationship:Ie}}}}function Fe(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(e=>i[e.type]).map(e=>i[e.type].fromJSON(e))}function Ee(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(e=>i[e.type]).map(e=>e.toJSON())}function Me(e,t,r=!0){return e?e.map(e=>Object(k.k)(r?t.typesWithGroup:t.typesWithoutGroup,e)):null}let Re=Se=class extends V{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Me(e,Ce,!1)}readElements(e,t){return Fe(t.formElements,Ce,!1)}writeElements(e,t){t.formElements=Ee(e,Ce,!1)}clone(){return new Se({description:this.description,elements:Object(L.a)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};Object(s.a)([Object(c.b)({json:{write:!0}})],Re.prototype,"elements",void 0),Object(s.a)([Object(u.a)("elements")],Re.prototype,"castElements",null),Object(s.a)([Object(d.a)("elements",["formElements"])],Re.prototype,"readElements",null),Object(s.a)([Object(b.a)("elements")],Re.prototype,"writeElements",null),Object(s.a)([Object(c.b)({type:["collapsed","expanded"],json:{default:"expanded",write:!0}})],Re.prototype,"initialState",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:!1,write:!0}})],Re.prototype,"type",void 0),Re=Se=Object(s.a)([Object(f.a)("esri.form.elements.GroupElement")],Re);const Ce=Te(Re);var Ae;const Ne=Te(Re);let De=Ae=class extends P.a{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Me(e,Ne)}readElements(e,t){return Fe(t.formElements,Ne)}writeElements(e,t){t.formElements=Ee(e,Ne)}clone(){return new Ae({description:this.description,expressionInfos:Object(L.a)(this.expressionInfos),elements:Object(L.a)(this.elements),title:this.title})}};Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],De.prototype,"description",void 0),Object(s.a)([Object(c.b)({json:{write:!0}})],De.prototype,"elements",void 0),Object(s.a)([Object(u.a)("elements")],De.prototype,"castElements",null),Object(s.a)([Object(d.a)("elements",["formElements"])],De.prototype,"readElements",null),Object(s.a)([Object(b.a)("elements")],De.prototype,"writeElements",null),Object(s.a)([Object(c.b)({type:[q],json:{write:!0}})],De.prototype,"expressionInfos",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],De.prototype,"title",void 0),De=Ae=Object(s.a)([Object(f.a)("esri.form.FormTemplate")],De);var Le=De,Pe=r(261);var ke=r(95),ze=r(167),qe=(r(54),r(133)),Ge=r(86),Ve=r(94),Be=r(307),Ue=r(221),Qe=r(310);let Je=0;const $e=l.a.getLogger("esri.layers.graphics.sources.MemorySource");let Ye=class extends(Ge.a.LoadableMixin(Object(qe.b)(j.a))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=Object(o.h)(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Object(g.r)(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}get workerGeometryType(){const e=this.layer&&this.layer.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);Object(Qe.a)(e,this.layer.spatialReference,r);const i=Pe.default.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const s=this.layer.objectIdField;for(const e of i.features){const t=e.attributes[s],r=this._idToClientGraphic.get(t);r&&(e.geometry=r.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())return Object(g.h)(new y.a("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)"));await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return Object(Qe.a)(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(e=>({count:e.count,extent:v.a.fromJSON(e.extent)}))}_applyEdits(e){if(!this._connection)throw new y.a("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],s=[],n=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const t of e.deleteFeatures){const e=n(t);null!=e&&i.push(e)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const t of e.updateFeatures)if(s.push(this._serializeFeature(t)),a){const e=n(t);null!=e&&a.set(e,t)}return Object(Ue.b)(r?r.features:null,s,this.layer.spatialReference),this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:i}).then(({fullExtent:e,featureEditResults:t})=>{if(this.fullExtent=e,r&&r.finish(t.uidToObjectId),this._idToClientGraphic){if(a)for(const e of t.updateResults){if(!e.success)continue;const t=a.get(e.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}return this._createEditsResult(t)})}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new y.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let s=0;s<e.length;s++){const n=e[s],a=this._serializeFeature(n);!i&&Object(o.h)(n.geometry)&&(i=n.geometry.type),r[s]=a,t.set(""+a.uid,n)}const s=this;return{features:r,inferredGeometryType:i,finish(e){const r=s.sourceJSON.objectIdField;for(const i in e){const n=e[i],a=t.get(i);a&&(a.attributes||(a.attributes={}),-1===n?delete a.attributes[r]:a.attributes[r]=n,s._addIdToClientGraphic(a))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];null!=r&&this._idToClientGraphic.set(r,e)}_requiresClientGraphicMapping(){const e=this.layer.geometryType||this.sourceJSON.geometryType;return this._geometryTypeRequiresClientGraphicMapping(e)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=(Je++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return Object(o.g)(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?ke.a.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Object(Be.b)("MemorySourceWorker",{strategy:Object(n.a)("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,objectIdField:i,hasM:s,hasZ:a,timeInfo:o}=this.layer,l="defaults"===this.layer.originOf("spatialReference"),c=this._prepareAddFeatures(this.items);this.on("before-changes",e=>{$e.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()});const u={features:c.features,fields:t&&t.map(e=>e.toJSON()),geometryType:ze.c.toJSON(this.workerGeometryType),hasM:s,hasZ:a,objectIdField:i,spatialReference:l?null:r&&r.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",u,{signal:e});for(const e of h.warnings)$e.warn(e.message,{layer:this.layer,warning:e});h.featureErrors.length&&$e.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const d=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(d.geometryType=ze.c.toJSON(c.inferredGeometryType)),"mesh"!==d.geometryType&&"mesh"!==this.layer.geometryType||(d.hasZ=!0),this.sourceJSON=d,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(h.assignedObjectIds)}};var He;Object(s.a)([(He={Type:Ve.a,ensureType:Object(k.m)(Ve.a)},(e,t)=>{e[t]=He})],Ye.prototype,"itemType",void 0),Object(s.a)([Object(c.b)()],Ye.prototype,"type",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],Ye.prototype,"layer",void 0),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["layer.geometryType"]})],Ye.prototype,"workerGeometryType",null),Object(s.a)([Object(c.b)()],Ye.prototype,"sourceJSON",void 0),Ye=Object(s.a)([Object(f.a)("esri.layers.graphics.sources.MemorySource")],Ye);var Ze,We=Ye,Xe=r(462),Ke=r(435),et=r(412),tt=r(429),rt=r(425),it=r(456),st=r(437),nt=r(432),at=r(459);let ot=Ze=class extends P.a{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:r,isUnique:i,description:s}=this;return new Ze({name:e,fields:t,isAscending:r,isUnique:i,description:s})}};Object(s.a)([Object(c.b)({constructOnly:!0})],ot.prototype,"name",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],ot.prototype,"fields",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],ot.prototype,"isAscending",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],ot.prototype,"isUnique",void 0),Object(s.a)([Object(c.b)({constructOnly:!0})],ot.prototype,"description",void 0),ot=Ze=Object(s.a)([Object(f.a)("esri.layers.support.FeatureIndex")],ot);var lt=r(427),ct=r(434),ut=r(454),ht=r(449),dt=r(523),pt=r(444),ft=r(478),bt=r(511),yt=r(516);const mt=new h.a({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),gt=new h.a({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Ot=class extends P.a{constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};Object(s.a)([Object(c.b)({json:{read:mt.read,write:mt.write}})],Ot.prototype,"cardinality",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"composite",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"id",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"keyField",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"keyFieldInRelationshipTable",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"name",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"relatedTableId",void 0),Object(s.a)([Object(c.b)({json:{read:!0,write:!0}})],Ot.prototype,"relationshipTableId",void 0),Object(s.a)([Object(c.b)({json:{read:gt.read,write:gt.write}})],Ot.prototype,"role",void 0),Ot=Object(s.a)([Object(f.a)("esri.layers.support.Relationship")],Ot);var _t=Ot,vt=r(151),jt=r(469),xt=r(526),wt=r(189),St=r(183),It=r(263);const Tt=new h.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Ft={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Et="FeatureLayer",Mt=l.a.getLogger("esri.layers.FeatureLayer");function Rt(e){return e&&e instanceof j.a}function Ct(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function At(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}const Nt=Object(bt.a)();let Dt=class extends(Object(Ke.a)(Object(at.a)(Object(st.a)(Object(it.a)(Object(Xe.a)(Object(tt.a)(Object(rt.a)(Object(F.a)(T.a))))))))){constructor(...e){super(...e),this._handles=new I.a,this.capabilities=null,this.copyright=null,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingEnabled=!0,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryProperties=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=_.a.WGS84,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(j.a.ofType(ot)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;null==(e=this.source)||e.destroy(),this._handles&&(this._handles.destroy(),this._handles=null)}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=Object(o.h)(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(e=>this._initLayerProperties(e)));const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(e=>e).then(async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new y.a("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))});return this.addResolvingPromise(r),Object(g.r)(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.definitionExpression,this.dynamicDataSource,this.timeExtent,this.timeOffset,this.geometryType,this.gdbVersion,this.historicMoment,this.returnZ,this.capabilities,this.returnM,(this._get("createQueryVersion")||0)+1}readEditingEnabled(e,t){return!t.layerDefinition||"Query"!==t.layerDefinition.capabilities}writeEditingEnabled(e,t){e||Object(a.c)("layerDefinition.capabilities","Query",t)}readEditingInfo(e,t){const{editingInfo:r}=t;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null}readFeatureReduction(e,t){return Object(dt.a)(e,t)}writeWebSceneFeatureReduction(e,t,r,i){Object(dt.c)(e,t,"layerDefinition.featureReduction",i)}get fieldsIndex(){return new D.a(this.fields||[])}readIsTable(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}get hasService(){return!this._hasMemorySource()}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeGlobalID"===e.type)return e.name}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const e of t.fields)if("esriFieldTypeOID"===e.type)return e.name}get parsedUrl(){const e=this.url?Object(m.H)(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=Object(m.w)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=Object(m.w)(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Object(x.j)(e,this.fields),this._set("renderer",e)}readRenderer(e,t,r){const i=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(i){const e=Object(N.b)(i,t,r)||void 0;return e||Mt.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),e}if(t.defaultSymbol)return t.types&&t.types.length?new R.a({defaultSymbol:Lt(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(e=>({id:e.id,symbol:Lt(e.symbol,e,r)}))}):new C.a({symbol:Lt(t.defaultSymbol,t,r)})}set source(e){const t=this._get("source");t!==e&&(Rt(t)&&this._resetMemorySource(t),Rt(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof j.a?new We({layer:this,items:e}):e:null}readSource(e,t){const r=Pe.default.fromJSON(t.featureSet);return new We({layer:this,items:r&&r.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e=e&&e.map(e=>pt.a.fromJSON(e)),this._fixTemplates(e,i),this._fixTemplates(e,s),e}readTitle(e,t){const r=t.layerDefinition&&t.layerDefinition.name||t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){const e=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?Object(E.h)(this.url,r):r;let t=r||this.url&&Object(E.e)(this.url).title;if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),Object(E.a)(t)}if("item-title"===this.sublayerTitleMode&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r){const e=Object(x.n)(t.fields,r);e&&(r=e.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e&&e.map(e=>(e=ft.a.fromJSON(e),this._fixTemplates(e.templates,i),this._fixTemplates(e.templates,s),e))}set url(e){const t=Object(E.g)(this,e,Mt);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,r,i){Object(E.i)(this,e,null,t,i)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new y.a(Et,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,r){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new y.a(Et,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,r)})}async applyEdits(e,t){return(await r.e(156).then(r.bind(null,976))).applyEdits(this,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Object(xt.a)(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.load({signal:e});const t=await r.e(157).then(r.bind(null,977));Object(g.t)(e);const i=await new t.default({layer:this}).load({signal:e});return this.emit("graphics-source-create",{graphicsSource:i}),i}createQuery(){const e=new St.a,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:i}=this;return e.timeExtent=null!=r&&null!=i?i.offset(-r.value,r.unit):i||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new y.a(Et,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(null==i)return null;let s=null;return r.some(e=>{const{id:t}=e;return null!=t&&(t.toString()===i.toString()&&(s=e),!!s)}),s}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const t=i.domains&&i.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=wt.a.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new y.a(Et,"this layer doesn't support attachments");const{attachmentTypes:t,objectIds:r,globalIds:i,num:s,size:n,start:a,where:o}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const l=r&&r.length>1,c=t&&t.length,u=i&&i.length,h=n&&n.length;if(l||c||u||h||s||a||o)throw new y.a(Et,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||o))throw new y.a(Et,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new y.a(Et,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(St.a.from(e)||this.createQuery(),t)).then(e=>{if(e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(St.a.from(e)||this.createQuery(),t);throw new y.a(Et,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(St.a.from(e)||this.createQuery(),t);throw new y.a(Et,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(St.a.from(e)||this.createQuery(),t);throw new y.a(Et,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(It.a.from(e),t);throw new y.a(Et,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(It.a.from(e),t);throw new y.a(Et,"Layer source does not support queryRelatedFeaturesCount capability")})}read(e,t){const r=e.featureCollection;if(r){const e=r.layers;e&&1===e.length&&(super.read(e[0],t),null!=r.showLegend&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){if(t){const e=t.origin,r=t.layerContainerType,i=t.messages;if(this.isTable){if("web-scene"===e||"web-map"===e&&"tables"!==r)return i&&i.push(new y.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Table source cannot be written to web scenes and web maps`,{layer:this})),null}else if(this.loaded&&"web-map"===e&&"tables"===r)return i&&i.push(new y.a("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a non-table source cannot be written to tables in web maps`,{layer:this})),null}return super.write(e,t)}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:r}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:Object(g.h)(new y.a(Et,"feature is missing the identifying attribute "+r)):Object(g.h)(new y.a(Et,"'attributes' are required on a feature to query attachments")):Object(g.h)(new y.a(Et,"A feature is required to add/delete/update attachments")):Object(g.h)(new y.a(Et,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Object(O.default)(this.url,{query:{f:"json"},responseType:"json",signal:e}).then(e=>{const t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Object(x.j)(this.renderer,this.fields),Object(x.k)(this.timeInfo,this.fields),Object(jt.a)(this,{origin:"service"})}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(e=>{const r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new y.a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new y.a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(e=>{e.layer=this,e.sourceLayer=this}),this._handles.add([e.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),e.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(e=>{e.layer=null,e.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach(e=>{const r=Ft[e.name];r&&(t[r]=!!e.isEnabled)}),t}_readDataCapabilities(e){return{isVersioned:Ct(e,"isDataVersioned",!1),supportsAttachment:Ct(e,"hasAttachments",!1),supportsM:Ct(e,"hasM",!1),supportsZ:Ct(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Ct(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const r=e?e.toLowerCase().split(",").map(e=>e.trim()):[],i=-1!==r.indexOf("editing");let s=i&&-1!==r.indexOf("create"),n=i&&-1!==r.indexOf("delete"),a=i&&-1!==r.indexOf("update");return i&&!(s||n||a)&&(s=n=a=!0),{supportsCalculate:Ct(t,"supportsCalculate",!1),supportsTruncate:Ct(t,"supportsTruncate",!1),supportsValidateSql:Ct(t,"supportsValidateSql",!1),supportsAdd:s,supportsDelete:n,supportsEditing:i,supportsQuery:-1!==r.indexOf("query"),supportsQueryAttachments:Ct(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:Ct(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==r.indexOf("sync"),supportsUpdate:a,supportsExceedsLimitStatistics:Ct(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){const t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,i=e.archivingInfo,s=(e.supportedQueryFormats||"").split(",").reduce((e,t)=>{const r=t.toLowerCase().trim();return r&&e.add(r),e},new Set);return{supportsStatistics:Ct(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Ct(t,"supportsPercentileStatistics",!1),supportsCentroid:Ct(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Ct(t,"supportsQueryWithDistance",!1),supportsDistinct:Ct(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Ct(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ct(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ct(t,"supportsHavingClause",!1),supportsOrderBy:Ct(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Ct(t,"supportsPagination",!1),supportsQuantization:Ct(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ct(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ct(e,"supportsReturningQueryGeometry",!1),supportsResultType:Ct(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ct(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ct(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ct(e,"useStandardizedQueries",!1),supportsQueryByOthers:Ct(r,"allowOthersToQuery",!0),supportsHistoricMoment:Ct(i,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:s.has("pbf"),supportsDisjointSpatialRelationship:Ct(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ct(t,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:At(e,"maxRecordCountFactor",void 0),maxRecordCount:At(e,"maxRecordCount",void 0),standardMaxRecordCount:At(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:At(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,r=Ct(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ct(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ct(e,"allowGeometryUpdates",!0),supportsGlobalId:Ct(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:Ct(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ct(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ct(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ct(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ct(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ct(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ct(t,"allowOthersToUpdate",!0)}}};Object(s.a)([Object(c.b)({readOnly:!0,json:{read:!1}})],Dt.prototype,"capabilities",void 0),Object(s.a)([Object(d.a)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Dt.prototype,"readCapabilities",null),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["definitionExpression","dynamicDataSource","timeExtent","timeOffset","geometryType","gdbVersion","historicMoment","returnZ","capabilities","returnM"]})],Dt.prototype,"createQueryVersion",null),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Dt.prototype,"copyright",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Dt.prototype,"displayField",void 0),Object(s.a)([Object(c.b)({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],Dt.prototype,"definitionExpression",void 0),Object(s.a)([Object(c.b)({types:S.i,readOnly:!0})],Dt.prototype,"defaultSymbol",void 0),Object(s.a)([Object(c.b)({type:vt.a})],Dt.prototype,"dynamicDataSource",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"editFieldsInfo",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Dt.prototype,"editingEnabled",void 0),Object(s.a)([Object(d.a)(["portal-item","web-map","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Dt.prototype,"readEditingEnabled",null),Object(s.a)([Object(b.a)(["portal-item","web-map","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Dt.prototype,"writeEditingEnabled",null),Object(s.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"editingInfo",void 0),Object(s.a)([Object(d.a)("editingInfo")],Dt.prototype,"readEditingInfo",null),Object(s.a)([Object(c.b)(et.b)],Dt.prototype,"elevationInfo",void 0),Object(s.a)([Object(c.b)({types:{key:"type",base:lt.a,typeMap:{selection:ht.a,cluster:ut.a}},json:{write:{target:"layerDefinition.featureReduction"}}})],Dt.prototype,"featureReduction",void 0),Object(s.a)([Object(d.a)("featureReduction",["layerDefinition.featureReduction"])],Dt.prototype,"readFeatureReduction",null),Object(s.a)([Object(b.a)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:dt.b}})],Dt.prototype,"writeWebSceneFeatureReduction",null),Object(s.a)([Object(c.b)({...Nt.fields,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.fields"}}})],Dt.prototype,"fields",void 0),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["fields"]})],Dt.prototype,"fieldsIndex",null),Object(s.a)([Object(c.b)({type:Le,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Dt.prototype,"formTemplate",void 0),Object(s.a)([Object(c.b)({type:v.a,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Dt.prototype,"fullExtent",void 0),Object(s.a)([Object(c.b)()],Dt.prototype,"gdbVersion",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"geometryProperties",void 0),Object(s.a)([Object(c.b)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Tt.read}},read:{source:"layerDefinition.geometryType",reader:Tt.read}}})],Dt.prototype,"geometryType",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Dt.prototype,"hasM",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Dt.prototype,"hasZ",void 0),Object(s.a)([Object(c.b)({readOnly:!0,type:M.a})],Dt.prototype,"heightModelInfo",void 0),Object(s.a)([Object(c.b)({type:Date})],Dt.prototype,"historicMoment",void 0),Object(s.a)([Object(c.b)({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],Dt.prototype,"id",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"isTable",void 0),Object(s.a)([Object(d.a)("service","isTable",["type","geometryType"]),Object(d.a)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Dt.prototype,"readIsTable",null),Object(s.a)([Object(c.b)({dependsOn:["loaded","url","source"],readOnly:!0})],Dt.prototype,"hasService",null),Object(s.a)([Object(c.b)(et.c)],Dt.prototype,"labelsVisible",void 0),Object(s.a)([Object(c.b)({type:[ct.a],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:yt.a},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:yt.a},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Dt.prototype,"labelingInfo",void 0),Object(s.a)([Object(c.b)(et.f)],Dt.prototype,"opacity",void 0),Object(s.a)([Object(c.b)({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],Dt.prototype,"layerId",void 0),Object(s.a)([Object(c.b)(et.d)],Dt.prototype,"legendEnabled",void 0),Object(s.a)([Object(c.b)({type:["show","hide"]})],Dt.prototype,"listMode",void 0),Object(s.a)([Object(c.b)({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],Dt.prototype,"minScale",void 0),Object(s.a)([Object(d.a)("service","minScale",["minScale","effectiveMinScale"])],Dt.prototype,"readMinScale",null),Object(s.a)([Object(c.b)({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],Dt.prototype,"maxScale",void 0),Object(s.a)([Object(d.a)("service","maxScale",["maxScale","effectiveMaxScale"])],Dt.prototype,"readMaxScale",null),Object(s.a)([Object(c.b)({type:String})],Dt.prototype,"globalIdField",void 0),Object(s.a)([Object(d.a)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Object(d.a)("service","globalIdField",["globalIdField","fields"])],Dt.prototype,"readGlobalIdFieldFromService",null),Object(s.a)([Object(c.b)({type:String})],Dt.prototype,"objectIdField",void 0),Object(s.a)([Object(d.a)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Object(d.a)("service","objectIdField",["objectIdField","fields"])],Dt.prototype,"readObjectIdFieldFromService",null),Object(s.a)([Object(c.b)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Dt.prototype,"operationalLayerType",void 0),Object(s.a)([Object(c.b)(Nt.outFields)],Dt.prototype,"outFields",void 0),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["layerId","dynamicDataSource"]})],Dt.prototype,"parsedUrl",null),Object(s.a)([Object(c.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Dt.prototype,"path",void 0),Object(s.a)([Object(c.b)(et.g)],Dt.prototype,"popupEnabled",void 0),Object(s.a)([Object(c.b)({type:w.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Dt.prototype,"popupTemplate",void 0),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["fields","title"]})],Dt.prototype,"defaultPopupTemplate",null),Object(s.a)([Object(c.b)({type:[_t],readOnly:!0})],Dt.prototype,"relationships",void 0),Object(s.a)([Object(c.b)({types:A.a,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:A.b,write:{target:"layerDefinition.drawingInfo.renderer",writer:N.c}}},write:{target:"layerDefinition.drawingInfo.renderer",writer:N.c}}})],Dt.prototype,"renderer",null),Object(s.a)([Object(d.a)("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),Object(d.a)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],Dt.prototype,"readRenderer",null),Object(s.a)([Object(c.b)()],Dt.prototype,"sourceJSON",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Dt.prototype,"returnM",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Dt.prototype,"returnZ",void 0),Object(s.a)([Object(c.b)(et.i)],Dt.prototype,"screenSizePerspectiveEnabled",void 0),Object(s.a)([Object(c.b)()],Dt.prototype,"source",null),Object(s.a)([Object(u.a)("source")],Dt.prototype,"castSource",null),Object(s.a)([Object(d.a)("portal-item","source",["featureSet"]),Object(d.a)("web-map","source",["featureSet"])],Dt.prototype,"readSource",null),Object(s.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"serviceDefinitionExpression",void 0),Object(s.a)([Object(d.a)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Dt.prototype,"readServiceDefinitionExpression",null),Object(s.a)([Object(c.b)({type:_.a,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Dt.prototype,"spatialReference",void 0),Object(s.a)([Object(c.b)({type:[pt.a]})],Dt.prototype,"templates",void 0),Object(s.a)([Object(d.a)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Dt.prototype,"readTemplates",null),Object(s.a)([Object(c.b)({type:nt.a})],Dt.prototype,"timeInfo",void 0),Object(s.a)([Object(c.b)()],Dt.prototype,"title",void 0),Object(s.a)([Object(d.a)("service","title",["name"]),Object(d.a)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Dt.prototype,"readTitle",null),Object(s.a)([Object(d.a)("web-map","title",["layerDefinition.name","title"])],Dt.prototype,"readTitleFromWebMap",null),Object(s.a)([Object(c.b)({type:String})],Dt.prototype,"sublayerTitleMode",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Dt.prototype,"trackIdField",void 0),Object(s.a)([Object(c.b)({json:{read:!1}})],Dt.prototype,"type",void 0),Object(s.a)([Object(c.b)({type:String})],Dt.prototype,"typeIdField",void 0),Object(s.a)([Object(d.a)("service","typeIdField"),Object(d.a)("typeIdField",["layerDefinition.typeIdField"])],Dt.prototype,"readTypeIdField",null),Object(s.a)([Object(c.b)({type:[ft.a]})],Dt.prototype,"types",void 0),Object(s.a)([Object(d.a)("service","types",["types"]),Object(d.a)("types",["layerDefinition.types"])],Dt.prototype,"readTypes",null),Object(s.a)([Object(c.b)({type:j.a.ofType(ot),readOnly:!0})],Dt.prototype,"indexes",void 0),Object(s.a)([Object(c.b)(et.j)],Dt.prototype,"url",null),Object(s.a)([Object(b.a)("url")],Dt.prototype,"writeUrl",null),Object(s.a)([Object(c.b)({readOnly:!0})],Dt.prototype,"userIsAdmin",void 0),Object(s.a)([Object(c.b)({json:{origins:{service:{read:!0}},read:!1}})],Dt.prototype,"version",void 0),Object(s.a)([Object(d.a)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Dt.prototype,"readVersion",null),Object(s.a)([Object(c.b)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Dt.prototype,"visible",void 0),Object(s.a)([Object(d.a)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Dt.prototype,"readVisible",null),Dt=Object(s.a)([Object(f.a)("esri.layers.FeatureLayer")],Dt);const Lt=Object(p.b)({types:S.a});var Pt=Dt;t.default=Pt},459:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(0),s=(r(4),r(9),r(5),r(6),r(1)),n=r(33),a=r(2),o=(r(3),r(10),r(11),r(144)),l=r(146),c=r(212),u=r(423),h=r(432);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const r=t.timeInfo.exportOptions;if(!r)return null;const i=r.timeOffset,s=l.d.fromJSON(r.timeOffsetUnits);return i&&s?new u.a({value:i,unit:s}):null}set timeInfo(e){Object(o.k)(e,this.fields),this._set("timeInfo",e)}};return Object(i.a)([Object(s.b)({type:c.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(i.a)([Object(s.b)({type:u.a})],t.prototype,"timeOffset",void 0),Object(i.a)([Object(n.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(i.a)([Object(s.b)({value:null,type:h.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(i.a)([Object(s.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(i.a)([Object(a.a)("esri.layers.mixins.TemporalLayer")],t),t}},461:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const i=new s(e.getPointX(t),e.getPointY(t),r),n=e.hasZ(t),a=e.hasM(t);return n&&(i.z=e.getPointZ(t)),a&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new n(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const i=e.hasZ(t),s=e.hasM(t),n=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){const r=e.getZExtent(t);n.zmin=r.vmin,n.zmax=r.vmax}if(s){const r=e.getMExtent(t);n.mmin=r.vmin,n.mmax=r.vmax}return n}};class s{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class n{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class a{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class l{constructor(e,t,r,i,s){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},462:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(0),s=(r(4),r(9),r(5)),n=(r(6),r(1)),a=r(2),o=(r(3),r(10),r(11),r(302));const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=Object(o.e)(this.url);if(e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",Object(o.f)(e,s.a.getLogger(this.declaredClass)))}};return Object(i.a)([Object(n.b)({dependsOn:["url"]})],t.prototype,"title",null),Object(i.a)([Object(n.b)({type:String})],t.prototype,"url",null),t=Object(i.a)([Object(a.a)("esri.layers.mixins.ArcGISService")],t),t}},463:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return j})),r.d(t,"g",(function(){return x}));var i=r(59);const s=(e,t,r)=>[t,r],n=(e,t,r)=>[t,r,e[2]],a=(e,t,r)=>[t,r,e[2],e[3]];function o(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function c({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function u(e,t,r){const i=[];let s,n,a,o;for(let u=0;u<r.length;u++){const h=r[u];u>0?(a=l(e,h[0]),o=c(e,h[1]),a===s&&o===n||(i.push(t(h,a-s,o-n)),s=a,n=o)):(s=l(e,h[0]),n=c(e,h[1]),i.push(t(h,s,n)))}return i.length>0?i:null}function h({scale:e,translate:t},r){return r*e[0]+t[0]}function d({scale:e,translate:t},r){return t[1]-r*e[1]}function p(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=e.scale;let a=h(e,r[0][0]),o=d(e,r[0][1]);i[0]=t(r[0],a,o);for(let e=1;e<r.length;e++){const l=r[e];a+=l[0]*s,o-=l[1]*n,i[e]=t(l,a,o)}return i}function f(e,t,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=p(e,t,r[s]);return i}function b(e,t,r,i,o){return t.points=function(e,t,r,i){return u(e,r?i?a:n:i?n:s,t)}(e,r.points,i,o),t}function y(e,t,r,i,s){return t.x=l(e,r.x),t.y=c(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function m(e,t,r,i,o){const l=function(e,t,r,i){const o=[],l=r?i?a:n:i?n:s;for(let r=0;r<t.length;r++){const i=u(e,l,t[r]);i&&i.length>=3&&o.push(i)}return o.length?o:null}(e,r.rings,i,o);return l?(t.rings=l,t):null}function g(e,t,r,i,o){const l=function(e,t,r,i){const o=[],l=r?i?a:n:i?n:s;for(let r=0;r<t.length;r++){const i=u(e,l,t[r]);i&&i.length>=2&&o.push(i)}return o.length?o:null}(e,r.paths,i,o);return l?(t.paths=l,t):null}function O(e,t){return e&&t?Object(i.f)(t)?y(e,{},t,!1,!1):Object(i.h)(t)?g(e,{},t,!1,!1):Object(i.g)(t)?m(e,{},t,!1,!1):Object(i.e)(t)?b(e,{},t,!1,!1):Object(i.d)(t)?(a=!1,o=!1,(s={}).xmin=l(r=e,(n=t).xmin),s.ymin=c(r,n.ymin),s.xmax=l(r,n.xmax),s.ymax=c(r,n.ymax),s!==n&&(a&&(s.zmin=n.zmin,s.zmax=n.zmax),o&&(s.mmin=n.mmin,s.mmax=n.mmax)),s):null:null;var r,s,n,a,o}function _(e,t,r,i,o){return t.points=function(e,t,r,i){return p(e,r?i?a:n:i?n:s,t)}(e,r.points,i,o),t}function v(e,t,r,i,s){return t.x=h(e,r.x),t.y=d(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function j(e,t,r,i,o){return t.rings=function(e,t,r,i){return f(e,r?i?a:n:i?n:s,t)}(e,r.rings,i,o),t}function x(e,t,r,i,o){return t.paths=function(e,t,r,i){return f(e,r?i?a:n:i?n:s,t)}(e,r.paths,i,o),t}},464:function(e,t,r){"use strict";function i(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function n(e,t){return new Float64Array(e,t,16)}r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return n}));const a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze({__proto__:null,create:i,clone:s,fromValues:function(e,t,r,i,s,n,a,o,l,c,u,h,d,p,f,b){return[e,t,r,i,s,n,a,o,l,c,u,h,d,p,f,b]},createView:n,IDENTITY:a})},465:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(531);function s(e,t){if(!(this instanceof s))return new s(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function n(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function a(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,i,s){s||(s=b(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,a=t;a<r;a++)n=e.children[a],l(s,e.leaf?i(n):n);return s}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,t,r,s,n){for(var a,o=[t,r];o.length;)(r=o.pop())-(t=o.pop())<=s||(a=t+Math.ceil((r-t)/s/2)*s,Object(i.a)(e,a,t,r,n),o.push(t,a,a,r))}s.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],i=this.toBBox;if(!f(e,t))return r;for(var s,n,a,o,l=[];t;){for(s=0,n=t.children.length;s<n;s++)a=t.children[s],f(e,o=t.leaf?i(a):a)&&(t.leaf?r.push(a):p(e,o)?this._all(a,r):l.push(a));t=l.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!f(e,t))return!1;for(var i,s,n,a,o=[];t;){for(i=0,s=t.children.length;i<s;i++)if(n=t.children[i],f(e,a=t.leaf?r(n):n)){if(t.leaf||p(e,a))return!0;o.push(n)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=b([]),this},remove:function(e,t){if(!e)return this;for(var r,i,s,a,o=this.data,l=this.toBBox(e),c=[],u=[];o||c.length;){if(o||(o=c.pop(),i=c[c.length-1],r=u.pop(),a=!0),o.leaf&&-1!==(s=n(e,o.children,t)))return o.children.splice(s,1),c.push(o),this._condense(c),this;a||o.leaf||!p(o,l)?i?(r++,o=i.children[r],a=!1):o=null:(c.push(o),u.push(r),r=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,i){var s,n=r-t+1,o=this._maxEntries;if(n<=o)return a(s=b(e.slice(t,r+1)),this.toBBox),s;i||(i=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,i-1))),(s=b([])).leaf=!1,s.height=i;var l,c,u,h,d=Math.ceil(n/o),p=d*Math.ceil(Math.sqrt(o));for(y(e,t,r,p,this.compareMinX),l=t;l<=r;l+=p)for(y(e,l,u=Math.min(l+p-1,r),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),s.children.push(this._build(e,c,h,i-1));return a(s,this.toBBox),s},_chooseSubtree:function(e,t,r,i){for(var s,n,a,o,l,c,u,d,p,f;i.push(t),!t.leaf&&i.length-1!==r;){for(u=d=1/0,s=0,n=t.children.length;s<n;s++)l=h(a=t.children[s]),p=e,f=a,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<d?(d=c,u=l<u?l:u,o=a):c===d&&l<u&&(u=l,o=a);t=o||t.children[0]}return t},_insert:function(e,t,r){var i=this.toBBox,s=r?e:i(e),n=[],a=this._chooseSubtree(s,this.data,t,n);for(a.children.push(e),l(a,s);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(s,n,t)},_split:function(e,t){var r=e[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);var n=this._chooseSplitIndex(r,s,i),o=b(r.children.splice(n,r.children.length-n));o.height=r.height,o.leaf=r.leaf,a(r,this.toBBox),a(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(e,t){this.data=b([e,t]),this.data.height=e.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var i,s,n,a,l,c,u,d,p,f,b,y,m,g;for(c=u=1/0,i=t;i<=r-t;i++)p=s=o(e,0,i,this.toBBox),f=n=o(e,i,r,this.toBBox),void 0,void 0,void 0,void 0,b=Math.max(p.minX,f.minX),y=Math.max(p.minY,f.minY),m=Math.min(p.maxX,f.maxX),g=Math.min(p.maxY,f.maxY),a=Math.max(0,m-b)*Math.max(0,g-y),l=h(s)+h(n),a<c?(c=a,d=i,u=l<u?l:u):a===c&&l<u&&(u=l,d=i);return d},_chooseSplitAxis:function(e,t,r){var i=e.leaf?this.compareMinX:c,s=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,s)&&e.children.sort(i)},_allDistMargin:function(e,t,r,i){e.children.sort(i);var s,n,a=this.toBBox,c=o(e,0,t,a),u=o(e,r-t,r,a),h=d(c)+d(u);for(s=t;s<r-t;s++)n=e.children[s],l(c,e.leaf?a(n):n),h+=d(c);for(s=r-t-1;s>=t;s--)n=e.children[s],l(u,e.leaf?a(n):n),h+=d(u);return h},_adjustParentBBoxes:function(e,t,r){for(var i=r;i>=0;i--)l(t[i],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():a(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},469:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(113),s=r(7),n=r(184);async function a(e,t,r){const a=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(a&&"unique-value"===a.type&&a.styleOrigin){const o=await Object(n.c)(a.populateFromStyle());if(Object(s.t)(r),!1===o.ok){const r=o.error;t&&t.messages&&t.messages.push(new i.a("renderer:style-reference","Failed to create unique value renderer from style reference: "+r.message,{error:r,context:t})),e.clear("renderer",t.origin)}}}},474:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(5),s=r(14),n=r(397),a=r(398);const o=i.a.getLogger("esri.views.2d.engine.webgl");function l(e){return Object(a.n)(e.minDataValue)&&Object(a.n)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?n.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?n.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?n.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?n.e.SIZE_UNIT_VALUE:(o.error(new s.a("mapview-bad-type","Found invalid size VisualVariable",e)),n.e.NONE)}},476:function(e,t,r){"use strict";r.r(t);var i,s=r(0),n=(r(4),r(9),r(12)),a=r(73),o=r(8),l=r(5),c=(r(6),r(1)),u=r(2),h=r(14),d=(r(3),r(10),r(7)),p=r(65),f=(r(11),r(56)),b=r(301),y=r(144),m=r(35),g=r(265),O=r(424),_=r(533),v=r(519);const j=l.a.getLogger("esri.renderers.DictionaryRenderer");let x=i=class extends(Object(_.a)(O.a)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new v.a(100),this.config=null,this.description=null,this.fieldMap=null,this.label=null,this.scaleExpression=null,this.url=null,this.type="dictionary"}clone(){return new i({config:Object(n.a)(this.config),scaleExpression:Object(n.a)(this.scaleExpression),description:Object(n.a)(this.description),fieldMap:Object(n.a)(this.fieldMap),label:Object(n.a)(this.label),url:Object(n.a)(this.url),visualVariables:Object(n.a)(this.visualVariables)})}async getSymbolAsync(e,t){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{r=await this._dictionaryPromise}catch(e){if(Object(d.b)(e))return this._dictionaryPromise=null,null}const i={};for(const t of this._symbolAttributes){const r=this.fieldMap[t];if(r&&null!==e.attributes[r]&&void 0!==e.attributes[r]){const s=""+e.attributes[r];i[t]=s}else i[t]=""}const s=r(i,t);if(!s||"string"!=typeof s)return null;const n=Object(a.b)(s).toString(),o=this._symbolCache.get(n);if(o)return o.catch(()=>{this._symbolCache.pop(n)}),o;const l=s.split(";"),c=[],u=[];for(const e of l)if(e&&0!==e.length)if(-1===e.indexOf("po:"))if(-1!==e.indexOf("|"))for(const t of e.split("|"))this._itemNames.has(t)&&c.push(t);else this._itemNames.has(e)&&c.push(e);else{const t=e.substr(3).split("|");if(3===t.length){const e=t[0],r=t[1];let i=t[2];if("DashTemplate"===r)i=i.split(" ").map(e=>Number(e));else if("Color"===r){const e=new m.a(i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);u.push({primitiveName:e,propertyName:r,value:i})}}const h=this._cimPartsToCIMSymbol(c,u,t);return this._symbolCache.put(n,h,1),h}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Object(y.a)(e,t,this.scaleExpression);const r=t.map(e=>e.name);for(const t in this.fieldMap)r.indexOf(this.fieldMap[t])<0||e.add(this.fieldMap[t])}get arcadeRequired(){return!0}async fetchResources(e){if(!this.url)return void j.error("no valid URL!");const t=Object(o.h)(e)?e.abortOptions:null,r=Object(p.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...t}),[{data:i}]=await Object(d.a)([r,Object(b.e)()]);if(!i)throw new h.a("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=Object(f.a)(i.itemsNames),this._symbolAttributes=n.symbol;const a={};if(this.config){const e=this.config;for(const t in e)a[t]=e[t]}for(const e of n.configuration)a.hasOwnProperty(e.name)||(a[e.name]=e.value);const l=[];if(Object(o.h)(e)&&e.fields)for(const t of this._symbolAttributes){const r=this.fieldMap[t],i=e.fields.filter(e=>e.name===r);i.length>0&&l.push({...i[0],name:t})}const c=await Object(b.b)(s,Object(o.h)(e)?e.spatialReference:null,l,a),u={scale:0};return(e,t)=>{const r=c.repurposeFeature({geometry:null,attributes:e});return u.scale=Object(o.h)(t)?t.scale:void 0,c.evaluate({$feature:r,$view:u})}}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(e=>e.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),i=Object(p.default)(r,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,i);try{return(await i).data}catch(t){return this._ongoingRequests.delete(e),Object(d.h)(t)}}_combineSymbolParts(e,t){if(!e||0===e.length)return null;if(1===e.length)return{type:"CIMSymbolReference",symbol:e[0],primitiveOverrides:t};const r={...e[0]};r.symbolLayers=[];for(const t of e){const e=t;r.symbolLayers.unshift(...e.symbolLayers)}return{type:"CIMSymbolReference",symbol:r,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,r){const i=new Array(e.length);for(let t=0;t<e.length;t++)i[t]=this._getSymbolPart(e[t],r);const s=await Object(d.a)(i);return new g.a({data:this._combineSymbolParts(s,t)})}};Object(s.a)([Object(c.b)({type:Object,json:{write:!0}})],x.prototype,"config",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],x.prototype,"description",void 0),Object(s.a)([Object(c.b)({type:Object,json:{write:!0}})],x.prototype,"fieldMap",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],x.prototype,"label",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],x.prototype,"scaleExpression",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],x.prototype,"url",void 0),x=i=Object(s.a)([Object(u.a)("esri.renderers.DictionaryRenderer")],x);var w=x;t.default=w},477:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(12)),a=(r(5),r(6),r(1)),o=r(19),l=r(2),c=(r(3),r(10),r(7)),u=(r(11),r(424)),h=r(533),d=r(591);let p=i=class extends(Object(h.a)(u.a)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Object(c.a)([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Object(c.a)(this.getSymbols().map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new i({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Object(n.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],p.prototype,"description",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],p.prototype,"label",void 0),Object(s.a)([Object(a.b)(d.b)],p.prototype,"symbol",void 0),Object(s.a)([Object(o.a)({simple:"simple"})],p.prototype,"type",void 0),p=i=Object(s.a)([Object(l.a)("esri.renderers.SimpleRenderer")],p);var f=p;t.a=f},478:function(e,t,r){"use strict";var i=r(0),s=(r(4),r(9),r(12)),n=(r(5),r(6),r(1)),a=r(33),o=r(2),l=r(22),c=(r(3),r(10),r(11),r(15)),u=r(187),h=r(185),d=r(186),p=(r(134),r(444));let f=class extends c.a{constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(i.type){case"range":t[r]=d.a.fromJSON(i);break;case"codedValue":t[r]=u.a.fromJSON(i);break;case"inherited":t[r]=h.a.fromJSON(i)}}return t}writeDomains(e,t){const r={};for(const t in e)e.hasOwnProperty(t)&&(r[t]=e[t]&&e[t].toJSON());Object(s.c)(r),t.domains=r}readTemplates(e){return e&&e.map(e=>new p.a(e))}writeTemplates(e,t){t.templates=e&&e.map(e=>e.toJSON())}};Object(i.a)([Object(n.b)({json:{write:!0}})],f.prototype,"id",void 0),Object(i.a)([Object(n.b)({json:{write:!0}})],f.prototype,"name",void 0),Object(i.a)([Object(n.b)({json:{write:!0}})],f.prototype,"domains",void 0),Object(i.a)([Object(a.a)("domains")],f.prototype,"readDomains",null),Object(i.a)([Object(l.a)("domains")],f.prototype,"writeDomains",null),Object(i.a)([Object(n.b)({json:{write:!0}})],f.prototype,"templates",void 0),Object(i.a)([Object(a.a)("templates")],f.prototype,"readTemplates",null),Object(i.a)([Object(l.a)("templates")],f.prototype,"writeTemplates",null),f=Object(i.a)([Object(o.a)("esri.layers.support.FeatureType")],f);var b=f;t.a=b},479:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return u}));r(49),r(8);var i=r(104),s=r(219),n=r(223),a=r(190),o=r(525);n.a.fromJSON(o.a),i.a.fromJSON(o.c),s.a.fromJSON(o.b);const l=a.a.fromJSON(o.d);const c=n.a.fromJSON(o.e),u=i.a.fromJSON(o.g),h=s.a.fromJSON(o.f)},482:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(59),s=(r(54),r(418)),n=r(413),a=r(515);let o=0;class l{constructor(e){this.type="FeatureSetReader",this.instance=0,this._tx=0,this._ty=0,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._joined=[],this.instance=e}static createInstance(){return o++,o=o>65535?0:o,o}get _hasFilter(){return-1!==this._xmin}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t){const r=this.copy();return r._tx=e,r._ty=t,r}extent(e,t,r,i){const s=this.copy();return s._xmin=e,s._xmax=r,s._ymin=t,s._ymax=i,s}hasFilter(){return this._hasFilter}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const r of this._joined){r.setIndex(this.getIndex());const i=r._readAttribute(e,t);if(void 0!==i)return i}}readAttributes(){return this._readAttributes()}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=Object(n.k)(e,this.geometryType,this.hasZ,this.hasM),r=Object(i.a)(t);return r.spatialReference=this._arcadeSpatialReference,r}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=this.getQuantizationTransform();return Object(a.a)(new s.a,e,this.hasM,this.hasZ,t)}copyInto(e){e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._xmin=this._xmin,e._xmax=this._xmax,e._ymin=this._ymin,e._ymax=this._ymax}}},485:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return h}));var i=r(424),s=r(475),n=r(484),a=r(476),o=r(486),l=r(487),c=r(477);const u={key:"type",base:i.a,typeMap:{heatmap:l.a,simple:c.a,"unique-value":n.a,"class-breaks":s.a,"dot-density":o.a,dictionary:a.default},errorContext:"renderer"},h={key:"type",base:i.a,typeMap:{simple:c.a,"unique-value":n.a,"class-breaks":s.a},errorContext:"renderer"}},486:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(12)),a=r(5),o=r(6),l=r(1),c=r(25),u=r(19),h=r(2),d=(r(3),r(10),r(11),r(144)),p=r(35),f=r(104),b=r(219),y=r(424),m=r(533),g=r(38),O=r(15);const _=a.a.getLogger("esri.renderers.support.AttributeColorInfo");let v=i=class extends O.a{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(_.error(".field: field must be a string value"),null):Object(o.l)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new i({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};Object(s.a)([Object(l.b)({type:p.a,json:{type:[Number],write:!0}})],v.prototype,"color",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],v.prototype,"field",void 0),Object(s.a)([Object(g.a)("field")],v.prototype,"castField",null),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],v.prototype,"label",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],v.prototype,"valueExpression",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],v.prototype,"valueExpressionTitle",void 0),v=i=Object(s.a)([Object(h.a)("esri.renderers.support.AttributeColorInfo")],v);var j,x=v;let w=j=class extends O.a{constructor(){super(...arguments),this.unit=null}clone(){return new j({unit:this.unit})}};Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],w.prototype,"unit",void 0),w=j=Object(s.a)([Object(h.a)("esri.renderers.support.DotDensityLegendOptions")],w);var S,I=w;let T=S=class extends(Object(m.a)(y.a)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new p.a([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new f.a,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new b.a({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new S({attributes:Object(n.a)(this.attributes),backgroundColor:Object(n.a)(this.backgroundColor),dotBlendingEnabled:Object(n.a)(this.dotBlendingEnabled),dotShape:Object(n.a)(this.dotShape),dotSize:Object(n.a)(this.dotSize),dotValue:Object(n.a)(this.dotValue),legendOptions:Object(n.a)(this.legendOptions),outline:Object(n.a)(this.outline),referenceScale:Object(n.a)(this.referenceScale),visualVariables:Object(n.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await Object(d.a)(e,t,r.valueExpression),r.field&&e.add(r.field)}};Object(s.a)([Object(l.b)({type:[x],json:{write:!0}})],T.prototype,"attributes",void 0),Object(s.a)([Object(l.b)({type:p.a,json:{write:!0}})],T.prototype,"backgroundColor",void 0),Object(s.a)([Object(l.b)({type:Boolean}),Object(c.a)("dotBlendingEnabled")],T.prototype,"blendDots",void 0),Object(s.a)([Object(l.b)({type:Boolean,json:{write:!0}})],T.prototype,"dotBlendingEnabled",void 0),Object(s.a)([Object(l.b)({type:String,json:{write:!0}})],T.prototype,"dotShape",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],T.prototype,"dotSize",void 0),Object(s.a)([Object(l.b)({type:I,json:{write:!0}})],T.prototype,"legendOptions",void 0),Object(s.a)([Object(l.b)({type:f.a,json:{default:null,write:!0}})],T.prototype,"outline",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],T.prototype,"dotValue",void 0),Object(s.a)([Object(l.b)({type:Number}),Object(c.a)("dotValue")],T.prototype,"referenceDotValue",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],T.prototype,"referenceScale",void 0),Object(s.a)([Object(l.b)({type:Number,json:{write:!0}})],T.prototype,"seed",void 0),Object(s.a)([Object(u.a)({dotDensity:"dot-density"})],T.prototype,"type",void 0),T=S=Object(s.a)([Object(h.a)("esri.renderers.DotDensityRenderer")],T);var F=T;t.a=F},487:function(e,t,r){"use strict";var i,s=r(0),n=(r(4),r(9),r(12)),a=(r(5),r(6),r(1)),o=r(19),l=r(2),c=(r(3),r(10),r(11),r(144)),u=r(35),h=r(424),d=r(15);let p=i=class extends d.a{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new i({color:this.color,ratio:this.ratio})}};Object(s.a)([Object(a.b)({type:u.a,json:{write:!0}})],p.prototype,"color",void 0),Object(s.a)([Object(a.b)({type:Number,json:{write:!0}})],p.prototype,"ratio",void 0),p=i=Object(s.a)([Object(l.a)("esri.renderers.support.HeatmapColorStop")],p);var f,b=p;let y=f=class extends h.a{constructor(e){super(e),this.blurRadius=10,this.colorStops=[new b({ratio:0,color:new u.a("rgba(255, 140, 0, 0)")}),new b({ratio:.75,color:new u.a("rgba(255, 140, 0, 1)")}),new b({ratio:.9,color:new u.a("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}async collectRequiredFields(e,t){const r=this.field;r&&"string"==typeof r&&Object(c.d)(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new f({blurRadius:this.blurRadius,colorStops:Object(n.a)(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};Object(s.a)([Object(a.b)({type:Number,json:{write:!0}})],y.prototype,"blurRadius",void 0),Object(s.a)([Object(a.b)({type:[b],json:{write:!0}})],y.prototype,"colorStops",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],y.prototype,"field",void 0),Object(s.a)([Object(a.b)({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:null==r})}}})],y.prototype,"fieldOffset",void 0),Object(s.a)([Object(a.b)({type:Number,json:{write:!0}})],y.prototype,"maxPixelIntensity",void 0),Object(s.a)([Object(a.b)({type:Number,json:{write:!0}})],y.prototype,"minPixelIntensity",void 0),Object(s.a)([Object(o.a)({heatmap:"heatmap"})],y.prototype,"type",void 0),y=f=Object(s.a)([Object(l.a)("esri.renderers.HeatmapRenderer")],y);var m=y;t.a=m},494:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));const i=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),s=!1},495:function(e,t,r){"use strict";function i(){return[1,0,0,0,1,0,0,0,1]}function s(e,t){return new Float64Array(e,t,9)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}));Object.freeze({__proto__:null,create:i,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,r,i,s,n,a,o,l){return[e,t,r,i,s,n,a,o,l]},createView:s})},510:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return c}));var i=r(49),s=r(52),n=r(113),a=r(149),o=r(14),l=r(485);function c(e,t,r,n){const a=function(e,t){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;case"heatmap":case"dictionary":case"dot-density":return!1;default:return Object(i.a)(e),!1}}(e,t)?e.write({},t):(t.messages&&t.messages.push(new o.a("renderer:unsupported",`Renderer of type '${e.declaredClass}' are not supported in scenes.`,{renderer:e,context:t})),null):null}(e,n);a&&Object(s.c)(r,a,t)}function u(e,t){return d(e,null,t)}const h=Object(a.b)({types:l.a});function d(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(r&&r.messages&&r.messages.push(new n.a("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):h(e,t,r):null}},511:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(5),s=r(39),n=r(144),a=r(218);const o=i.a.getLogger("esri.layers.support.fieldProperties");function l(){return{fields:{type:[a.a],value:null},outFields:{type:[String],dependsOn:["fields"],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(Object(s.e)(e,"*"))return["*"];if(!this.fields)return e;for(const t of e)Object(n.p)(this.fields,t)||o.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Object(n.i)(this.fields,e)}}}}},515:function(e,t,r){"use strict";function i(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,o){if(!t||!t.lengths.length)return null;const l="upperLeft"===(null==o?void 0:o.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const c=e.coords,u=[],h=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:p}=t,f=i(r,s);let b=0;for(const e of d){const t=n(h,p,b,e,r,s,l);t&&u.push(t),b+=e*f}if(u.sort((e,t)=>{let i=l*e[2]-l*t[2];return 0===i&&r&&(i=e[4]-t[4]),i}),u.length){let e=6*u[0][2];c[0]=u[0][0]/e,c[1]=u[0][1]/e,r&&(e=6*u[0][4],c[2]=0!==e?u[0][3]/e:0),(c[0]<h[0]||c[0]>h[1]||c[1]<h[2]||c[1]>h[3]||r&&(c[2]<h[4]||c[2]>h[5]))&&(c.length=0)}if(!c.length){const e=t.lengths[0]?a(p,0,d[0],r,s):null;if(!e)return null;c[0]=e[0],c[1]=e[1],r&&e.length>2&&(c[2]=e[2])}return e}function n(e,t,r,s,n,a,o=1){const l=i(n,a);let c=r,u=r+l,h=0,d=0,p=0,f=0,b=0;for(let r=0,i=s-1;r<i;r++,c+=l,u+=l){const r=t[c],i=t[c+1],s=t[c+2],a=t[u],o=t[u+1],l=t[u+2];let y=r*o-a*i;f+=y,h+=(r+a)*y,d+=(i+o)*y,n&&(y=r*l-a*s,p+=(s+l)*y,b+=y),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),n&&(s<e[4]&&(e[4]=s),s>e[5]&&(e[5]=s))}if(f*o>0&&(f*=-1),b*o>0&&(b*=-1),!f)return null;const y=[h,d,.5*f];return n&&(y[3]=p,y[4]=.5*b),y}function a(e,t,r,s,n){const a=i(s,n);let h=t,d=t+a,p=0,f=0,b=0,y=0;for(let t=0,i=r-1;t<i;t++,h+=a,d+=a){const t=e[h],r=e[h+1],i=e[h+2],n=e[d],a=e[d+1],m=e[d+2],g=s?l(t,r,i,n,a,m):o(t,r,n,a);if(g)if(p+=g,s){const e=u(t,r,i,n,a,m);f+=g*e[0],b+=g*e[1],y+=g*e[2]}else{const e=c(t,r,n,a);f+=g*e[0],b+=g*e[1]}}return p>0?s?[f/p,b/p,y/p]:[f/p,b/p]:r>0?s?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,i){const s=r-e,n=i-t;return Math.sqrt(s*s+n*n)}function l(e,t,r,i,s,n){const a=i-e,o=s-t,l=n-r;return Math.sqrt(a*a+o*o+l*l)}function c(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function u(e,t,r,i,s,n){return[e+.5*(i-e),t+.5*(s-t),r+.5*(n-r)]}r.d(t,"a",(function(){return s}))},516:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(434);const s=/\[([^\[\]]+)\]/gi;function n(e,t,r){return e?e.map(e=>{const n=new i.a;if(n.read(e,r),n.labelExpression){const e=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replace(s,(t,r)=>`[${function(e,t){if(!t)return e;const r=e.toLowerCase();for(let e=0;e<t.length;e++){const i=t[e].name;if(i.toLowerCase()===r)return i}return e}(r,e)}]`)}return n}):null}},519:function(e,t,r){"use strict";var i=r(520);t.a=class{constructor(e,t){this._storage=new i.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,r){this._storage.put(e,t,r,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},523:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return u}));var i=r(52),s=r(14),n=r(427),a=r(454),o=r(449);const l={key:"type",base:n.a,typeMap:{selection:o.a}};function c(e,t){const r=(t=t.layerDefinition||t).featureReduction;if(r)switch(r.type){case"selection":return o.a.fromJSON(r);case"cluster":return a.a.fromJSON(r)}return null}function u(e,t,r,n){const a=function(e,t,r){return e?"selection"!==e.type?(r.messages&&r.messages.push(new s.a("featureReduction:unsupported",`FeatureReduction of type '${e.declaredClass}' are not supported in scenes.`,{featureReduction:e,context:r})),null):e.write(t,r):null}(e,{},n);a&&Object(i.c)(r,a,t)}},525:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return c}));const i=[252,146,31,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},n={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},o={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},l={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},u={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},526:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(144),s=(r(84),r(135)),n=(r(227),r(234)),a=r(136),o=r(137),l=(r(138),r(116),r(300));const c=["oid","global-id"],u=["oid","global-id","guid"];function h({displayField:e,editFieldsInfo:t,fields:r,objectIdField:n,title:a},c){if(!r)return null;const u=m({editFieldsInfo:t,fields:r,objectIdField:n},c);if(!u.length)return null;const h=function(e){const t=Object(i.l)(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r}({titleBase:a,fields:r,displayField:e}),d=[new o.a,new s.a];return new l.a({title:h,content:d,fieldInfos:u})}const d=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],p=(e,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i})=>i?i.has(e.name):!(b(e.name,t)||r&&e.name===r||c.indexOf(e.type)>-1||d.some(t=>t.test(e.name)));function f(e,t){return"oid"===e.type?-1:"oid"===t.type?1:O(e)?-1:O(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function b(e,t){if(!e||!t)return!1;const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=t;return-1!==[r&&r.toLowerCase(),i&&i.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].indexOf(e.toLowerCase())}function y(e,t){return e.editable&&-1===u.indexOf(e.type)&&!b(e.name,t)}function m({editFieldsInfo:e,fields:t,objectIdField:r},i){return function(e,t){const r=e;return t&&(e=e.filter(e=>-1===t.indexOf(e.type))),e===r&&(e=e.slice()),e.sort(f),e}(t,(null==i?void 0:i.ignoreFieldTypes)||_).map(t=>new a.a({fieldName:t.name,isEditable:y(t,e),label:t.alias,format:g(t),visible:p(t,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:null==i?void 0:i.visibleFieldNames})}))}function g(e){switch(e.type){case"small-integer":case"integer":case"single":return new n.a({digitSeparator:!0,places:0});case"double":return new n.a({digitSeparator:!0,places:2});case"date":return new n.a({dateFormat:"long-month-day-year"});default:return null}}function O(e){return"name"===(e.name&&e.name.toLowerCase())||("name"===(e.alias&&e.alias.toLowerCase())||void 0)}const _=["geometry","blob","raster","guid","xml"]},527:function(e,t,r){"use strict";var i=r(8);t.a=class{constructor(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}clear(){for(;Object(i.h)(this.dequeue()););}}},529:function(e,t,r){"use strict";class i{constructor(e=null,t={},r,i){this.displayId=0,this.geohashIndexed=!1,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),r&&(this.centroid=r),null!=i&&(this.objectId=i)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashIndexed=this.geohashIndexed,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}t.a=i},531:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(211),s=Object(i.b)((function(e){var t;void 0!==(t=function(){function e(r,i,s,n,a){for(;n>s;){if(n-s>600){var o=n-s+1,l=i-s+1,c=Math.log(o),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(o-u)/o)*(l-o/2<0?-1:1);e(r,i,Math.max(s,Math.floor(i-l*u/o+h)),Math.min(n,Math.floor(i+(o-l)*u/o+h)),a)}var d=r[i],p=s,f=n;for(t(r,s,i),a(r[n],d)>0&&t(r,s,n);p<f;){for(t(r,p,f),p++,f--;a(r[p],d)<0;)p++;for(;a(r[f],d)>0;)f--}0===a(r[s],d)?t(r,s,f):t(r,++f,n),f<=i&&(s=f+1),i<=f&&(n=f-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,s,n,a){e(t,i,s||0,n||t.length-1,a||r)}}())&&(e.exports=t)}))},532:function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return o})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return a})),r.d(t,"i",(function(){return b})),r.d(t,"j",(function(){return f})),r.d(t,"k",(function(){return p})),r.d(t,"l",(function(){return d}));var i=r(8),s=(r(36),r(259));function n(e=v){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,r,i,s,a,o=n()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=a,o}function o(e,t,r=e){return g(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5])):Object(s.l)(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[2]),r[4]=Math.max(e[4],t[3])):2===t.length?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1])):3===t.length&&(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1]),r[5]=Math.max(e[5],t[2])),r}function l(e,t,r,i=e){const s=t.length;let n=e[0],a=e[1],o=e[2],l=e[3],c=e[4],u=e[5];if(r)for(let e=0;e<s;e++){const r=t[e];n=Math.min(n,r[0]),a=Math.min(a,r[1]),o=Math.min(o,r[2]),l=Math.max(l,r[0]),c=Math.max(c,r[1]),u=Math.max(u,r[2])}else for(let e=0;e<s;e++){const r=t[e];n=Math.min(n,r[0]),a=Math.min(a,r[1]),l=Math.max(l,r[0]),c=Math.max(c,r[1])}return i[0]=n,i[1]=a,i[2]=o,i[3]=l,i[4]=c,i[5]=u,i}function c(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function h(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,t=[0,0,0]){return t[0]=c(e),t[1]=u(e),t[2]=h(e),t}function p(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function f(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function y(e){return e?b(e,_):n(_)}function m(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function g(e){return 6===e.length}function O(e,t,r){if(Object(i.g)(e)||Object(i.g)(t))return e===t;if(!g(e)||!g(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const _=[1/0,1/0,1/0,-1/0,-1/0,-1/0],v=[0,0,0,0,0,0];n()},536:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(413),s=r(482);class n extends s.a{constructor(e,t,r){super(e),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=t}static fromFeatures(e,t,r){const s=Object(i.c)([],e,t,!1,!1,r);for(let t=0;t<s.length;t++)s[t].displayId=e[t].displayId;return n.fromOptimizedFeatures(s,t)}static fromFeatureSet(e,t){const r=Object(i.b)(e,t);return n.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(e){const{features:t,geometryType:r}=e,i=n.fromOptimizedFeatures(t,r);i._exceededTransferLimit=e.exceededTransferLimit,i._transform=e.transform;for(const t of e.fields)"esriFieldTypeDate"===t.type&&i._dateFields.add(t.name);return i}static fromOptimizedFeatures(e,t,r){const i=s.a.createInstance(),a=new n(i,e,t);return a._transform=r,a}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}getGroupId(){return this._current.groupId}setGroupId(e){this._current.groupId=e}copy(){const e=new n(this.instance,this._features,this.geometryType);return this.copyInto(e),e}next(){if(!this._hasFilter)return++this._featureIndex<this._features.length;for(;++this._featureIndex<this._features.length&&!this._passesFilter(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(i.i)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){const e=this.readGeometry();return e?{x:e.coords[0],y:e.coords[1]}:null}readLegacyGeometry(){const e=this.readGeometry();return Object(i.k)(e,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const e=this.readCentroid();return e?{x:e.coords[0],y:e.coords[1]}:null}readGeometryArea(){return Object(i.s)(this._current.geometry,2)}readUnquantizedGeometry(){const e=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!e)return e;const t=e.clone();return function({coords:e,lengths:t}){let r=0;for(const i of t){for(let t=1;t<i;t++)e[2*(r+t)]+=e[2*(r+t)-2],e[2*(r+t)+1]+=e[2*(r+t)-1];r+=i}}(t),t}readHydratedGeometry(){const e=this._current.geometry;if(!e)return null;const t=e.clone();return Object(i.y)(t,t,this.hasZ,this.hasM,this._transform),t}getXHydrate(){const e=this._current.geometry.coords[0]+this._tx,t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]}getYHydrate(){const e=this._current.geometry.coords[1]+this._ty,t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]}readGeometry(){if(!this._current.hasGeometry)return null;const e=this._current.geometry.clone();if(e.isPoint)return e.coords[0]+=this._tx,e.coords[1]+=this._ty,e;let t=0;for(const r of e.lengths)e.coords[2*t]+=this._tx,e.coords[2*t+1]+=this._ty,t+=r;return e}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const e=this._computeCentroid();if(!e)return null;e.coords[0]-=this._tx,e.coords[1]-=this._ty,this._current.centroid=e}const e=this._current.centroid.clone();return e.coords[0]+=this._tx,e.coords[1]+=this._ty,e}_readAttribute(e,t){const r=this._current.attributes[e];if(void 0!==r)return t&&this._dateFields.has(e)?new Date(r):r;const i=this.readAttributes(),s=e.toLocaleLowerCase().trim();for(const e in i)if(e.toLocaleLowerCase().trim()===s){const t=this._current.attributes[e];return this._dateFields.has(e)?new Date(t):t}}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;let e=0,t=0;switch(this.geometryType){case"esriGeometryPoint":{const r=this._current.geometry;if(!r)return!1;[e,t]=r.coords;break}case"esriGeometryPolygon":{const r=this.readCentroid();if(!r)return!1;[e,t]=r.coords,e-=this._tx,t-=this._ty;break}default:return!1}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}}},540:function(e,t,r){"use strict";r.d(t,"a",(function(){return D})),r.d(t,"b",(function(){return R}));var i=r(23),s=r(396),n=r(49),a=r(69),o=r(110),l=r(45),c=r(455),u=r(403),h=(r(495),r(464)),d=(r(148),r(0)),p=(r(4),r(9),r(5),r(6),r(1)),f=r(2),b=(r(3),r(10),r(11),r(18));let y=class extends b.a{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TERRAIN_DEBUG_POPUP=!1,this.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,this.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,this.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.ENABLE_PROFILE_DEPTH_RANGE=!1,this.DISABLE_FAST_UPDATES=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(d.a)([Object(p.b)()],y.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(d.a)([Object(p.b)()],y.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(d.a)([Object(p.b)()],y.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),Object(d.a)([Object(p.b)()],y.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(d.a)([Object(p.b)()],y.prototype,"LABELS_SHOW_BORDER",void 0),Object(d.a)([Object(p.b)()],y.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(d.a)([Object(p.b)()],y.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(d.a)([Object(p.b)()],y.prototype,"SHOW_POI",void 0),Object(d.a)([Object(p.b)()],y.prototype,"TERRAIN_DEBUG_POPUP",void 0),Object(d.a)([Object(p.b)()],y.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(d.a)([Object(p.b)()],y.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(d.a)([Object(p.b)()],y.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(d.a)([Object(p.b)()],y.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(d.a)([Object(p.b)()],y.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(d.a)([Object(p.b)()],y.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(d.a)([Object(p.b)()],y.prototype,"DISABLE_FAST_UPDATES",void 0),Object(d.a)([Object(p.b)()],y.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(d.a)([Object(p.b)()],y.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(d.a)([Object(p.b)()],y.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),y=Object(d.a)([Object(f.a)("esri.views.3d.support.DebugFlags")],y);var m;new y;function g(e){return null!=e}function O(e){return"number"==typeof e}function _(e){return"string"==typeof e}function v(e,t){e&&e.push(t)}function j(e,t,r,i,s){const n=e.minSize,a=e.maxSize;if(e.expression)return v(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=i.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(g(e.field))return g(e.stops)?2===e.stops.length&&O(e.stops[0].size)&&O(e.stops[1].size)?(x(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(v(s,"Could not convert size info: stops only supported with 2 elements"),!1):O(n)&&O(a)&&g(e.minDataValue)&&g(e.maxDataValue)?(x(n,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=u.a[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/u.a[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(v(s,"Could not convert size info: proportional size not supported"),!1):(v(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!g(e.field)){if(e.stops&&e.stops[0]&&O(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(O(n))return t.minSize[r]=n,t.maxSize[r]=n,t.offset[r]=n,t.factor[r]=0,t.type[r]=1,!0}return v(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function x(e,t,r,i,s,n){const a=Math.abs(i-r)>0?(t-e)/(i-r):0;s.minSize[n]=a>0?e:t,s.maxSize[n]=a>0?t:e,s.offset[n]=e-r*a,s.factor[n]=a}function w(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function S(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function I(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,l=e.reduce((e,l)=>{if(!e)return e;if(l.valueExpression)return v(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case"size":return i?function(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return v(i,"Could not convert size info: unsupported property"),null;if(null!=(s=e.field)&&!_(s))return v(i,"Could not convert size info: field is not a string"),null;var s;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return v(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};let n;switch(e.axis){case"width":return n=j(e,t.size,0,r,i),n?t:null;case"height":return n=j(e,t.size,2,r,i),n?t:null;case"depth":return n=j(e,t.size,1,r,i),n?t:null;case"width-and-depth":return n=j(e,t.size,0,r,i),n&&j(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return n=j(e,t.size,0,r,i),n=n&&j(e,t.size,1,r,i),n=n&&j(e,t.size,2,r,i),n?t:null;default:return v(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}(l,e,t,r):e;case"color":return s?function(e,t,r){if(e.normalizationField)return v(r,"Could not convert color info: unsupported property"),null;if(_(e.field)){if(!e.stops)return v(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return v(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.color.values[e]=r.value,w(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return v(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,w(t.color.colors,e,r)}}return t}(l,e,r):e;case"opacity":return o?function(e,t,r){if(e.normalizationField)return v(r,"Could not convert opacity info: unsupported property"),null;if(_(e.field)){if(!e.stops)return v(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return v(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return v(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}(l,e,r):null;case"rotation":return a?function(e,t,r){if(!_(e.field))return v(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return v(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return S(e,t.rotation,0),t;case"roll":return S(e,t.rotation,1),t;case null:case void 0:case"heading":return S(e,t.rotation,2),t;default:return v(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(l,e,r):e;default:return Object(n.a)(l),null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!function(e,t,r){for(let r=0;r<3;++r){let i=t.unitInMeters;1===e.type[r]&&(i*=t.modelSize[r],e.type[r]=2),e.minSize[r]=e.minSize[r]/i,e.maxSize[r]=e.maxSize[r]/i,e.offset[r]=e.offset[r]/i,e.factor[r]=e.factor[r]/i}let i;if(0!==e.type[0])i=0;else if(0!==e.type[1])i=1;else{if(0===e.type[2])return v(r,"No size axis contains a valid size or scale"),!1;i=2}for(let t=0;t<3;++t)0===e.type[t]&&(e.minSize[t]=e.minSize[i],e.maxSize[t]=e.maxSize[i],e.offset[t]=e.offset[i],e.factor[t]=e.factor[i],e.type[t]=e.type[i]);return!0}(l.size,t,r)?null:l:null}!function(e){const t=Object(h.b)(),r=Object(o.e)();e.evaluateModelTransform=function(e,i,s){if(!e.vvSizeEnabled)return s;Object(c.c)(t,s);const n=e.vvSymbolRotationMatrix;Object(c.d)(T,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),Object(c.j)(t,t,T);for(let t=0;t<3;++t){const s=e.vvSizeOffset[t]+i[0]*e.vvSizeFactor[t];r[t]=Object(a.c)(s,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return Object(c.n)(t,t,r),Object(c.o)(t,t,e.vvSymbolAnchor),t},e.evaluateModelTransformScale=function(e,t,r){if(!t.vvSizeEnabled)return Object(l.r)(e,1,1,1);for(let i=0;i<3;++i){const s=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=Object(a.c)(s,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}}(m||(m={}));const T=Object(h.b)();m.evaluateModelTransform,m.evaluateModelTransformScale;var F=r(397),E=r(410),M=r(474);function R(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function C(e){return e.map(e=>{return{value:(t=e).value,size:Object(i.j)(t.size)};var t})}function A(e){if("string"==typeof e||"number"==typeof e)return Object(i.j)(e);const t=e;return{type:"size",expression:t.expression,stops:C(t.stops)}}const N=e=>{const t=[],r=[],n=C(e),a=n.length;for(let e=0;e<6;e++){const o=n[Math.min(e,a-1)];t.push(o.value),r.push(null==o.size?s.p:Object(i.h)(o.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function D(e){const t=e&&e.length>0?{}:null,r=t?{}:null;if(!t)return{vvFields:t,vvRanges:r};for(const i of e){const e=i.type;if(i.field&&(t[e]=i.field),"size"===e){r.size||(r.size={});const e=i;switch(Object(M.a)(e)){case F.e.SIZE_MINMAX_VALUE:r.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:A(e.minSize),maxSize:A(e.maxSize)};break;case F.e.SIZE_SCALE_STOPS:r.size.scaleStops={stops:C(e.stops)};break;case F.e.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const r in e.levels)t[r]=N(e.levels[r]);r.size.fieldStops={type:"level-dependent",levels:t}}else r.size.fieldStops={type:"static",...N(e.stops)};break;case F.e.SIZE_UNIT_VALUE:r.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===e){const e=I([i],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});if(!e)continue;r.color=e.color;for(let e=0;e<32;e+=4)Object(E.b)(r.color.colors,e,!0)}else if("opacity"===e)r.opacity=L(i);else if("rotation"===e){const e=i;r.rotation={type:e.rotationType}}}return{vvFields:t,vvRanges:r}}function L(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const r=e.stops;for(let e=0;e<8;++e){const i=r[Math.min(e,r.length-1)];t.values[e]=i.value,t.opacities[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=r}}return t}},547:function(e,t,r){"use strict";r.d(t,"b",(function(){return O}));var i=r(4),s=(r(9),r(8)),n=r(5),a=r(14),o=r(7),l=r(69),c=r(522),u=r(417),h=r(396),d=r(398),p=r(494),f=r(540);const b=n.a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),y=Object(p.b)(p.a,b),m=e=>(2147483648&e)>>>31,g=e=>2147483647&e;function O(e){return 1===m(e)}const _={sharedArrayBuffer:Object(i.a)("esri-shared-array-buffer"),oesTextureFloat:Object(i.a)("esri-webgl-texture-float"),maxTextureSize:Object(i.a)("esri-webgl-max-texture-size"),atomics:Object(i.a)("esri-atomics")};function v(e,t){return r=>t(e(r))}class j{constructor(e,t,r,i){this.size=0,this.texelSize=4;const{pixelType:s,layout:n,textureOnly:a}=i;this.textureOnly=a||!1,this.pixelType=s,this._ctype=t,this.layout=n,this._resetRange(),this._shared=e,this.size=r,a||(this.data=this._initData(s,r,e,t))}get buffer(){return Object(s.a)(this.data,e=>e.buffer)}unsetComponentAllTexels(e,t){const r=Object(s.m)(this.data);for(let i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const r=Object(s.m)(this.data);for(let i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,r){const i=Object(s.m)(this.data);for(const s of r)i[s*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)}setComponentTexel(e,t,r){Object(s.m)(this.data)[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}unsetComponentTexel(e,t,r){Object(s.m)(this.data)[r*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}getData(e,t){const r=g(e);return Object(s.m)(this.data)[r*this.texelSize+t]}setData(e,t,r){const i=g(e),s=1<<t;0!=(this.layout&s)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):b.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType?this._shared&&_.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):Object(i.a)("esri-2d-debug")&&b.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")}unlock(){5121===this.pixelType?this._shared&&_.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):Object(i.a)("esri-2d-debug")&&b.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e,this._shared,this._ctype),r=Object(s.m)(this.data);t.set(r),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();const i=!(this._shared||"local"===this._ctype),n=this.pixelType,a=this.layout,o=Object(s.m)(this.data);return o.slice?{start:e,end:t,data:i&&o.slice(e*r,(t+1)*r)||null,pixelType:n,layout:a}:i?{start:e,end:t,data:new(Object(d.i)(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:a}:{start:e,end:t,data:null,pixelType:n,layout:a}}_initData(e,t,r,i){const s=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,n=Object(d.i)(e),a=new n(new s(t*t*4*n.BYTES_PER_ELEMENT));for(let e=0;e<a.length;e+=4)a[e+1]=255;return a}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}t.a=class{constructor(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(h.o),this._targetType=0,this._abortController=Object(o.c)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const t=_.oesTextureFloat?5126:5121;y(`Creating AttributeStore ${_.sharedArrayBuffer?"with":"without"} shared memory`),Object(i.a)("esri-2d-debug")&&_.sharedArrayBuffer&&!_.atomics&&b.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,t){const r=Object(c.a)(this._schema,t);if(r&&(Object(i.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",r),e.storage.data=!0,this._schema=t,this._attributeComputeMap.clear(),!Object(s.g)(t))){switch(t.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(const e of t.mapping)this._bindAttribute(e)}}onTileData(e,t){if(Object(s.g)(t.addOrUpdate))return;const r=t.addOrUpdate.getCursor();for(;r.next();){const e=r.getDisplayId();this.setAttributeData(e,r)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=Object(o.c)()}async setHighlight(e,t){const r=this._getBlock(0),i=t.map(e=>g(e));r.lock(),r.unsetComponentAllTexels(0,1),r.setComponent(0,1,i),r.unlock(),this._idsToHighlight.clear();for(const t of e)this._idsToHighlight.add(t);await this.sendUpdates()}async updateFilters(e,t){const{config:r,service:s,spatialReference:n}=t,{filters:a}=r,l=a.map((e,t)=>this._updateFilter(e,t,s,n));(await Object(o.a)(l)).some(e=>e)&&(e.storage.filters=!0,Object(i.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(e,t,r,i){const s=g(e);this._ensureSizeForTexel(s),this._getBlock(t).setData(e,r,i)}getData(e,t,r){return this._getBlock(t).getData(e,r)}getHighlightFlag(e){return this._idsToHighlight.has(e)?h.l:0}setAttributeData(e,t){const r=g(e);if(this._ensureSizeForTexel(r),this._getBlock(0).setData(r,0,this.getFilterFlags(t)),this._targetType!==m(e))return;const i=this._attributeComputeMap,s=_.oesTextureFloat?1:2;i.size&&i.forEach((e,i)=>{const n=i*s%4,a=Math.floor(i*s/4),o=this._getBlock(a+h.b),c=e(t);if(_.oesTextureFloat)o.setData(r,n,c);else if(c===h.p)o.setData(r,n,255),o.setData(r,n+1,255);else{const e=Object(l.c)(Math.round(c),-32767,32766)+32768,t=255&e,i=(65280&e)>>8;o.setData(r,n,t),o.setData(r,n+1,i)}})}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(o.g)(),this._nextUpdate.promise;const e={blocks:this._blocks.map(e=>Object(s.h)(e)?e.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>e.resolve())}},r=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),r}).catch(e=>Object(o.b)(e)?(this._createResourcesPromise=null,this._createResources()):(b.error(new a.a("mapview-attribute-store","Encountered an error during client update",e)),Object(o.r)())),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){let t;if(null!=e.fieldIndex)e.normalizationField&&b.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),t=t=>t.getComputedNumericAtIndex(e.fieldIndex);else{if(!e.field)return void(Object(i.a)("esri-2d-debug")&&console.error("Unable to create evaluator. Found neither a field nor fieldIndex in",e));t=e.normalizationField?t=>{const r=t.readAttribute(e.normalizationField);return r?t.readAttribute(e.field)/r:null}:t=>t.readAttribute(e.field)}e.valueRepresentation&&(t=v(t,t=>Object(f.b)(t,e.valueRepresentation))),this._attributeComputeMap.set(e.binding,v(t,e=>null===e||isNaN(e)||e===1/0?h.p:e))}_createResources(){if(Object(s.h)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(h.a),y("Initializing AttributeStore");const e={shared:_.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(s.j)(this._blocks,e=>({textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}))},t=this._client.initialize(e,this._signal).catch(e=>{Object(o.b)(e)?this._createResourcesPromise=null:b.error(new a.a("mapview-attribute-store","Encountered an error during client initialization",e))});return this._createResourcesPromise=t,t.then(()=>Object(s.g)(this._createResourcesPromise)?this._createResources():void 0),t}_getBlock(e){const t=this._blocks[e];if(Object(s.h)(t))return t;y("Initializing AttributeBlock at index "+e);const r=_.sharedArrayBuffer,i=this._client.type,n=new j(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n}_expand(){if(this._size<_.maxTextureSize){const e=this._size<<=1;return y("Expanding block size to",e,this._blocks),Object(s.e)(this._blocks,t=>t.expand(e)),this._createResourcesPromise=null,this._size=e,0}return b.error(new a.a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(e,t,r,i){const n=this._filters[t],a=Object(s.h)(n)&&n.hash;if(!n&&!e)return!1;if(a===JSON.stringify(e))return!1;if(Object(s.g)(e)){const e=1<<t+1,r=this._getBlock(0);return this._filters[t]=null,r.setComponentAllTexels(0,e),this.sendUpdates(),!0}const o=await this._getFilter(t,r);return await o.update(e,i),!0}async _getFilter(e,t){const i=this._filters[e];if(Object(s.h)(i))return i;const{default:n}=await r.e(75).then(r.bind(null,586)),a=new n({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new u.a(t.fields)});return this._filters[e]=a,a}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){let t=0;const r=(i=e.getDisplayId(),1===m(i)?254:255);var i;for(let i=0;i<this._filters.length;i++){const n=!!(r&1<<i),a=this._filters[i];t|=(!n||Object(s.g)(a)||a.check(e)?1:0)<<i}let n=0;if(this._idsToHighlight.size){const t=e.getObjectId();n=this.getHighlightFlag(t)}return t<<1|n}}},554:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));class i{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}class s{constructor(e,t){this._mask=0,this._buf=e,this._mask=t}static fromBuffer(e,t){return new s(e,t)}static create(e,t=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new s(r,t)}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}set(e){const t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]|=i}unset(e){const t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]&=4294967295^i}resize(e){const t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new s(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(let t=0;t<this._buf.length;t++){let r=this._buf[t],i=32*t;if(r)for(;r;)1&r&&e(i),r>>>=1,i++}}countSet(){let e=0;return this.forEachSet(t=>{e++}),e}}function n(e,t,r){if(!(e.length>t))for(;e.length<=t;)e.push(r)}class a{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new i,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const e=this._bitsets.length;return this._bitsets.push(s.create(this._allocatedSize,2147483647)),e+1}getBitset(e){return this._bitsets[e-1]}_expand(){this._allocatedSize<<=1;for(const e of this._bitsets)e.resize(this._allocatedSize)}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),n(this._numerics[e],t,0)}_ensureInstanceId(e){n(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),n(this._strings[e],t,null)}createDisplayId(e=!1){const t=this._idGenerator.createId();return t>this._allocatedSize&&this._expand(),((e,t)=>((t?2147483648:0)|e)>>>0)(t,e)}releaseDisplayId(e){for(const t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(2147483647&e)}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(2147483647&e,0)}setComputedNumeric(e,t,r){return this.setComputedNumericAtIndex(2147483647&e,r,0)}getComputedString(e,t){return this.getComputedStringAtIndex(2147483647&e,0)}setComputedString(e,t,r){return this.setComputedStringAtIndex(2147483647&e,0,r)}getComputedNumericAtIndex(e,t){const r=2147483647&e;return this._ensureNumeric(t,r),this._numerics[t][r]}setComputedNumericAtIndex(e,t,r){const i=2147483647&e;this._ensureNumeric(t,i),this._numerics[t][i]=r}getInstanceId(e){const t=2147483647&e;return this._ensureInstanceId(t),this._instanceIds[t]}setInstanceId(e,t){const r=2147483647&e;this._ensureInstanceId(r),this._instanceIds[r]=t}getComputedStringAtIndex(e,t){const r=2147483647&e;return this._ensureString(t,r),this._strings[t][r]}setComputedStringAtIndex(e,t,r){const i=2147483647&e;this._ensureString(t,i),this._strings[t][i]=r}getXMin(e){return this._bounds[4*(2147483647&e)]}getYMin(e){return this._bounds[4*(2147483647&e)+1]}getXMax(e){return this._bounds[4*(2147483647&e)+2]}getYMax(e){return this._bounds[4*(2147483647&e)+3]}setBounds(e,t){const r=t.readHydratedGeometry();if(!r||!r.coords.length)return!1;let i=1/0,s=1/0,a=-1/0,o=-1/0;r.forEachVertex((e,t)=>{i=Math.min(i,e),s=Math.min(s,t),a=Math.max(a,e),o=Math.max(o,t)});const l=2147483647&e;return n(this._bounds,4*l+4,0),this._bounds[4*l]=i,this._bounds[4*l+1]=s,this._bounds[4*l+2]=a,this._bounds[4*l+3]=o,!0}}},557:function(e,t,r){"use strict";var i=r(4),s=r(83),n=r(147),a=r(188),o=r(465),l=r(79),c=r(36),u=r(259),h=r(312);class d{constructor(e,t){this.key=new n.a(0,0,0,0),this.bounds=Object(u.d)(),this.objectIds=new Set,this.key.set(t);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return c.a.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){const e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new d(this.tileInfoView,this.key)}neighbor(e,t){const r=this.key.clone(),i=1<<r.level,s=r.col+e,n=r.row+t;return s<0?(r.col=s+i,r.world-=1):s>=i?(r.col=s-i,r.world+=1):r.col=s,r.row=n,new d(this.tileInfoView,r)}createChildTiles(){const e=this.key.getChildKeys(),t=l.a.acquire();for(let r=0;r<e.length;r++)t[r]=new d(this.tileInfoView,e[r]);return t}getQuantizationParameters(){return h.a.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}const p={added:[],removed:[]},f=new Set,b=new n.a(0,0,0,0);t.a=class extends s.a{constructor(e){super(),this._tiles=new Map,this._index=Object(o.a)(9,Object(i.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}intersections(e,t){const r="string"==typeof e?this.get(e):e;if(!r)return[];const i=t*r.resolution,s=r.bounds[0]-i,n=r.bounds[1]-i,a=r.bounds[2]+i,o=r.bounds[3]+i,l=[];for(const e of this._index.search({minX:s,minY:n,maxX:a,maxY:o})){const t=e.bounds.slice();t[0]=Math.max(t[0],s),t[1]=Math.max(t[1],n),t[2]=Math.min(t[2],a),t[3]=Math.min(t[3],o),t[2]-t[0]>0&&t[3]-t[1]>0&&l.push({bounds:t,tile:e})}return l}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const e=new d(this.tileScheme,r);this._tiles.set(r,e),this._index.insert(e),t.added.push(e)}for(const r of e.removed)if(this.has(r)){const e=this.get(r);this._tiles.delete(r),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach(e=>this.tiles.push(e)),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:r,lodInfo:i}=t,{level:s}=i;if(r.length>0)for(const{row:e,colFrom:t,colTo:n}of r)for(let r=t;r<=n;r++){const t=b.set(s,e,i.normalizeCol(r),i.getWorldForColumn(r)).id;if(f.add(t),!this.has(t)){const e=new d(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),p.added.push(e)}}for(let e=this.tiles.length-1;e>=0;e--){const t=this.tiles[e];f.has(t.id)||(this._tiles.delete(t.id),this.tiles.splice(e,1),this._index.remove(t),p.removed.push(t))}(p.added.length||p.removed.length)&&this.emit("update",p),a.a.pool.release(t),f.clear(),p.added.length=0,p.removed.length=0}}},558:function(e,t,r){"use strict";class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}t.a=i},583:function(e,t,r){"use strict";var i=r(520);t.a=class{constructor(e,t){this._storage=new i.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}}},589:function(e,t,r){"use strict";function i(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:i,endTimeField:s}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(i&&s)t.forEach(e=>{const t=r.getAttribute(e,i),o=r.getAttribute(e,s);null==t||isNaN(t)||(n=Math.min(n,t)),null==o||isNaN(o)||(a=Math.max(a,o))});else{const e=i||s;t.forEach(t=>{const i=r.getAttribute(t,e);null==i||isNaN(i)||(n=Math.min(n,i),a=Math.max(a,i))})}return{start:n,end:a}}function s(e,t,r){if(!t||!e)return null;const{startTimeField:i,endTimeField:s}=e;if(!i&&!s)return null;const{start:n,end:a}=t;return null===n&&null===a?null:void 0===n&&void 0===a?()=>!1:i&&s?function(e,t,r,i,s){return null!=i&&null!=s?n=>{const a=e.getAttribute(n,t),o=e.getAttribute(n,r);return(null==a||a<=s)&&(null==o||o>=i)}:null!=i?t=>{const s=e.getAttribute(t,r);return null==s||s>=i}:null!=s?r=>{const i=e.getAttribute(r,t);return null==i||i<=s}:void 0}(r,i,s,n,a):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e.getAttribute(i,t)===r:null!=r&&null!=i?s=>{const n=e.getAttribute(s,t);return n>=r&&n<=i}:null!=r?i=>e.getAttribute(i,t)>=r:null!=i?r=>e.getAttribute(r,t)<=i:void 0}(r,i||s,n,a)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}))},592:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return l}));var i=r(73);const s=new RegExp("__begin__","ig"),n=new RegExp("__end__","ig"),a=new RegExp("^__begin__","i"),o=new RegExp("__end__$","i");function l(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function c(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function u(e){const t=c(e);if(!t)return null;switch(t.type){case"conventional":return d(t.expression);case"arcade":return t.expression}return null}function h(e){const t=c(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e.match(p);return t&&t[1].trim()||null}(t.expression);case"arcade":return m(t.expression)}return null}function d(e){let t;return e?(t=Object(i.c)(e,e=>'__begin__$feature["'+e+'"]__end__'),t=a.test(t)?t.replace(a,""):'"'+t,t=o.test(t)?t.replace(o,""):t+'"',t=t.replace(s,'" + ').replace(n,' + "')):t='""',t}const p=/^\s*\{([^}]+)\}\s*$/i;const f=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,b=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,y=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function m(e){if(!e)return null;let t=f.exec(e)||b.exec(e);return t?t[1]||t[3]:(t=y.exec(e),t?t[2]:null)}},599:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return F})),r.d(t,"c",(function(){return q})),r.d(t,"d",(function(){return M})),r.d(t,"e",(function(){return z})),r.d(t,"f",(function(){return T})),r.d(t,"g",(function(){return k})),r.d(t,"h",(function(){return E})),r.d(t,"i",(function(){return I}));r(9);var i=r(8),s=r(32),n=r(14),a=r(7),o=r(34),l=r(74),c=r(220),u=r(222),h=r(59),d=r(50),p=r(303),f=r(418),b=r(413),y=(r(515),r(442));function m(e,t){return e?t?4:3:t?3:2}function g(e,t,r,i,s){if(!e)return!1;const n=m(t,r),{coords:a,lengths:o}=e;let l=!1,c=0;for(const e of o)l=O(l,a,n,c,e,i,s),c+=e*n;return l}function O(e,t,r,i,s,n,a){let o=e,l=i;for(let e=i,c=i+s*r;e<c;e+=r){l=e+r,l===c&&(l=i);const s=t[e],u=t[e+1],h=t[l],d=t[l+1];(u<a&&d>=a||d<a&&u>=a)&&s+(a-u)/(d-u)*(h-s)<n&&(o=!o)}return o}const _=new s.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),v=Object.freeze({}),j=new f.a,x=new f.a,w=new f.a,S={esriGeometryPoint:b.m,esriGeometryPolyline:b.o,esriGeometryPolygon:b.n,esriGeometryMultipoint:b.l};function I(e,t,r,i=e.hasZ,s=e.hasM){const n=e.hasZ&&i,a=e.hasM&&s;if(r){const o=Object(b.u)(w,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,s);return Object(b.m)(o,n,a)}return Object(b.m)(t,n,a)}function T(e,t,r,i,s,n,a=t,o=r){const l=t&&a,c=r&&o,u=i?"coords"in i?i:i.geometry:null;if(!u)return null;if(s){let i=Object(b.q)(x,u,t,r,e,s,a,o);return n&&(i=Object(b.u)(w,i,l,c,e,n)),S[e](i,l,c)}if(n){const i=Object(b.u)(w,u,t,r,e,n,a,o);return S[e](i,l,c)}return Object(b.x)(j,u,t,r,a,o),S[e](j,l,c)}async function F(e,t,r){const{outFields:i,orderByFields:s,groupByFieldsForStatistics:n,outStatistics:a}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),E(e,t,r)}async function E(e,t,r){if(!e)return null;let{where:s}=e;if(e.where=s=s&&s.trim(),(!s||/^1 *= *1$/.test(s)||t&&t===s)&&(e.where=null),!e.geometry)return e;let n=await async function(e){const{geometry:t,distance:r,units:i}=e;if(null==r||"vertexAttributes"in t)return t;const s=t.spatialReference,n=i?_.fromJSON(i):Object(d.e)(s),a=s&&(Object(o.e)(s)||Object(o.h)(s))?t:await Object(y.a)(s,o.a).then(()=>Object(y.c)(t,o.a));return(await P().then(e=>e.geodesicBuffer))(a.spatialReference,a,r,n)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;n=Object(u.a)(n),n.spatialReference=t}e.geometry=n,await Object(y.a)(n.spatialReference,r);const a=(await Object(p.a)(Object(h.a)(n)))[0];if(Object(i.g)(a))throw v;const l=a.toJSON(),c=await Object(y.c)(l,l.spatialReference,r);if(!c)throw v;return c.spatialReference=r,e.geometry=c,e}function M(e){return e&&R in e?JSON.parse(JSON.stringify(e,C)):e}const R="_geVersion",C=(e,t)=>e!==R?t:void 0,A={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},N={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},D={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},L={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function P(){return Promise.all([r.e(11),r.e(27)]).then(r.bind(null,889))}function k(e,t,r,i,s){if(Object(h.g)(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=Object(b.g)(new f.a,t,!1,!1);return Object(a.r)(t=>function(e,t,r,i){return g(e,t,r,i.coords[0],i.coords[1])}(e,!1,!1,t))}if(Object(h.g)(t)&&"esriGeometryMultipoint"===r){const r=Object(b.g)(new f.a,t,!1,!1);if("esriSpatialRelContains"===e)return Object(a.r)(e=>function(e,t,r,i,s,n){const a=m(s,n),{coords:o,lengths:l}=i;if(!l)return!1;for(let i=0,s=0;i<l.length;i++,s+=a)if(!g(e,t,r,o[s],o[s+1]))return!1;return!0}(r,!1,!1,e,i,s))}if(Object(h.d)(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Object(a.r)(e=>Object(l.e)(t,T(r,i,s,e)));if(Object(h.d)(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return Object(a.r)(e=>Object(l.d)(t,T(r,i,s,e)));if(Object(h.d)(t)&&"esriSpatialRelIntersects"===e){const e=Object(c.b)(r);return Object(a.r)(n=>e(t,T(r,i,s,n)))}return P().then(n=>{const a=n[A[e]].bind(null,t.spatialReference,t);return e=>a(T(r,i,s,e))})}async function z(e,t,r){const{spatialRel:i,geometry:s}=e;if(s){if(!0!==N[i])throw new n.a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if(Object(o.f)(s.spatialReference)&&Object(o.f)(r)){if(!function(e){return!0===D[Object(h.c)(e)]}(s))throw new n.a("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===L[e]}(t))throw new n.a("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});if(e.outSR)return Object(y.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function q(e){if(Object(h.d)(e))return!0;if(Object(h.g)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},624:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return a}));var i=r(4),s=r(12),n=r(525);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?n.a:"esriGeometryPolyline"===e?n.c:n.b}}}function o(e,t){if(Object(i.a)("csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${t.indexOf(".")?`["${t}"]`:"."+t} = ${JSON.stringify(e[t])};`;const i=new Function(r);return()=>new i}catch(r){return()=>({[t]:null,...e})}}function l(e={}){return[{name:"New Feature",description:"",prototype:{attributes:Object(s.a)(e)}}]}},625:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},643:function(e,t,r){"use strict";var i=r(12),s=r(8),n=r(14),a=r(7),o=r(34),l=r(213),c=r(59),u=r(56),h=r(50),d=r(259),p=r(520),f=r(320),b=r(417),y=r(625),m=r(532),g=r(442),O=r(583),_=r(387);const v=new class{constructor(e,t){this._cache=new O.a(e),this._invalidCache=new O.a(t)}get(e,t){const r=`${t.uid}:${e}`,i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{const i=_.WhereClause.create(e,t);return this._cache.put(r,i),i}catch{return this._invalidCache.put(r,null),null}}}(50,500),j="feature-store:unsupported-query",x=Object(u.a)(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function w(e,t){return e?v.get(e,t):null}function S(e,t,r,i=!0){const s=[];for(const r of t)if("*"!==r&&!e.has(r))if(i){const t=I(r);try{const r=w(t,e);if(!r)throw new n.a(j,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new n.a(j,"expression is not standard",{clause:r});S(e,r.fieldNames,"expression contains missing fields")}catch(e){const t=e&&e.details;if(t&&(t.clause||t.where))throw e;t&&t.missingFields?s.push(...t.missingFields):s.push(r)}}else s.push(r);if(s.length)throw new n.a(j,r,{missingFields:s})}function I(e){return e.split(" as ")[0]}function T(e,t){const r=t.get(e);return!!r&&!x.has(r.type)}var F=r(599),E=r(589),M=r(125),R=r(413),C=r(463),A=class{constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;const i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;let e=0;for(const t of i){const i=I(t),s=this.fieldsIndex.get(i),n=s?null:w(i,r),a=s?s.name:t.split(" as ")[1]||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:a,clause:n})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(e=>this.getAttributes(e)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){const i=r?r.name:t;let s=null;return this._fieldDataCache.has(i)?s=this._fieldDataCache.get(i).clause:r||(s=w(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:s})),r?this.featureAdapter.getAttribute(e,i):s.calculateValue(e,this.featureAdapter)}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:w(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:w(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}_processAttributesForOutFields(e){const t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);const r={};for(const i of t){const{alias:t,clause:s}=this._fieldDataCache.get(i);r[t]=s?s.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(Object(s.g)(e)||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const i of t){const{alias:t}=this._fieldDataCache.get(i);r.push(e[t])}else for(const t in e)r.push(e[t]);const i=`${(t||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++n),n>1?null:e}};function N(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function D(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function L(e,t,r){return r?t-e:e-t}function P(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){const r=new Date(e).getTime(),s=new Date(t).getTime();if(!isNaN(r)&&!isNaN(s))return L(r,s,i)}if("number"==typeof e&&"number"==typeof t)return L(e,t,i);if("string"==typeof e&&"string"==typeof t){const s=e.toUpperCase(),n=t.toUpperCase();return!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?D(s,n,i):D(N(s),N(n),i)}return i?1:-1}class k{constructor(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(e){const t=new A(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:r,having:i}=e;if(!(null==r?void 0:r.length))return 1;const s=new Map,n=new Map,a=new Set,o=e.outStatistics;for(const e of o){const{statisticType:o}=e,l="exceedslimit"!==o?e.onStatisticField:void 0;if(!n.has(l)){const e=[];for(const i of r){const r=this._getAttributeValues(t,i,s);e.push(r)}n.set(l,this._calculateUniqueValues(e))}const c=n.get(l);for(const e in c){const{data:r,items:s}=c[e],n=r.join(",");i&&!t.validateItems(s,i)||a.add(n)}}return a.size}createQueryResponse(e){let t;return t=e.outStatistics?e.outStatistics.some(e=>"exceedslimit"===e.statisticType)?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(Object(o.f)(e.outSR)&&!Object(o.c)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=Object(F.d)({spatialReference:e.outSR,...Object(g.c)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR)}):t.queryGeometry=Object(F.d)({spatialReference:e.outSR,...this.queryGeometry})),t}executeAttributesQuery(e){const t=w(e.where,this.fieldsIndex);if(!t)return Object(a.r)(this);if(t.isStandardized){let r=0;const i=[];for(const e of this.items)t.testFeature(e,this.featureAdapter)&&(i[r++]=e);const s=new k(i,this.queryGeometry,this);return s.definitionExpression=e.where,Object(a.r)(s)}return Object(a.h)(new TypeError("Where clause is not standardized"))}executeObjectIdsQuery(e){if(!e.objectIds||!e.objectIds.length)return Object(a.r)(this);const t=Object(u.a)(e.objectIds),r=this.featureAdapter.getObjectId;return Object(a.r)(new k(this.items.filter(e=>t.has(r(e))),this.queryGeometry,this))}executeTimeQuery(e){const t=Object(E.b)(this.timeInfo,e.timeExtent,this.featureAdapter);if(!Object(s.h)(t))return Object(a.r)(this);const r=this.items.filter(t);return Object(a.r)(new k(r,this.queryGeometry,this))}filterLatest(){const{trackIdField:e,startTimeField:t,endTimeField:r}=this.timeInfo,i=r||t,s=new Map,n=this.featureAdapter.getAttribute;for(const t of this.items){const r=n(t,e),a=n(t,i),o=s.get(r);(!o||a>n(o,i))&&s.set(r,t)}const o=Object(M.e)(s);return Object(a.r)(new k(o,this.queryGeometry,this))}async project(e){if(!e||Object(o.c)(this.spatialReference,e))return this;const t=this.featureAdapter,r=(await Object(g.d)(this.items.map(e=>Object(F.f)(this.geometryType,this.hasZ,this.hasM,t.getGeometry(e))),this.spatialReference,e)).map((e,r)=>t.cloneWithGeometry(this.items[r],Object(R.d)(e,this.hasZ,this.hasM)));return new k(r,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:e,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})}_sortFeatures(e,t,r){if(e.length>1&&t&&t.length)for(const i of t.reverse()){const t=i.split(" "),s=t[0],n=this.fieldsIndex.get(s),a=t[1]&&"desc"===t[1].toLowerCase();e.sort((e,t)=>P(r(e,s,n),r(t,s,n),n,a))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:r,hasM:i,hasZ:s,objectIdField:n,spatialReference:a}=this,{outFields:o,outSR:l,quantizationParameters:c,resultRecordCount:u,resultOffset:h,returnZ:d,returnM:p}=e,f=null!=u&&t.length>(h||0)+u,b=o&&(o.indexOf("*")>-1?[...this.fieldsIndex.fields]:o.map(e=>this.fieldsIndex.get(e)));return{exceededTransferLimit:f,features:this._createFeatures(e,t),fields:b,geometryType:r,hasM:i&&p,hasZ:s&&d,objectIdFieldName:n,spatialReference:Object(F.d)(l||a),transform:c&&Object(C.c)(c)||null}}_createFeatures(e,t){const r=new A(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:s}=this,{orderByFields:n,quantizationParameters:a,returnGeometry:o,returnCentroid:l,maxAllowableOffset:c,resultOffset:u,resultRecordCount:h,returnZ:d=!1,returnM:p=!1}=e,f=s&&d,b=i&&p;let y=[],m=0;const g=[...t];if(this._sortFeatures(g,n,(e,t,i)=>r.getFieldValue(e,t,i)),o||l){const e=Object(C.c)(a);if(o&&!l)for(const t of g)y[m++]={attributes:r.getAttributes(t),geometry:Object(F.f)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,f,b)};else if(!o&&l)for(const t of g)y[m++]={attributes:r.getAttributes(t),centroid:Object(F.i)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of g)y[m++]={attributes:r.getAttributes(t),centroid:Object(F.i)(this,this.featureAdapter.getCentroid(t,this),e),geometry:Object(F.f)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,f,b)}}else for(const e of g){const t=r.getAttributes(e);t&&(y[m++]={attributes:t})}const O=u||0;if(null!=h){const e=O+h;y=y.slice(O,Math.min(y.length,e))}return y}_createExceedsLimitQueryResponse(e){let t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(const t of e.outStatistics)if("exceedslimit"===t.statisticType){r=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,i=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{const e=this.hasZ?this.hasM?4:3:this.hasM?3:2,r=this.featureAdapter;t=this.items.reduce((e,t)=>{const i=r.getGeometry(t);return e+(i&&i.coords.length||0)},0)/e>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){const t={attributes:{}},r=[],i=new Map,s=new Map,n=new Map,a=new Map,o=new A(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:c,having:u,orderByFields:h}=e,d=c&&c.length,p=!!d,f=p&&c[0],b=p&&!this.fieldsIndex.get(f);for(const e of l){const{outStatisticFieldName:l,statisticType:h}=e,y=e,m="exceedslimit"!==h?e.onStatisticField:void 0,g="percentile_disc"===h||"percentile_cont"===h,O=p&&1===d&&(m===f||b)&&"count"===h;if(p){if(!n.has(m)){const e=[];for(const t of c){const r=this._getAttributeValues(o,t,i);e.push(r)}n.set(m,this._calculateUniqueValues(e))}const e=n.get(m);for(const t in e){const{count:r,data:s,items:n,itemPositions:h}=e[t],d=s.join(",");if(!u||o.validateItems(n,u)){const e=a.get(d)||{attributes:{}};let t=null;if(O)t=r;else{const e=this._getAttributeValues(o,m,i),r=h.map(t=>e[t]);t=g&&"statisticParameters"in y?this._getPercentileValue(y,r):this._getStatisticValue(y,r)}e.attributes[l]=t,c.forEach((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+(r+1)]=s[r]),a.set(d,e)}}}else{const e=this._getAttributeValues(o,m,i);t.attributes[l]=g&&"statisticParameters"in y?this._getPercentileValue(y,e):this._getStatisticValue(y,e,s)}r.push({name:l,alias:l,type:"esriFieldTypeDouble"})}const y=p?Object(M.e)(a):[t];return this._sortFeatures(y,h,(e,t)=>e.attributes[t]),{fields:r,features:y}}_getStatisticValue(e,t,r){const{onStatisticField:i,statisticType:s}=e,n=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,n),n["var"===s?"variance":s]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:i,statisticType:s}=e,{value:n,orderBy:a}=i,o="desc"===a,l=this.fieldsIndex.get(r),c=[...t].filter(e=>null!=e).sort((e,t)=>P(e,t,l,o));return this._calculatePercentile(c,n,"percentile_disc"===s)}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);const i=this.fieldsIndex.get(t),s=this.items.map(r=>e.getFieldValue(r,t,i));return r.set(t,s),s}_calculateStatistics(e){let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,s=null,n=null,a=null;const o=[];let l=0;for(const s of e)"string"==typeof s?l++:null==s||isNaN(s)||(i+=s,t=Math.min(t,s),r=Math.max(r,s),o.push(s),l++);if(l){s=i/l;let e=0;for(const t of o)e+=Math.pow(t-s,2);a=l>1?e/(l-1):0,n=Math.sqrt(a)}else t=null,r=null;return{avg:s,count:l,max:r,min:t,stddev:n,sum:i,variance:a}}_calculateUniqueValues(e){const t={},r=this.items,i=r.length;for(let s=0;s<i;s++){const i=r[s],n=[];for(const t of e)n.push(t[s]);const a=n.join(",");null==t[a]?t[a]={count:1,data:n,items:[i],itemPositions:[s]}:(t[a].count++,t[a].items.push(i),t[a].itemPositions.push(s))}return t}_calculatePercentile(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];const i=(e.length-1)*t,s=Math.floor(i),n=s+1,a=i%1,o=e[s],l=e[n];return n>=e.length||r||"string"==typeof o||"string"==typeof l?o:o*(1-a)+l*a}}var z=k;const q=new Set,G=new p.c(2e6);let V=0;const B=Object(m.b)(),U=Object(m.b)();t.a=class{constructor(e){this.capabilities={query:y.a},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new p.b(V+++"$$",G)),this.fieldsIndex=new b.a(e.fields),e.scheduler&&e.task&&(this._frameQueue=new f.a,this._frameTask=e.scheduler.registerTask(e.task,e=>this._update(e),()=>this._frameQueue.length>0))}destroy(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(F.d)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(E.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}async executeQuery(e={},t){let r,s=Object(i.a)(e);try{s=await this._schedule(()=>Object(F.b)(s,this.definitionExpression,this.spatialReference)),s=await this._reschedule(()=>this._checkQuerySupport(s)),r=await this._reschedule(()=>this._executeGeometryQuery(s)),r=await this._reschedule(()=>r.executeObjectIdsQuery(s)),r=await this._reschedule(()=>r.executeTimeQuery(s)),r=await this._reschedule(()=>r.executeAttributesQuery(s))}catch(e){if(e!==F.a)throw e;r=new z([],null,this)}return r.createQueryResponse(s)}async executeQueryForCount(e={},t){let r,s=Object(i.a)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=await this._schedule(()=>Object(F.b)(s,this.definitionExpression,this.spatialReference)),s=await this._reschedule(()=>this._checkQuerySupport(s)),r=await this._reschedule(()=>this._executeGeometryQuery(s)),r=await this._reschedule(()=>r.executeObjectIdsQuery(s)),r=await this._reschedule(()=>r.executeTimeQuery(s)),r=await this._reschedule(()=>r.executeAttributesQuery(s))}catch(e){if(e!==F.a)throw e;return 0}return r.createQueryResponseForCount(s)}async executeQueryForExtent(e={},t){let r,s=Object(i.a)(e);const n=s.outSR;try{s=await this._schedule(()=>Object(F.b)(s,this.definitionExpression,this.spatialReference)),s=await this._reschedule(()=>this._checkQuerySupport(s)),s.returnGeometry=!0,s.returnCentroid=!1,s.outSR=null,r=await this._reschedule(()=>this._executeGeometryQuery(s)),r=await this._reschedule(()=>r.executeObjectIdsQuery(s)),r=await this._reschedule(()=>r.executeTimeQuery(s)),r=await this._reschedule(()=>r.executeAttributesQuery(s));const e=r.size;if(!e)return{count:e,extent:null};Object(m.i)(U,m.a),this.featureStore.forEachBounds(r.items,e=>Object(m.e)(U,e),B);const t={xmin:U[0],ymin:U[1],xmax:U[3],ymax:U[4],spatialReference:Object(F.d)(this.spatialReference)};this.hasZ&&isFinite(U[2])&&isFinite(U[5])&&(t.zmin=U[2],t.zmax=U[5]);const i=Object(g.c)(t,r.spatialReference,n);if(i.spatialReference=Object(F.d)(n||this.spatialReference),i.xmax-i.xmin==0){const e=Object(h.c)(i.spatialReference);i.xmin-=e,i.xmax+=e}if(i.ymax-i.ymin==0){const e=Object(h.c)(i.spatialReference);i.ymin-=e,i.ymax+=e}if(this.hasZ&&null!=i.zmin&&null!=i.zmax&&i.zmax-i.zmin==0){const e=Object(h.c)(i.spatialReference);i.zmin-=e,i.zmax+=e}return{count:e,extent:i}}catch(e){if(e===F.a)return{count:0,extent:null};throw e}}async executeQueryForIds(e={},t){return this.executeQueryForIdSet(e,t).then(e=>Object(u.c)(e))}async executeQueryForIdSet(e={},t){let r,s=Object(i.a)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=await this._schedule(()=>Object(F.b)(s,this.definitionExpression,this.spatialReference)),s=await this._reschedule(()=>this._checkQuerySupport(s)),r=await this._reschedule(()=>this._executeGeometryQuery(s)),r=await this._reschedule(()=>r.executeObjectIdsQuery(s)),r=await this._reschedule(()=>r.executeTimeQuery(s)),r=await this._reschedule(()=>r.executeAttributesQuery(s));const e=r.items,t=new Set;return await this._reschedule(()=>{for(const i of e)t.add(r.featureAdapter.getObjectId(i))}),t}catch(e){if(e===F.a)return new Set;throw e}}async executeQueryForLatestObservations(e={},t){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new n.a("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});let r,s=Object(i.a)(e);try{s=await this._schedule(()=>Object(F.b)(s,this.definitionExpression,this.spatialReference)),s=await this._reschedule(()=>this._checkQuerySupport(s)),r=await this._reschedule(()=>this._executeGeometryQuery(s)),r=await this._reschedule(()=>r.executeObjectIdsQuery(s)),r=await this._reschedule(()=>r.executeTimeQuery(s)),r=await this._reschedule(()=>r.executeAttributesQuery(s)),r=await this._reschedule(()=>r.filterLatest())}catch(e){if(e!==F.a)throw e;r=new z([],null,this)}return r.createQueryResponse(s)}async _schedule(e){return this._frameQueue?this._frameQueue.push(e):e()}async _reschedule(e){return this._frameQueue?this._frameQueue.unshift(e):e()}_update(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null}_getAll(){if(!this._allItems){const e=[];this.featureStore.forEach(t=>e.push(t)),this._allItems=new z(e,null,this)}return this._allItems}async _executeGeometryQuery(e){const{geometry:t,outSR:r,spatialRel:i}=e,n=Object(o.f)(r)&&!Object(o.c)(this.spatialReference,r),a=this._geometryQueryCache?n?JSON.stringify({geometry:t,spatialRelationship:i,outSpatialReference:r}):JSON.stringify({geometry:t,spatialRelationship:i}):null;if(a){const e=this._geometryQueryCache.get(a);if(!Object(s.i)(e))return e}const l=async t=>{if(n&&(e.returnGeometry||e.returnCentroid)){const e=await t.project(r);return a&&this._geometryQueryCache.put(a,e,e.size||1),e}return a&&this._geometryQueryCache.put(a,t,t.size||1),t};if(!t)return l(this._getAll());const c=this.featureAdapter;if("esriSpatialRelDisjoint"===i){const e=this._searchFeatures(this._getQueryBBoxes(t));if(!e.length)return l(this._getAll());let r,s;const n=new Set;for(const t of e)n.add(c.getObjectId(t));return await this._reschedule(()=>{let e=0;r=new Array(n.size),this.featureStore.forEach(t=>r[e++]=t),s=n}),l(await this._reschedule(async()=>{const e=await Object(F.g)(i,t,this.geometryType,this.hasZ,this.hasM);return new z(await this._runSpatialFilter(r,t=>!s.has(c.getObjectId(t))||e(c.getGeometry(t))),t,this)}))}const u=this._searchFeatures(this._getQueryBBoxes(t));if(!u.length){const e=new z([],t,this);return a&&this._geometryQueryCache.put(a,e,e.size||1),e}if(this._canExecuteSoloPass(t,e))return l(new z(u,t,this));const h=await Object(F.g)(i,t,this.geometryType,this.hasZ,this.hasM),d=await this._runSpatialFilter(u,e=>h(c.getGeometry(e)));return l(new z(d,t,this))}async _runSpatialFilter(e,t){if(!t)return e;if(!this._budget)return e.filter(e=>t(e));let r=0;const i=new Array,s=async()=>{for(;r<e.length;){const n=e[r];t(n)&&i.push(n),this._budget.done&&await this._reschedule(()=>s()),++r}};return this._reschedule(()=>s()).then(()=>i)}_canExecuteSoloPass(e,t){const{geometryType:r}=this,{spatialRel:i}=t;return Object(F.c)(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))}_getQueryBBoxes(e){if(Object(F.c)(e)){if(Object(c.d)(e))return[Object(d.i)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(c.g)(e))return e.rings.map(e=>Object(d.i)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1])))}return[Object(l.a)(Object(d.d)(),e)]}_searchFeatures(e){for(const t of e)this.featureStore.forEachInBounds(t,e=>{q.add(e)});const t=new Array(q.size);let r=0;return q.forEach(e=>t[r++]=e),q.clear(),t}async _checkQuerySupport(e){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new n.a("feature-store:unsupported-query","Unsupported query options",{query:e});return Object(a.a)([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),Object(F.e)(e,this.geometryType,this.spatialReference),Object(g.a)(this.spatialReference,e.outSR)]).then(()=>e)}_checkAttributesQuerySupport(e){const{outFields:t,orderByFields:r,returnDistinctValues:i,outStatistics:s}=e,a=s?s.map(e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()):[];if(r&&r.length>0){const e=" asc",t=" desc",i=r.map(r=>{const i=r.toLowerCase();return i.indexOf(e)>-1?i.split(e)[0]:i.indexOf(t)>-1?i.split(t)[0]:r}).filter(e=>-1===a.indexOf(e));S(this.fieldsIndex,i,"orderByFields contains missing fields")}if(t&&t.length>0)S(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new n.a("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});!function(e,t){if(!t)return!0;const r=v.get(t,e);if(!r)throw new n.a(j,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new n.a(j,"where clause is not standard",{where:t});S(e,r.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,e.where)}async _checkStatisticsQuerySupport(e){const{outStatistics:t,groupByFieldsForStatistics:r,having:i}=e,s=r&&r.length,a=t&&t.length;if(i){if(!s||!a)throw new n.a("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});!function(e,t,r){if(!t)return!0;const i=v.get(t,e);if(!i)throw new n.a(j,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new n.a(j,"having does not contain a valid aggregate function",{having:t});const s=i.fieldNames;if(S(e,s,"having contains missing fields"),!i.getExpressions().every(t=>{const{aggregateType:i,field:s}=t,n=e.has(s)&&e.get(s).name;return r.some(t=>{const{onStatisticField:r,statisticType:s}=t;return(e.has(r)&&e.get(r).name)===n&&s.toLowerCase().trim()===i})}))throw new n.a(j,"expressions in having should also exist in outStatistics",{having:t})}(this.fieldsIndex,i,t)}if(a){if(!function(e){return e.every(e=>"exceedslimit"!==e.statisticType)}(t))return;const i=t.map(e=>e.onStatisticField);S(this.fieldsIndex,i,"onStatisticFields contains missing fields"),s&&S(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");for(const r of t){const{onStatisticField:t,statisticType:i}=r;if("percentile_disc"!==i&&"percentile_cont"!==i||!("statisticParameters"in r)){if("count"!==i&&t&&T(t,this.fieldsIndex))throw new n.a("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:r,query:e})}else{const{statisticParameters:t}=r;if(!t)throw new n.a("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:r,query:e})}}}}}},698:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(4),s=(r(9),r(8)),n=r(7),a=r(301),o=r(522),l=r(5);var c=function(e,t,r){e.referencesGeometry();const i=t.readArcadeFeature();try{return e.evaluate({...r,$feature:i})}catch(e){return l.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}};const u=r.e(102).then(r.bind(null,975));class h{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}async updateSchema(e,t){const r=Object(o.a)(this._schema,t);if(this._schema=t,!t||Object(s.g)(r)||!Object(o.b)(r,"attributes"))return;Object(i.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",r),this._bitsets.computed.clear(),e.targets[t.name]=!0;const a=t.attributes,l=[],c=[];for(const e in a){const t=a[e];switch(t.type){case"field":break;case"expression":l.push(this._createArcadeComputedField(t));break;case"label-expression":l.push(this._createLabelArcadeComputedField(t));break;case"statistic":c.push(t)}}this._computedFields=await Object(n.a)(l),this._canCacheExpressionValue=!this._computedFields.some(e=>"expression"===e.type&&e.expression.referencesScale()),this._statisticFields=c}setComputedAttributes(e,t,r,i){const s=this._bitsets.computed;if(!this._canCacheExpressionValue||!s.has(r)){s.set(r);for(const s of this._computedFields){const n=this._evaluateField(t,s,i);switch(s.resultType){case"numeric":e.setComputedNumericAtIndex(r,s.fieldIndex,n);break;case"string":e.setComputedStringAtIndex(r,s.fieldIndex,n)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex;return{...e,expression:await Object(a.d)(e.valueExpression,t,r)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fields,{createLabelFunction:i}=await u,s=await i(e.label,r,t);return{...e,builder:s}}_evaluateField(e,t,r){switch(t.type){case"label-expression":{const r=e.readArcadeFeature();return t.builder.evaluate(r)||""}case"expression":{const{expression:i}=t;return c(i,e,{$view:{scale:r}})}}}}},713:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return _}));var i=r(14),s=r(529),n=r(418);function a(e){const t=[];return e.forEach(e=>t.push(e)),t}const o={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*l(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*c(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function u(e){for(;;){const{value:t,done:r}=e.next();if(r)return!1;if(t.length>2)return!0}}function h(e){let t=0;for(let r=0;r<e.length;r++){const i=e[r],s=e[(r+1)%e.length];t+=i[0]*s[1]-s[0]*i[1]}return t<=0}function d(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function p(e,t,r){switch(t.type){case"LineString":return function(e,t,r){return y(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const i of t.coordinates)y(e,i,r);return e}(e,t,r);case"MultiPoint":return function(e,t,r){return y(e,t.coordinates,r),e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const i of t.coordinates){f(e,i[0],r);for(let t=1;t<i.length;t++)b(e,i[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return g(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const i=t.coordinates;f(e,i[0],r);for(let t=1;t<i.length;t++)b(e,i[t],r);return e}(e,t,r)}}function f(e,t,r){const i=d(t);h(i)?y(e,i,r):m(e,i,r)}function b(e,t,r){const i=d(t);h(i)?m(e,i,r):y(e,i,r)}function y(e,t,r){for(const i of t)g(e,i,r);e.lengths.push(t.length)}function m(e,t,r){for(let i=t.length-1;i>=0;i--)g(e,t[i],r);e.lengths.push(t.length)}function g(e,t,r){const[i,s,n]=t;e.coords.push(i,s),r.hasZ&&e.coords.push(n||0)}function O(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function _(e){if(!e)throw new i.a("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new i.a("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const r="string"==typeof t?t:"name"===t.type?t.properties.name:null,s=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!s.test(r))throw new i.a("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function v(e,t={}){const r=l(e),i=[],s=new Set,n=new Set;let h=!1,d=Number.NEGATIVE_INFINITY,p=null,f=!1,b=void 0,{geometryType:y=null}=t,m=!1;for(;;){const{value:e,done:t}=r.next();if(t){const e=p&&1===p.length&&p[0]||null;if(e)for(const t of i)t.name===e&&(t.type="esriFieldTypeOID");return{fields:i,geometryType:y,hasZ:h,maxObjectId:Math.max(0,d),objectIdFieldName:e,objectIdFieldType:b,unknownFields:a(n)}}const{geometry:l,properties:g,id:_}=e;if((!l||(y||(y=o[l.type]),o[l.type]===y))&&(h||(h=u(c(l))),f||(f=null!=_,f&&(b=typeof _,"number"===b&&(p=Object.keys(g).filter(e=>g[e]===_)))),f&&"number"===b&&null!=_&&(d=Math.max(d,_),p.length>1?p=p.filter(e=>g[e]===_):1===p.length&&(p=g[p[0]]===_?p:[])),!m&&g)){let e=!0;for(const t in g){if(s.has(t))continue;const r=g[t];if(null==r){e=!1,n.add(t);continue}const a=O(r);"unknown"!==a?(n.delete(t),s.add(t),i.push({name:t,alias:t,type:a})):n.add(t)}m=e}}}function j(e,t){return function(e){const t=[];for(;;){const{value:r,done:i}=e.next();if(i)return t;t.push(r)}}(function*(e,t={}){const{geometryType:r,objectIdFieldName:i}=t;for(;;){const{value:a,done:l}=e.next();if(l)return;const{geometry:c,properties:u,id:h}=a;if(c&&o[c.type]!==r)continue;const d=u||{};i&&null!=h&&!d[i]&&(d[i]=h);const f=new s.a(c?p(new n.a,c,t):null,d);yield f}}(l(e),t))}},716:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u}));var i=r(8),s=r(83),n=r(532),a=r(465),o=r(698);function l(e){return(4294901760&e)>>>16}function c(e){return 65535&e}const u={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class h extends o.a{constructor(e,t){super(e,t),this.featureAdapter=u,this.events=new s.a,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._index=Object(a.a)(9,e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))}get storeStatistics(){return{featureCount:0,vertexCount:0}}onTileData(e,t,r){if(Object(i.g)(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=r,t.addOrUpdate._storage=r;const s=t.addOrUpdate.getCursor();for(;s.next();){const t=s.getObjectId(),i=s.instance<<16|s.getIndex();let n=this._objectIdToDisplayId.get(t);n||(n=r.createDisplayId(),this._objectIdToDisplayId.set(t,n),this._spatialIndexInvalid=!0),s.setDisplayId(n),r.setInstanceId(n,i),this.setComputedAttributes(r,s,n,e.scale)}return this.events.emit("changed"),t}forEach(e){this._objectIdToDisplayId.forEach(t=>{const r=this._storage.getInstanceId(t),i=this._lookupFeature(r);e(i)})}forEachUnsafe(e){this._objectIdToDisplayId.forEach(t=>{const r=this._storage.getInstanceId(t),i=l(r),s=c(r),n=this._getFeatureSet(i);n.setIndex(s),e(n)})}forEachInBounds(e,t){const r=this._searchIndex(e);for(const e of r){const r=this.lookupFeatureByDisplayId(e,this._storage);t(Object(i.m)(r))}}forEachBounds(e,t,r){this._rebuildIndex();const i=[0,0,0,0];for(const s of e){const e=s.getDisplayId();i[0]=this._storage.getXMin(e),i[1]=this._storage.getYMin(e),i[2]=this._storage.getXMax(e),i[3]=this._storage.getYMax(e),t(Object(n.g)(r,i))}}sweepFeatures(e,t){this._objectIdToDisplayId.forEach((r,i)=>{e.has(r)||(t.releaseDisplayId(r),this._objectIdToDisplayId.delete(i))}),this.events.emit("changed")}sweepFeatureSets(e){this._featureSetsByInstance.forEach((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)})}lookupObjectId(e,t){const r=this.lookupFeatureByDisplayId(e,t);return Object(i.g)(r)?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),r=l(t),i=c(t),s=this._getFeatureSet(r);return s?(s.setIndex(i),s):null}hasInstance(e){return this._featureSetsByInstance.has(e)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;this._index.clear();const e=[];this._objectIdToDisplayId.forEach(t=>{const r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)}),this._index.load(e),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=l(e),r=c(e),i=this._getFeatureSet(t);if(!i)return null;const s=i.getCursor();return s.setIndex(r),s}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}},984:function(e,t,r){"use strict";r.r(t),r.d(t,"getInstances",(function(){return Ze}));var i=r(0),s=r(4),n=(r(9),r(5)),a=(r(6),r(1)),o=r(2),l=(r(3),r(10),r(7)),c=(r(11),r(112)),u=r(304),h=r(295),d=r(311),p=r(557);class f{constructor(){this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}static create(e){const t=new f;for(const r in e){const i=e[r];if("object"==typeof i)for(const e in i){const s=i[e];t[r][e]=s}t[r]=i}return t}static empty(){return f.create({})}static all(){return f.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})}any(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter}describe(){let e=0,t="";if(this.mesh){e+=20,t+="-> (20) Mesh needs update\n";for(const e of this.why.mesh)t+=`    + ${e}\n`}if(this.source){e+=10,t+="-> (10) The source needs update\n";for(const e of this.why.source)t+=`    + ${e}\n`}this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed");const r=e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow";console.debug(`Applying ${r} update of cost ${e}/45 `),console.debug(t)}toJSON(){return{source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh,queryFilter:this.queryFilter}}}var b=r(8),y=r(16),m=r(413),g=r(417),O=r(232),_=r(547),v=r(554),j=r(536),x=r(716),w=r(643),S=r(212),I=r(522),T=r(183),F=r(396),E=r(302),M=r(14),R=r(65),C=r(307),A=r(168),N=(r(39),r(126),r(34)),D=(r(317),r(558)),L=(r(261),r(442)),P=r(713);r(624);n.a.getLogger("esri.layers.graphics.sources.ogcfeature");async function k(e,t,r){var i;const{capabilities:{query:{maxRecordCount:s}},collectionId:n,layerDefinition:a,url:o}=e,l=`${o}/collections/${n}/items`,{geometry:c,num:u,outSpatialReference:h,start:d,timeExtent:p,where:f}=t,b=function(e){if(!e)return null;const{xmin:t,ymin:r,xmax:i,ymax:s}=e;return`${t},${r},${i},${s}`}(Object(L.c)(c,N.a)),y=function(e){if(!e)return null;const{start:t,end:r}=e;return`${t?t.toISOString():".."}/${r?r.toISOString():".."}`}(p),g=function(e){return e&&"1=1"!==e?e:null}(f),O=null!=d?d:0,_=null!=u?u:null!=d&&void 0!==d?10:s,{data:v}=await Object(R.default)(l,{...r,query:{bbox:b,datetime:y,query:g,limit:_,startindex:O,f:"application/geo+json"}}),j=null==(i=v.links)?void 0:i.filter(e=>"next"===e.rel),x=0!==(null==j?void 0:j.length),{fields:w,globalIdField:S,hasM:I,hasZ:T,objectIdField:F}=a,E=a.geometryType,M=Object(P.a)(v,{geometryType:E,hasZ:T,objectIdFieldName:F});if(!Object(N.c)(h,N.a))for(const e of M)e.geometry&&(e.geometry=Object(m.d)(Object(L.c)(Object(m.k)(e.geometry,E,T,!1),N.a,h)));for(const e of M)e.objectId=e.attributes[F];const C=new D.a;return C.exceededTransferLimit=x,C.features=M,C.fields=w,C.geometryType=E,C.globalIdFieldName=S,C.hasM=I,C.hasZ=T,C.objectIdFieldName=F,C.spatialReference=h||N.a,C}var z=r(529),q=r(418),G=r(482),V=r(314),B=r(329);class U{constructor(){this.hasFeatures=!1,this.fieldIndexMap=new Map,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.dateFields=new Set,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}hasFieldIndex(e){return this.fieldIndexMap.has(e)}isDateField(e){return this.dateFields.has(e)}getFieldIndex(e){return this.fieldIndexMap.get(e)}}function Q(e){const t=e.getLength(),r=e.pos()+t,i={name:"",isDate:!1};for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:i.name=e.getString();break;case 2:"esriFieldTypeDate"===Object(B.b)(e.getEnum())&&(i.isDate=!0);break;default:e.skip()}return i}const J=n.a.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF");function $(e){for(;e.next();)switch(e.tag()){case 1:return e.getMessage();default:e.skip()}return null}class Y extends G.a{constructor(e,t,r,i){super(e),this._hasNext=!1,this._isPoints=!1,this._isPolygons=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},this._geometryType=i,this._reader=t,this._header=r,this._hasNext=r.hasFeatures,this._isPoints="esriGeometryPoint"===i,this._isPolygons="esriGeometryPolygon"===i}static fromBuffer(e,t){const r=function(e){try{const t=2,r=new V.a(new Uint8Array(e),new DataView(e));for(;r.next();)switch(r.tag()){case t:return $(r.getMessage());default:r.skip()}}catch(e){const t=new M.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});J.error(t)}return null}(e),i=function(e,t){const r=e.pos(),i=new U;let s=0,n=0,a=null,o=null,l=null,c=!1;for(;e.next();)switch(e.tag()){case 1:a=e.getString();break;case 3:o=e.getString();break;case 12:l=e.processMessage(B.c);break;case 9:i.exceededTransferLimit=e.getBool(),i.exceededTransferLimit&&(i.offsets.geometry=new Int32Array(8e3),i.centroid=new Int32Array(16e3));break;case 13:{const t=Q(e),r=t.name.toLowerCase().trim(),n=s++;i.fieldIndexMap.set(t.name,n),i.fieldIndexMap.set(r,n),t.isDate&&(i.dateFields.add(t.name),i.dateFields.add(r));break}case 15:{const r=e.getLength(),a=e.pos()+r;if(!i.exceededTransferLimit){const e=i.offsets.geometry,t=i.centroid;e.push(0),t.push(268435455),t.push(268435455)}!c&&i.exceededTransferLimit&&(c=!0,i.offsets.attributes=new Uint32Array(8e3*s));let o=n*s;for(;e.pos()<a&&e.next();)switch(e.tag()){case 1:{c?i.offsets.attributes[o++]=e.pos():i.offsets.attributes.push(e.pos());const t=e.getLength();e.skipLen(t);break}case 2:if(t){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 3:{e.getUInt32();const t=e.getSInt32(),r=e.getSInt32();i.centroid[2*n]=t,i.centroid[2*n+1]=r;break}default:e.skip()}}else{i.offsets.geometry[n]=e.pos();const t=e.getLength();e.skipLen(t)}break;case 4:{const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 3:{e.getUInt32();const t=e.getSInt32(),r=e.getSInt32();i.centroid[2*n]=t,i.centroid[2*n+1]=r;break}default:e.skip()}break}default:e.skip()}n++,i.hasFeatures=!0;break}default:e.skip()}const u=a||o;if(!u)throw new M.a("FeatureSet has no objectId or globalId field name");return i.featureCount=n,i.fieldCount=s,i.objectIdFieldIndex=i.getFieldIndex(u),i.transform=l,i.displayIds=new Uint32Array(i.featureCount),i.groupIds=new Uint16Array(i.featureCount),e.move(r),i}(r,"esriGeometryPoint"===t),s=G.a.createInstance();return new Y(s,r,i,t)}get geometryType(){return this._geometryType}get size(){return this._header.featureCount}get hasZ(){return!1}get hasM(){return!1}get stride(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getApproximateSize(){if(this._hasFilter){const e=Math.abs(this._xmax-this._xmin)*Math.abs(this._ymax-this._ymin),t=this.size*e/262144;return Math.max(Math.round(t),0)}return this.size}getQuantizationTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}getAttributeHash(){let e="";return this._header.fieldIndexMap.forEach(t=>{e+=this._readAttributeAtIndex(t)+"."}),e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}getGroupId(){return this._header.groupIds[this._featureIndex]}setGroupId(e){this._header.groupIds[this._featureIndex]=e}readLegacyFeature(){if(void 0===this._cache.legacyFeature){var e;const t=this.readCentroid(),r={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:null!=(e=t&&{x:t.coords[0],y:t.coords[1]})?e:null};return this._cache.legacyFeature=r,r}return this._cache.legacyFeature}readOptimizedFeature(){if(void 0===this._cache.optFeature){const e=new z.a(this.readGeometry(),this.readAttributes(),this.readCentroid());return this._cache.optFeature=e,e}return this._cache.optFeature}getXHydrate(){const e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]}getYHydrate(){const e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]}readLegacyPointGeometry(){return{x:this._header.centroid[2*this._featureIndex]+this._tx,y:this._header.centroid[2*this._featureIndex+1]+this._ty}}readLegacyGeometry(){const e=this.readGeometry();return Object(m.k)(e,this.geometryType,!1,!1)}readLegacyCentroid(){const e=this.readCentroid();if(!e)return null;const[t,r]=e.coords;return{x:t,y:r}}readGeometryArea(){return this._cache.area||this.readGeometry(),this._cache.area}readUnquantizedGeometry(){if(void 0===this._cache.unquantGeometry){const e=this.readGeometry();if(!e)return this._cache.unquantGeometry=null,null;const t=e.clone(),r=t.lengths,i=t.coords;for(let e=0,t=2;e<r.length;e++,t+=2){const s=r[e];for(let e=1;e<s;e+=1,t+=2)i[t]+=i[t-2],i[t+1]+=i[t-1]}return this._cache.unquantGeometry=t,t}return this._cache.unquantGeometry}readHydratedGeometry(){const e=this.readGeometry();if(!e)return null;const t=e.clone();return this._isPoints&&(t.coords[0]-=this._tx,t.coords[1]-=this._ty),Object(m.y)(t,t,this.hasZ,this.hasM,this.getQuantizationTransform()),t}readGeometry(){if(void 0===this._cache.geometry){let e=null;if(this._isPoints){const t=this._header.centroid[2*this._featureIndex]+this._tx,r=this._header.centroid[2*this._featureIndex+1]+this._ty;e=new q.a([],[t,r])}else{const t=this._header.offsets.geometry[this._featureIndex],r=this._reader;if(0===t)return null;r.move(t);try{e=this._parseGeometry(r)}catch(e){return console.error("Failed to parse geometry!",e),null}}return this._cache.geometry=e,e}return this._cache.geometry}readCentroid(){if(void 0===this._cache.centroid){let e=null;const t=this._header.centroid[2*this._featureIndex]+this._tx,r=this._header.centroid[2*this._featureIndex+1]+this._ty;return 268435455===t?(e=this._computeCentroid(),e&&(this._header.centroid[2*this._featureIndex]=e.coords[0]-this._tx,this._header.centroid[2*this._featureIndex+1]=e.coords[1]-this._ty)):e=new q.a([],[t,r]),this._cache.centroid=e,e}return this._cache.centroid}copy(){const e=this._reader.clone(),t=new Y(this.instance,e,this._header,this.geometryType);return this.copyInto(t),t}next(){if(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,!this._hasFilter)return++this._featureIndex<this.size;for(;++this._featureIndex<this.size&&!this._passesFilter(););return this._featureIndex<this.size}_readAttribute(e,t){const r=this._header.hasFieldIndex(e)?e:function(e){return e.toLowerCase().trim()}(e),i=this._header.getFieldIndex(r);if(null==i)return;const s=this._readAttributeAtIndex(i);return t&&this._header.isDateField(r)?new Date(s):s}_readAttributes(){const e={};return this._header.fieldIndexMap.forEach((t,r)=>{e[r]=this._readAttributeAtIndex(t)}),e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext}_passesFilter(){if(!this._hasFilter)return!0;let e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];if(268435455===e){if(this._isPolygons&&!this.readCentroid())return!1;e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1]}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_readAttributeAtIndex(e){const t=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],r=this._reader;return r.move(t),function(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:{const t=e.getString();return""===t?null:t}case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(r)}_preprocessPolygon(e,t){let r=0,i=0,s=0,n=!1,a=!1,o=!1,l=-1;const c=[];let u=0,h=!1;for(let d=0;d<t.length;d++){const p=t[d];let f=e[2*r],b=e[2*r+1],y=0;for(let t=1;t<p;t++){const i=f,s=b,n=f+e[2*(r+t)],a=b+e[2*(r+t)+1];f=n,b=a,y+=(n-i)*(a+s)*.5}const m=y>0;if(m&&h&&(i+=p),m||(l++,h=!1),l>=1e6)break;u+=y,n&&m&&a&&(o=!0);{e[2*s]=e[2*i],e[2*s+++1]=e[2*i+++1];let t=1,r=e[2*i],n=e[2*i+++1];for(let a=2;a<p;a++){const a=e[2*i],o=e[2*i+++1];r*o-a*n==0?(r+=a,n+=o):(e[2*s]=r,e[2*s+++1]=n,t++,r=a,n=o)}e[2*s]=r,e[2*s+++1]=n,t++,c.push(t)}n=!1,a=!0,r+=p}return c.length?(this._cache.area=Math.abs(u),new q.a(c,e,o)):null}_parseGeometry(e){const t=e.getLength(),r=e.pos()+t,i=[],s=[];for(;e.pos()<r&&e.next();)switch(e.tag()){case 2:{const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r;)s.push(e.getUInt32());break}case 3:{const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r;)i.push(e.getSInt32()),i.push(e.getSInt32()),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32();break}case 1:default:e.skip()}let n=0;for(const e of s)i[2*n]+=this._tx,i[2*n+1]+=this._ty,n+=e;return this._isPolygons?this._preprocessPolygon(i,s):new q.a(s,i)}}class H{constructor(e){this.service=e}destroy(){}}class Z extends H{constructor(e){super(e),this._portsOpen=Object(C.c)(e.source).then(e=>this.client=e)}destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const r=await this.client.invoke("queryFeatures",e.toJSON(),t);return j.a.fromFeatureSet(r,this.service.objectIdField)}}class W extends H{async executeQuery(e,t){const{data:r}=await Object(A.executeQueryPBFBuffer)(this.service.source,e,t);return Y.fromBuffer(r,this.service.geometryType)}}class X extends H{async executeQuery(e,t){const{source:r,capabilities:i,spatialReference:s,objectIdField:n}=this.service;if(e.quantizationParameters&&!i.query.supportsQuantization){const i=e.clone();i.quantizationParameters=null;const{data:a}=await Object(A.executeQuery)(r,i,s,t),o=Object(m.b)(a,n);return Object(m.t)(t.transform,o),j.a.fromOptimizedFeatureSet(o)}const{data:a}=await Object(A.executeQuery)(r,e,this.service.spatialReference,t);return j.a.fromFeatureSet(a,this.service.objectIdField)}}class K extends H{async executeQuery(e,t){const{capabilities:r}=this.service;if(e.quantizationParameters&&!r.query.supportsQuantization){e.clone().quantizationParameters=null;const r=await k(this.service.source,e,t);return Object(m.t)(t.transform,r),j.a.fromOptimizedFeatureSet(r)}const i=await k(this.service.source,e,t);return j.a.fromOptimizedFeatureSet(i)}}var ee=r(83);class te{constructor(e){this._abortController=new AbortController,this.requests={pending:new Array,done:new Array},this.tile=e}get signal(){return this._abortController.signal}add(e){this.requests.done.push(e),e.request.end&&(this.resolved=!0)}abort(){this._abortController.abort()}}class re{constructor(e){this.events=new ee.a,this._subscriptions=new Map,this._serviceQueryInfo={outSpatialReference:e.outSR},this._serviceInfo=e.serviceInfo,this._onRequest=e.onRequest}async queryLastEditDate(){throw new Error("Service does not support query type")}async query(e,t){throw new Error("Service does not support query")}get geometryType(){return this._serviceInfo.geometryType}update(e){Object(I.a)(e,this._sourceQueryInfo)&&(this._sourceQueryInfo=e)}updateSubscriptions(){}setViewState(e){}subscribe(e){const t=new te(e);this._subscriptions.set(e.id,t)}unsubscribe(e){const t=this.get(e.id);Object(b.h)(t)&&t.abort(),this._subscriptions.delete(e.id)}pause(){}resume(){}get(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null}enableEvent(e,t){}}const ie=n.a.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource");class se extends re{constructor(e){super(e),this.type="feature",this._adapter=function(e){const{capabilities:t}=e;return(r=e.source)&&r.capabilities&&r.collectionId&&r.layerDefinition&&r.url?new K(e):function(e){return Array.isArray(e.source)}(e)?new Z(e):t.query.supportsFormatPBF?new W(e):new X(e);var r}(e.serviceInfo),this._queue=new O.a({concurrency:8,process:async e=>{Object(l.t)(e);const t=e.tile.key.id,{tile:r,signal:i}=e,n={query:Object(s.a)("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,signal:i,transform:r.transform};return this._adapter.executeQuery(e.query,n)}}),this._patchQueue=new O.a({concurrency:8,process:async e=>{Object(l.t)(e);const t=e.tile.key.id,{tile:r,signal:i}=e,n={query:Object(s.a)("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,signal:i,transform:r.transform};return this._adapter.executeQuery(e.query,n)}})}destroy(){this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()}setViewState(e){}get updating(){return!!this._queue.length}subscribe(e){super.subscribe(e),this._fetchDataTile(e).catch(t=>{Object(l.b)(t)||ie.error(new M.a("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t}))})}unsubscribe(e){super.unsubscribe(e)}pause(){this._queue.pause()}resume(){this._queue.resume()}async query(e,t){return this._adapter.executeQuery(e,t)}async queryLastEditDate(){const e=this._serviceInfo.source,t={...e.query,f:"json"};return(await Object(R.default)(e.path,{query:t,responseType:"json"})).data.editingInfo.lastEditDate}forEachRequest(e,t){const r=this._subscriptions.get(e),{requests:i,signal:s}=r;for(const e of i.done)t(e.request,{signal:s})}async _executePatchQuery(e,t,r,i){const s=t.clone();s.outFields=[this._serviceInfo.objectIdField,...r],s.returnCentroid=!1,s.returnGeometry=!1;const n=s.start/8e3,a=i.signal;return this._patchQueue.push({tile:e,query:s,signal:a,depth:n})}async _resendRequest(e,t){const{query:r,request:i}=e,n=r.outFields,a=this._sourceQueryInfo.outFields,o=a.filter(e=>-1===n.indexOf(e));if(!Object(b.g)(i.features))if(o.length)try{const e=await this._executePatchQuery(i.tile,r,o,t);Object(l.t)(t),r.outFields=a,i.features.joinAttributes(e),this._onRequest({...i,end:i.end||t.end},!1,t)}catch(e){Object(s.a)("esri-2d-debug")&&!Object(l.b)(e)&&console.debug("Encountered an error when querying:",e)}else this._onRequest({...i,end:i.end||t.end},!1,t)}async resend({dataTileOnly:e}){let t=0,r=!1;const i=[];for(this._subscriptions.forEach(e=>{if(!e.requests.done.length){const t=e.tile;this._onRequest({tile:t,id:t.id,features:null,noData:!0,end:!1},!1,{dataTileOnly:!0})}});!r;)r=!0,this._subscriptions.forEach(({requests:s,signal:n})=>{if(s.done.length>t){r=!1;const a=s.done.length===t+1;i.push(this._resendRequest(s.done[t],{signal:n,dataTileOnly:e,end:a}))}}),t++;await Object(l.a)(i)}_createQuery(e,t){const r=new T.a({...this._serviceQueryInfo,...this._sourceQueryInfo,...t});return this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,r.maxAllowableOffset=e.resolution),t.quantizationParameters&&"esriGeometryPolyline"===this.geometryType&&(r.maxAllowableOffset=e.resolution),r.resultType="tile",r.geometry=e.extent,r}}const ne=Object(s.a)("esri-featurelayer-webgl"),ae=Object(s.a)("esri-mobile"),oe={maxDrillLevel:ne&&"object"==typeof ne&&null!=ne.maxDrillLevel?ne.maxDrillLevel:ae?1:4,maxRecordCountFactor:ne&&"object"==typeof ne&&null!=ne.maxRecordCountFactor?ne.maxRecordCountFactor:ae?1:3};class le extends se{constructor(e){super(e)}async _fetchDataTile(e){const t=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,r=this._subscriptions.get(e.key.id),i=r.signal,n=e.getQuantizationParameters(),a=this._sourceQueryInfo;let o=0;const c=async(u,h)=>{const d=this._createQuery(u,{maxRecordCountFactor:t?oe.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:n});o++;try{const t=await this._queue.push({tile:e,query:d,signal:i,depth:h});if(o--,Object(l.t)(i),!t)return;if(a!==this._sourceQueryInfo)return void c(u,h);if(t.exceededTransferLimit&&h<oe.maxDrillLevel){for(const e of u.createChildTiles())c(e,h+1);return}const s={tile:e,id:e.id,features:t,end:0===o};r.requests.done.push({query:d,request:s}),this._onRequest(s)}catch(t){Object(l.b)(t)||(Object(s.a)("esri-2d-debug")&&console.debug("Encountered an error while querying",t),this._onRequest({tile:e,id:e.id,features:null,end:!0}))}};c(e,0)}}var ce=r(465),ue=r(69),he=r(527);var de=r(221);let pe=class extends(ee.a.EventedMixin(c.a)){onFeature(e){this.emit("feature",e)}};pe=Object(i.a)([Object(o.a)("esri.layers.graphics.sources.connections.StreamConnection")],pe);var fe=pe;const be=n.a.getLogger("esri.layers.graphics.sources.connections.WebSocketConnection");var ye,me;(me=ye||(ye={}))[me.CONNECTING=0]="CONNECTING",me[me.OPEN=1]="OPEN",me[me.CLOSING=2]="CLOSING",me[me.CLOSED=3]="CLOSED";let ge=class extends fe{constructor(e){super(),this.errorString=null;const{geometryType:t,spatialReference:r,sourceSpatialReference:i}=e;this._config=e,this._featureZScaler=Object(de.a)(t,i,r),this._open()}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){Object(b.h)(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(Object(b.g)(this._websocket))return"disconnected";switch(this._websocket.readyState){case ye.CONNECTING:case ye.OPEN:return"connected";case ye.CLOSING:case ye.CLOSED:return"disconnected"}}async _tryCreateWebSocket(e=this._config.source.path,t=1e3,r=0){try{if(this.destroyed)return;this._websocket=await this._createWebSocket(e),this.notifyChange("connectionStatus")}catch(i){const s=t/1e3;return this._config.maxReconnectionAttempts&&r>=this._config.maxReconnectionAttempts?(be.error(new M.a("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void this.destroy()):(be.error(new M.a("websocket-connection",`Failed to connect. Attempting to reconnect in ${s}s`,i)),await Object(l.s)(t),this._tryCreateWebSocket(e,Math.min(1.5*t,1e3*this._config.maxReconnectionInterval),r+1))}}_createWebSocket(e){const t=new WebSocket(e),r=Object(l.f)((e,r)=>{t.onopen=()=>e(t),t.onclose=e=>r(e)});return r.then(()=>{if(this.destroyed)return t.onclose=()=>{},void t.close();t.onclose=e=>this._onClose(e),t.onerror=e=>this._onError(e),t.onmessage=e=>this._onMessage(e)}),r}async _handshake(e=1e4){const t=this._websocket;if(Object(b.g)(t))return;const r=Object(l.g)(),i=t.onmessage,{filter:s,outFields:n,spatialReference:a}=this._config;return r.timeout(e),t.onmessage=e=>{var o;let l=null;try{l=JSON.parse(e.data)}catch(e){}l&&"object"==typeof l||(be.error(new M.a("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),r.reject(),this.destroy()),(null==(o=l.spatialReference)?void 0:o.wkid)!==(null==a?void 0:a.wkid)&&(be.error(new M.a("websocket-connection","Protocol violation. Handshake failed - expected wkid of "+a.wkid,e.data)),r.reject(),this.destroy()),"json"!==l.format&&(be.error(new M.a("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),r.reject(),this.destroy()),s&&l.filter!==s&&be.error(new M.a("websocket-connection","Tried to set filter, but server doesn't support it")),n&&l.outFields!==n&&be.error(new M.a("websocket-connection","Tried to set outFields, but server doesn't support it")),t.onmessage=i,r.resolve()},t.send(JSON.stringify({filter:s,outFields:n,format:"json",spatialReference:{wkid:a.wkid}})),r.promise}_onMessage(e){try{const t=JSON.parse(e.data);if("featureResult"!==t.type)throw new M.a("websocket-connection","Protocol violation - Expected to find message of type 'featureResult'",t);for(const e of t.features)this._featureZScaler&&this._featureZScaler(e.geometry),this.onFeature(e)}catch(e){return be.error(new M.a("websocket-connection","Failed to parse message",e)),void this.destroy()}}_onError(e){const t="Encountered an error over WebSocket connection";this._set("errorString",t),be.error("websocket-connection",t)}_onClose(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&be.error("websocket-connection","WebSocket closed unexpectedly with error code "+e.code),this.destroyed||this._open()}};Object(i.a)([Object(a.b)()],ge.prototype,"connectionStatus",null),Object(i.a)([Object(a.b)()],ge.prototype,"errorString",void 0),ge=Object(i.a)([Object(o.a)("esri.layers.graphics.sources.connections.WebSocketConnection")],ge);var Oe=r(28),_e=r(59),ve=(r(54),r(457));const je=n.a.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection"),xe={maxQueryDepth:5,maxRecordCountFactor:3};let we=class extends ge{constructor(e){super({...xe,...e})}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||je.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");const t=await this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:i}=this._config;this.destroyed||this._setFilter(r,i)}_onMessage(e){let t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void je.error(new M.a("geoevent-connection","Failed to parse message",e))}this.onFeature(t)}async _fetchServiceDefinition(e){const t=Object(R.default)(e.path,{query:{f:"json"},responseType:"json"}),r=(await t).data;return this._serviceDefinition=r,r}async _fetchWebSocketUrl(e,t){const r=e[0],{urls:i,token:s}=r;return`${this._inferWebSocketBaseUrl(i)}/subscribe?outSR=${t.wkid}${s?"&token="+s:""}`}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(-1!==t.indexOf("wss"))return t;return je.error(new M.a("geoevent-connection","Unable to infer WebSocket url",e)),null}async _setFilter(e,t){const r=this._websocket;if(Object(b.g)(r)||Object(b.g)(e)&&Object(b.g)(t))return;const i=JSON.stringify({filter:this._serializeFilter(e,t)});let s=!1;const n=Object(l.g)();return r.onmessage=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(je.error(new M.a("geoevent-connection","Failed to set service filter",t.error)),this._set("errorString","Could not set service filter - "+t.error),n.reject(t.error)),r.onmessage=this._onMessage.bind(this),s=!0,n.resolve())},r.send(i),setTimeout(()=>{s||(this.destroyed||this._websocket!==r||je.error(new M.a("geoevent-connection","Server timed out when setting filter")),n.reject())},1e4),n.promise}_serializeFilter(e,t){const r={};if(Object(b.g)(e)&&Object(b.g)(t))return r;if(Object(b.h)(e)&&e.geometry)try{const t=Object(_e.a)(e.geometry);if("extent"!==t.type)throw new M.a("Expected extent but found type "+t.type);r.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(e){je.error(new M.a("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return Object(b.h)(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),Object(b.h)(t)&&(r.outFields=t.join(",")),r}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return je.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;const{attributes:i,geometry:s}=this._relatedFeatures.get(r);for(const t in i)e.attributes[t]=i[t];return s&&(e.geometry=s),e.geometry||e.centroid||je.error(new M.a("geoevent-connection","Found malformed feature - no geometry found",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),i=this._queryArchive(t);await r;const s=await i;if(!s)return;for(const e of s.features)this.onFeature(this._enrich(e))}catch(e){je.error(new M.a("geoevent-connection","Encountered an error when querying buddy services",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new ve.default({url:e}),{capabilities:r}=await t.load(),i=r.query.supportsMaxRecordCountFactor,s=r.query.supportsPagination,n=r.query.supportsCentroid,a=this._config.maxRecordCountFactor,o=t.capabilities.query.maxRecordCount,l=i?o*a:o,c=new T.a;if(c.outFields=Object(b.n)(this._config.outFields,["*"]),c.where=Object(b.n)(Object(b.f)(this._config.filter,"where"),"1=1"),c.returnGeometry=!0,c.returnExceededLimitFeatures=!0,c.outSpatialReference=Oe.a.fromJSON(this._config.spatialReference),n&&(c.returnCentroid=!0),i&&(c.maxRecordCountFactor=a),s)return c.num=l,t.destroy(),this._queryPages(e,c);const u=await Object(A.executeQuery)(e,c,this._config.sourceSpatialReference);return t.destroy(),u.data}async _queryPages(e,t,r=[],i=0){t.start=i*t.num;const{data:s}=await Object(A.executeQuery)(e,t,this._config.sourceSpatialReference);return s.exceededTransferLimit&&i<this._config.maxQueryDepth?(s.features.forEach(e=>r.push(e)),this._queryPages(e,t,r,i+1)):(r.forEach(e=>s.features.push(e)),s)}_addRelatedFeatures(e){const t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField;for(const e of r){const r=e.attributes[i];t.set(r,e)}this._relatedFeatures=t}};we=Object(i.a)([Object(o.a)("esri.layers.graphics.sources.connections.GeoEventConnection")],we);var Se=we;function Ie(e,t){const r=e.weakClone(),i=Object(m.v)(t,e.geometry.coords[0]),s=Object(m.w)(t,e.geometry.coords[1]);return r.geometry=new q.a([],[i,s]),r}function Te(e,t){const r=Object(ce.a)(9,function(e){switch(e){case"esriGeometryPoint":return e=>({minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]});default:return e=>{let t=1/0,r=1/0,i=-1/0,s=-1/0;return e.geometry.forEachVertex((e,n)=>{t=Math.min(t,e),r=Math.min(r,n),i=Math.max(i,e),s=Math.max(s,n)}),{minX:t,minY:r,maxX:i,maxY:s}}}}(t));return r.load(e),r}function Fe(e,t){return e.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}class Ee{constructor(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map}get _features(){const e=[];return this._objectIdToFeature.forEach(t=>e.push(t)),e}add(e){this._objectIdToFeature.set(e.objectId,e),this._index=null}get(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null}forEach(e){this._objectIdToFeature.forEach(e)}search(e){return this._index||(this._index=Te(this._features,this._geometryType)),Fe(this._index,e)}removeById(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._objectIdToFeature.size}}class Me extends re{constructor(e){super(e),this.type="geoevent",this._dataReceiveEventEnabled=!1,this._updateInfo={websocket:0,client:0};const{outSR:t}=e,{geometryType:r,objectIdField:i,timeInfo:s,purgeOptions:n,source:a,spatialReference:o,serviceFilter:l,maxReconnectionAttempts:c,maxReconnectionInterval:u}=e.serviceInfo,h=new Ee(this._onUpdate.bind(this),r),d=new class{constructor(e,t,r,i,s=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=r,this._purgeOptions=i,this.store=e,this.objectIdField=t,this.purgeInterval=s,this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}add(e){if(this._useGeneratedIds){const t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}if(this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return;const t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){const e=Object(b.h)(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,r=Object(ue.c)(e,0,1e3);this._trackIdToObservations.set(t,new he.a(r))}const r=this._trackIdToObservations.get(t).enqueue(e.objectId);Object(b.h)(r)&&(this._addOrUpdated.has(r)?this._addOrUpdated.delete(r):this._removed.push(r))}checkForUpdates(){const e=this._getToAdd(),t=this._getToRemove(),r=performance.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);const i=[];if(Object(b.h)(t))for(const e of t){const t=this.store.removeById(e);Object(b.h)(t)&&i.push(t)}if(Object(b.h)(e))for(const t of e)t.attributes.__esri_timestamp__=r,this.store.add(t);(e||i)&&this.store.update(e,i)}_getToAdd(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach(r=>e[t++]=r),this._addOrUpdated.clear(),e}_getToRemove(){const e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){const t=this._purgeOptions;Object(b.h)(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(!e.displayCount)return;let t=this.store.size;t>e.displayCount&&this._trackIdToObservations.forEach(r=>{if(t>e.displayCount&&r.size){const e=Object(b.m)(r.dequeue());this._removed.push(e),t--}})}_purgeByAge(e){var t;if(!e.age||!(null==(t=this._timeInfo)?void 0:t.startTimeField))return;const r=60*e.age*1e3,i=this._maxAge-r;this.store.forEach(e=>{e.attributes[this._timeInfo.startTimeField]<i&&this._removed.push(e.objectId)})}_purgeByAgeReceived(e,t){if(!t.ageReceived)return;const r=e+60*t.ageReceived*1e3;this.store.forEach(e=>{e.attributes.__esri_timestamp__<r&&this._removed.push(e.objectId)})}_purgeTracks(){this._trackIdToObservations.forEach((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)})}}(h,i,s,n),p=function(e,t,r,i,s,n,a){const o=0===e.path.indexOf("wss://")||0===e.path.indexOf("ws://"),l={source:e,sourceSpatialReference:t,spatialReference:r,geometryType:i,filter:s,maxReconnectionAttempts:n,maxReconnectionInterval:a};return o?new ge(l):new Se(l)}(a,o,t,r,l,c,u);this._store=h,this._manager=d,this._connection=p,this._quantize=function(e){switch(e){case"esriGeometryPoint":return Ie;case"esriGeometryPolygon":case"esriGeometryPolyline":default:return(t,r)=>{const i=t.weakClone(),s=new q.a,n=Object(m.u)(s,t.geometry,!1,!1,e,r,!1,!1);return i.geometry=n,i}}}(r),this._handles=[this._connection.on("feature",e=>this._onFeature(e)),this._connection.watch("connectionStatus",e=>this.events.emit("connectionStatus",e)),this._connection.watch("errorString",e=>this.events.emit("errorString",e))];let f=performance.now();this._updateIntervalId=setInterval(()=>{const t=performance.now(),r=t-f;if(r>2500){f=t;const e=Math.round(this._updateInfo.client/(r/1e3)),i=Math.round(this._updateInfo.websocket/(r/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.events.emit("updateRate",{client:e,websocket:i})}e.canAcceptRequest()&&this._manager.checkForUpdates()},16)}destroy(){clearInterval(this._updateIntervalId),this._handles.forEach(e=>e.remove()),this._connection.destroy()}_fetchDataTile(){}enableEvent(e,t){"data-received"===e&&(this._dataReceiveEventEnabled=t)}get updating(){return!1}subscribe(e){super.subscribe(e);const t=this._getTileFeatures(e);this._onRequest({tile:e,id:e.key.id,features:t,end:!0})}unsubscribe(e){super.unsubscribe(e)}forEachRequest(e,t){const r=this._subscriptions.get(e),{tile:i,signal:s}=r;t({tile:i,id:e,features:this._getTileFeatures(i),end:!0},{signal:s})}async resend(e){this._subscriptions.forEach(t=>{const{tile:r}=t,i={tile:r,id:r.id,features:this._getTileFeatures(r),end:!0};this._onRequest(i,!1,e)})}_getTileFeatures(e){const t=this._store.search(e).map(t=>this._quantize(t,e.transform));return j.a.fromOptimizedFeatures(t,this.geometryType,e.transform)}_onFeature(e){this._updateInfo.websocket++;try{this._dataReceiveEventEnabled&&this.events.emit("feature",e);const t=Object(m.a)(e,this.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(t)}catch(e){Object(s.a)("esri-2d-debug")&&console.debug(e)}}async _onUpdate(e,t){const r=Object(b.a)(e,e=>Te(e,this.geometryType)),i=Object(b.a)(t,e=>Te(e,this.geometryType));Object(b.h)(e)&&(this._updateInfo.client+=e.length),this._subscriptions.forEach((e,t)=>{const s=e.tile,n=Object(b.a)(r,e=>Fe(e,s)),a=Object(b.a)(n,e=>e.map(e=>this._quantize(e,s.transform))),o=Object(b.a)(a,e=>j.a.fromOptimizedFeatures(e,this.geometryType,s.transform)),l=Object(b.a)(i,e=>Fe(e,s)),c=Object(b.a)(l,e=>e.map(e=>e.objectId));this._onRequest({tile:s,id:t,features:o,remove:Object(b.n)(c,[]),end:!0})})}}const Re=n.a.getLogger("esri.views.2d.layers.features.sources.FeatureSource");class Ce extends se{constructor(e){super(e)}async _fetchDataTile(e){const t=this._subscriptions.get(e.key.id);let r=!1,i=0,s=0;const n=(i,n)=>{s--,Object(l.t)(t);const a=i.reader,o=i.query;if(!a.exceededTransferLimit){if(r=!0,0!==n&&!a.hasFeatures){const r={tile:e,id:e.id,features:a,end:0===s};return t.requests.done.push({request:r,query:o}),void this._onRequest(r)}const i={tile:e,id:e.id,features:a,end:0===s};return t.requests.done.push({request:i,query:o}),void this._onRequest(i)}const c={tile:e,id:e.id,features:a,end:r&&0===s};t.requests.done.push({request:c,query:o}),this._onRequest(c)};let a=0,o=0;for(;!r&&o++<20;){let o;for(let c=0;c<a+1;c++){const a=i++;s++,o=this._fetchDataTilePage(e,a,t).then(e=>e&&n(e,a)).catch(t=>{r=!0,Object(l.b)(t)||(Re.error(new M.a("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t})),this._onRequest({tile:e,id:e.id,features:null,end:r}))})}await o,Object(l.t)(t),a=Math.min(a+2,6)}}async _fetchDataTilePage(e,t,r){const i=this._sourceQueryInfo,s=this._createQuery(e,{start:8e3*t,num:8e3,maxRecordCountFactor:3,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()});try{const n=r.signal,a=await this._queue.push({tile:e,query:s,signal:n,depth:t});return Object(l.t)(r),a?i!==this._sourceQueryInfo?this._fetchDataTilePage(e,t,r):{reader:a,query:s}:null}catch(e){return Object(l.x)(e),null}}}let Ae=0;class Ne{constructor(e,t){this.didSend=!1,this.dataTileCount=0,this.update=f.all(),this._abortController=new AbortController,this.invalid=!1,this.displayTile=e,this._pixelBuffer=t,this.partitions=Le(e,t)}setUpdate(e,t){this.update=e,this.dataTileCount=0,t!==this._pixelBuffer&&(this._pixelBuffer=t,this.partitions=Le(this.displayTile,t)),this.didSend=!1}get signal(){return this._abortController.signal}abort(){this._abortController.abort()}}class De{constructor(e,t,r){this.resolved=!1,this.tile=t,this.offset=e,this.extent=r}reset(){this.resolved=!1}}function Le(e,t){const r=[];if(r.push(new De([0,0],e,null)),0===t)return r;const i=Math.min(t,F.F),n=F.F;return Object(s.a)("esri-2d-debug")&&i!==t&&console.debug(`Clamping pixelBuffer to max size of ${F.F}px`),r.push(new De([-n,-n],e.neighbor(-1,-1),[n-i,n-i,n,n])),r.push(new De([0,-n],e.neighbor(0,-1),[0,n-i,n,n])),r.push(new De([n,-n],e.neighbor(1,-1),[0,n-i,i,n])),r.push(new De([-n,0],e.neighbor(-1,0),[i,0,n,n])),r.push(new De([n,0],e.neighbor(1,0),[0,0,i,n])),r.push(new De([-n,n],e.neighbor(-1,1),[i,0,n,i])),r.push(new De([0,n],e.neighbor(0,1),[0,0,n,i])),r.push(new De([n,n],e.neighbor(1,1),[0,0,i,i])),r}class Pe{constructor(e,t,r){this.type="remote",this._queryInfo=null,this._subscriptions={display:new Map},this._invalid={outFields:!1,queryFilterParameters:!1};const i=this._onDataTileRequest.bind(this);this._source=function(e,t,r,i,s){const n=function(e,t,r,i,s){switch(e.type){case"stream":return{type:"geoevent",serviceInfo:e,onRequest:i,outSR:t,canAcceptRequest:s};case"memory":case"on-demand":return{type:"feature",serviceInfo:e,onRequest:i,outSR:t,origin:function(e){return Array.isArray(e)?"local":"path"in e&&Object(E.c)(e.path)?"hosted":"unknown"}(e.source),tileInfoView:r,canAcceptRequest:s}}}(e,t,r,i,s);switch(n.type){case"feature":switch(n.origin){case"hosted":case"local":return new Ce(n);case"unknown":return new le(n)}case"geoevent":return new Me(n)}}(e,t,r,i,()=>this.canAcceptPatch()),this._serviceInfo=e,this._geometryType=e.geometryType,this._outSR=t,this.editable="hosted"===origin||"unknown"===origin,this.editable&&(this._lastEditPromise=this._source.queryLastEditDate().then(e=>(this._lastEdit=e,e)))}destroy(){this._getSubscriptions().map(({displayTile:e})=>this.unsubscribe(e)),this._source.destroy()}get updating(){return this._source.updating||this._getSubscriptions().some(e=>!e.didSend)}get isStream(){return"geoevent"===this._source.type}get sourceEvents(){return"geoevent"===this._source.type?{type:"geoevent",events:this._source.events}:{type:"feature",events:this._source.events}}enableEvent(e,t){this._source.enableEvent(e,t)}setViewState(e){this._source.setViewState(e)}update(e,t){var r,i,n,a;const o=this._serviceInfo.fields.length,l=null!=(r=null==(i=this._schema)?void 0:i.outFields)?r:[],c=null!=(n=null==(a=this._schema)?void 0:a.pixelBuffer)?n:0,u=t.outFields.filter(e=>-1===l.indexOf(e)),h=[...l,...u],d=0===t.pixelBuffer?0:Math.max(t.pixelBuffer,c);t.pixelBuffer=d,t.outFields=h.length>=.75*o?["*"]:h,t.outFields.sort();const p=Object(I.a)(this._schema,t);if(!p)return;const f=this._schema&&Object(I.b)(p,"outFields"),b=this._schema&&Object(I.b)(p,"pixelBuffer"),y=this._schema&&Object(I.c)(p,["definitionExpression","gdbVersion","historicMoment"]);Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - Source:",p);const m={returnCentroid:"esriGeometryPolygon"===this._geometryType,returnGeometry:!0,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:[this._serviceInfo.objectIdField+" ASC"],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment?new Date(t.historicMoment):null,timeExtent:S.a.fromJSON(t.timeExtent)};e.source=!0,b&&(e.why.mesh.push("Pixel buffer changed"),e.mesh=!0),y&&(e.why.mesh.push("Layer filter changed"),e.why.source.push("Layer filter changed"),e.mesh=!0,e.queryFilter=!0,this._invalid.queryFilterParameters=!0),f&&(e.why.source.push("Layer required fields changed"),this._invalid.outFields=!0),this.editable&&this._invalid.outFields&&(this._lastEditPromise=this._source.queryLastEditDate()),this._schema=t,this._source.update(m),this._queryInfo=m}subscribe(e){this._subscriptions.display.has(e.id)?Object(s.a)("esri-2d-debug")&&console.debug("A subscription already exists for the target displayTile"):this._subscribeDisplayTile(e)}unsubscribe(e){if(!this._subscriptions.display.has(e.id))return void(Object(s.a)("esri-2d-debug")&&console.debug("A subscription does not exist for the target displayTile"));const t=this._subscriptions.display.get(e.id);this._subscriptions.display.delete(e.id),this._source.unsubscribe(e),t.abort()}forEachRequest(e,t){this._source.forEachRequest(e,t)}query(e){return this._source.query(e)}createQuery(){return new T.a({...this._queryInfo})}createTileQuery(e){if("stream"===this._serviceInfo.type)throw new Error("Service does not support tile  queries");const t=this.createQuery();return t.quantizationParameters=e.getQuantizationParameters(),t.resultType="tile",t.geometry=e.extent,"esriGeometryPolyline"===this._serviceInfo.geometryType&&(t.maxAllowableOffset=e.resolution),this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,t.maxAllowableOffset=e.resolution),t}invalidate(){this._subscriptions.display.forEach(e=>e.invalid=!0)}async resubscribe(e,t=!1){const r=this._schema.pixelBuffer;this._subscriptions.display.forEach(t=>t.setUpdate(e,r));let i=!1,s=!1;if(this._subscriptions.display.forEach(e=>{e.invalid&&(s=!0)}),this._invalid.outFields&&(i=await this._lastEditPromise!==this._lastEdit,this._invalid.outFields=!1),t||this._invalid.queryFilterParameters||i||s){const e=this._getSubscriptions().map(({displayTile:e})=>e),t=await this._lastEditPromise;e.forEach(e=>this.unsubscribe(e)),e.forEach(e=>this.subscribe(e)),this._lastEdit=t,this._source.resume(),this._invalid.queryFilterParameters=!1}else await this._source.resend({dataTileOnly:!0}),e.mesh&&this._source.resend({dataTileOnly:!1})}pause(){this._source.pause()}resume(){this._source.resume()}_getSubscriptions(){const e=[];return this._subscriptions.display.forEach(t=>{e.push(t)}),e}_subscribeDisplayTile(e){const t=new Ne(e,this._schema.pixelBuffer);this._subscriptions.display.set(e.id,t),this._source.subscribe(e);for(const r of t.partitions){const t=r.tile,i=this._source.get(t.id);if(Object(b.h)(i))for(const t of i.requests.done)this._onPartitionMessage(e.id,r,t.request,!0)}}_onDataTileRequest(e,t=!0,r){const i=this._subscriptions.display.get(e.id);if(r&&r.dataTileOnly){for(const r of i.partitions)if(r.tile.id===e.id){this._onPartitionMessage(e.id,r,e,t);break}}else{for(const r of i.partitions)if(r.tile.id===e.id){this._onPartitionMessage(e.id,r,e,t);break}this._subscriptions.display.forEach((r,i)=>{if(i!==e.id)for(const s of r.partitions)if(s.tile.id===e.id){this._onPartitionMessage(i,s,e,t);break}})}}_onPartitionMessage(e,t,r,i){const s=Object(b.a)(r.features,e=>function(e,t){if(Object(b.g)(t.extent))return e;const{offset:r,extent:i}=t,[s,n,a,o]=i,[l,c]=r;return e.extent(s,n,a,o).transform(l,c)}(e,t)),n=this._subscriptions.display.get(e),a=n.signal,o=!n.didSend,l=i?f.all():n.update;let c=!1;r.end&&(t.resolved=!0,c=e===t.tile.id),n.didSend=!0,this.onDisplayTilePatch({type:o?"replace":this.isStream?"update":"new",id:e,version:Ae++,update:l,addOrUpdate:s,remove:r.remove||[],noData:r.noData,end:c},{signal:a})}}var ke=r(91);new Float64Array(2),new Float64Array(2);function ze(e,t,r,i){i%2&&(i+=1);let s=0,n=0,a=-90,o=90,l=-180,c=180;for(let e=0;e<i/2;e++){for(let t=0;t<5;t++){const i=(l+c)/2,n=r>i?1:0;s|=n<<29-(t+5*e),l=(1-n)*l+n*i,c=(1-n)*i+n*c}for(let r=0;r<5;r++){const i=(a+o)/2,s=t>i?1:0;n|=s<<29-(r+5*e),a=(1-s)*a+s*i,o=(1-s)*i+s*o}}e.geohashX=s,e.geohashY=n}function qe(e,t,r,i,s){s%2&&(s+=1);let n=0,a=0,o=-90,l=90,c=-180,u=180;for(let e=0;e<s/2;e++){for(let t=0;t<5;t++){const r=(c+u)/2,s=i>r?1:0;n|=s<<29-(t+5*e),c=(1-s)*c+s*r,u=(1-s)*r+s*u}for(let t=0;t<5;t++){const i=(o+l)/2,s=r>i?1:0;a|=s<<29-(t+5*e),o=(1-s)*o+s*i,l=(1-s)*i+s*l}}e[2*t]=n,e[2*t+1]=a}class Ge{constructor(e,t,r=8096){this._nodes=0,this._root=new Ve(0,0,0),this._fields=e,this._statisticFields=t,this._pool=r?new he.a(8096):null}_acquire(e,t,r){this._nodes++;let i=null;return Object(b.h)(this._pool)&&(i=this._pool.dequeue()),Object(b.h)(i)?i.realloc(e,t,r):new Ve(e,t,r)}_release(e){this._nodes--,Object(b.h)(this._pool)&&this._pool.enqueue(e)}get count(){return this._root.count}get size(){return this._nodes}get poolSize(){return Object(b.k)(this._pool,0,e=>e.size)}get depth(){let e=0;return this._forEachNode(t=>e=Math.max(e,t.depth)),e}dropLevels(e){this._forEachNode(t=>{if(t.depth>=e)for(let e=0;e<t.children.length;e++){const r=t.children[e];t.children[e]=null,r&&this._release(r)}})}clear(){this.dropLevels(0)}insert(e,t,r=0){let i=this._root,s=0,n=0,a=0;for(;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,i.displayId=e.displayId,this._updateStatistics(e,i,1)),s>=t)return;const o=Math.ceil((s+1)/2),l=Math.floor((s+1)/2),c=1-s%2,u=30-(3*o+2*l),h=30-(2*o+3*l),d=7*c+3*(1-c)<<u,p=3*c+7*(1-c)<<h,f=8*c+4*(1-c),b=(e.geohashX&d)>>u,y=(e.geohashY&p)>>h,m=b+y*f;n=n<<3*c+2*(1-c)|b,a=a<<2*c+3*(1-c)|y,null==i.children[m]&&(i.children[m]=this._acquire(n,a,s+1)),s+=1,i=i.children[m]}}insertCursor(e,t,r,i,s,n,a,o=0){let l=this._root,c=0,u=0,h=0;for(;null!==l;){if(l.depth>=o&&(l.count+=1,l.xTotal+=r,l.yTotal+=i,l.xGeohashTotal+=s,l.yGeohashTotal+=n,l.displayId=t,this._updateStatisticsCursor(e,l,1)),c>=a)return;const d=Math.ceil((c+1)/2),p=Math.floor((c+1)/2),f=1-c%2,b=30-(3*d+2*p),y=30-(2*d+3*p),m=(s&7*f+3*(1-f)<<b)>>b,g=(n&3*f+7*(1-f)<<y)>>y,O=m+g*(8*f+4*(1-f));u=u<<3*f+2*(1-f)|m,h=h<<2*f+3*(1-f)|g,null==l.children[O]&&(l.children[O]=this._acquire(u,h,c+1)),c+=1,l=l.children[O]}}remove(e,t){let r=this._root,i=0;for(;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;const s=Math.ceil((i+1)/2),n=Math.floor((i+1)/2),a=1-i%2,o=30-(3*s+2*n),l=30-(2*s+3*n),c=7*a+3*(1-a)<<o,u=3*a+7*(1-a)<<l,h=8*a+4*(1-a),d=((e.geohashX&c)>>o)+((e.geohashY&u)>>l)*h,p=r.children[d];1===p.count&&(this._release(p),r.children[d]=null),i+=1,r=p}}removeCursor(e,t,r,i,s,n){let a=this._root,o=0;for(;null!==a;){if(a.count-=1,a.xTotal-=t,a.yTotal-=r,a.xGeohashTotal-=i,a.yGeohashTotal-=s,this._updateStatisticsCursor(e,a,-1),o>=n)return;const l=Math.ceil((o+1)/2),c=Math.floor((o+1)/2),u=1-o%2,h=30-(3*l+2*c),d=30-(2*l+3*c),p=((i&7*u+3*(1-u)<<h)>>h)+((s&3*u+7*(1-u)<<d)>>d)*(8*u+4*(1-u)),f=a.children[p];1===f.count&&(this._release(f),a.children[p]=null),o+=1,a=f}}find(e,t,r){return this._root.find(e,t,r,0,0,0)}findSingleOccupancyNode(e,t,r,i,s){let n=this._root;for(;null!==n;){const a=n.depth,o=n.xNode,l=n.yNode,c=1-a%2,u=n.xGeohashTotal/n.count,h=n.yGeohashTotal/n.count;if(1===n.count&&e<u&&u<=r&&t<h&&h<=i)return n;if(a>=s){n=n.next;continue}const d=Math.ceil((a+1)/2),p=Math.floor((a+1)/2),f=30-(3*d+2*p),b=30-(2*d+3*p),y=~((1<<f)-1),m=~((1<<b)-1),g=(e&y)>>f,O=(t&m)>>b,_=(r&y)>>f,v=(i&m)>>b,j=o<<3*c+2*(1-c),x=l<<2*c+3*(1-c),w=j+8*c+4*(1-c),S=x+4*c+8*(1-c),I=Math.max(j,g),T=Math.max(x,O),F=Math.min(w,_),E=Math.min(S,v);let M=null,R=null;for(let e=T;e<=E;e++)for(let t=I;t<=F;t++){const r=t-j+(e-x)*(8*c+4*(1-c)),i=n.children[r];i&&(M||(M=i,M.next=n.next),R&&(R.next=i),R=i,i.next=n.next)}n=M||n.next}return null}getRegionStatistics(e,t,r,i,s){let n=this._root,a=0,o=0,l=0;const c={};let u=0;for(;null!==n;){const h=n.depth,d=n.xNode,p=n.yNode;if(h>=s){const s=n.xGeohashTotal/n.count,h=n.yGeohashTotal/n.count;e<s&&s<=r&&t<h&&h<=i&&(a+=n.count,o+=n.xTotal,l+=n.yTotal,1===n.count&&(u=n.displayId),this._aggregateStatistics(c,n.statistics)),n=n.next;continue}const f=Math.ceil((h+1)/2),b=Math.floor((h+1)/2),y=1-h%2,m=30-(3*f+2*b),g=30-(2*f+3*b),O=~((1<<m)-1),_=~((1<<g)-1),v=(e&O)>>m,j=(t&_)>>g,x=(r&O)>>m,w=(i&_)>>g,S=d<<3*y+2*(1-y),I=p<<2*y+3*(1-y),T=S+8*y+4*(1-y),F=I+4*y+8*(1-y),E=Math.max(S,v),M=Math.max(I,j),R=Math.min(T,x),C=Math.min(F,w);let A=null,N=null;for(let s=M;s<=C;s++)for(let h=E;h<=R;h++){const d=h-S+(s-I)*(8*y+4*(1-y)),p=n.children[d];if(p){if(s!==M&&s!==C&&h!==E&&h!==R){const s=p.xGeohashTotal/p.count,n=p.yGeohashTotal/p.count;e<s&&s<=r&&t<n&&n<=i&&(a+=p.count,o+=p.xTotal,l+=p.yTotal,1===p.count&&(u=p.displayId),this._aggregateStatistics(c,p.statistics));continue}A||(A=p,A.next=n.next),N&&(N.next=p),N=p,p.next=n.next}}n=A||n.next}return{count:a,attributes:this._normalizeStatistics(c,a),xTotal:o,yTotal:l,referenceId:u}}_forEachNode(e){let t=this._root;for(;null!==t;){const r=this._linkChildren(t)||t.next;e(t),t=r}}_linkChildren(e){let t=null,r=null;for(let i=0;i<=e.children.length;i++){const s=e.children[i];s&&(t||(t=s,t.next=e.next),r&&(r.next=s),r=s,s.next=e.next)}return t}_updateStatistics(e,t,r){for(const i of this._fields){const s=i.name,n=i.outStatistic.onStatisticField,a=e.attributes[n];switch(i.outStatistic.statisticType){case"norm":{t.statistics[s]||(t.statistics[s]={});const n=i.outStatistic.onStatisticNormalizationField,o=e.attributes[n],l=t.statistics[s].onStatisticField||0,c=t.statistics[s].onStatisticNormalizationField||0;null==a||isNaN(a)||null==o||0===o||isNaN(o)||(t.statistics[s].onStatisticField=l+r*a,t.statistics[s].onStatisticNormalizationField=c+r*o);break}case"sum":case"avg":{t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});const e=t.statistics[s].value,i=t.statistics[s].nanCount;null==a||isNaN(a)?t.statistics[s].nanCount=i+r:t.statistics[s].value=e+r*a;break}case"avg_angle":{t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});const e=t.statistics[s].x,i=t.statistics[s].y,n=t.statistics[s].nanCount,o=Math.PI/180;null==a||isNaN(a)?t.statistics[s].nanCount=n+r:(t.statistics[s].x=e+r*Math.cos(a*o),t.statistics[s].y=i+r*Math.sin(a*o));break}case"mode":{t.statistics[s]||(t.statistics[s]={});const e=t.statistics[s][a]||0;t.statistics[s][a]=e+r;break}}}}_updateStatisticsCursor(e,t,r){for(const i of this._statisticFields){const s=i.name,n=i.inField?e.readAttribute(i.inField):e.getComputedNumericAtIndex(i.inFieldIndex);switch(i.statisticType){case"norm":{t.statistics[s]||(t.statistics[s]={});const a=i.inNormalizationField,o=e.readAttribute(a),l=t.statistics[s].onStatisticField||0,c=t.statistics[s].onStatisticNormalizationField||0;null==n||isNaN(n)||null==o||0===o||isNaN(o)||(t.statistics[s].onStatisticField=l+r*n,t.statistics[s].onStatisticNormalizationField=c+r*o);break}case"sum":case"avg":{t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});const e=t.statistics[s].value,i=t.statistics[s].nanCount;null==n||isNaN(n)?t.statistics[s].nanCount=i+r:t.statistics[s].value=e+r*n;break}case"avg_angle":{t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});const e=t.statistics[s].x,i=t.statistics[s].y,a=t.statistics[s].nanCount,o=Math.PI/180;null==n||isNaN(n)?t.statistics[s].nanCount=a+r:(t.statistics[s].x=e+r*Math.cos(n*o),t.statistics[s].y=i+r*Math.sin(n*o));break}case"mode":{t.statistics[s]||(t.statistics[s]={});const e=t.statistics[s][n]||0;t.statistics[s][n]=e+r;break}}}}_aggregateStatistics(e,t){for(const r of this._fields){const i=r.name;switch(r.outStatistic.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":e[i]||(e[i]={});for(const r in t[i]){const s=e[i][r]||0;e[i][r]=s+t[i][r]}}}}_normalizeStatistics(e,t){const r={};for(const i of this._fields){const s=i.name;switch(i.outStatistic.statisticType){case"norm":{const i=e[s];if(t&&null==i.onStatisticNormalizationField)break;if(t&&i.onStatisticNormalizationField){r[s]=i.onStatisticField/i.onStatisticNormalizationField;break}r[s]=0;break}case"sum":{if(!t)break;const{value:i,nanCount:n}=e[s];if(!(t-n))break;r[s]=i;break}case"avg":{if(!t)break;const{value:i,nanCount:n}=e[s];if(!(t-n))break;r[s]=i/(t-n);break}case"avg_angle":{if(!t)break;const{x:i,y:n,nanCount:a}=e[s];if(!(t-a))break;const o=i/(t-a),l=n/(t-a),c=180/Math.PI,u=Math.atan2(l,o)*c;r[s]=u;break}case"mode":{const t=e[s];let i=0,n=null;for(const e in t){const r=t[e];r>i&&(i=r,n=e)}r[s]="null"===n?null:n;break}}}return r}}class Ve{constructor(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(let e=0;e<this.children.length;e++)this.children[e]=null;this.xNode=e,this.yNode=t,this.depth=r}realloc(e,t,r){for(let e=0;e<this.children.length;e++)this.children[e]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this}getLngLatBounds(){const e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),s=30-(2*t+3*r);return function(e,t){let r=-90,i=90,s=-180,n=180;for(let a=0;a<t;a++){const t=Math.ceil((a+1)/2),o=Math.floor((a+1)/2),l=1-a%2,c=30-(3*t+2*o),u=30-(2*t+3*o),h=3*l+2*(1-l),d=2*l+3*(1-l),p=3*l+7*(1-l)<<u,f=(7*l+3*(1-l)<<c&e.geohashX)>>c,b=(p&e.geohashY)>>u;for(let e=h-1;e>=0;e--){const t=(s+n)/2,r=f&1<<e?1:0;s=(1-r)*s+r*t,n=(1-r)*t+r*n}for(let e=d-1;e>=0;e--){const t=(r+i)/2,s=b&1<<e?1:0;r=(1-s)*r+s*t,i=(1-s)*t+s*i}}return[s,r,n,i]}({geohashX:this.xNode<<i,geohashY:this.yNode<<s},this.depth)}find(e,t,r,i,s,n){if(i>=r)return this;const a=1-i%2,o=3*a+2*(1-a),l=2*a+3*(1-a),c=30-s-o,u=30-n-l,h=((e&7*a+3*(1-a)<<c)>>c)+((t&3*a+7*(1-a)<<u)>>u)*(8*a+4*(1-a)),d=this.children[h];return null==d?null:d.find(e,t,r,i+1,s+o,n+l)}}var Be=r(698);class Ue extends z.a{constructor(e,t,r,i,s){super(new q.a([],[t,r]),i,null,e),this.geohashBoundsInfo=s}get count(){return this.attributes.cluster_count}static create(e,t,r,i,s,n,a,o){const l=new Ue(t,r,i,n,a);return l.displayId=e.createDisplayId(!0),l.referenceId=o,l.tileLevel=s,l}update(e,t,r,i,s,n){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=s,this.referenceId=null,this.referenceId=n,this}toJSON(){return{objectId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null,attributes:{...this.attributes,clusterId:this.objectId},geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}}}function Qe(e){return 57.29577951308232*e}class Je extends Be.a{constructor(e,t,r){super(e,r),this.events=new ee.a,this._geohashLevel=0,this._aggregateValueRanges={},this._aggregateValueRangesChanged=!1,this._geohashBuf=[],this._clusters=new Map,this._tiles=new Map,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=Object(L.a)(t,Oe.a.WGS84),this._bitsets.geohash=r.getBitset(r.createBitset()),this._bitsets.inserted=r.getBitset(r.createBitset())}async updateSchema(e,t){const r=this._schema;await super.updateSchema(e,t),await this._projectionSupportCheck;const i=Object(I.a)(r,t);e.mesh&&(e.targets.aggregate=!0),t&&(!Object(b.g)(i)||e.source||e.storage.filters)&&((Object(I.b)(i,"params.fields")||!this._tree||e.source)&&(this._tree=new Ge(t.params.fields,this._statisticFields),this._rebuildTree(),Object(s.a)("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",i),e.mesh=!0,e.targets[t.name]=!0,this._aggregateValueRanges={})}sweepFeatures(e,t){this._bitsets.inserted.forEachSet(r=>{if(!e.has(r)){const e=t.lookupByDisplayIdUnsafe(r);this._remove(e)}})}sweepClusters(e,t){this._clusters.forEach((r,i)=>{r&&r.tileLevel!==t&&(e.releaseDisplayId(r.displayId),this._clusters.delete(i))})}onTileData(e,t,r,i,s,n){if(!this._schema||Object(b.g)(t.addOrUpdate))return t;const a=this._tree,o=this._getTransforms(e,this._spatialReference);{const e=t.addOrUpdate.getCursor();for(;e.next();)this._update(e,s,a)}if(!n)return t;const l=new Array,c=this._schema.params.clusterRadius;this._getClustersForTile(l,e,c,r,a,o),t.type="replace"===t.type?"replace":"update",t.addOrUpdate=j.a.fromOptimizedFeatures(l,"esriGeometryPoint"),t.addOrUpdate._storage=r;{const i=t.addOrUpdate.getCursor();for(;i.next();){const t=i.getDisplayId();this._bitsets.computed.unset(t),this.setComputedAttributes(r,i,t,e.scale)}}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t}onTileUpdate({added:e,removed:t}){if(e.length){const t=e[0].level;this._setGeohashLevel(t)}if(!this._schema)return;const r=this._schema.params.clusterRadius;t.forEach(e=>{this._tiles.delete(e.key.id),this._markTileClustersForDeletion(e,r)})}getAggregate(e){let t=null;return this._clusters.forEach(r=>{r&&r.displayId===e&&(t=r.toJSON())}),t}getDisplayId(e){const t=this._clusters.get(e);return t?t.displayId:null}getDisplayIdForReferenceId(e){let t;return this._clusters.forEach(r=>{r&&r.referenceId===e&&(t=r.displayId)}),t}getAggregateValueRanges(){return this._aggregateValueRanges}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){const t=e.getDisplayId(),r=e.getXHydrate(),i=e.getYHydrate(),s=this._geohashBuf[2*t],n=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,r,i,s,n,this._geohashLevel))}_update(e,t,r){const i=e.getDisplayId(),s=this._bitsets.inserted,n=t.isVisible(i);if(n===s.has(i))return;if(!n)return void this._remove(e);const a=e.getXHydrate(),o=e.getYHydrate();if(!this._setGeohash(i,a,o))return;const l=this._geohashBuf[2*i],c=this._geohashBuf[2*i+1];r.insertCursor(e,i,a,o,l,c,this._geohashLevel),s.set(i)}_setGeohash(e,t,r){if(this._bitsets.geohash.has(e))return!0;const i=this._geohashBuf;if(this._spatialReference.isWebMercator){const s=Qe(t/ke.b),n=s-360*Math.floor((s+180)/360);qe(i,e,Qe(Math.PI/2-2*Math.atan(Math.exp(-1*r/ke.b))),n,12)}else{const n=Object(L.c)({x:t,y:r},this._spatialReference,Oe.a.WGS84);if(!n)return Object(s.a)("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`"),!1;qe(i,e,n.y,n.x,12)}return this._bitsets.geohash.set(e),!0}_getClustersForTile(e,t,r,i,s,n,a=!0){const o=this._schema.params.clusterPixelBuffer,l=2*r,c=this._getGeohashLevel(t.key.level),u=Math.pow(2,t.key.level)*Math.ceil(F.F/l),h=Math.ceil(o/l)+0,d=Math.ceil(F.F/l),{row:p,col:f}=t.key,y=f*F.F,g=p*F.F,O=Math.floor(y/l)-h,_=Math.floor(g/l)-h,v=O+d+2*h,j=_+d+2*h,x=t.tileInfoView.getLODInfoAt(t.key.level);for(let r=O;r<=v;r++)for(let o=_;o<=j;o++){let l=r;x.wrap&&(l=r<0?r+u:r%u);const h=x.wrap&&r<0,d=x.wrap&&r%u!==r,p=this._lookupCluster(i,x,t.key.level,l,o,c,s);if(Object(b.h)(p)){const t=Object(b.a)(n,e=>h?e.left:d?e.right:e.tile);if(a&&Object(b.g)(t))continue;if(!p.count)continue;if(Object(b.h)(t)&&a){const r=p.geometry.clone();let i=p.attributes;r.coords[0]=Object(m.v)(t,r.coords[0]),r.coords[1]=Object(m.w)(t,r.coords[1]),1===p.count&&Object(b.h)(p.referenceId)&&(i={...p.attributes,referenceId:p.referenceId});const s=new z.a(r,i);s.displayId=p.displayId,e.push(s)}}}}_getGeohashLevel(e){return Math.min(Math.ceil(e/2+2),12)}_setGeohashLevel(e){const t=this._getGeohashLevel(e),r=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==r)return this._geohashLevel=r,void this._rebuildTree()}_getTransforms(e,t){const r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},i=Object(N.d)(t);if(!i)return{tile:r,left:null,right:null};const[s,n]=i.valid;return{tile:r,left:{...r,translate:[n,e.bounds[3]]},right:{...r,translate:[s-n+e.bounds[0],e.bounds[3]]}}}_getClusterId(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r}_markForDeletion(e,t,r){const i=this._getClusterId(e,t,r);this._clusters.delete(i)}_getClusterBounds(e,t,r){const i=this._schema.params.clusterRadius,s=2*i,n=r%2?t*s:t*s+i,a=r*s,o=n/F.F,l=a/F.F,c=(n+s)/F.F,u=(a-s)/F.F;return[e.getXForColumn(o),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(u)]}_lookupCluster(e,t,r,i,s,n,a){const o=this._getClusterId(r,i,s),l=this._clusters.get(o),[c,u,h,d]=this._getClusterBounds(t,i,s),p={x:c,y:u},f={x:h,y:d};let y=0,m=0,g=0,O=0;if(this._spatialReference.isWebMercator){{const e=Qe(p.x/ke.b);y=e-360*Math.floor((e+180)/360),m=Qe(Math.PI/2-2*Math.atan(Math.exp(-1*p.y/ke.b)))}{const e=Qe(f.x/ke.b);g=e-360*Math.floor((e+180)/360),O=Qe(Math.PI/2-2*Math.atan(Math.exp(-1*f.y/ke.b)))}}else{const e=Object(L.c)(p,this._spatialReference,Oe.a.WGS84),t=Object(L.c)(f,this._spatialReference,Oe.a.WGS84);if(!e||!t)return null;y=e.x,m=e.y,g=t.x,O=t.y}y>g&&(g=180);const _={geohashX:0,geohashY:0},v={geohashX:0,geohashY:0};ze(_,m,y,n),ze(v,O,g,n);const j=_.geohashX,x=_.geohashY,w=v.geohashX,S=v.geohashY,I={xLL:j,yLL:x,xTR:w,yTR:S,level:n},T=a.getRegionStatistics(j,x,w,S,n),{count:F,xTotal:E,yTotal:M,referenceId:R}=T,C=F?E/F:0,A=F?M/F:0;if(0===F)return this._clusters.set(o,null),null;const N={cluster_count:F,...T.attributes},D=Object(b.h)(l)?l.update(C,A,r,N,I,R):Ue.create(e,o,C,A,r,N,I,R);return 0===F&&(D.geometry.coords[0]=(c+h)/2,D.geometry.coords[1]=(u+d)/2),this._clusters.set(o,D),this._updateAggregateValueRangeForCluster(D,D.tileLevel),D}_updateAggregateValueRangeForCluster(e,t){const r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,s=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(s,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&s===r.maxValue||(this._aggregateValueRangesChanged=!0)}_markTileClustersForDeletion(e,t){const r=2*t,i=Math.ceil(F.F/r),{row:s,col:n}=e.key,a=n*F.F,o=s*F.F,l=Math.floor(a/r),c=Math.floor(o/r);for(let t=l;t<l+i;t++)for(let r=c;r<c+i;r++)this._markForDeletion(e.key.level,t,r)}}let $e=class extends c.a{constructor(){super(...arguments),this._storage=new v.a,this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null}initialize(){this._initAttributeStore(),this._initStores(),this._initQueryEngine(),this._initSource(),this._updateQueue=new O.a({concurrency:4,process:(e,t)=>this._onDisplayTilePatch(e,{signal:t})}),this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this)),this.watch("updating",e=>!e&&this.onIdle())])}async startup(){this._initAttributeStore()}_initSource(){this._source=new Pe(this.service,this.spatialReference,this.tileStore.tileScheme),this._source.onDisplayTilePatch=(e,t)=>(this._invalidated=!0,this._patchTile(e,t)),this._source.canAcceptPatch=()=>this._updateQueue.length<50;const e=this._source.sourceEvents;if("geoevent"===e.type){const t=e.events;this.handles.add([t.on("connectionStatus",e=>this.remoteClient.invoke("setProperty",{propertyName:"connectionStatus",value:e})),t.on("errorString",e=>this.remoteClient.invoke("setProperty",{propertyName:"errorString",value:e})),t.on("feature",e=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}})),t.on("updateRate",e=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:{...e}}))])}}_initAttributeStore(){this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new _.a({type:"remote",initialize:(e,t)=>Object(l.v)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t})),update:(e,t)=>Object(l.v)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t})),render:e=>Object(l.v)(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:e}))})}_initStores(){const e={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new x.a(e,this._storage),this.aggregateStore=new Je(e,this.spatialReference,this._storage),this.handles.add(this.aggregateStore.events.on("valueRangesChanged",e=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:e.valueRanges}})}))}_initQueryEngine(){var e;null==(e=this.queryEngine)||e.destroy(),this.queryEngine=new w.a({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,timeInfo:this.service.timeInfo})}destroy(){this._updateQueue.destroy(),this._source.destroy(),this.queryEngine.destroy(),this.attributeStore&&this.attributeStore.destroy()}get fieldsIndex(){return new g.a(this.service.fields)}get hasAggregates(){return!!this.config.schema.targets.aggregate}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){return this._source.updating||!!this._updateQueue.length}enableEvent(e){this._source.enableEvent(e.name,e.value)}async invalidate(e){if(!e.any())return;Object(s.a)("esri-2d-update-debug")&&e.describe();const t=this.tileStore.tiles.map(({key:e})=>{const t=Object(l.g)();return this._tileToResolver.set(e.id,t),t.promise}),r=this._updateQueue.takeAll();this._updateQueue.resume(),this.hasAggregates&&e.mesh&&e.targets.aggregate&&!e.queryFilter?this._repushAggregateMeshTiles(e):(this._source.resubscribe(e),Object(l.a)(t).then(()=>{this._source.resume()}),e.mesh&&await Object(y.g)(this,"updating")),this.notifyChange("updating"),await Object(l.a)(t),this._updateQueue.pause();for(const e of r)this._patchTile(e);e.source&&(this._cleanupNeeded=!0)}resume(){return this._updateQueue.resume(),this._source.resume()}async update(e,t,r=!1){r&&(this._source.pause(),this._updateQueue.pause()),this._set("config",t),this._schema=t.schema,this._initQueryEngine(),await Object(l.a)([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t.schema.processors[0].storage),this.attributeStore.updateFilters(e,this)]),await this.aggregateStore.updateSchema(e,t.schema.targets.aggregate)}async refresh(){this._source.resubscribe(f.all(),!0),this._cleanupNeeded=!0,this.notifyChange("updating"),await Object(y.g)(this,"updating",!0)}onTileUpdate(e){this.aggregateStore.onTileUpdate(e);for(const t of e.added)this._source.subscribe(t),this._level=t.level;for(const t of e.removed)this._source.unsubscribe(t),this._cleanupNeeded=!0,this._tileToResolver.has(t.id)&&(this._tileToResolver.get(t.id).resolve(),this._tileToResolver.delete(t.id));this.notifyChange("updating")}onIdle(){this.hasAggregates&&this._invalidated&&(this._repushAggregateMeshTiles(),this._invalidated=!1),this._markAndSweep()}async onEdits(e){const t=e.addedFeatures.filter(e=>!e.error).map(e=>e.objectId),r=e.updatedFeatures.filter(e=>!e.error).map(e=>e.objectId),i=e.deletedFeatures.filter(e=>!e.error).map(e=>e.objectId),s=[...t,...r],n=[...t,...r,...i];if(this._source.invalidate(),!s.length)return void this.tileStore.tiles.forEach(e=>{this._patchTile({type:"update",id:e.key.id,addOrUpdate:null,remove:n,end:!0,noData:!1,update:f.all()})});const a=this.tileStore.tiles.map(e=>{const t=this._source.createTileQuery(e);return t.objectIds=s,{tile:e,query:t}}).map(async({tile:e,query:t})=>({tile:e,result:await this._source.query(t)})),o=(await Object(l.a)(a)).map(({tile:e,result:t})=>this._patchTile({type:"update",id:e.key.id,addOrUpdate:t,remove:n,end:!0,noData:!1,update:f.all()}));await Object(l.a)(o)}queryExtent(e){return this.queryEngine.executeQueryForExtent(e)}queryFeatures(e){return this.queryEngine.executeQuery(e)}queryFeatureCount(e){return this.queryEngine.executeQueryForCount(e)}queryLatestObservations(e){return this.queryEngine.executeQueryForLatestObservations(e)}queryObjectIds(e){return this.queryEngine.executeQueryForIds(e)}async queryStatistics(){return{...this.featureStore.storeStatistics,displayedFeatureCount:0,displayedVertexCount:0,displayPreProcessTime:0}}getObjectId(e){return this.featureStore.lookupObjectId(e,this._storage)}getDisplayId(e){if(this._schema.targets.aggregate){const t=this.aggregateStore.getDisplayId(e);if(Object(b.g)(t)){const t=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(t)}return t}return this.featureStore.lookupDisplayId(e)}getFeature(e){const t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(Object(b.g)(t))return null;const r=t.readHydratedGeometry(),i=Object(m.k)(r,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:i}}getAggregate(e){return this.aggregateStore.getAggregate(e)}async setHighlight(e){const t=e.map(e=>this.getDisplayId(e));return this.attributeStore.setHighlight(e,t)}_repushAggregateMeshTiles(e){for(const t of this.tileStore.tiles)this._patchTile({type:"replace",id:t.key.id,addOrUpdate:j.a.fromOptimizedFeatures([],this.service.geometryType),remove:[],end:!0,noData:!1,update:e||f.create({mesh:!0,targets:{aggregate:!0}})})}_maybeForceCleanup(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()}_patchTile(e,t){const r=this._updateQueue.push(e,t).then(()=>{this.notifyChange("updating")}).catch(e=>{Object(s.a)("esri-2d-debug")&&!Object(l.b)(e)&&console.debug(e),this.notifyChange("updating")});return this.notifyChange("updating"),r}async _onDisplayTilePatch(e,t){const r=this.tileStore.get(e.id),i=e.update;e.remove.length&&(this._cleanupNeeded=!0);const s=[];for(const t of e.remove)s.push(this.featureStore.lookupDisplayId(t));e.remove=s,Object(l.t)(t);try{if(Object(b.g)(e.addOrUpdate))return this.processor.onTileData(r,{...e,addOrUpdate:null},t).catch(e=>{Object(l.x)(e)}),void this._finishedPatch(e);e.addOrUpdate._storage=this._storage;const s=e.addOrUpdate.hasFilter(),n=e.addOrUpdate.instance;e.addOrUpdate._arcadeSpatialReference=this.spatialReference,(!this.featureStore.hasInstance(n)||i.targets.feature&&!s)&&this.featureStore.onTileData(r,e,this._storage),!i.storage.data&&!i.storage.filters||s||(this.attributeStore.onTileData(r,e),this._source.isStream?await this.attributeStore.sendUpdates():this.attributeStore.sendUpdates()),this.hasAggregates&&i.targets.aggregate&&(this.aggregateStore.onTileData(r,e,this._storage,this.featureStore,this.attributeStore,i.mesh),i.mesh&&(this.attributeStore.onTileData(r,e),this.attributeStore.sendUpdates())),i.mesh&&await this.processor.onTileData(r,e,t),this._maybeForceCleanup(),this._finishedPatch(e)}catch(e){Object(l.x)(e)}}_finishedPatch(e){(e.noData||e.end)&&this._tileToResolver.has(e.id)&&(this._tileToResolver.get(e.id).resolve(),this._tileToResolver.delete(e.id))}_markAndSweep(){if(this._lastCleanup=performance.now(),!this._cleanupNeeded&&!this._source.isStream)return;this._cleanupNeeded=!1;const e=this._storage.getBitset(this._markedIdsBufId),t=new Set;e.clear();const r=r=>{const i=this.featureStore.lookupDisplayId(r),s=(4294901760&this._storage.getInstanceId(i))>>>16;i&&(t.add(s),e.set(i))};for(const e of this.tileStore.tiles)this._source.forEachRequest(e.key.id,e=>{if(Object(b.g)(e.features))return;const t=e.features.getCursor();for(;t.next();){const e=t.getObjectId();r(e)}});this._updateQueue.forEach(e=>{for(const t of e.remove)r(t)}),this.config.schema.targets.aggregate&&(this.aggregateStore.sweepFeatures(e,this.featureStore),this.aggregateStore.sweepClusters(this._storage,this._level)),this.featureStore.sweepFeatures(e,this._storage),this.featureStore.sweepFeatureSets(t)}};Object(i.a)([Object(a.b)({constructOnly:!0})],$e.prototype,"tileStore",void 0),Object(i.a)([Object(a.b)()],$e.prototype,"config",void 0),Object(i.a)([Object(a.b)({readOnly:!0,dependsOn:["service"]})],$e.prototype,"fieldsIndex",null),Object(i.a)([Object(a.b)()],$e.prototype,"processor",void 0),Object(i.a)([Object(a.b)({constructOnly:!0})],$e.prototype,"remoteClient",void 0),Object(i.a)([Object(a.b)({constructOnly:!0})],$e.prototype,"service",void 0),Object(i.a)([Object(a.b)({dependsOn:["tileStore"]})],$e.prototype,"spatialReference",null),Object(i.a)([Object(a.b)()],$e.prototype,"updating",null),$e=Object(i.a)([Object(o.a)("esri.views.2d.layers.features.controllers.FeatureController2D")],$e);var Ye=$e;const He=new Set;function Ze(){return He}let We=class extends c.a{constructor(){super(...arguments),this.controller=null,this.processor=null,this.remoteClient=null,this.tileStore=null,this.service=null,this.viewState=null}initialize(){this.handles.add(this.watch("updating",e=>{this.remoteClient.invoke("setUpdating",e).catch(e=>{Object(s.a)("esri-2d-debug")&&console.debug("Encountered an error when calling setUpdating",e)})}))}destroy(){var e,t,r;null==(e=this.controller)||e.destroy(),null==(t=this.processor)||t.destroy(),null==(r=this.tileStore)||r.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null}get updating(){return!this.controller||this.controller.updating}async startup({service:e,config:t,tileInfo:r}){if(this.service=e,!this.tileStore){const e=new d.a(u.a.fromJSON(r));this.tileStore=new p.a(e)}await this._configure(t),this.tileStore.clear()}async updateTiles(e){this.tileStore.updateTiles(e)}async update({config:e,pause:t}){const r=f.empty();return await Object(l.a)([this.processor.update(r,e),this.controller.update(r,e,t)]),r.toJSON()}async invalidate(e){const t=f.create(e),r=this.controller.invalidate(t);return await this.remoteClient.invoke("setUpdating",this.updating),r}setViewState(e){const t=h.a.fromJSON(e);this._set("viewState",t)}async _configure(e){await Object(l.a)([this._handleControllerConfig(e),this._handleProcessorConfig(e)]),this.controller.processor=this.processor,await this.update({config:e})}async _handleControllerConfig(e){const t=await this._createController(this.service,e);return await t.startup(),t}async _handleProcessorConfig(e){return this._createProcessor(this.service,e)}async _createController(e,t){this.controller&&this.controller.destroy();const{tileStore:r,remoteClient:i}=this,s=new Ye({service:e,config:t,tileStore:r,remoteClient:i});return this.controller=s,s}async _createProcessor(e,t){const i=t.schema.processors[0].type,s=(await function(e){return"heatmap"===e?r.e(90).then(r.bind(null,974)):Promise.all([r.e(14),r.e(25),r.e(42)]).then(r.bind(null,1007))}(i)).default,{remoteClient:n,tileStore:a}=this,o=new s({service:e,config:t,tileStore:a,remoteClient:n});return this.processor&&this.processor.destroy(),this.processor=o,o}};Object(i.a)([Object(a.b)()],We.prototype,"controller",void 0),Object(i.a)([Object(a.b)()],We.prototype,"processor",void 0),Object(i.a)([Object(a.b)({dependsOn:["controller.updating"]})],We.prototype,"updating",null),Object(i.a)([Object(a.b)()],We.prototype,"viewState",void 0),We=Object(i.a)([Object(o.a)("esri.views.2d.layers.features.Pipeline")],We);var Xe=We;t.default=Xe}}]);