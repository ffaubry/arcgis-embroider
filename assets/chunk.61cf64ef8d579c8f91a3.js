(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{476:function(e,t,s){"use strict";s.r(t);var i,r=s(0),o=(s(4),s(9),s(12)),a=s(73),n=s(8),l=s(5),c=(s(6),s(1)),h=s(2),u=s(14),b=(s(3),s(10),s(7)),p=s(65),f=(s(11),s(56)),y=s(301),m=s(144),d=s(35),g=s(265),j=s(424),O=s(533),_=s(519);const w=l.a.getLogger("esri.renderers.DictionaryRenderer");let v=i=class extends(Object(O.a)(j.a)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new _.a(100),this.config=null,this.description=null,this.fieldMap=null,this.label=null,this.scaleExpression=null,this.url=null,this.type="dictionary"}clone(){return new i({config:Object(o.a)(this.config),scaleExpression:Object(o.a)(this.scaleExpression),description:Object(o.a)(this.description),fieldMap:Object(o.a)(this.fieldMap),label:Object(o.a)(this.label),url:Object(o.a)(this.url),visualVariables:Object(o.a)(this.visualVariables)})}async getSymbolAsync(e,t){let s;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{s=await this._dictionaryPromise}catch(e){if(Object(b.b)(e))return this._dictionaryPromise=null,null}const i={};for(const t of this._symbolAttributes){const s=this.fieldMap[t];if(s&&null!==e.attributes[s]&&void 0!==e.attributes[s]){const r=""+e.attributes[s];i[t]=r}else i[t]=""}const r=s(i,t);if(!r||"string"!=typeof r)return null;const o=Object(a.b)(r).toString(),n=this._symbolCache.get(o);if(n)return n.catch(()=>{this._symbolCache.pop(o)}),n;const l=r.split(";"),c=[],h=[];for(const e of l)if(e&&0!==e.length)if(-1===e.indexOf("po:"))if(-1!==e.indexOf("|"))for(const t of e.split("|"))this._itemNames.has(t)&&c.push(t);else this._itemNames.has(e)&&c.push(e);else{const t=e.substr(3).split("|");if(3===t.length){const e=t[0],s=t[1];let i=t[2];if("DashTemplate"===s)i=i.split(" ").map(e=>Number(e));else if("Color"===s){const e=new d.a(i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);h.push({primitiveName:e,propertyName:s,value:i})}}const u=this._cimPartsToCIMSymbol(c,h,t);return this._symbolCache.put(o,u,1),u}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Object(m.a)(e,t,this.scaleExpression);const s=t.map(e=>e.name);for(const t in this.fieldMap)s.indexOf(this.fieldMap[t])<0||e.add(this.fieldMap[t])}get arcadeRequired(){return!0}async fetchResources(e){if(!this.url)return void w.error("no valid URL!");const t=Object(n.h)(e)?e.abortOptions:null,s=Object(p.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...t}),[{data:i}]=await Object(b.a)([s,Object(y.e)()]);if(!i)throw new u.a("esri.renderers.DictionaryRenderer","Bad dictionary data!");const r=i.expression,o=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=Object(f.a)(i.itemsNames),this._symbolAttributes=o.symbol;const a={};if(this.config){const e=this.config;for(const t in e)a[t]=e[t]}for(const e of o.configuration)a.hasOwnProperty(e.name)||(a[e.name]=e.value);const l=[];if(Object(n.h)(e)&&e.fields)for(const t of this._symbolAttributes){const s=this.fieldMap[t],i=e.fields.filter(e=>e.name===s);i.length>0&&l.push({...i[0],name:t})}const c=await Object(y.b)(r,Object(n.h)(e)?e.spatialReference:null,l,a),h={scale:0};return(e,t)=>{const s=c.repurposeFeature({geometry:null,attributes:e});return h.scale=Object(n.h)(t)?t.scale:void 0,c.evaluate({$feature:s,$view:h})}}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(e=>e.data);const s=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),i=Object(p.default)(s,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,i);try{return(await i).data}catch(t){return this._ongoingRequests.delete(e),Object(b.h)(t)}}_combineSymbolParts(e,t){if(!e||0===e.length)return null;if(1===e.length)return{type:"CIMSymbolReference",symbol:e[0],primitiveOverrides:t};const s={...e[0]};s.symbolLayers=[];for(const t of e){const e=t;s.symbolLayers.unshift(...e.symbolLayers)}return{type:"CIMSymbolReference",symbol:s,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,s){const i=new Array(e.length);for(let t=0;t<e.length;t++)i[t]=this._getSymbolPart(e[t],s);const r=await Object(b.a)(i);return new g.a({data:this._combineSymbolParts(r,t)})}};Object(r.a)([Object(c.b)({type:Object,json:{write:!0}})],v.prototype,"config",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"description",void 0),Object(r.a)([Object(c.b)({type:Object,json:{write:!0}})],v.prototype,"fieldMap",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"label",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"scaleExpression",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],v.prototype,"url",void 0),v=i=Object(r.a)([Object(h.a)("esri.renderers.DictionaryRenderer")],v);var S=v;t.default=S},519:function(e,t,s){"use strict";var i=s(520);t.a=class{constructor(e,t){this._storage=new i.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,s){this._storage.put(e,t,s,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}}}]);