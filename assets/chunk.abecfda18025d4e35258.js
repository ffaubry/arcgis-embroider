(window.webpackJsonp=window.webpackJsonp||[]).push([[46,47],{403:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(5),s=(i(82),i(70)),n=i(50);i(414),i(55),i(66),i(85),i(111);r.a.getLogger("esri.renderers.support.utils");const a={inches:Object(n.a)(1,"meters","inches"),feet:Object(n.a)(1,"meters","feet"),"us-feet":Object(n.a)(1,"meters","us-feet"),yards:Object(n.a)(1,"meters","yards"),miles:Object(n.a)(1,"meters","miles"),"nautical-miles":Object(n.a)(1,"meters","nautical-miles"),millimeters:Object(n.a)(1,"meters","millimeters"),centimeters:Object(n.a)(1,"meters","centimeters"),decimeters:Object(n.a)(1,"meters","decimeters"),meters:Object(n.a)(1,"meters","meters"),kilometers:Object(n.a)(1,"meters","kilometers"),"decimal-degrees":1/Object(n.h)(1,"meters")};Object(s.a)("short-date")},412:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return y})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return c})),i.d(t,"j",(function(){return p}));var r=i(44),s=i(75),n=i(299),a=i(166),o=i(212),l=i(447);const c={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;Object(r.a)(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer(e,t,i,r){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||Object(n.a)(this,"screenSizePerspectiveEnabled",{},r))&&(t[i]=e)}}}}}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},d={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},p={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:s.f}}},h={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},b={value:null,type:l.a,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function f(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const y={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},m={...y,json:{...y.json,origins:{"web-document":{...y.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?Object(a.b)(t.layerDefinition.drawingInfo.transparency):void 0:Object(a.b)(t.drawingInfo.transparency)}}},O={type:o.a,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get(){var e,t;if(!(null==(e=this.layer)?void 0:e.timeInfo))return null;const i=null==(t=this.view)?void 0:t.timeExtent,r=this.layer.timeExtent,s=this.layer.useViewTime?i&&r?i.intersection(r):i||r:r;if(!s||s.isEmpty)return s;const n=this.layer.timeOffset,a=n?s.offset(-n.value,n.unit):s,o=this._get("timeExtent");return a.equals(o)?o:a}}},414:function(e,t,i){"use strict";var r,s=i(0),n=(i(4),i(9),i(5),i(6)),a=i(1),o=i(2),l=i(22),c=(i(3),i(10),i(11),i(15)),u=i(35);let d=r=class extends c.a{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=null==e?0:e}clone(){return new r({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};Object(s.a)([Object(a.b)({type:u.a,json:{type:[n.a],write:!0}})],d.prototype,"color",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],d.prototype,"label",void 0),Object(s.a)([Object(a.b)({type:Number,json:{write:{allowNull:!0}}})],d.prototype,"value",void 0),Object(s.a)([Object(l.a)("value")],d.prototype,"writeValue",null),d=r=Object(s.a)([Object(o.a)("esri.renderers.visualVariables.support.ColorStop")],d);var p=d;t.a=p},416:function(e,t,i){"use strict";function r(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function s(e){return null!=e&&!isNaN(e)&&isFinite(e)}function n(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function a(e,t){const i=t||n(e),r=e.valueUnit||"unknown";return"unknown"===i?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===r?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return s}))},438:function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return h}));var r=i(49),s=i(8),n=i(5),a=i(35),o=i(94),l=i(416),c=i(403);const u=n.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),d=new o.a,p=Math.PI,h=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function b(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"color"===e.type)[0]:e;if(!r)return;if("esri.renderers.visualVariables.ColorVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n="number"==typeof t,o=n?null:t,l=o&&o.attributes;let c=n?t:null;const d=r.field,{ipData:p,hasExpression:h}=r.cache;let b=r.cache.compiledFunc;if(!d&&!h){const e=r.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(h){if(!Object(s.h)(i)||!Object(s.h)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,n=t.getViewInfo(e),a=t.createExecContext(o,n);if(!b){const e=t.createSyntaxTree(r.valueExpression);b=t.createFunction(e),r.cache.compiledFunc=b}c=t.executeFunction(b,a)}else l&&(c=l[d]);const f=r.normalizationField,y=l?parseFloat(l[f]):void 0;if(null!=c&&(!f||n||!isNaN(y)&&0!==y)){isNaN(y)||n||(c/=y);const e=v(c,p);if(e){const t=e[0],n=e[1],o=t===n?r.stops[t].color:a.a.blendColors(r.stops[t].color,r.stops[n].color,e[2],Object(s.h)(i)?i.color:void 0);return new a.a(o)}}}function f(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"opacity"===e.type)[0]:e;if(!r)return;if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n="number"==typeof t,a=n?null:t,o=a&&a.attributes;let l=n?t:null;const c=r.field,{ipData:d,hasExpression:p}=r.cache;let h=r.cache.compiledFunc;if(!c&&!p){const e=r.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof l)if(p){if(Object(s.g)(i)||Object(s.g)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,n=t.getViewInfo(e),o=t.createExecContext(a,n);if(!h){const e=t.createSyntaxTree(r.valueExpression);h=t.createFunction(e),r.cache.compiledFunc=h}l=t.executeFunction(h,o)}else o&&(l=o[c]);const b=r.normalizationField,f=o?parseFloat(o[b]):void 0;if(null!=l&&(!b||n||!isNaN(f)&&0!==f)){isNaN(f)||n||(l/=f);const e=v(l,d);if(e){const t=e[0],i=e[1];if(t===i)return r.stops[t].opacity;{const s=r.stops[t].opacity;return s+(r.stops[i].opacity-s)*e[2]}}}}function y(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"rotation"===e.type)[0]:e;if(!r)return;if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=r.axis||"heading",a="heading"===n&&"arithmetic"===r.rotationType?90:0,o="heading"===n&&"arithmetic"===r.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,d=r.field,{hasExpression:p}=r.cache;let h=r.cache.compiledFunc,b=0;if(!d&&!p)return b;if(p){if(Object(s.g)(i)||Object(s.g)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,n=t.getViewInfo(e),a=t.createExecContext(l,n);if(!h){const e=t.createSyntaxTree(r.valueExpression);h=t.createFunction(e),r.cache.compiledFunc=h}b=t.executeFunction(h,a)}else c&&(b=c[d]||0);return b="number"!=typeof b||isNaN(b)?null:a+o*b,b}function m(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"size"===e.type)[0]:e;if(!r)return;if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=function(e,t,i,r,n){switch(t.transformationType){case"additive":return function(e,t,i,r){return e+(O(t.minSize,i,r)||t.minDataValue)}(e,t,i,r);case"constant":return function(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return null==s&&(s=e.minSize),O(s,t,i)}(t,i,r);case"clamped-linear":return function(e,t,i,r){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),a=O(t.minSize,i,r),o=O(t.maxSize,i,r),l=Object(s.h)(r)?r.shape:void 0;if(e<=t.minDataValue)return a;if(e>=t.maxDataValue)return o;if("area"===t.scaleBy&&l){const e="circle"===l,t=e?p*Math.pow(a/2,2):a*a,i=t+n*((e?p*Math.pow(o/2,2):o*o)-t);return e?2*Math.sqrt(i/p):Math.sqrt(i)}return a+n*(o-a)}(e,t,i,r);case"proportional":return function(e,t,i,r){const n=Object(s.h)(r)?r.shape:void 0,a=e/t.minDataValue,o=O(t.minSize,i,r),l=O(t.maxSize,i,r);let c=null;return c="circle"===n?2*Math.sqrt(a*Math.pow(o/2,2)):"square"===n||"diamond"===n||"image"===n?Math.sqrt(a*Math.pow(o,2)):a*o,j(c,o,l)}(e,t,i,r);case"stops":return function(e,t,i,r,s){const[n,a,o]=v(e,s);if(n===a)return O(t.stops[n].size,i,r);{const e=O(t.stops[n].size,i,r);return e+(O(t.stops[a].size,i,r)-e)*o}}(e,t,i,r,n);case"real-world-size":return function(e,t,i,r){const n=(Object(s.h)(r)&&r.resolution?r.resolution:1)*c.a[t.valueUnit],a=O(t.minSize,i,r),o=O(t.maxSize,i,r),{valueRepresentation:l}=t;let u=null;return u="area"===l?2*Math.sqrt(e/p)/n:"radius"===l||"distance"===l?2*e/n:e/n,j(u,a,o)}(e,t,i,r);case"identity":return e;case"unknown":return null}}(function(e,t,i){const r="number"==typeof t,n=r?null:t,a=n&&n.attributes;let o=r?t:null;const{isScaleDriven:c}=e.cache;let d=e.cache.compiledFunc;if(c){const t=Object(s.h)(i)?i.scale:void 0,r=Object(s.h)(i)?i.view:void 0;o=null==t||r&&"3d"===r.type?function(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}(e):t}else if(!r)switch(e.inputValueType){case"expression":{if(Object(s.g)(i)||Object(s.g)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const t={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},r=i.arcade.arcadeUtils,a=r.getViewInfo(t),l=r.createExecContext(n,a);if(!d){const t=r.createSyntaxTree(e.valueExpression);d=r.createFunction(t),e.cache.compiledFunc=d}o=r.executeFunction(d,l);break}case"field":a&&(o=a[e.field]);break;case"unknown":o=null}if(!Object(l.d)(o))return null;if(r||!e.normalizationField)return o;const p=a?parseFloat(a[e.normalizationField]):null;return Object(l.d)(p)&&0!==p?o/p:null}(r,t,i),r,t,i,r.cache.ipData);return null==n||isNaN(n)?0:n}function O(e,t,i){return null==e?null:Object(l.c)(e)?m(e,t,i):Object(l.d)(e)?e:null}function j(e,t,i){return Object(l.d)(i)&&e>i?i:Object(l.d)(t)&&e<t?t:e}function g(e,t,i){const{isScaleDriven:r}=e.cache,s=i&&"3d"===i.type;if(!(r&&s||t))return null;const n={scale:t,view:i};let a=O(e.minSize,d,n),o=O(e.maxSize,d,n);if(null!=a||null!=o){if(a>o){const e=o;o=a,a=e}return{minSize:a,maxSize:o}}}function v(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((t,s)=>e<t?(r=s,!0):(i=s,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function x(e,t,i){const s=["proportional","proportional","proportional"];for(const n of e){const e=n.useSymbolValue?"symbol-value":m(n,t,i);switch(n.axis){case"width":s[0]=e;break;case"depth":s[1]=e;break;case"height":s[2]=e;break;case"width-and-depth":s[0]=e,s[1]=e;break;case"all":case void 0:case null:s[0]=e,s[1]=e,s[2]=e;break;default:Object(r.a)(n.axis)}}return s}},442:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return O})),i.d(t,"d",(function(){return g}));var r=i(14),s=i(7),n=i(34),a=i(30),o=i(461),l=i(262);const c=[0,0];function u(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,c),null!=t.z&&(i.z=t.z),null!=t.m&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,c),[i.xmax,i.ymax]=e(t.xmax,t.ymax,c),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:d(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:d(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:p(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function d(e,t){const i=[];for(const r of e)i.push(p(r,t));return i}function p(e,t){const i=[];for(const r of e){const e=t(r[0],r[1],[0,0]);i.push(e),r.length>2&&e.push(r[2]),r.length>3&&e.push(r[3])}return i}function h(e,t){return!f(e,t)||Object(l.b)()}async function b(e,t){if(t)if(Array.isArray(e)){for(const i of e)if(f(i.geometry&&i.geometry.spatialReference,t)){if(Object(l.b)())return Object(l.c)();throw new r.a("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}}else if(f(e,t)){if(Object(l.b)())return Object(l.c)();throw new r.a("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}}function f(e,t){return!(!Object(n.f)(e)||!Object(n.f)(t)||Object(n.c)(e,t)||Object(a.a)(e,t))}const y=u.bind(null,a.c),m=u.bind(null,a.f);function O(e,t,i){return e?(i||(i=t,t=e.spatialReference),Object(n.f)(t)&&Object(n.f)(i)&&!Object(n.c)(t,i)?Object(a.a)(t,i)?Object(n.h)(i)?y(e):m(e):Object(l.e)(o.a,[e],t,i,null)[0]:e):e}const j=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i){!e||!e.length||!t||!i||Object(n.c)(t,i);const r={geometries:e,inSpatialReference:t,outSpatialReference:i,resolve:null};return this._jobs.push(r),Object(s.f)(e=>{r.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:i,outSpatialReference:r,resolve:s}=e;Object(a.a)(i,r)?Object(n.h)(r)?s(t.map(y)):s(t.map(m)):s(Object(l.e)(o.a,t,i,r,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function g(e,t,i){return j.push(e,t,i)}},445:function(e,t,i){"use strict";var r=i(0),s=(i(4),i(9),i(5)),n=(i(6),i(1)),a=i(2),o=(i(3),i(10),i(11),i(18)),l=i(83),c=i(217),u=i(133),d=i(112);let p=class extends(Object(d.b)(Object(c.a)(Object(u.b)(l.a.EventedMixin(o.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw s.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(r.a)([Object(n.b)({dependsOn:["layer.opacity","parent.fullOpacity"]})],p.prototype,"fullOpacity",null),Object(r.a)([Object(n.b)()],p.prototype,"layer",void 0),Object(r.a)([Object(n.b)()],p.prototype,"parent",void 0),Object(r.a)([Object(n.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],p.prototype,"suspended",null),Object(r.a)([Object(n.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],p.prototype,"suspendInfo",null),Object(r.a)([Object(n.b)({readOnly:!0,dependsOn:["suspended","layer.legendEnabled?"]})],p.prototype,"legendEnabled",null),Object(r.a)([Object(n.b)({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],p.prototype,"updating",null),Object(r.a)([Object(n.b)({dependsOn:["layer.visible"]})],p.prototype,"visible",null),p=Object(r.a)([Object(a.a)("esri.views.layers.LayerView")],p);var h=p;t.a=h},446:function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var r=i(0),s=(i(4),i(9),i(5),i(6),i(1)),n=i(2),a=(i(3),i(10),i(11),i(21)),o=i(88),l=i(16),c=i(15);let u=class extends c.a{};u=Object(r.a)([Object(n.a)("esri.views.layers.support.ClipArea")],u);var d,p=u;let h=d=class extends p{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new d({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(r.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"left",void 0),Object(r.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"right",void 0),Object(r.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0),Object(r.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0),Object(r.a)([Object(s.b)({readOnly:!0,dependsOn:["left","right","top","bottom"]})],h.prototype,"version",null),h=d=Object(r.a)([Object(n.a)("esri.views.layers.support.ClipRect")],h);var b,f=h,y=i(496),m=i(71),O=i(36),j=i(95),g=i(59);i(54);const v={base:m.a,key:"type",typeMap:{extent:O.a,polygon:j.a}};let x=b=class extends p{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new b({geometry:this.geometry.clone()})}};Object(r.a)([Object(s.b)({types:v,json:{read:g.a,write:!0}})],x.prototype,"geometry",void 0),Object(r.a)([Object(s.b)({readOnly:!0,dependsOn:["geometry"]})],x.prototype,"version",null),x=b=Object(r.a)([Object(n.a)("esri.views.layers.support.Geometry")],x);var w=x;let _=class extends p{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(r.a)([Object(s.b)({type:[[[Number]]],json:{write:!0}})],_.prototype,"path",void 0),Object(r.a)([Object(s.b)({readOnly:!0,dependsOn:["path"]})],_.prototype,"version",null),_=Object(r.a)([Object(n.a)("esri.views.layers.support.Path")],_);var S=_;const E=a.a.ofType({key:"type",base:p,typeMap:{rect:f,path:S,geometry:w}}),R=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new E,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new y.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(l.a)(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(l.a)(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(l.a)(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(l.a)(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),(null==(e=this.view)?void 0:e.whenLayerView)?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,r=i.minScale,s=i.maxScale;if(null!=r&&null!=s){let i=!r,n=!s;!i&&e<=r&&(i=!0),!n&&e>=s&&(n=!0),t=i&&n}return t}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(r.a)([Object(s.b)({type:E,set(e){const t=Object(o.b)(e,this._get("clips"),E);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(r.a)([Object(s.b)()],t.prototype,"moving",void 0),Object(r.a)([Object(s.b)()],t.prototype,"attached",void 0),Object(r.a)([Object(s.b)()],t.prototype,"container",void 0),Object(r.a)([Object(s.b)({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),Object(r.a)([Object(s.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(r.a)([Object(s.b)()],t.prototype,"updateRequested",void 0),Object(r.a)([Object(s.b)({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),Object(r.a)([Object(s.b)()],t.prototype,"view",void 0),t=Object(r.a)([Object(n.a)("esri.views.2d.layers.LayerView2D")],t),t}},447:function(e,t,i){"use strict";var r,s=i(0),n=(i(4),i(9),i(8)),a=(i(5),i(6),i(1)),o=i(32),l=i(33),c=i(2),u=i(22),d=(i(3),i(10),i(11),i(15)),p=i(144);let h=r=class extends d.a{async collectRequiredFields(e,t){return Object(p.a)(e,t,this.expression)}clone(){return new r({expression:this.expression,title:this.title})}};Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],h.prototype,"expression",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],h.prototype,"title",void 0),h=r=Object(s.a)([Object(c.a)("esri.layers.support.FeatureExpressionInfo")],h);var b=h,f=i(403);const y=function(){const e=Object.keys(f.a);return e.sort(),e}();var m;const O=Object(o.b)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),j=new o.a({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let g=m=class extends d.a{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write(null,r),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){return this._isOverridden("mode")?this._get("mode"):Object(n.h)(this.offset)||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};Object(s.a)([Object(a.b)({type:b,json:{write:!0}})],g.prototype,"featureExpressionInfo",void 0),Object(s.a)([Object(l.a)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],g.prototype,"readFeatureExpressionInfo",null),Object(s.a)([Object(u.a)("featureExpressionInfo",{featureExpressionInfo:{type:b},"featureExpression.value":{type:[0]}})],g.prototype,"writeFeatureExpressionInfo",null),Object(s.a)([Object(a.b)({type:O.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:O.jsonValues,read:O.read,write:{writer:O.write,isRequired:!0}}})],g.prototype,"mode",null),Object(s.a)([Object(a.b)({type:Number,json:{write:!0}})],g.prototype,"offset",void 0),Object(s.a)([Object(a.b)({type:y,json:{type:String,read:j.read,write:j.write}})],g.prototype,"unit",null),g=m=Object(s.a)([Object(c.a)("esri.layers.support.ElevationInfo")],g);var v=g;t.a=v},452:function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return N})),i.d(t,"c",(function(){return U})),i.d(t,"d",(function(){return k})),i.d(t,"e",(function(){return D})),i.d(t,"f",(function(){return R})),i.d(t,"g",(function(){return E})),i.d(t,"h",(function(){return P})),i.d(t,"i",(function(){return C}));var r=i(4),s=i(8),n=i(34),a=i(28),o=i(220),l=i(213),c=i(59),u=i(23),d=i(259),p=i(303),h=i(26),b=i(72),f=i(298),y=i(260),m=i(420),O=i(491),j=i(441),g=i(467);const v=Math.PI/180,x=Object(f.a)(),w=Object(y.a)(),_=Object(d.d)();function S(e,t,i,s,a,o,u){if(!s||!i.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;const d=s;if(!Object(c.f)(d)){Object(l.a)(e,d);let s=t[0];0===s&&(s=function e(t){switch(t.symbol.type){case"esriSFS":case"esriPFS":{const e=t.symbol.outline;return e?e.width:0}case"esriSLS":return t.symbol.width;case"esriSMS":return t.symbol.size;case"esriPMS":return Math.max(t.symbol.width,t.symbol.height);case"esriTS":{const e=[0,0,0,0];D(e,t.symbol,t.mosaicItem);const i=Math.max(Math.abs(e[0]),Math.abs(e[1]));return Math.max(e[2],e[3])+i}case"expanded-cim":{const e=g.a.getEnvelope(t.symbol.data);return Math.sqrt(e.width*e.width+e.height*e.height)}case"composite-symbol":{if(!t.symbol.layers.length)return 0;const i=t.symbol.layers.length-1;return e({symbol:t.symbol.layers[i],mosaicItem:null})}case"label":default:return Object(r.a)("esri-2d-debug")&&console.debug(`Resource of type ${t.symbol.type} not valid for graphics`),0}}(i),t[0]=s);const n=a*s/2;return e[0]-=n,e[1]-=n,e[2]+=n,e[3]+=n,e}{const r=d.x,s=d.y;"esriTS"===i.symbol.type&&0===t[2]&&0===t[3]&&D(t,i.symbol,i.mosaicItem),function(e,t,i,r,s,a,o,l){let c;switch(r.type){case"esriSMS":case"esriPMS":c=U(t,i,r,a,o,0);break;case"esriTS":c=k(t,i,r,s,a,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":c=N(t,i,r,a,o,0)}let u,d,h=0;for(let e=0;e<c.rings[0].length-1;e++)d=c.rings[0][e],u=(t-d[0])*(t-d[0])+(i-d[1])*(i-d[1]),h=Math.max(h,u);h=Math.sqrt(h);let b=Object(p.b)(t-h,l),f=Object(p.b)(t+h,l);if(b>f){const e=Object(n.d)(l);if(e){const[t,i]=e.valid;b=t,f=i}}e[0]=b,e[1]=i-h,e[2]=f,e[3]=i+h}(e,r,s,i.symbol,t,a,o,u)}return e}function E(e){return"simple-marker"===e||"picture-marker"===e||"text"===e}function R(e){switch(Object(s.m)(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}const V=Object(y.a)(),I=Object(y.a)(),z=Object(y.a)(),F=Object(y.a)(),M=Object(y.a)(),T=Object(y.a)(),q=Object(y.a)();function P(e,t,i,r){Object(h.m)(z,t,i);const s=e.paths;let n,a,o,l,c,u,d,p,b,f=1/0;for(let e=0;e<s.length;e++){const y=s[e];if(!(y.length<2))for(let e=1;e<y.length;e++)n=y[e-1][0],o=y[e-1][1],a=y[e][0],l=y[e][1],c=Math.min(n,a)-r,u=Math.min(o,l)-r,d=Math.max(n,a)+r,p=Math.max(o,l)+r,t<c||t>d||i<u||i>p||(Object(h.m)(V,n,o),Object(h.m)(I,a,l),Object(h.d)(F,I,V),Object(h.d)(M,V,z),Object(h.a)(T,F,Object(h.g)(F,M)/Object(h.g)(F,F)),Object(h.d)(q,M,T),b=Object(h.g)(q,q),f>b&&(f=b))}return Math.sqrt(f)<=r}function U(e,t,i,r,s,n){let a,o;const l=Object(u.h)(i.xoffset),c=Object(u.h)(i.yoffset),d=v*i.angle,p=v*n;switch(i.type){case"esriSMS":a=o=Object(u.h)(i.size);break;case"esriPMS":a=Object(u.h)(i.width),o=Object(u.h)(i.height)}s<.04&&(r=.04*r/s);const f=Object(b.d)(x);Object(b.h)(f,f,Object(h.m)(w,e,t)),Object(b.f)(f,f,p-d),Object(b.g)(f,f,Object(h.m)(w,r,-r)),Object(b.h)(f,f,Object(h.m)(w,l,-c));const y=[0,0];Object(h.n)(y,Object(h.m)(w,-.5*a,-.5*o),f);const m=[0,0];Object(h.n)(m,Object(h.m)(w,-.5*a,.5*o),f);const O=[0,0];Object(h.n)(O,Object(h.m)(w,.5*a,-.5*o),f);const j=[0,0];return Object(h.n)(j,Object(h.m)(w,.5*a,.5*o),f),{rings:[[y,O,j,m,y]]}}function N(e,t,i,r,s,n){const a=g.a.getEnvelope(i.data);if(!a)return null;s<.04&&(r=.04*r/s);const o=Object(u.h)(a.width),l=Object(u.h)(a.height),c=Object(u.h)(a.x),d=Object(u.h)(a.y),p=0*v,f=v*n,y=Object(b.d)(x);Object(b.h)(y,y,Object(h.m)(w,e,t)),Object(b.f)(y,y,f-p),Object(b.g)(y,y,Object(h.m)(w,r,r));const m=[0,0];Object(h.n)(m,Object(h.m)(w,c,d+l),y);const O=[0,0];Object(h.n)(O,Object(h.m)(w,c,d),y);const j=[0,0];Object(h.n)(j,Object(h.m)(w,c+o,d+l),y);const _=[0,0];return Object(h.n)(_,Object(h.m)(w,c+o,d),y),{rings:[[m,j,_,O,m]]}}function k(e,t,i,r,s,n){const a=Object(u.h)(i.xoffset),o=Object(u.h)(i.yoffset),l=v*i.angle,c=v*n,d=Object(b.d)(x);Object(b.h)(d,d,Object(h.m)(w,e,t)),Object(b.f)(d,d,c),Object(b.g)(d,d,Object(h.m)(w,s,-s));const p=r[0]+r[2]/2,f=r[1]+r[3]/2;Object(b.h)(d,d,Object(h.m)(w,a,-o)),Object(b.h)(d,d,Object(h.m)(w,p,f)),Object(b.f)(d,d,l),Object(b.h)(d,d,Object(h.m)(w,-p,-f));const y=[0,0];Object(h.n)(y,Object(h.m)(w,r[0],r[1]),d);const m=[0,0];Object(h.n)(m,Object(h.m)(w,r[0],r[1]+r[3]),d);const O=[0,0];Object(h.n)(O,Object(h.m)(w,r[0]+r[2],r[1]),d);const j=[0,0];return Object(h.n)(j,Object(h.m)(w,r[0]+r[2],r[1]+r[3]),d),{rings:[[y,O,j,m,y]]}}function C(e){let t,i,r,s,a,u,d,p,h,b=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,i=Object(n.d)(t),!i)return e.toJSON();r=t.isWebMercator,u=r?102100:4326,s=L[u].maxX,a=L[u].minX,d=L[u].plus180Line,p=L[u].minus180Line;const f=e.toJSON();if(Object(c.f)(f))h=$(f,s,a);else if(Object(c.e)(f))f.points=f.points.map(e=>$(e,s,a)),h=f;else if(Object(c.d)(f))h=function(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:r,ymax:s}=e,n=e.xmax-e.xmin,a=e.xmin,o=e.xmax;let l;const[c,u]=t.valid;l=H(e.xmin,t);const d=l.x,p=l.frameId;l=H(e.xmax,t);const h=l.x,b=l.frameId,f=d===h&&n>0;if(n>2*u){const e={xmin:a<o?d:h,ymin:r,xmax:u,ymax:s},t={xmin:c,ymin:r,xmax:a<o?h:d,ymax:s},n={xmin:0,ymin:r,xmax:u,ymax:s},l={xmin:c,ymin:r,xmax:0,ymax:s},f=[],y=[];J(e,n)&&f.push(p),J(e,l)&&y.push(p),J(t,n)&&f.push(b),J(t,l)&&y.push(b);for(let e=p+1;e<b;e++)f.push(e),y.push(e);i.push({extent:e,frameIds:[p]},{extent:t,frameIds:[b]},{extent:n,frameIds:f},{extent:l,frameIds:y})}else d>h||f?i.push({extent:{xmin:d,ymin:r,xmax:u,ymax:s},frameIds:[p]},{extent:{xmin:c,ymin:r,xmax:h,ymax:s},frameIds:[b]}):i.push({extent:{xmin:d,ymin:r,xmax:h,ymax:s},frameIds:[p]});return i}(e,t).map(e=>e.extent);return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}(f,i);else if(Object(c.g)(f)||Object(c.h)(f)){const e=_;Object(l.a)(e,f);const t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=A(t.xmin,a)*(2*s),r=0===i?f:function(e,t){const i=function(e){return Object(c.g)(e)?e.rings:e.paths}(e);for(const e of i)for(const i of e)i[0]+=t;return e}(f,i);t.xmin+=i,t.xmax+=i,Object(o.a)(t,d)&&t.xmax!==s||Object(o.a)(t,p)&&t.xmin!==a?b=r:h=r}else h=e.clone();return null!==b?(new Z).cut(b,s):h}function D(e,t,i){if(!i||0===i.glyphMosaicItems.length)return e;const r=Object(j.a)(t.text)[1],s=i.glyphMosaicItems,n=Object(O.a)(s,r,{scale:Object(u.h)(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:Object(m.d)(t.horizontalAlignment||"center"),vAlign:Object(m.f)(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=n.x-n.halfWidth,e[1]=n.y-n.halfHeight,e[2]=n.width,e[3]=n.height,e}const L={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:a.a.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:a.a.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:a.a.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:a.a.WGS84}}};function A(e,t){return Math.ceil((e-t)/(2*t))}function H(e,t){const[i,r]=t.valid,s=2*r;let n,a=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,a=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,a=-n),{x:e,frameId:a}}function J(e,t){const{xmin:i,ymin:r,xmax:s,ymax:n}=t;return G(e,i,r)&&G(e,i,n)&&G(e,s,n)&&G(e,s,r)}function G(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function $(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const i=A(r,t);e[0]=r+i*(-2*t)}else if(r<i){const t=A(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>t){const i=A(r,t);e.x+=i*(-2*t)}else if(r<i){const t=A(r,i);e.x+=t*(-2*i)}}return e}class Z{cut(e,t){let i;if(e.rings)this.closed=!0,i=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,i=e.paths,this.minPts=2}const r=i.length,s=-2*t;for(let e=0;e<r;e++){const t=i[e];if(t&&t.length>=this.minPts){const e=[];for(const i of t)e.push([i[0]+s,i[1]]);i.push(e)}}return this.closed?e.rings=i:e.paths=i,e}}},461:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const r={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const r=new s(e.getPointX(t),e.getPointY(t),i),n=e.hasZ(t),a=e.hasM(t);return n&&(r.z=e.getPointZ(t)),a&&(r.m=e.getPointM(t)),r},exportPolygon:function(e,t,i){return new n(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,i){return new a(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,i){return new o(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(r){const i=e.getZExtent(t);n.zmin=i.vmin,n.zmax=i.vmax}if(s){const i=e.getMExtent(t);n.mmin=i.vmin,n.mmax=i.vmax}return n}};class s{constructor(e,t,i){this.x=e,this.y=t,this.spatialReference=i,this.z=void 0,this.m=void 0}}class n{constructor(e,t,i,r){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),r&&(this.hasM=r)}}class a{constructor(e,t,i,r){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),r&&(this.hasM=r)}}class o{constructor(e,t,i,r){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),r&&(this.hasM=r)}}class l{constructor(e,t,i,r,s){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=r,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},468:function(e,t,i){"use strict";var r,s=i(0),n=(i(4),i(9),i(5)),a=i(1),o=i(38),l=i(32),c=i(33),u=i(2),d=i(22),p=i(14),h=(i(3),i(10),i(11),i(23)),b=i(528),f=i(503),y=(i(6),i(504));let m=r=class extends y.a{constructor(){super(...arguments),this.customValues=null}clone(){return new r({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};Object(s.a)([Object(a.b)({type:[Number],json:{write:!0}})],m.prototype,"customValues",void 0),m=r=Object(s.a)([Object(u.a)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],m);var O,j=m,g=i(416),v=i(438);const x=n.a.getLogger("esri.renderers.visualVariables.SizeVariable"),w=new l.a({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),_=new l.a({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function S(e){if(null!=e)return"string"==typeof e||"number"==typeof e?Object(h.j)(e):"size"===e.type?Object(g.c)(e)?e:(delete(e={...e}).type,new R(e)):void 0}function E(e,t,i){if("object"!=typeof e)return e;const r=new R;return r.read(e,i),r}let R=O=class extends b.a{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:v.g.test(this.valueExpression)}}set expression(e){x.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){Object(g.c)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),Object(g.c)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return Object(g.a)(this)}set maxDataValue(e){e&&this.stops&&(x.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(x.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return S(e)}readMaxSize(e,t,i){return E(e,0,i)}set minDataValue(e){e&&this.stops&&(x.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(x.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return S(e)}readMinSize(e,t,i){return E(e,0,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter(e=>!!e)).sort((e,t)=>e.value-t.value):e&&(x.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return Object(g.b)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if("$view.scale"===e){if(r&&r.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;r.messages.push(new p.a("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?_.read(e):null}clone(){return new O({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(g.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(g.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if("clamped-linear"===this.transformationType){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){const e=this.stops,t=e.map(e=>e.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};Object(s.a)([Object(a.b)({readOnly:!0,dependsOn:["valueExpression","stops"]})],R.prototype,"cache",null),Object(s.a)([Object(a.b)({type:w.apiValues,json:{type:w.jsonValues,origins:{"web-map":{read:!1}},read:w.read,write:w.write}})],R.prototype,"axis",void 0),Object(s.a)([Object(a.b)({type:String,value:null,json:{read:!1}})],R.prototype,"expression",null),Object(s.a)([Object(a.b)()],R.prototype,"index",null),Object(s.a)([Object(a.b)({type:String,readOnly:!0,dependsOn:["field","valueExpression"]})],R.prototype,"inputValueType",null),Object(s.a)([Object(a.b)({type:j,json:{write:!0}})],R.prototype,"legendOptions",void 0),Object(s.a)([Object(a.b)({type:Number,value:null,json:{write:!0}})],R.prototype,"maxDataValue",null),Object(s.a)([Object(a.b)({type:Number,value:null,json:{write:!0}})],R.prototype,"maxSize",null),Object(s.a)([Object(o.a)("maxSize")],R.prototype,"castMaxSize",null),Object(s.a)([Object(c.a)("maxSize")],R.prototype,"readMaxSize",null),Object(s.a)([Object(a.b)({type:Number,value:null,json:{write:!0}})],R.prototype,"minDataValue",null),Object(s.a)([Object(a.b)({type:Number,value:null,json:{write:!0}})],R.prototype,"minSize",null),Object(s.a)([Object(o.a)("minSize")],R.prototype,"castMinSize",null),Object(s.a)([Object(c.a)("minSize")],R.prototype,"readMinSize",null),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],R.prototype,"normalizationField",void 0),Object(s.a)([Object(a.b)({readOnly:!0,dependsOn:["valueExpression","minSize.arcadeRequired","maxSize.arcadeRequired"]})],R.prototype,"arcadeRequired",null),Object(s.a)([Object(a.b)({type:String})],R.prototype,"scaleBy",void 0),Object(s.a)([Object(a.b)({type:[f.a],value:null,json:{write:!0}})],R.prototype,"stops",null),Object(s.a)([Object(a.b)({type:["outline"],json:{write:!0}})],R.prototype,"target",void 0),Object(s.a)([Object(a.b)({type:String,readOnly:!0,dependsOn:["minDataValue","maxDataValue","minSize","maxSize","valueUnit","inputValueType","stops"]})],R.prototype,"transformationType",null),Object(s.a)([Object(a.b)({type:["size"],json:{type:["sizeInfo"]}})],R.prototype,"type",void 0),Object(s.a)([Object(a.b)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],R.prototype,"useSymbolValue",void 0),Object(s.a)([Object(a.b)({type:String,json:{write:!0}})],R.prototype,"valueExpression",void 0),Object(s.a)([Object(c.a)("valueExpression",["valueExpression","expression"])],R.prototype,"readValueExpression",null),Object(s.a)([Object(d.a)("web-scene","valueExpression")],R.prototype,"writeValueExpressionWebScene",null),Object(s.a)([Object(a.b)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],R.prototype,"valueRepresentation",void 0),Object(s.a)([Object(a.b)({type:_.apiValues,json:{write:_.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],R.prototype,"valueUnit",void 0),Object(s.a)([Object(c.a)("valueUnit")],R.prototype,"readValueUnit",null),R=O=Object(s.a)([Object(u.a)("esri.renderers.visualVariables.SizeVariable")],R);var V=R;t.a=V},474:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(5),s=i(14),n=i(397),a=i(398);const o=r.a.getLogger("esri.views.2d.engine.webgl");function l(e){return Object(a.n)(e.minDataValue)&&Object(a.n)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?n.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?n.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?n.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?n.e.SIZE_UNIT_VALUE:(o.error(new s.a("mapview-bad-type","Found invalid size VisualVariable",e)),n.e.NONE)}},481:function(e,t,i){"use strict";var r,s=i(0),n=(i(4),i(9),i(5),i(6),i(1)),a=i(2),o=(i(3),i(10),i(11),i(15));let l=r=class extends o.a{constructor(){super(...arguments),this.title=null}clone(){return new r({title:this.title})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=r=Object(s.a)([Object(a.a)("esri.renderers.support.LegendOptions")],l);var c=l;t.a=c},503:function(e,t,i){"use strict";var r,s=i(0),n=(i(4),i(9),i(5),i(6),i(1)),a=i(2),o=(i(3),i(10),i(11),i(15)),l=i(23);let c=r=class extends o.a{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new r({label:this.label,size:this.size,value:this.value})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],c.prototype,"label",void 0),Object(s.a)([Object(n.b)({type:Number,cast:l.j,json:{write:!0}})],c.prototype,"size",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],c.prototype,"value",void 0),c=r=Object(s.a)([Object(a.a)("esri.renderers.visualVariables.support.SizeStop")],c);var u=c;t.a=u},504:function(e,t,i){"use strict";var r,s=i(0),n=(i(4),i(9),i(5),i(6),i(1)),a=i(2),o=(i(3),i(10),i(11),i(481));let l=r=class extends o.a{constructor(){super(...arguments),this.showLegend=null}clone(){return new r({title:this.title,showLegend:this.showLegend})}};Object(s.a)([Object(n.b)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),l=r=Object(s.a)([Object(a.a)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);var c=l;t.a=c},528:function(e,t,i){"use strict";var r=i(0),s=(i(4),i(9),i(5)),n=i(6),a=i(1),o=i(38),l=i(32),c=i(2),u=(i(3),i(10),i(11),i(15)),d=i(504);const p=s.a.getLogger("esri.renderers.visualVariables.VisualVariable"),h=new l.a({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let b=class extends u.a{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(p.error(".field: field must be a string value"),null):Object(n.l)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};Object(r.a)([Object(a.b)()],b.prototype,"index",void 0),Object(r.a)([Object(a.b)({type:h.apiValues,readOnly:!0,json:{read:h.read,write:h.write}})],b.prototype,"type",void 0),Object(r.a)([Object(a.b)({type:String,json:{write:!0}})],b.prototype,"field",void 0),Object(r.a)([Object(o.a)("field")],b.prototype,"castField",null),Object(r.a)([Object(a.b)({type:String,json:{write:!0}})],b.prototype,"valueExpression",void 0),Object(r.a)([Object(a.b)({type:String,json:{write:!0}})],b.prototype,"valueExpressionTitle",void 0),Object(r.a)([Object(a.b)({readOnly:!0,dependsOn:["valueExpression"]})],b.prototype,"arcadeRequired",null),Object(r.a)([Object(a.b)({type:d.a,json:{write:!0}})],b.prototype,"legendOptions",void 0),b=Object(r.a)([Object(c.a)("esri.renderers.visualVariables.VisualVariable")],b);var f=b;t.a=f},563:function(e,t,i){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let r=0;r<e.length;r++){const s=e[r].size;"number"==typeof s&&(t+=s,i++)}return t/i}(e.stops):t}function n(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?function(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:r}=t;return(s(i,e)+s(r,e))/2});let r=0;const n=i.length;if(0===n)return e;for(let e=0;e<n;e++)r+=i[e];const a=Math.floor(r/n);return Math.max(a,e)}(i,t.visualVariables):i;if("simple"===t.type)return r(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos.forEach(t=>{e=r(e,t.symbol)}),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach(t=>{e=r(e,t.symbol)}),e}return t.type,n}i.d(t,"a",(function(){return n}))},574:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i(8);var r=i(36),s=(i(54),i(50));i(563);function n(e,t,i,n=new r.a){let a;if("2d"===i.type)a=t*i.resolution;else if("3d"===i.type){const r=i.basemapTerrain,n=r.overlayManager,o=n?n.overlayPixelSizeInMapUnits(e):1;a=r&&!r.spatialReference.equals(i.spatialReference)?Object(s.c)(r.spatialReference)/Object(s.c)(i.spatialReference):t*o}const o=e.x-a,l=e.y-a,c=e.x+a,u=e.y+a,{spatialReference:d}=i;return n.xmin=Math.min(o,c),n.ymin=Math.min(l,u),n.xmax=Math.max(o,c),n.ymax=Math.max(l,u),n.spatialReference=d,n}new r.a},575:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return a}));var r=i(8),s=i(39),n=i(144);async function a(e,t=e.popupTemplate){if(!Object(r.h)(t))return[];const i=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:a}=t,{objectIdField:o,typeIdField:l,globalIdField:c,relationships:u}=e;if(Object(s.e)(i,"*"))return["*"];const d=a?await Object(n.m)(e):[],p=Object(n.i)(e.fields,[...i,...d]);return l&&p.push(l),p&&o&&Object(n.p)(e.fields,o)&&-1===p.indexOf(o)&&p.push(o),p&&c&&Object(n.p)(e.fields,c)&&-1===p.indexOf(c)&&p.push(c),u&&u.forEach(t=>{const{keyField:i}=t;p&&i&&Object(n.p)(e.fields,i)&&-1===p.indexOf(i)&&p.push(i)}),p}function o(e,t){return e.popupTemplate?e.popupTemplate:Object(r.h)(t)&&t.defaultPopupTemplateEnabled&&Object(r.h)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},898:function(e,t,i){"use strict";i.r(t);var r,s=i(0),n=i(4),a=(i(9),i(12)),o=i(8),l=i(5),c=(i(6),i(1)),u=i(2),d=i(14),p=(i(3),i(10),i(7)),h=(i(11),i(82)),b=i(28),f=i(36),y=i(54),m=i(21),O=i(94);let j=r=class extends O.a{getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer&&this.sourceLayer.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.objectId}clone(){return new r({objectId:this.objectId,...this.cloneProperties()})}};Object(s.a)([Object(c.b)({type:Number,json:{read:!0}})],j.prototype,"objectId",void 0),j=r=Object(s.a)([Object(u.a)("esri.AggregateGraphic")],j);var g,v=j,x=i(16),w=i(125),_=i(261),S=i(183),E=i(225),R=i(442),V=i(396),I=i(445),z=i(563),F=i(574),M=i(542),T=i(535),q=i(450),P=i(32),U=i(22),N=i(15),k=i(59),C=i(56),D=i(212);const L=new P.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),A=new P.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let H=g=class extends N.a{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||"1=1"}enable(){this._set("enabled",!0)}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:l}=this;return new S.a({geometry:Object(a.a)(i),objectIds:Object(a.a)(n),spatialRelationship:r,timeExtent:Object(a.a)(s),where:t,units:o,distance:l,...e})}clone(){const{where:e,geometry:t,spatialRelationship:i,hiddenIds:r,timeExtent:s,objectIds:n,units:o,distance:l}=this,c=new Set;return r.forEach(e=>c.add(e)),new g({geometry:Object(a.a)(t),hiddenIds:c,objectIds:Object(a.a)(n),spatialRelationship:i,timeExtent:Object(a.a)(s),where:e,units:o,distance:l})}};Object(s.a)([Object(c.b)({type:String})],H.prototype,"where",void 0),Object(s.a)([Object(U.a)("where")],H.prototype,"writeWhere",null),Object(s.a)([Object(c.b)({types:y.a,json:{read:k.a,write:!0}})],H.prototype,"geometry",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:{source:"spatialRel",reader:L.read},write:{target:"spatialRel",writer:L.write}}})],H.prototype,"spatialRelationship",void 0),Object(s.a)([Object(c.b)({json:{write:(e,t,i)=>t[i]=Object(C.c)(e),read:e=>Object(C.a)(e)}})],H.prototype,"hiddenIds",void 0),Object(s.a)([Object(c.b)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],H.prototype,"distance",void 0),Object(s.a)([Object(c.b)({type:[Number],json:{write:!0}})],H.prototype,"objectIds",void 0),Object(s.a)([Object(c.b)({type:String,json:{read:A.read,write:{writer:A.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],H.prototype,"units",void 0),Object(s.a)([Object(c.b)({type:D.a,json:{write:!0}})],H.prototype,"timeExtent",void 0),Object(s.a)([Object(c.b)({readOnly:!0})],H.prototype,"enabled",void 0),H=g=Object(s.a)([Object(u.a)("esri.views.layers.support.FeatureFilter")],H);var J,G=H,$=i(455),Z=i(539),W=i(588);const B=l.a.getLogger("esri.views.layers.support.ParsedFeatureEffect");let Q=J=class extends N.a{constructor(){super(...arguments),this.done=!0}static fromString(e){const t=[];let i=null;const r=Object(W.a)(e);if(r.error)B.error(new d.a("invalid-type","Encountered an error when parsing css",r.error));else for(const e of r.effects)"opacity"===e.type?i=e:"colorMatrix"in e&&t.push(e);return new J({transforms:t,opacity:i})}getOpacity(){return Object(o.h)(this.opacity)?this.opacity.amount:1}getColorMatrix(){return(this.transforms||[]).map(e=>({colorMatrix:Object(Z.a)(e.colorMatrix)})).reverse().reduce((e,t)=>Object($.j)(e,e,t.colorMatrix),Object(Z.b)())}clone(){return new J({transforms:this.transforms&&this.transforms.map(e=>({...e}))})}};Object(s.a)([Object(c.b)()],Q.prototype,"opacity",void 0),Object(s.a)([Object(c.b)()],Q.prototype,"transforms",void 0),Q=J=Object(s.a)([Object(u.a)("esri.views.layers.support.ParsedFeatureEffect")],Q);var X,K=i(18);let Y=X=class extends K.a{constructor(){super(...arguments),this.from=null,this.to=null,this.duration=4e3,this.repeat=!0,this.done=!1}getColorMatrix(){if(this.done=!1,null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{const e=this._lastTime,t=Date.now(),i=t-e;this._currentStep=this._currentStep+i,this._currentStep>=2147483647&&(this._currentStep=0),this._lastTime=t}const e=this._currentStep%this.duration/(this.duration/2),t=e<=1?e:2-e,i=this.from.getColorMatrix(),r=this.to.getColorMatrix();return Object($.k)(i,i,1-t),Object($.k)(r,r,t),!this.repeat&&this._currentStep>=this.duration&&(this.done=!0),Object($.l)(i,i,r)}getOpacity(){throw new Error("No getOpacity definition for Transition")}clone(){const e=new X({from:this.from.clone(),to:this.to.clone(),duration:this.duration});return e._lastTime=this._lastTime,e._currentStep=this._currentStep,e}};Object(s.a)([Object(c.b)()],Y.prototype,"from",void 0),Object(s.a)([Object(c.b)()],Y.prototype,"to",void 0),Object(s.a)([Object(c.b)({type:Number})],Y.prototype,"duration",void 0),Object(s.a)([Object(c.b)({type:Boolean})],Y.prototype,"repeat",void 0),Y=X=Object(s.a)([Object(u.a)("esri.views.layers.support.Transition")],Y);var ee,te=Y;const ie=l.a.getLogger("esri.views.layers.support.FeatureEffect");let re=ee=class extends N.a{constructor(){super(...arguments),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}get insideEffect(){return ie.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect}set insideEffect(e){ie.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect=e}get outsideEffect(){return ie.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect}set outsideEffect(e){ie.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect=e}get parsedIncludedEffect(){return Object(o.h)(this.includedEffect)?"string"==typeof this.includedEffect?Q.fromString(this.includedEffect):new te({from:Q.fromString(this.includedEffect.from),to:Q.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null}get parsedExcludedEffect(){return Object(o.h)(this.excludedEffect)?"string"==typeof this.excludedEffect?Q.fromString(this.excludedEffect):new te({from:Q.fromString(this.excludedEffect.from),to:Q.fromString(this.excludedEffect.to),duration:this.excludedEffect.duration}):null}get renderingHash(){return`${this.excludedLabelsVisible}-${this.includedEffect}-${this.excludedEffect}`}get done(){return(!Object(o.h)(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!Object(o.h)(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)}clone(){return new ee({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};Object(s.a)([Object(c.b)({type:G,json:{write:!0}})],re.prototype,"filter",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],re.prototype,"includedEffect",void 0),Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],re.prototype,"excludedEffect",void 0),Object(s.a)([Object(c.b)({type:Boolean,json:{write:!0}})],re.prototype,"excludedLabelsVisible",void 0),Object(s.a)([Object(c.b)({dependsOn:["includedEffect"]})],re.prototype,"parsedIncludedEffect",null),Object(s.a)([Object(c.b)({dependsOn:["excludedEffect"]})],re.prototype,"parsedExcludedEffect",null),Object(s.a)([Object(c.b)({dependsOn:["includedEffect","excludedEffect"]})],re.prototype,"renderingHash",null),re=ee=Object(s.a)([Object(u.a)("esri.views.layers.support.FeatureEffect")],re);var se=re,ne=i(301),ae=i(144),oe=i(412),le=i(575);const ce=l.a.getLogger("esri.views.layers.FeatureLayerView"),ue=e=>{let t=class extends e{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.effect=null,this.filter=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){Object(x.a)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","timeExtent"],()=>this._handleRequiredFieldsChange(),!0)}get availableFields(){const{layer:e,layer:{fields:t},requiredFields:i}=this;return"outFields"in e&&e.outFields?Object(ae.i)(t,[...Object(ae.t)(t,e.outFields),...i]):Object(ae.i)(t,i)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){ce.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e,t={}){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(o.h)(this.filter)?this.filter.createQuery(e):new S.a(e);return this.timeExtent&&(t.timeExtent=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return Object(ne.e)()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then(()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fields:i,objectIdField:r,renderer:s,displayField:n}}=this,a=t.featureReduction,l=new Set,c=await Object(p.m)([s?s.collectRequiredFields(l,i):null,Object(ae.g)(l,t),e?Object(ae.b)(l,t):null,Object(o.h)(this.filter)?Object(ae.f)(l,t,this.filter):null,this.effect?Object(ae.f)(l,t,this.effect.filter):null,a?Object(ae.c)(l,t,a):null]);t.timeInfo&&this.timeExtent&&Object(ae.e)(l,t.fields,[t.timeInfo.startField,t.timeInfo.endField]);for(const e of c)e.error&&ce.error(e.error);Object(ae.d)(l,i,r),e&&n&&Object(ae.d)(l,i,n);const u=Object(C.c)(l).sort();this._set("requiredFields",u)}validateFetchPopupFeatures(e){const{layer:t,layer:{popupEnabled:i}}=this;return i?Object(le.a)(this.layer,e)?void 0:new d.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new d.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})}async fetchClientPopupFeatures(e){const t=Object(o.h)(e)?e.clientGraphics:null;if(!t||0===t.length)return Object(p.r)([]);const i=[],r=[],{layer:s}=this,n=Object(le.a)(s,e);if(!Object(o.h)(n))return Object(p.r)([]);const a=await this._loadArcadeModules(n),l=a&&a.arcadeUtils.hasGeometryOperations(n),c=await this.createPopupQuery(e),u=Object(ae.t)(s.fields,c.outFields);for(const e of t)l||!Object(ae.h)(u,e)?r.push(e):i.push(e);return"stream"===s.type||0===r.length?Object(p.r)(i):(c.objectIds=r.map(e=>e.attributes[s.objectIdField]),s.queryFeatures(c).then(e=>i.concat(e.features)).catch(()=>r))}async createPopupQuery(e){const t=this.layer,i=t.createQuery(),r=Object(le.a)(t,e),s=Object(o.h)(r)&&await this._loadArcadeModules(r),n=Object(o.h)(r)&&s&&s.arcadeUtils.hasGeometryOperations(r),a=!("point"!==t.geometryType&&!n);return i.returnGeometry=a,i.returnZ=a,i.returnM=a,i.outFields=await Object(le.b)(this.layer,r),i.outSpatialReference=this.view.spatialReference,i}canResume(){var e;return!!super.canResume()&&!(null==(e=this.timeExtent)?void 0:e.isEmpty)}};return Object(s.a)([Object(c.b)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null),Object(s.a)([Object(c.b)({type:se})],t.prototype,"effect",void 0),Object(s.a)([Object(c.b)({type:G})],t.prototype,"filter",void 0),Object(s.a)([Object(c.b)(oe.a)],t.prototype,"timeExtent",void 0),Object(s.a)([Object(c.b)()],t.prototype,"layer",void 0),Object(s.a)([Object(c.b)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),Object(s.a)([Object(c.b)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),Object(s.a)([Object(c.b)({readOnly:!0})],t.prototype,"requiredFields",void 0),Object(s.a)([Object(c.b)({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0),Object(s.a)([Object(c.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(u.a)("esri.views.layers.FeatureLayerView")],t),t};var de=i(446);var pe=i(23),he=i(472),be=i(467),fe=i(452);const ye={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};const me=[0,0,0,0];function Oe(e,t){return null==e?t:e}const je={sdf:!0,code:99,metrics:V.c.metrics,rect:new he.a(0,0,24,24),page:0,textureBinding:2};async function ge(e,t){return function(e){return e.type in ye}(e)?Math.min(await async function e(t,i){if("simple-marker"===t.type){const e=Math.max(Oe(t.size,12),i);return ve(t)+.707*e}if("picture-marker"===t.type){const e=Math.max(Oe(t.height,12),i),r=Oe(t.width,12)*(e/Oe(t.height,12))/2,s=e/2;return ve(t)+Math.sqrt(r*r+s*s)}if("text"===t.type){const e=function(e){const t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[je]};const i=[];for(let r=0;r<t;r++)i.push({...je,code:e.text.charCodeAt(r)});return{glyphMosaicItems:i}}(t);Object(fe.e)(me,t.toJSON(),e);const i=Math.abs(me[0]),r=Math.abs(me[1]),s=me[2],n=me[3];return Math.max(i,r)+Math.max(s,n)}if("simple-line"===t.type){const e=t,r=Math.max(Oe(e.width,.75),i)/2;return e.marker?Math.max(6*e.width,2*i):r}if("simple-fill"===t.type||"picture-fill"===t.type)return Math.max(function(e,t){return null==e.outline?0:Oe(e.outline.width,0)}(t),i)/2;if("cim"===t.type){const e=be.a.getEnvelope(t.data);return e?Math.sqrt(e.width*e.width+e.height*e.height):0}return"web-style"===t.type?e(await t.fetchCIMSymbol(),i):0}(e,t),75):0}function ve(e){const t=Oe(e.xoffset,0),i=Oe(e.yoffset,0);return Math.sqrt(t*t+i*i)}function xe(e,t){return Math.max(e,t)}var we=i(133),_e=i(307);let Se=class extends we.a{constructor(e){super(e),this._startupResolver=Object(p.g)(),this.isReady=!1}initialize(){this._controller=Object(p.c)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort(),this._connection&&this._connection.close()}set tileRenderer(e){this.client.tileRenderer=e}get closed(){return this._connection.closed}async startup(e,t,i){await this.when();const r=this._controller.signal,s=(n=i.source,Array.isArray(n)?{transferList:i.source,signal:r}:void 0);var n;const a={service:i,config:t,tileInfo:e.tileInfo.toJSON()};await this._connection.invoke("startup",a,s),this._startupResolver.resolve(),this._set("isReady",!0)}async updateTiles(e){return await this._startupResolver.promise,this._connection.invoke("updateTiles",e)}async update(e,t){const i={config:e,pause:t};return await this._startupResolver.promise,this._connection.invoke("update",i)}async invalidate(e){return await this._startupResolver.promise,this._connection.invoke("invalidate",e)}async resume(){return await this._startupResolver.promise,Object(p.v)(this._connection.invoke("controller.resume"))}async setHighlight(e){return await this._startupResolver.promise,Object(p.v)(this._connection.invoke("controller.setHighlight",e))}async refresh(){return await this._startupResolver.promise,Object(p.v)(this._connection.invoke("controller.refresh"))}async setViewState(e){return await this._startupResolver.promise,Object(p.v)(this._connection.invoke("setViewState",e.toJSON()))}async queryFeatures(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",e.toJSON(),t)}async queryObjectIds(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",e.toJSON(),t)}async queryFeatureCount(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)}async queryExtent(e,t){return this._connection.invoke("controller.queryExtent",e.toJSON(),t)}async queryLatestObservations(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)}async queryStatistics(e){return await this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",e)}async getObjectId(e){return await this._startupResolver.promise,this._connection.invoke("controller.getObjectId",e)}async getDisplayId(e){return await this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",e)}async getFeature(e){return await this._startupResolver.promise,this._connection.invoke("controller.getFeature",e)}async getAggregate(e){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregate",e)}async getAggregateValueRanges(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")}async mapValidDisplayIds(e){return await this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",e)}async onEdits(e){await this._startupResolver.promise;const{addedFeatures:t,deletedFeatures:i,updatedFeatures:r}=e;return Object(p.v)(this._connection.invoke("controller.onEdits",{addedFeatures:t,deletedFeatures:i,updatedFeatures:r}))}async enableEvent(e,t){return await this._startupResolver.promise,Object(p.v)(this._connection.invoke("controller.enableEvent",{name:e,value:t}))}async _startWorker(e){try{this._connection=await Object(_e.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(e){Object(p.x)(e)}}};Object(s.a)([Object(c.b)()],Se.prototype,"isReady",void 0),Object(s.a)([Object(c.b)()],Se.prototype,"client",void 0),Object(s.a)([Object(c.b)()],Se.prototype,"tileRenderer",null),Se=Object(s.a)([Object(u.a)("esri.views.2d.layers.support.FeatureLayerProxy")],Se);var Ee=Se,Re=i(147),Ve=i(188);class Ie{constructor(e){this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}destroy(){}clear(){this._tiles.forEach(e=>this._releaseTile(e))}tileKeys(){const e=[];return this._tiles.forEach((t,i)=>e.push(i)),e}update(e){const t=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),{spans:i,lodInfo:r}=t,{level:s}=r,n=[],a=[],o=new Set,l=new Set;for(const{row:e,colFrom:t,colTo:a}of i)for(let i=t;i<=a;i++){const t=Re.a.getId(s,e,r.normalizeCol(i),r.getWorldForColumn(i)),a=this._getOrAcquireTile(n,t);o.add(t),a.isReady?a.visible=!0:l.add(a.key)}return l.forEach(e=>this._addPlaceholders(o,e)),this._tiles.forEach(e=>{o.has(e.key.id)||(a.push(e.key.id),this._releaseTile(e))}),Ve.a.pool.release(t),{hasMissingTiles:l.size>0,added:n,removed:a}}_getOrAcquireTile(e,t){if(!this._tiles.has(t)){const i=this.acquireTile(new Re.a(t));e.push(t),this._tiles.set(t,i),i.visible=!1}return this._tiles.get(t)}_getTile(e){return this._tiles.get(e)}_releaseTile(e){this._tiles.delete(e.key.id),this.releaseTile(e)}_addPlaceholders(e,t){const i=this._addPlaceholderChildren(e,t);Math.abs(1-i)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}_addPlaceholderChildren(e,t){let i=0;return this._tiles.forEach(r=>{i+=this._addPlaceholderChild(e,r,t)}),i}_addPlaceholderChild(e,t,i){return t.key.level<=i.level||!t.hasData||!i.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-i.level)))}_addPlaceholderParent(e,t){let i=t.getParentKey(),r=0,s=null;for(;Object(o.h)(i);){if(e.has(i.id))return!0;const t=this._getTile(i.id);if(null==t?void 0:t.isReady)return t.visible=!0,e.add(t.key.id),!0;(null==t?void 0:t.hasData)&&t.patchCount>r&&(r=t.patchCount,s=t),i=i.getParentKey()}return!!s&&(s.visible=!0,e.add(s.key.id),!0)}}const ze=l.a.getLogger("esri.views.2d.layers.FeatureLayerView2D");let Fe=class extends(ue(Object(E.a)(Object(de.a)(I.a)))){constructor(){super(...arguments),this._pipelineIsUpdating=!0,this._updatingPipelineConfig=!1,this._onGoingEdits=0,this._viewStateId=-1,this._visibilityOverrides=new Set,this._effect=null,this._highlightIds=new Map,this._lastPixelBuffer=0,this.filter=null,this.doRefresh=Object(p.n)(async()=>{this._onGoingEdits=0;try{this._lockGPUUploads(),await this._proxy.refresh(),this._unlockGPUUploads()}catch(e){Object(p.b)(e)||ze.error(e)}}),this._doUpdate=Object(p.n)(async()=>{if(this.destroyed||!this._hasRequiredSupport(this.layer))return;this._set("_updatingPipelineConfig",!0);const{effect:e,filter:t}=this;if(await this._updateRequiredFields(),this.destroyed)return;const{renderer:i}=this._getEffectiveRenderer();this._set("_effectiveRenderer",i);const r=Object(T.a)(this.layer.geometryType),s=await async function(e,t,i){if(!e||i&&"cluster"===i.type)return 0;if("heatmap"===e.type)return Math.round(3*e.blurRadius);if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?100:200;const r=e.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;const t=e.getVisualVariablesForType("size");if(!t[0])return 0;const i=t[0];return"stops"===i.transformationType?i.stops.map(e=>e.size).reduce(xe,0):"clamped-linear"===i.transformationType?"number"==typeof i.maxSize?i.maxSize:i.maxSize.stops.map(e=>e.size).reduce(xe,0):"real-world-size"===i.transformationType?30:void 0}(e),n=[];for(const e of r)n.push(ge(e,s));const a=await Object(p.a)(n);return Object(pe.h)(a.reduce(xe,0))}(i,r,this.layer.featureReduction),n=this._createConfiguration(t,e);this._lastPixelBuffer=0===s?0:Math.max(s,this._lastPixelBuffer),n.schema.source.pixelBuffer=this._lastPixelBuffer;const a=this._createTileRendererHash(i);if(!this.destroyed){if(a!==this._tileRendererHash){if(await this._initTileRenderer(i),this.destroyed)return;const e=await this._createServiceOptions();if(this.destroyed)return;if(this.effects.forEach(e=>Object(o.h)(e)&&Object(o.h)(e.filter)&&e.filter.enable()),this.tileRenderer.onConfigUpdate(i),await this._proxy.startup(this.view.featuresTilingScheme,n,e),await this._proxy.updateTiles({added:this._tileStrategy.tileKeys(),removed:[]}),this.destroyed)return;if(this.hasHighlight()&&await this._proxy.setHighlight(Object(w.b)(this._highlightIds)),this.destroyed)return;if(await this._onceTilesUpdated(),this.destroyed)return;this.tileRenderer.onConfigUpdate(i)}else{const t=await this._proxy.update(n,!0);if(this.destroyed)return;if(t.queryFilter){this._lockGPUUploads();try{await this._proxy.invalidate(t)}catch(e){Object(p.b)(e)||ze.error(e)}if(this.destroyed)return;this._unlockGPUUploads()}else{try{await this._proxy.invalidate({...t,mesh:!1})}catch(e){Object(p.b)(e)||ze.error(e)}if(this.destroyed)return;if(t.mesh){this._lockGPUUploads();try{var l;await this._proxy.invalidate({mesh:!0,targets:{aggregate:null==(l=t.targets)?void 0:l.aggregate}})}catch(e){Object(p.b)(e)||ze.error(e)}this._unlockGPUUploads()}}if(this.destroyed)return;this._proxy.resume(),this.effects.forEach(e=>Object(o.h)(e)&&Object(o.h)(e.filter)&&e.filter.enable()),this.tileRenderer.onConfigUpdate(i),this._forceAttributeTextureUpload()}this._tileRendererHash=a,this.tileRenderer.invalidateLabels(),this.requestUpdate()}}),this._updateHighlight=Object(p.n)(async()=>this._proxy.setHighlight(Object(w.b)(this._highlightIds)))}destroy(){var e,t;null==(e=this._proxy)||e.destroy(),Object(o.a)(this._updateClusterSizeTask,e=>e.remove()),null==(t=this.tileRenderer)||t.destroy()}initialize(){this.addResolvingPromise(this._initProxy()),this.handles.add([this.on("valueRangesChanged",e=>{this._set("_aggregateValueRanges",e.valueRanges)})])}async _initProxy(){if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type&&this.layer.isTable)throw new d.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});const e=this.layer.spatialReference,t=b.a.WGS84;if(this.layer.featureReduction&&!Object(R.b)(e,t))throw new d.a("featurelayerview:featureReduction-not-supported","cannot project feature layer to WGS84",{inSpatialReference:e,outSpatialReference:t});this._proxy&&this._proxy.destroy();const i=this._createClientOptions();return this._set("_proxy",new Ee({client:i})),this._proxy.when()}get labelsVisible(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible}get effect(){return Object(o.n)(this._effect,null)}set effect(e){const t=this._effect;Object(o.h)(t)&&Object(o.h)(t.filter)&&t.filter.enabled&&Object(o.h)(e)&&Object(o.h)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}get effects(){return this.effect&&[this.effect]||[]}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,{definitionExpression:i,renderer:r,labelingInfo:s}=t,n="feature"===t.type?t.gdbVersion:void 0,a="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:l}=this,c="stream"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,u=JSON.stringify(this.clips),d=t.featureReduction&&t.featureReduction.toJSON();return JSON.stringify({filterHash:Object(o.h)(this.filter)&&this.filter.toJSON(),effectHash:Object(o.h)(this.effect)&&this.effect.toJSON(),streamFilter:c,gdbVersion:n,definitionExpression:i,historicMoment:a,availableFields:e,renderer:r,labelingInfo:t.labelsVisible&&s,timeExtent:l,clipsHash:u,featureReduction:d})}highlight(e){let t;return e instanceof O.a?t=[e.getObjectId()]:"number"==typeof e?t=[e]:m.a.isCollection(e)?t=e.map(e=>e&&e.getAttribute(this.layer.objectIdField)).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]?e:e.map(e=>e&&e.getAttribute(this.layer.objectIdField))),t&&t.length?(t=t.filter(e=>null!=e),this._addHighlight(t),{remove:()=>this._removeHighlight(t),pause:()=>this._removeHighlight(t),resume:()=>this._addHighlight(t)}):{remove:()=>{},pause:()=>{},resume:()=>{}}}hasHighlight(){return!!this._highlightIds.size}hitTest(e,t){return this._hitTest(e,t)}queryStatistics(){return this._proxy.queryStatistics()}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then(e=>{const t=_.default.fromJSON(e);return t.features.forEach(e=>{e.layer=this.layer,e.sourceLayer=this.layer}),t})}queryFeaturesJSON(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}queryObjectIds(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}queryFeatureCount(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}queryExtent(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then(e=>({count:e.count,extent:f.a.fromJSON(e.extent)}))}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:i,removed:r}=this._tileStrategy.update(e);(i.length||r.length)&&this._proxy.updateTiles({added:i,removed:r}),t&&this.requestUpdate();const{state:s}=e;this._viewStateId!==s.id&&(this._proxy.setViewState(s),this._viewStateId=s.id),this.notifyChange("updating")}attach(){this.view.timeline.record(this.layer.title+" (FeatureLayer) Attach"),this._tileStrategy=new Ie({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(x.a)(this,"renderingConfigHash",()=>this._update()),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",async e=>{this._set("_onGoingEdits",this._onGoingEdits+1),await this._proxy.onEdits(e),this._set("_onGoingEdits",Math.max(0,this._onGoingEdits-1))}),"attach")}detach(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}async fetchPopupFeatures(e,t){if(Object(o.h)(t)&&t.clientGraphics.length){const e=t.clientGraphics[0];if(e instanceof v)return[e]}const i=this.validateFetchPopupFeatures(t);if(i)return Object(p.h)(i);if(Object(o.h)(t)&&0===t.clientGraphics.length)return Object(p.r)([]);const r=this.fetchClientPopupFeatures(t);if(!e)return r;const s=this._fetchServicePopupFeatures(e,t);return Object(p.u)([r,s]).then(h.d)}async _fetchServicePopupFeatures(e,t){if("stream"===this.layer.type)return[];const i=await this.createPopupQuery(t),{layer:r}=this,{renderer:s}=r,n=Object(o.h)(t)?t.event:null,a=Object(z.a)({renderer:s,event:n});i.geometry=this.createFetchPopupFeaturesQueryGeometry(e,a);const l=new Set,{objectIdField:c}=r,u=Object(o.h)(t)?t.clientGraphics:null;if(u)for(const e of u)l.add(e.attributes[c]);return r.queryFeatures(i).then(e=>e.features.filter(e=>!l.has(e.attributes[c])))}createFetchPopupFeaturesQueryGeometry(e,t){return Object(F.a)(e,t,this.view)}isUpdating(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||this._onGoingEdits>0)}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}async _createServiceOptions(){const e=this.layer;if("stream"===e.type)return null;const{capabilities:t,objectIdField:i}=e,r=e.fields.map(e=>e.toJSON()),s=e.fullExtent&&e.fullExtent.toJSON(),n=Object(T.a)(e.geometryType),o=e.timeInfo&&e.timeInfo.toJSON()||null,l=e.spatialReference?e.spatialReference.toJSON():null;let c;return"ogc-feature"===e.type?c=function(e){const{capabilities:t,collectionId:i,source:{layerDefinition:r},url:s}=e;return{capabilities:t,collectionId:i,url:s,layerDefinition:r}}(e):function(e){return e&&"openPorts"in e}(e.source)?c=await e.source.openPorts():e.parsedUrl&&(c=Object(a.a)(e.parsedUrl),"dynamicDataSource"in e&&e.dynamicDataSource&&(c.query={layer:JSON.stringify({source:e.dynamicDataSource})})),{type:"on-demand",maxRecordCount:t.query.maxRecordCount,tileMaxRecordCount:t.query.tileMaxRecordCount,capabilities:t,fields:r,fullExtent:s,geometryType:n,objectIdField:i,source:c,timeInfo:o,spatialReference:l}}async _createMemoryServiceOptions(e){const t=await e.openPorts();return{...this._createServiceOptions(),type:"memory",source:t}}_cleanUpQuery(e){const t=S.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}_createUpdateClusterSizeTask(e,t){return this.watch("_aggregateValueRanges",async i=>{this._updateClusterEffectiveRendererSizeVariable(e,t,i),this._updatingPipelineConfig||this.tileRenderer.onConfigUpdate(this._effectiveRenderer)})}async _updateClusterEffectiveRendererSizeVariable(e,t,i){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const r=Object(M.c)(e.visualVariables);if(Object(o.h)(r)&&"cluster_count"===r.field){const s=e.visualVariables.indexOf(r);e.visualVariables[s]=Object(M.a)(t,i);const n=e.clone();n.dynamicClusterSize=!0,this._set("_effectiveRenderer",n)}}}_getEffectiveRenderer(){const e=this.layer.renderer,t=this.layer.featureReduction;if(Object(o.h)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(M.d)(e)){const i=t,r=[],s=Object(M.b)(r,e,i,this._aggregateValueRanges);return Object(o.a)(this._updateClusterSizeTask,e=>e.remove()),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,i),{renderer:s,aggregateFields:r,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const t=this.tileRenderer.acquireTile(e);return t.once("attach",()=>{this.requestUpdate()}),t}_releaseTile(e){this.tileRenderer.releaseTile(e)}async _initTileRenderer(e){const t=await async function(e,t){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((await Promise.all([i.e(6),i.e(49)]).then(i.bind(null,1005))).default)(t);case"heatmap":return new((await Promise.all([i.e(6),i.e(72)]).then(i.bind(null,1006))).default)(t)}}(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=t,this._set("tileRenderer",t),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(e),this.requestUpdate(),this.tileRenderer)}_createTileRendererHash(e){return`${"heatmap"===e.type?"heatmap":"symbol"}.${"dot-density"===e.type}`}_createFeatureDataHash(e,t,i){const r=e.getAttributeHash(),s=JSON.stringify(t),n=Object(o.h)(i)&&JSON.stringify(i.filter),a=JSON.stringify(this.timeExtent);let l="";return this._visibilityOverrides.forEach(e=>l+=e),`${r}.${s}.${n}.${a}.${l}`}_injectOverrides(e){const t=Object(o.h)(e)?e.timeExtent:null,i=this.timeExtent&&t?this.timeExtent.intersection(t):this.timeExtent||t;if(!this._visibilityOverrides.size&&!i)return e;const r=Object(o.h)(e)&&e.clone()||new G;return r.hiddenIds=this._visibilityOverrides,r.timeExtent=i,r}_createConfiguration(e,t){const i="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,r="feature"===this.layer.type?this.layer.gdbVersion:void 0,s=new Array(V.o),n=this._injectOverrides(e);return s[0]=Object(o.h)(n)?n.toJSON():null,s[1]=Object(o.h)(t)&&t.filter?t.filter.toJSON():null,{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:r,historicMoment:i,devicePixelRatio:window.devicePixelRatio||1,filters:s,schema:Object(o.m)(Object(q.b)(this,0))}}_hasRequiredSupport(e){var t;return!("dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(n.a)("esri-webgl-texture-float")&&(ze.error(new d.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),Object(x.g)(this,"_pipelineIsUpdating",!1)}_lockGPUUploads(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()}_unlockGPUUploads(){this.tileRenderer&&this.tileRenderer.unlockGPUUploads()}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_update(){this.view.timeline.begin(this.layer.title+" (FeatureLayer) Initial Pipeline Config");const e=this._doUpdate();this._updatingPromise=e;const t=()=>{e===this._updatingPromise&&this._set("_updatingPipelineConfig",!1),this.view&&this.view.timeline.end(this.layer.title+" (FeatureLayer) Initial Pipeline Config")};e.then(t).catch(e=>{Object(p.b)(e)||ze.error(e),t()})}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch(e=>{Object(p.b)(e)||ze.error(e)})}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight().catch(e=>{Object(p.b)(e)||ze.error(e)})}_createHittestResult(e){return e.layer=this.layer,e.sourceLayer=this.layer,Object(o.h)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}async _hitTest(e,t){if(this.suspended||!this.tileRenderer)return null;const i=await this.tileRenderer.hitTest(e,t);if(0===i.length)return await Object(p.s)(1),null;const r=i[0];if(!(e=>(2147483648&e)>>>31==1)(r)){const e=await this._proxy.getFeature(r);return Object(o.a)(e,e=>this._createHittestResult(O.a.fromJSON(e)))}const s=await this._proxy.getAggregate(r);if(Object(o.g)(s))return null;if(Object(o.h)(s.referenceId)){const e=await this._proxy.getFeature(s.referenceId);return Object(o.a)(e,e=>this._createHittestResult(O.a.fromJSON(e)))}return this._createHittestResult(v.fromJSON(s))}};Object(s.a)([Object(c.b)()],Fe.prototype,"_proxy",void 0),Object(s.a)([Object(c.b)()],Fe.prototype,"_pipelineIsUpdating",void 0),Object(s.a)([Object(c.b)()],Fe.prototype,"_updatingPipelineConfig",void 0),Object(s.a)([Object(c.b)()],Fe.prototype,"_effectiveRenderer",void 0),Object(s.a)([Object(c.b)()],Fe.prototype,"_aggregateValueRanges",void 0),Object(s.a)([Object(c.b)()],Fe.prototype,"_onGoingEdits",void 0),Object(s.a)([Object(c.b)({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],Fe.prototype,"labelsVisible",null),Object(s.a)([Object(c.b)({type:G})],Fe.prototype,"filter",void 0),Object(s.a)([Object(c.b)({type:se})],Fe.prototype,"effect",null),Object(s.a)([Object(c.b)({readOnly:!0,dependsOn:["effect"]})],Fe.prototype,"effects",null),Object(s.a)([Object(c.b)({dependsOn:["layer.renderer","layer.outFields","layer.definitionExpression","layer.gdbVersion?","layer.geometryDefinition?","layer.historicMoment?","layer.labelingInfo","layer.labelsVisible","layer.featureReduction","filter","effect","timeExtent","clips"]})],Fe.prototype,"renderingConfigHash",null),Object(s.a)([Object(c.b)()],Fe.prototype,"tileRenderer",void 0),Object(s.a)([Object(c.b)({dependsOn:["layer.renderer","tileRenderer","tileRenderer.updating","_updatingPipelineConfig","_pipelineIsUpdating","_updatingRequiredFieldsPromise","_proxy","_proxy.isReady?","_onGoingEdits"]})],Fe.prototype,"updating",void 0),Fe=Object(s.a)([Object(u.a)("esri.views.2d.layers.FeatureLayerView2D")],Fe);var Me=Fe;t.default=Me},959:function(e,t,i){"use strict";i.r(t);var r=i(0),s=(i(4),i(9),i(8)),n=(i(5),i(6),i(1)),a=i(2),o=i(14),l=(i(3),i(10),i(11),i(261)),c=i(535),u=i(898);function d(e,t){if(Object(s.g)(e)&&Object(s.g)(t))return null;const i={};return Object(s.h)(t)&&(i.geometry=t.toJSON()),Object(s.h)(e)&&(i.where=e),i}let p=class extends u.default{constructor(){super(...arguments),this._enabledDataReceived=!1,this.errorString=null,this.connectionStatus="disconnected"}initialize(){this.handles.add([this.layer.watch("purgeOptions",()=>this._update())])}destroy(){this.connectionStatus="disconnected"}get connectionError(){if(this.errorString)return new o.a("stream-controller",this.errorString)}on(e,t){"data-received"===e&&(this._enabledDataReceived=!0,this._proxy.enableEvent("data-received",!0));const i=super.on(e,t),r=this;return{remove(){i.remove(),"data-received"===e&&(r._proxy.closed||r.hasEventListener("data-received")||r._proxy.enableEvent("data-received",!1))}}}queryLatestObservations(e,t){if(!this.layer.timeInfo.endField&&!this.layer.timeInfo.startField)throw new o.a("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(e),t).then(e=>{const t=l.default.fromJSON(e);return t.features.forEach(e=>{e.layer=this.layer,e.sourceLayer=this.layer}),t})}_createClientOptions(){return{...super._createClientOptions(),setProperty:e=>{this.set(e.propertyName,e.value)}}}_createTileRendererHash(e){const t=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(d(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(e)+t}async _createServiceOptions(){const e=this.layer,{objectIdField:t}=e,i=e.fields.map(e=>e.toJSON()),r=Object(c.a)(e.geometryType),s=e.timeInfo&&e.timeInfo.toJSON()||null,n=e.spatialReference?e.spatialReference.toJSON():null;return{type:"stream",fields:i,geometryType:r,objectIdField:t,timeInfo:s,source:this.layer.parsedUrl,serviceFilter:d(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enableDataReceived:this._enabledDataReceived,spatialReference:n,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval}}};Object(r.a)([Object(n.b)()],p.prototype,"errorString",void 0),Object(r.a)([Object(n.b)({dependsOn:["errorString"],readOnly:!0})],p.prototype,"connectionError",null),Object(r.a)([Object(n.b)()],p.prototype,"connectionStatus",void 0),p=Object(r.a)([Object(a.a)("esri.views.2d.layers.StreamLayerView2D")],p);var h=p;t.default=h}}]);