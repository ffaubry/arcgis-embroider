(window.webpackJsonp=window.webpackJsonp||[]).push([[33,6,7,14,25,95],{399:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return _})),i.d(t,"d",(function(){return m})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return a})),i.d(t,"h",(function(){return l}));var n=i(14),r=i(397),s=i(551);function o(e,t=!1){const i=r.e.SIZE_FIELD_STOPS|r.e.SIZE_MINMAX_VALUE|r.e.SIZE_SCALE_STOPS|r.e.SIZE_UNIT_VALUE,n=(e&(r.f.FIELD_TARGETS_OUTLINE|r.f.MINMAX_TARGETS_OUTLINE|r.f.SCALE_TARGETS_OUTLINE|r.f.UNIT_TARGETS_OUTLINE))>>>4;return t?i&n:i&~n}function a(e,t,i,n,s){switch(e){case r.d.FILL:return p.from(t,n);case r.d.LINE:return _.from(t,i);case r.d.MARKER:return m.from(t);case r.d.TEXT:return g.from(t);case r.d.LABEL:return y.from(t,s);default:throw new Error("Unable to createMaterialKey for unknown geometryType "+e)}}function l(e){switch(c.load(e).geometryType){case r.d.MARKER:return new m(e);case r.d.FILL:return new p(e);case r.d.LINE:return new _(e);case r.d.TEXT:return new g(e);case r.d.LABEL:return new y(e)}}class c{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get geometryTypeString(){switch(this.geometryType){case r.d.FILL:return"fill";case r.d.MARKER:return"marker";case r.d.LINE:return"line";case r.d.TEXT:return"text";case r.d.LABEL:return"label";default:throw new n.a("Unable to handle unknown geometryType: "+this.geometryType)}}setBit(e,t){const i=1<<e;t?this._data|=i:this._data&=~i}bit(e){return(this._data&1<<e)>>e}setBits(e,t,i){for(let n=t,r=0;n<i;n++,r++)this.setBit(n,0!=(e&1<<r))}bits(e,t){let i=0;for(let n=e,r=0;n<t;n++,r++)i|=this.bit(n)<<r;return i}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}c.shared=new c(0);const u=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const i=o(e,t)&e;this.vvSizeMinMaxValue=!!(i&r.e.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&r.e.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&r.e.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&r.e.SIZE_SCALE_STOPS)}},h=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t&&!!(e&r.e.ROTATION)}},d=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t&&!!(e&r.e.COLOR)}},f=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t&&!!(e&r.e.OPACITY)}};class p extends(d(f(c))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const i=this.load(0);return i.geometryType=r.d.FILL,t?i.dotDensity=!0:i.setVV(e,!1),i.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(e){this.setBit(15,e)}}p.shared=new p(0);class m extends(d(f(h(u(c))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r.d.MARKER,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0);class _ extends(d(f(u(c)))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const i=this.load(0);return i.geometryType=r.d.LINE,i.setVV(e,t),i.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}_.shared=new _(0);class g extends(d(f(h(u(c))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(e);return t.geometryType=r.d.TEXT,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class y extends(u(c)){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const i=this.load(0);return i.geometryType=r.d.LABEL,i.setVV(e,!1),i.mapAligned=!!Object(s.a)(t),i.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0)},401:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return m})),i.d(t,"h",(function(){return d})),i.d(t,"i",(function(){return f})),i.d(t,"j",(function(){return g}));var n=i(12),r=i(59),s=i(421);function o(e){const t=Object(n.a)(e);return(i=t)&&(Object(r.g)(i)?u(i.rings):Object(r.h)(i)?u(i.paths):Object(r.e)(i)&&c(i.points)),t;var i}function a(e){if(e)for(let t=e.length-1;t>0;--t)e[t][0]-=e[t-1][0],e[t][1]-=e[t-1][1]}function l(e){if(e)for(const t of e)a(t)}function c(e){if(e){const t=e.length;for(let i=1;i<t;++i)e[i][0]+=e[i-1][0],e[i][1]+=e[i-1][1]}}function u(e){if(e)for(const t of e)c(t)}function h(e){e&&(Object(r.g)(e)?l(e.rings):Object(r.h)(e)?l(e.paths):Object(r.e)(e)&&a(e.points))}function d(e){if(e)for(const t of e)f(t)}function f(e){e&&e.reverse()}function p(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]}function m(e){return!(!e||0===e.length)&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function _(e){return e[4]}function g(e,t){e[4]=t}class y{constructor(e,t,i,n){this.acceptPolygon=t,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,e&&(Object(r.g)(e)?t&&(this.multiPath=e.rings,this.isClosed=!0):Object(r.h)(e)?i&&(this.multiPath=e.paths,this.isClosed=!1):Object(r.d)(e)&&t&&(this.multiPath=x(e).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new s.a}next(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;const e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null}}class v{constructor(e,t,i,n){this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1}next(){for(;;){if(!this.multiPath){let e=this.inputGeometries.next();for(;e;){if(Object(r.g)(e)?this.acceptPolygon&&(this.multiPath=e.rings,this.isClosed=!0):Object(r.h)(e)?this.acceptPolyline&&(this.multiPath=e.paths,this.isClosed=!1):Object(r.d)(e)&&this.acceptPolygon&&(this.multiPath=x(e).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}e=this.inputGeometries.next()}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;const e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null}}}function x(e){return{rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}}},403:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i(5),r=(i(82),i(70)),s=i(50);i(414),i(55),i(66),i(85),i(111);n.a.getLogger("esri.renderers.support.utils");const o={inches:Object(s.a)(1,"meters","inches"),feet:Object(s.a)(1,"meters","feet"),"us-feet":Object(s.a)(1,"meters","us-feet"),yards:Object(s.a)(1,"meters","yards"),miles:Object(s.a)(1,"meters","miles"),"nautical-miles":Object(s.a)(1,"meters","nautical-miles"),millimeters:Object(s.a)(1,"meters","millimeters"),centimeters:Object(s.a)(1,"meters","centimeters"),decimeters:Object(s.a)(1,"meters","decimeters"),meters:Object(s.a)(1,"meters","meters"),kilometers:Object(s.a)(1,"meters","kilometers"),"decimal-degrees":1/Object(s.h)(1,"meters")};Object(r.a)("short-date")},413:function(e,t,i){"use strict";i.d(t,"a",(function(){return H})),i.d(t,"b",(function(){return Q})),i.d(t,"c",(function(){return q})),i.d(t,"d",(function(){return X})),i.d(t,"e",(function(){return W})),i.d(t,"f",(function(){return U})),i.d(t,"g",(function(){return k})),i.d(t,"h",(function(){return R})),i.d(t,"i",(function(){return Y})),i.d(t,"j",(function(){return J})),i.d(t,"k",(function(){return Z})),i.d(t,"l",(function(){return D})),i.d(t,"m",(function(){return b})),i.d(t,"n",(function(){return F})),i.d(t,"o",(function(){return A})),i.d(t,"p",(function(){return ce})),i.d(t,"q",(function(){return te})),i.d(t,"r",(function(){return re})),i.d(t,"s",(function(){return le})),i.d(t,"t",(function(){return $})),i.d(t,"u",(function(){return ee})),i.d(t,"v",(function(){return g})),i.d(t,"w",(function(){return y})),i.d(t,"x",(function(){return oe})),i.d(t,"y",(function(){return se}));var n=i(5),r=i(14),s=i(59),o=i(529),a=i(558),l=i(418);function c(e,t){return e?t?4:3:t?3:2}const u=n.a.getLogger("esri.tasks.support.optimizedFeatureSet"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},d=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s},f=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s,e[i+2]=t[n+2]},p=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s,e[i+2]=t[n+3]},m=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s,e[i+2]=t[n+2],e[i+3]=t[n+3]};function _(e,t,i,n){if(e){if(i)return t&&n?m:f;if(t&&n)return p}else if(t&&n)return f;return d}function g({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function y({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function v({scale:e,translate:t},i){return i*e[0]+t[0]}function x({scale:e,translate:t},i){return t[1]-i*e[1]}function b(e,t,i){return e?t?i?I(e):w(e):i?C(e):O(e):null}function O(e){const t=e.coords;return{x:t[0],y:t[1]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function w(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function C(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function j(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function E(e,t){return e&&t?j:e?T:t?M:S}function P(e,t,i,n,r){const s=E(i,n);for(const i of t){const{geometry:t,attributes:n}=i;let a;t&&(a=s(new l.a,t)),e.push(new o.a(a,n,null,n[r]))}return e}function D(e,t,i){if(!e)return null;const n=c(t,i),r=[];for(let t=0;t<e.coords.length;t+=n){const i=[];for(let r=0;r<n;r++)i.push(e.coords[t+r]);r.push(i)}return t?i?{points:r,hasZ:t,hasM:i}:{points:r,hasZ:t}:i?{points:r,hasM:i}:{points:r}}function L(e,t,i,n,r){const s=c(i,n);for(const i of t){const t=i.geometry,n=i.attributes;let a;t&&(a=z(new l.a,t,s)),e.push(new o.a(a,n,null,n[r]))}return e}function z(e,t,i=c(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const n=e.coords;let r=0;for(const e of t.points)for(let t=0;t<i;t++)n[r++]=e[t];return e}function A(e,t,i){if(!e)return null;const n=c(t,i),{coords:r,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<n;t++)e.push(r[a++]);t.push(e)}o.push(t)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function V(e,t,i,n,r){const s=c(i,n);for(const i of t){const t=i.geometry,n=i.attributes;let a;t&&(a=R(new l.a,t,s)),e.push(new o.a(a,n,null,n[r]))}return e}function R(e,t,i=c(t.hasZ,t.hasM)){const{lengths:n,coords:r}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<i;e++)r[s++]=t[e];n.push(e.length)}return e}function F(e,t,i){if(!e)return null;const n=c(t,i),{coords:r,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<n;t++)e.push(r[a++]);t.push(e)}o.push(t)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function N(e,t,i,n,r){for(const s of t){const t=s.geometry,a=s.centroid,c=s.attributes;let u;t&&(u=k(new l.a,t,i,n)),a?e.push(new o.a(u,c,S(new l.a,a),c[r])):e.push(new o.a(u,c,null,c[r]))}return e}function k(e,t,i=t.hasZ,n=t.hasM){return U(e,t.rings,i,n),e}function U(e,t,i,n){const r=c(i,n),{lengths:s,coords:o}=e;let a=0;s.length=o.length=0;for(const e of t){for(const t of e)for(let e=0;e<r;e++)o[a++]=t[e];s.push(e.length)}return e}const G=[],B=[];function H(e,t,i,n,r){G[0]=e;const[s]=q(B,G,t,i,n,r);return G.length=B.length=0,s}function q(e,t,i,n,s,a){if(e.length=0,!i){for(const i of t){const t=i.attributes[a];e.push(new o.a(null,i.attributes,null,t))}return e}switch(i){case"esriGeometryPoint":return P(e,t,n,s,a);case"esriGeometryMultipoint":return L(e,t,n,s,a);case"esriGeometryPolyline":return V(e,t,n,s,a);case"esriGeometryPolygon":return N(e,t,n,s,a);default:u.error("convertToFeatureSet:unknown-geometry",new r.a(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function W(e,t,i,n,s,o){const a=e.length;switch(i){case"esriGeometryPoint":P(e,t,n,s,o);break;case"esriGeometryMultipoint":L(e,t,n,s,o);break;case"esriGeometryPolyline":V(e,t,n,s,o);break;case"esriGeometryPolygon":N(e,t,n,s,o);break;default:u.error("convertToFeatureSet:unknown-geometry",new r.a(`Unable to parse unknown geometry type '${i}'`))}for(let n=0;n<t.length;n++)e[n+a].geometryType=i,e[n+a].insertAfter=t[n].insertAfter,e[n+a].groupId=t[n].groupId;return e}function Y(e,t,i,n){B[0]=e,K(G,B,t,i,n);const r=G[0];return G.length=B.length=0,r}function X(e,t,i){if(!e)return null;const n=new l.a;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),Object(s.f)(e)?E(null!=t?t:null!=e.z,null!=i?i:null!=e.m)(n,e):Object(s.g)(e)?k(n,e,t,i):Object(s.h)(e)?R(n,e,c(t,i)):Object(s.e)(e)?z(n,e,c(t,i)):void u.error("convertFromGeometry:unknown-geometry",new r.a(`Unable to parse unknown geometry type '${e}'`))}function Z(e,t,i,n){const s=e&&("coords"in e?e:e.geometry);if(!s)return null;switch(t){case"esriGeometryPoint":{let e=O;return i&&n?e=I:i?e=w:n&&(e=C),e(s)}case"esriGeometryMultipoint":return D(s,i,n);case"esriGeometryPolyline":return A(s,i,n);case"esriGeometryPolygon":return F(s,i,n);default:return void u.error("convertToGeometry:unknown-geometry",new r.a(`Unable to parse unknown geometry type '${t}'`))}}function K(e,t,i,n,s){switch(e.length=0,i){case"esriGeometryPoint":return function(e,t,i,n){let r=O;i&&n?r=I:i?r=w:n&&(r=C);for(const i of t){const{geometry:t,attributes:n}=i,s=t?r(t):null;e.push({attributes:n,geometry:s})}return e}(e,t,n,s);case"esriGeometryMultipoint":return function(e,t,i,n){for(const r of t){const{geometry:t,attributes:s}=r;let o;t&&(o=D(t,i,n)),e.push({attributes:s,geometry:o})}return e}(e,t,n,s);case"esriGeometryPolyline":return function(e,t,i,n){for(const r of t){const{geometry:t,attributes:s}=r;let o;t&&(o=A(t,i,n)),e.push({attributes:s,geometry:o})}return e}(e,t,n,s);case"esriGeometryPolygon":return function(e,t,i,n){for(const r of t){const{geometry:t,attributes:s,centroid:o}=r;let a;if(t&&(a=F(t,i,n)),o){const t=O(o);e.push({attributes:s,centroid:t,geometry:a})}else e.push({attributes:s,geometry:a})}return e}(e,t,n,s);default:u.error("convertToFeatureSet:unknown-geometry",new r.a(`Unable to parse unknown geometry type '${i}'`))}return e}function J(e){const{objectIdFieldName:t,spatialReference:i,transform:n,fields:r,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,f={features:K([],a,l,o,s),fields:r,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:u,queryGeometry:Z(h,d,!1,!1)};return n&&(f.transform=n),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function Q(e,t){const i=new a.a,{hasM:n,hasZ:s,features:o,objectIdFieldName:l,spatialReference:c,geometryType:h,exceededTransferLimit:d,transform:f}=e;return i.fields=e.fields,i.geometryType=h,i.objectIdFieldName=l||t,i.spatialReference=c,i.objectIdFieldName?(o&&q(i.features,o,h,s,n,i.objectIdFieldName),d&&(i.exceededTransferLimit=d),n&&(i.hasM=n),s&&(i.hasZ=s),f&&(i.transform=f),i):(u.error(new r.a("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function $(e,t){const{geometryType:i,features:n,hasM:r,hasZ:s}=t;if(!e)return t;for(let t=0;t<n.length;t++){const o=n[t],a=o.weakClone();a.geometry=new l.a,ee(a.geometry,o.geometry,r,s,i,e),o.centroid&&(a.centroid=new l.a,ee(a.centroid,o.centroid,r,s,"esriGeometryPoint",e)),n[t]=a}return t.transform=e,t}function ee(e,t,i,n,r,s,o=i,a=n){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=h[r],{coords:u,lengths:d}=t,f=c(i,n),p=c(i&&o,n&&a),m=_(i,n,o,a);if(!d.length)return m(e.coords,u,0,0,g(s,u[0]),y(s,u[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let v,x,b,O,S=0,w=0,T=w;for(const t of d){if(t<l)continue;let i=0;w=T,b=v=g(s,u[S]),O=x=y(s,u[S+1]),m(e.coords,u,w,S,b,O),i++,S+=f,w+=p;for(let n=1;n<t;n++,S+=f)b=g(s,u[S]),O=y(s,u[S+1]),b===v&&O===x||(m(e.coords,u,w,S,b-v,O-x),w+=p,i++,v=b,x=O);i>=l&&(e.lengths.push(i),T=w)}return e.coords.length=T,e.coords.length?e:null}function te(e,t,i,n,r,s,o=i,a=n){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=h[r],{coords:u,lengths:d}=t,f=c(i,n),p=c(i&&o,n&&a),m=_(i,n,o,a);if(!d.length)return m(e.coords,u,0,0,u[0],u[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;let g=0;const y=s*s;for(const t of d){if(t<l){g+=t*f;continue}const i=e.coords.length/p,n=g,r=g+(t-1)*f;m(e.coords,u,e.coords.length,n,u[n],u[n+1]),ne(e.coords,u,f,y,m,n,r),m(e.coords,u,e.coords.length,r,u[r],u[r+1]);const s=e.coords.length/p-i;s>=l?e.lengths.push(s):e.coords.length=i*p,g+=t*f}return e.coords.length?e:null}function ie(e,t,i,n){const r=e[t],s=e[t+1],o=e[i],a=e[i+1],l=e[n],c=e[n+1];let u=o,h=a,d=l-u,f=c-h;if(0!==d||0!==f){const e=((r-u)*d+(s-h)*f)/(d*d+f*f);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=f*e)}return d=r-u,f=s-h,d*d+f*f}function ne(e,t,i,n,r,s,o){let a,l=n,c=0;for(let e=s+i;e<o;e+=i)a=ie(t,e,s,o),a>l&&(c=e,l=a);l>n&&(c-s>i&&ne(e,t,i,n,r,s,c),r(e,t,e.length,c,t[c],t[c+1]),o-c>i&&ne(e,t,i,n,r,c,o))}function re(e,t,i,n){if(!t||!t.coords||!t.coords.length)return null;const r=c(i,n);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=r){const i=e[t],n=e[t+1];s=Math.min(s,i),a=Math.max(a,i),o=Math.min(o,n),l=Math.max(l,n)}}return e[0]=s,e[1]=o,e[2]=a,e[3]=l,e}function se(e,t,i,n,r){const{coords:s,lengths:o}=t,a=i?n?m:f:n?f:d,l=c(i,n);if(!s.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,s,0,0,v(r,s[0]),x(r,s[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[u,h]=r.scale;let p=0;for(let t=0;t<o.length;t++){const i=o[t];e.lengths[t]=i;let n=v(r,s[p]),c=x(r,s[p+1]);a(e.coords,s,p,p,n,c),p+=l;for(let t=1;t<i;t++,p+=l)n+=s[p]*u,c-=s[p+1]*h,a(e.coords,s,p,p,n,c)}return e!==t&&(e.lengths.length=o.length,e.coords.length=s.length),e}function oe(e,t,i,n,r,s){const o=c(i,n),a=_(i,n,r,s),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1]);return e}function ae(e,t,i,n){let r=0,s=e[n*t],o=e[n*(t+1)];for(let a=1;a<i;a++){const i=s+e[n*(t+a)],l=o+e[n*(t+a)+1],c=(i-s)*(l+o);s=i,o=l,r+=c}return.5*r}function le(e,t){const{coords:i,lengths:n}=e;let r=0,s=0;for(let e=0;e<n.length;e++)s+=ae(i,r,n[e],t),r+=e;return Math.abs(s)}function ce(e,t){const i=e.clone(),n=e.coords,r=e.lengths;let s=0;for(let e=0;e<r.length;e++){const o=r[e];let a=n[t*s],l=n[t*s+1];for(let e=1;e<o;e++){const r=a+n[t*(s+e)],o=l+n[t*(s+e)+1];i.coords[t*(s+e)]=r,i.coords[t*(s+e)+1]=o,a=r,l=o}s+=o}return i}},414:function(e,t,i){"use strict";var n,r=i(0),s=(i(4),i(9),i(5),i(6)),o=i(1),a=i(2),l=i(22),c=(i(3),i(10),i(11),i(15)),u=i(35);let h=n=class extends c.a{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=null==e?0:e}clone(){return new n({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};Object(r.a)([Object(o.b)({type:u.a,json:{type:[s.a],write:!0}})],h.prototype,"color",void 0),Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],h.prototype,"label",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:{allowNull:!0}}})],h.prototype,"value",void 0),Object(r.a)([Object(l.a)("value")],h.prototype,"writeValue",null),h=n=Object(r.a)([Object(a.a)("esri.renderers.visualVariables.support.ColorStop")],h);var d=h;t.a=d},415:function(e,t,i){"use strict";function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function r(e,t){return Math.sqrt(e*e+t*t)}function s(e){const t=r(e[0],e[1]);e[0]/=t,e[1]/=t}function o(e,t){return r(e[0]-t[0],e[1]-t[1])}function a(e){return"function"==typeof e}function l(e){return 1/Math.max(e,1)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return n}))},416:function(e,t,i){"use strict";function n(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function r(e){return null!=e&&!isNaN(e)&&isFinite(e)}function s(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function o(e,t){const i=t||s(e),n=e.valueUnit||"unknown";return"unknown"===i?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===n?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return r}))},417:function(e,t,i){"use strict";function n(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function r(e){return e.toLowerCase().trim()}t.a=class{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],!e)return;const t=[];for(const i of e){const e=i&&i.name;if(e){const s=r(e);this._fieldsMap.set(e,i),this._fieldsMap.set(s,i),t.push(s),n(i)&&(this.dateFields.push(i),this._dateFieldsSet.add(i))}}t.sort(),this.uid=t.join(",")}destroy(){this._fieldsMap.clear()}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(r(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}normalizeFieldName(e){const t=this.get(e);if(t)return t.name}}},418:function(e,t,i){"use strict";class n{constructor(e=[],t=[],i=!1){this.lengths=e,this.coords=t,this.hasIndeterminateRingOrder=i}get isPoint(){return 0===this.lengths.length}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let i=0;i<n;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=n}}clone(){return new n(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}t.a=n},420:function(e,t,i){"use strict";var n,r;function s(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":case"justify":return n.Center}}function o(e){switch(e){case"top":return r.Top;case"middle":return r.Center;case"baseline":return r.Baseline;case"bottom":return r.Bottom}}function a(e){switch(e){case"above-left":return[n.Right,r.Bottom];case"above-center":case"above-along":return[n.Center,r.Bottom];case"above-right":return[n.Left,r.Bottom];case"center-left":return[n.Right,r.Center];case"center-center":case"center-along":return[n.Center,r.Center];case"center-right":return[n.Left,r.Center];case"below-left":return[n.Right,r.Top];case"below-center":case"below-along":return[n.Center,r.Top];case"below-right":return[n.Left,r.Top];case"always-horizontal":return[n.Center,r.Baseline];default:return console.debug("Found invalid placement type "+e),[n.Center,r.Center]}}function l(e){switch(e){case n.Right:return-1;case n.Center:return 0;case n.Left:return 1;default:return console.debug("Found invalid horizontal alignment "+e),0}}function c(e){switch(e){case r.Top:return 1;case r.Center:return 0;case r.Bottom:case r.Baseline:return-1;default:return console.debug("Found invalid vertical alignment "+e),0}}function u(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":case"justify":return n.Center}}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return c})),function(e){e[e.Left=-1]="Left",e[e.Center=0]="Center",e[e.Right=1]="Right"}(n||(n={})),function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(r||(r={}))},421:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rz_c=e,this.rz_s=t}setRotate(e){this.rz=e,this.rz_c=void 0,this.rz_s=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}}},422:function(e,t,i){"use strict";var n=i(8),r=i(59),s=i(397),o=i(401),a=i(499),l=i(453);class c{static executeEffects(e,t){const i=Object(o.c)(t);let n=new a.a(i);for(const t of e){const e=Object(l.a)(t);e&&(n=e.execute(n,t,1.3333333333333333))}return n}static next(e){const t=e.next();return Object(o.d)(t),t}}t.a=class{get needsPixelBuffer(){return!!this.effects||this.geometryType===s.d.MARKER||this.geometryType===s.d.TEXT||this.geometryType===s.d.LABEL}writeMesh(e,t,i,s,o){if(Object(n.g)(this.effects))return this.writeMeshWithGeometry(e,t,i,s,o);const a=c.executeEffects(this.effects,i.readLegacyGeometry());let l=c.next(a);for(;l;)this.writeMeshWithGeometry(e,t,i,Object(r.c)(l),o,l),l=c.next(a)}writeMeshWithGeometry(e,t,i,n,r,s){}bindFeature(e,t,i){}}},426:function(e,t,i){"use strict";function n(e,t){if(null!==t){e.push(t.length);for(const i of t)i.serialize(e);return e}e.push(0)}function r(e,t,i){const n=e.readInt32(),r=new Array(n);for(let n=0;n<r.length;n++)r[n]=t.deserialize(e,i);return r}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}))},430:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(14);function r(e,t){if(e&&"name"in e){const i=e;return t&&t.error(new n.a(i.name,i.message,i.details)),!1}return!0}},436:function(e,t,i){"use strict";t.a=class{constructor(){this.name=this.constructor.name||"UnnamedBrush"}prepareState(e,t,i){}draw(e,t,i){}drawMany(e,t,i){for(const n of t)this.draw(e,n,i)}}},438:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return f}));var n=i(49),r=i(8),s=i(5),o=i(35),a=i(94),l=i(416),c=i(403);const u=s.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),h=new a.a,d=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function p(e,t,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"color"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s="number"==typeof t,a=s?null:t,l=a&&a.attributes;let c=s?t:null;const h=n.field,{ipData:d,hasExpression:f}=n.cache;let p=n.cache.compiledFunc;if(!h&&!f){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(f){if(!Object(r.h)(i)||!Object(r.h)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),o=t.createExecContext(a,s);if(!p){const e=t.createSyntaxTree(n.valueExpression);p=t.createFunction(e),n.cache.compiledFunc=p}c=t.executeFunction(p,o)}else l&&(c=l[h]);const m=n.normalizationField,_=l?parseFloat(l[m]):void 0;if(null!=c&&(!m||s||!isNaN(_)&&0!==_)){isNaN(_)||s||(c/=_);const e=b(c,d);if(e){const t=e[0],s=e[1],a=t===s?n.stops[t].color:o.a.blendColors(n.stops[t].color,n.stops[s].color,e[2],Object(r.h)(i)?i.color:void 0);return new o.a(a)}}}function m(e,t,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"opacity"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.OpacityVariable"!==n.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s="number"==typeof t,o=s?null:t,a=o&&o.attributes;let l=s?t:null;const c=n.field,{ipData:h,hasExpression:d}=n.cache;let f=n.cache.compiledFunc;if(!c&&!d){const e=n.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof l)if(d){if(Object(r.g)(i)||Object(r.g)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),a=t.createExecContext(o,s);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}l=t.executeFunction(f,a)}else a&&(l=a[c]);const p=n.normalizationField,m=a?parseFloat(a[p]):void 0;if(null!=l&&(!p||s||!isNaN(m)&&0!==m)){isNaN(m)||s||(l/=m);const e=b(l,h);if(e){const t=e[0],i=e[1];if(t===i)return n.stops[t].opacity;{const r=n.stops[t].opacity;return r+(n.stops[i].opacity-r)*e[2]}}}}function _(e,t,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"rotation"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.RotationVariable"!==n.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=n.axis||"heading",o="heading"===s&&"arithmetic"===n.rotationType?90:0,a="heading"===s&&"arithmetic"===n.rotationType?-1:1,l="number"==typeof t?null:t,c=l&&l.attributes,h=n.field,{hasExpression:d}=n.cache;let f=n.cache.compiledFunc,p=0;if(!h&&!d)return p;if(d){if(Object(r.g)(i)||Object(r.g)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),o=t.createExecContext(l,s);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}p=t.executeFunction(f,o)}else c&&(p=c[h]||0);return p="number"!=typeof p||isNaN(p)?null:o+a*p,p}function g(e,t,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"size"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.SizeVariable"!==n.declaredClass)return void u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=function(e,t,i,n,s){switch(t.transformationType){case"additive":return function(e,t,i,n){return e+(y(t.minSize,i,n)||t.minDataValue)}(e,t,i,n);case"constant":return function(e,t,i){const n=e.stops;let r=n&&n.length&&n[0].size;return null==r&&(r=e.minSize),y(r,t,i)}(t,i,n);case"clamped-linear":return function(e,t,i,n){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),o=y(t.minSize,i,n),a=y(t.maxSize,i,n),l=Object(r.h)(n)?n.shape:void 0;if(e<=t.minDataValue)return o;if(e>=t.maxDataValue)return a;if("area"===t.scaleBy&&l){const e="circle"===l,t=e?d*Math.pow(o/2,2):o*o,i=t+s*((e?d*Math.pow(a/2,2):a*a)-t);return e?2*Math.sqrt(i/d):Math.sqrt(i)}return o+s*(a-o)}(e,t,i,n);case"proportional":return function(e,t,i,n){const s=Object(r.h)(n)?n.shape:void 0,o=e/t.minDataValue,a=y(t.minSize,i,n),l=y(t.maxSize,i,n);let c=null;return c="circle"===s?2*Math.sqrt(o*Math.pow(a/2,2)):"square"===s||"diamond"===s||"image"===s?Math.sqrt(o*Math.pow(a,2)):o*a,v(c,a,l)}(e,t,i,n);case"stops":return function(e,t,i,n,r){const[s,o,a]=b(e,r);if(s===o)return y(t.stops[s].size,i,n);{const e=y(t.stops[s].size,i,n);return e+(y(t.stops[o].size,i,n)-e)*a}}(e,t,i,n,s);case"real-world-size":return function(e,t,i,n){const s=(Object(r.h)(n)&&n.resolution?n.resolution:1)*c.a[t.valueUnit],o=y(t.minSize,i,n),a=y(t.maxSize,i,n),{valueRepresentation:l}=t;let u=null;return u="area"===l?2*Math.sqrt(e/d)/s:"radius"===l||"distance"===l?2*e/s:e/s,v(u,o,a)}(e,t,i,n);case"identity":return e;case"unknown":return null}}(function(e,t,i){const n="number"==typeof t,s=n?null:t,o=s&&s.attributes;let a=n?t:null;const{isScaleDriven:c}=e.cache;let h=e.cache.compiledFunc;if(c){const t=Object(r.h)(i)?i.scale:void 0,n=Object(r.h)(i)?i.view:void 0;a=null==t||n&&"3d"===n.type?function(e){let t=null,i=null;const n=e.stops;return n?(t=n[0].value,i=n[n.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}(e):t}else if(!n)switch(e.inputValueType){case"expression":{if(Object(r.g)(i)||Object(r.g)(i.arcade))return void u.error("Use of arcade expressions requires an arcade context");const t={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,o=n.getViewInfo(t),l=n.createExecContext(s,o);if(!h){const t=n.createSyntaxTree(e.valueExpression);h=n.createFunction(t),e.cache.compiledFunc=h}a=n.executeFunction(h,l);break}case"field":o&&(a=o[e.field]);break;case"unknown":a=null}if(!Object(l.d)(a))return null;if(n||!e.normalizationField)return a;const d=o?parseFloat(o[e.normalizationField]):null;return Object(l.d)(d)&&0!==d?a/d:null}(n,t,i),n,t,i,n.cache.ipData);return null==s||isNaN(s)?0:s}function y(e,t,i){return null==e?null:Object(l.c)(e)?g(e,t,i):Object(l.d)(e)?e:null}function v(e,t,i){return Object(l.d)(i)&&e>i?i:Object(l.d)(t)&&e<t?t:e}function x(e,t,i){const{isScaleDriven:n}=e.cache,r=i&&"3d"===i.type;if(!(n&&r||t))return null;const s={scale:t,view:i};let o=y(e.minSize,h,s),a=y(e.maxSize,h,s);if(null!=o||null!=a){if(o>a){const e=a;a=o,o=e}return{minSize:o,maxSize:a}}}function b(e,t){if(!t)return;let i=0,n=t.length-1;return t.some((t,r)=>e<t?(n=r,!0):(i=r,!1)),[i,n,(e-t[i])/(t[n]-t[i])]}function O(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const e=s.useSymbolValue?"symbol-value":g(s,t,i);switch(s.axis){case"width":r[0]=e;break;case"depth":r[1]=e;break;case"height":r[2]=e;break;case"width-and-depth":r[0]=e,r[1]=e;break;case"all":case void 0:case null:r[0]=e,r[1]=e,r[2]=e;break;default:Object(n.a)(s.axis)}}return r}},439:function(e,t,i){"use strict";var n=i(5),r=i(396),s=i(260),o=i(489),a=i(426);const l=n.a.getLogger("esri/views/2d/engine/webgl/collisions/Metric");class c{constructor(e,t,i,n,r){this.id=e,this.range=t,this.boxes=null,this.minZoom=-1,this.size=0,this.directionX=0,this.directionY=0,this.offsetX=0,this.offsetY=0,this.placementPadding=0,this.anchor=Object(s.b)(i,n),this.baseZoom=r}add(e,t,i){e.x=e.x+t,e.y=e.y+i,this.bounds?this.boxes?(this.boxes.push(e),this.bounds.extend(e)):(this.boxes=[this.bounds,e],this.bounds=this.bounds.clone(),this.bounds.extend(e)):this.bounds=e}computeIndex(){const e=this.anchor[0],t=this.anchor[1],i=Math.floor(e/r.d),n=Math.floor(t/r.d);this.xBucket=i,this.yBucket=n;const s=r.F/r.d;if(this.hasVV)return this.xOverflow=s,void(this.yOverflow=s);this.xOverflow=Math.min(s,Math.ceil(2*this.bounds.width/r.d)),this.yOverflow=Math.min(s,Math.ceil(2*this.bounds.height/r.d))}findCollisionDelta(e){const t=this.bounds.findCollisionDelta(e.bounds),i=this.boxes&&this.boxes.length,n=e.boxes&&e.boxes.length;return Math.abs(t)>r.f||!i&&!n?t:i&&n?this._boxesToBoxes(e):i?this._boxesToBox(e):this._boxToBoxes(e)}computeVVOffset(e,t){t||l.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+t);let i=this.size;if(this.hasVV){const n=t(e);i=isNaN(n)||null==n||n===1/0?this.size:n}this._computeOffset(i)}setPlacementOffset(e,t,i,n,r){this.hasVV=e,this.size=t,this.placementPadding=Math.round(i),this.directionX=n,this.directionY=r}clone(){const e=new c(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);return e.minZoom=this.minZoom,this.bounds&&(e.bounds=this.bounds.clone()),this.boxes&&(e.boxes=this.boxes.map(e=>e.clone())),e.xBucket=this.xBucket,e.yBucket=this.yBucket,e.xOverflow=this.xOverflow,e.yOverflow=this.yOverflow,e.hasVV=this.hasVV,e.size=this.size,e.directionX=this.directionX,e.directionY=this.directionY,e.offsetX=this.offsetX,e.offsetY=this.offsetY,e}_boxToBoxes(e){let t=-1/0;for(const i of e.boxes){const e=this.bounds.findCollisionDelta(i);t=Math.max(e,t)}return t}_boxesToBox(e){let t=this.boxes[0].findCollisionDelta(e.bounds);for(let i=1;i<this.boxes.length;i++){const n=this.boxes[i].findCollisionDelta(e.bounds);t=Math.max(n,t)}return t}_boxesToBoxes(e){let t=-1/0;for(let i=0;i<this.boxes.length;i++){const n=this.boxes[i];for(const i of e.boxes){const e=n.findCollisionDelta(i);t=Math.max(e,t)}}return t}_computeOffset(e){this.offsetX=this.directionX*(e/2+this.placementPadding),this.offsetY=this.directionY*(e/2+this.placementPadding)}serialize(e){return e.push(this.id),this.bounds.serialize(e),e.push(this.range.from),e.push(this.range.count),e.push(this.anchor[0]),e.push(this.anchor[1]),e.push(this.baseZoom),e.push(this.hasVV?1:0),e.push(this.size),e.writeF32(this.directionX),e.writeF32(this.directionY),e.push(this.offsetX),e.push(this.offsetY),e.push(this.placementPadding),Object(a.b)(e,this.boxes),e}static deserialize(e){const t=e.readInt32(),i=o.a.deserialize(e),n={from:e.readInt32(),count:e.readInt32()},r=e.readInt32(),s=e.readInt32(),l=e.readInt32(),u=e.readInt32(),h=e.readInt32(),d=e.readF32(),f=e.readF32(),p=e.readInt32(),m=e.readInt32(),_=e.readInt32(),g=Object(a.a)(e,o.a),y=new c(t,n,r,s,l);return y.bounds=i,y.boxes=g,y.setPlacementOffset(!!u,h,_,d,f),y.offsetX=p,y.offsetY=m,y.computeIndex(),u||y._computeOffset(h),y}}t.a=c},440:function(e,t,i){"use strict";var n=i(398),r=class{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(e,t,i){for(const t in e)this.vertexData.set(t,e[t]);for(const t in this.vertexData)null===e[t]&&this.vertexData.delete(t);this.vertexCount=t,this.indexData=i}};class s{constructor(e,t,i,n=0,r=0){this.id=e,this.geometryType=t,this.materialKey=i,this.minZoom=n,this.maxZoom=r,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){const e=new s(this.id,this.geometryType,this.materialKey);return e.vertexFrom=this.vertexFrom,e.vertexCount=this.vertexCount,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e.zOrder=this.zOrder,e.symbolLevel=this.symbolLevel,e.meshData=this.meshData,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e}setMeshDataFromBuffers(e,t,i){const s=new r;for(const i in t){const r=t[i].stride,o=t[i].data,a=[],l=Object(n.o)(r);for(let t=0;t<r*e.vertexCount/l;++t)a[t]=o[t+r*e.vertexFrom/l];s.vertexData.set(i,a)}s.indexData.length=0;for(let t=0;t<e.indexCount;++t)s.indexData[t]=i[t+e.indexFrom]-e.vertexFrom;s.vertexCount=e.vertexCount,this.meshData=s}readMeshDataFromBuffers(e,t){this.meshData?this.meshData.clear():this.meshData=new r;for(const t in e){const i=e[t].stride,r=e[t].data,s=[],o=Object(n.o)(i);for(let e=0;e<i*this.vertexCount/o;++e)s[e]=r[e+i*this.vertexFrom/o];this.meshData.vertexData.set(t,s)}this.meshData.indexData.length=0;for(let e=0;e<this.indexCount;++e)this.meshData.indexData[e]=t[e+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(e,t,i,r){for(const i in t){const r=t[i].stride,s=this.meshData.vertexData.get(i),o=t[i].data,a=Object(n.o)(r);for(let t=0;t<r*this.meshData.vertexCount/a;++t)o[t+r*e/a]=s[t]}for(let t=0;t<this.meshData.indexData.length;++t)r[t+i]=this.meshData.indexData[t]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=i,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(e,t,i){let n=0,r=0;for(const s of e)s.writeMeshDataToBuffers(n,t,r,i),n+=s.vertexCount,r+=s.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}static deserialize(e,t){const i=e.readInt32(),n=e.readInt32(),r=new s(t.id,i,n);return r.vertexFrom=e.readInt32(),r.vertexCount=e.readInt32(),r.indexFrom=e.readInt32(),r.indexCount=e.readInt32(),r.minZoom=e.readInt32(),r.maxZoom=e.readInt32(),r}}t.a=s},441:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const n=new(i(541).a);function r(e){if(!n.hasBidiChar(e))return[e,!1];let t;return t="rtl"===n.checkContextual(e)?"IDNNN":"ICNNN",[n.bidiTransform(e,t,"VLYSN"),!0]}},442:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return x}));var n=i(14),r=i(7),s=i(34),o=i(30),a=i(461),l=i(262);const c=[0,0];function u(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,c),null!=t.z&&(i.z=t.z),null!=t.m&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,c),[i.xmax,i.ymax]=e(t.xmax,t.ymax,c),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:h(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:d(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function h(e,t){const i=[];for(const n of e)i.push(d(n,t));return i}function d(e,t){const i=[];for(const n of e){const e=t(n[0],n[1],[0,0]);i.push(e),n.length>2&&e.push(n[2]),n.length>3&&e.push(n[3])}return i}function f(e,t){return!m(e,t)||Object(l.b)()}async function p(e,t){if(t)if(Array.isArray(e)){for(const i of e)if(m(i.geometry&&i.geometry.spatialReference,t)){if(Object(l.b)())return Object(l.c)();throw new n.a("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}}else if(m(e,t)){if(Object(l.b)())return Object(l.c)();throw new n.a("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}}function m(e,t){return!(!Object(s.f)(e)||!Object(s.f)(t)||Object(s.c)(e,t)||Object(o.a)(e,t))}const _=u.bind(null,o.c),g=u.bind(null,o.f);function y(e,t,i){return e?(i||(i=t,t=e.spatialReference),Object(s.f)(t)&&Object(s.f)(i)&&!Object(s.c)(t,i)?Object(o.a)(t,i)?Object(s.h)(i)?_(e):g(e):Object(l.e)(a.a,[e],t,i,null)[0]:e):e}const v=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i){!e||!e.length||!t||!i||Object(s.c)(t,i);const n={geometries:e,inSpatialReference:t,outSpatialReference:i,resolve:null};return this._jobs.push(n),Object(r.f)(e=>{n.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:i,outSpatialReference:n,resolve:r}=e;Object(o.a)(i,n)?Object(s.h)(n)?r(t.map(_)):r(t.map(g)):r(Object(l.e)(a.a,t,i,n,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function x(e,t,i){return v.push(e,t,i)}},443:function(e,t,i){"use strict";t.a=class{constructor(e,t){this._pos=0;const i=t?this._roundToNearest(t,e.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new e(this._array),this._ctor=e}get length(){return this._pos}_roundToNearest(e,t){const i=Math.round(e);return i+(t-i%t)}_ensureSize(e){if(this._pos+e>=this._buffer.length){const t=this._roundToNearest(1.5*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(t),n=new this._ctor(i);n.set(this._buffer,0),this._array=i,this._buffer=n}}writeF32(e){this._ensureSize(1);const t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}push(e){this._ensureSize(1);const t=this._pos;return this._buffer[this._pos++]=e,t}writeFixed(e){this._buffer[this._pos++]=e}setValue(e,t){this._buffer[e]=t}getValue(e){return this._buffer[e]}incr(e){this._buffer[e]++}decr(e){this._buffer[e]--}writeRegion(e){this._ensureSize(e.length);const t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}buffer(){const e=this._array.slice(0,4*this._pos);return this.destroy(),e}toArray(){const e=this._array,t=[];for(let i=0;i<e.byteLength/4;i++)t.push(e[i]);return t}seek(e){this._pos=e}destroy(){this._array=null,this._buffer=null}}},445:function(e,t,i){"use strict";var n=i(0),r=(i(4),i(9),i(5)),s=(i(6),i(1)),o=i(2),a=(i(3),i(10),i(11),i(18)),l=i(83),c=i(217),u=i(133),h=i(112);let d=class extends(Object(h.b)(Object(c.a)(Object(u.b)(l.a.EventedMixin(a.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw r.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(n.a)([Object(s.b)({dependsOn:["layer.opacity","parent.fullOpacity"]})],d.prototype,"fullOpacity",null),Object(n.a)([Object(s.b)()],d.prototype,"layer",void 0),Object(n.a)([Object(s.b)()],d.prototype,"parent",void 0),Object(n.a)([Object(s.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],d.prototype,"suspended",null),Object(n.a)([Object(s.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],d.prototype,"suspendInfo",null),Object(n.a)([Object(s.b)({readOnly:!0,dependsOn:["suspended","layer.legendEnabled?"]})],d.prototype,"legendEnabled",null),Object(n.a)([Object(s.b)({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],d.prototype,"updating",null),Object(n.a)([Object(s.b)({dependsOn:["layer.visible"]})],d.prototype,"visible",null),d=Object(n.a)([Object(o.a)("esri.views.layers.LayerView")],d);var f=d;t.a=f},446:function(e,t,i){"use strict";i.d(t,"a",(function(){return M}));var n=i(0),r=(i(4),i(9),i(5),i(6),i(1)),s=i(2),o=(i(3),i(10),i(11),i(21)),a=i(88),l=i(16),c=i(15);let u=class extends c.a{};u=Object(n.a)([Object(s.a)("esri.views.layers.support.ClipArea")],u);var h,d=u;let f=h=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new h({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(n.a)([Object(r.b)({type:[Number,String],json:{write:!0}})],f.prototype,"left",void 0),Object(n.a)([Object(r.b)({type:[Number,String],json:{write:!0}})],f.prototype,"right",void 0),Object(n.a)([Object(r.b)({type:[Number,String],json:{write:!0}})],f.prototype,"top",void 0),Object(n.a)([Object(r.b)({type:[Number,String],json:{write:!0}})],f.prototype,"bottom",void 0),Object(n.a)([Object(r.b)({readOnly:!0,dependsOn:["left","right","top","bottom"]})],f.prototype,"version",null),f=h=Object(n.a)([Object(s.a)("esri.views.layers.support.ClipRect")],f);var p,m=f,_=i(496),g=i(71),y=i(36),v=i(95),x=i(59);i(54);const b={base:g.a,key:"type",typeMap:{extent:y.a,polygon:v.a}};let O=p=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new p({geometry:this.geometry.clone()})}};Object(n.a)([Object(r.b)({types:b,json:{read:x.a,write:!0}})],O.prototype,"geometry",void 0),Object(n.a)([Object(r.b)({readOnly:!0,dependsOn:["geometry"]})],O.prototype,"version",null),O=p=Object(n.a)([Object(s.a)("esri.views.layers.support.Geometry")],O);var S=O;let w=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(n.a)([Object(r.b)({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0),Object(n.a)([Object(r.b)({readOnly:!0,dependsOn:["path"]})],w.prototype,"version",null),w=Object(n.a)([Object(s.a)("esri.views.layers.support.Path")],w);var T=w;const C=o.a.ofType({key:"type",base:d,typeMap:{rect:m,path:T,geometry:S}}),M=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new C,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new _.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(l.a)(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(l.a)(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(l.a)(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(l.a)(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),(null==(e=this.view)?void 0:e.whenLayerView)?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,n=i.minScale,r=i.maxScale;if(null!=n&&null!=r){let i=!n,s=!r;!i&&e<=n&&(i=!0),!s&&e>=r&&(s=!0),t=i&&s}return t}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(n.a)([Object(r.b)({type:C,set(e){const t=Object(a.b)(e,this._get("clips"),C);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(n.a)([Object(r.b)()],t.prototype,"moving",void 0),Object(n.a)([Object(r.b)()],t.prototype,"attached",void 0),Object(n.a)([Object(r.b)()],t.prototype,"container",void 0),Object(n.a)([Object(r.b)({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),Object(n.a)([Object(r.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(n.a)([Object(r.b)()],t.prototype,"updateRequested",void 0),Object(n.a)([Object(r.b)({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),Object(n.a)([Object(r.b)()],t.prototype,"view",void 0),t=Object(n.a)([Object(s.a)("esri.views.2d.layers.LayerView2D")],t),t}},448:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return a}));Number.POSITIVE_INFINITY;const n=Math.PI,r=128/n,s=1/Math.LN2;function o(e,t){return(e%=t)>=0?e:e+t}function a(e){return o(e*r,256)}function l(e){return o(.7111111111111111*e,256)}function c(e){return Math.log(e)*s}function u(e,t,i){return e>=t&&e<=i||e>=i&&e<=t}},450:function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return S})),i.d(t,"c",(function(){return b}));var n=i(4),r=i(12),s=i(8),o=i(5),a=i(14),l=i(23),c=i(214),u=i(542),h=i(397),d=i(399),f=i(398),p=i(474);var m=i(544),_=i(535);const g=o.a.getLogger("esri.views.2d.layers.features.schemaUtils"),y={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function v(e){return Object(d.h)(e)}function x(e){switch(e.type){case"line-marker":var t;return{type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style};default:return Object(c.f)(e.toJSON()).toJSON()}}function b(e,t,i){if(!e)return null;let n=0,r=!1;switch(Object(s.h)(t)&&"visualVariables"in t&&(n=function(e){if(!e)return h.e.NONE;let t=0;for(const i of e)if("size"===i.type){const e=Object(p.a)(i);t|=e,"outline"===i.target&&(t|=e<<4)}else"color"===i.type?t|=h.e.COLOR:"opacity"===i.type?t|=h.e.OPACITY:"rotation"===i.type&&(t|=h.e.ROTATION);return t}(t.visualVariables||[]),r="dot-density"===t.type),e.type){case"simple-fill":case"picture-fill":return function(e,t,i,n){const r=Object(d.g)(h.d.FILL,t,!1,i),s=n?v(r):r,o=e.clone(),a=o.outline;o.outline=null;const l=[],c={materialKey:s,hash:o.hash(),...x(o)};if(l.push(c),a){const e=Object(d.g)(h.d.LINE,t,!0,!1),i={materialKey:n?v(e):e,hash:a.hash(),...x(a)};l.push(i)}return{type:"composite-symbol",layers:l,hash:l.reduce((e,t)=>t.hash+e,"")}}(e,n,r,i);case"simple-marker":case"picture-marker":return function(e,t,i){const n=Object(d.g)(h.d.MARKER,t,!1,!1),r=i?v(n):n,s=x(e);return{materialKey:r,hash:e.hash(),...s,angle:e.angle}}(e,n,i);case"simple-line":return function(e,t,i){const n=Object(d.g)(h.d.LINE,t,!1,!1),r=i?v(n):n,s=e.clone(),o=s.marker;s.marker=null;const a=[];if(a.push({materialKey:r,hash:s.hash(),...x(s)}),o){var l;const e=Object(d.g)(h.d.MARKER,t,!1,!1),n=i?v(e):e;o.color=null!=(l=o.color)?l:s.color,a.push({materialKey:n,hash:o.hash(),lineWidth:s.width,...x(o)})}return{type:"composite-symbol",layers:a,hash:a.reduce((e,t)=>t.hash+e,"")}}(e,n,i);case"text":return function(e,t,i){const n=Object(d.g)(h.d.TEXT,t,!1,!1),r=i?v(n):n,s=x(e);return{materialKey:r,hash:e.hash(),...s,angle:e.angle}}(e,n,i);case"label":return function(e,t,i){const n=Object(d.g)(h.d.LABEL,t,!1,!1,e.labelPlacement);return{materialKey:i?v(n):n,hash:e.hash(),...e.toJSON(),labelPlacement:e.labelPlacement}}(e,n,i);case"cim":return{type:"cim",rendererKey:n,data:e.data};case"web-style":return{...x(e),type:"web-style",hash:e.hash(),rendererKey:n};default:throw new Error("symbol not supported "+e.type)}}function O(e,t){const i=Object(r.a)(e);return i.some(e=>function(e,t){const i=e.labelPlacement,n=y[t];if(!e.symbol)return g.warn("No LabelClass symbol specified."),!0;if(!n)return g.error(new a.a("mapview-labeling:unsupported-geometry-type",`Unable to create labels for Feature Layer, ${t} is not supported`)),!0;if(!n.some(e=>e===i)){const r=n[0];i&&g.warn(`Found invalid label placement type ${i} for ${t}. Defaulting to ${r}`),e.labelPlacement=r}return!1}(e,t))?[]:i}function S(e,t=0){return Object(n.a)("esri-2d-update-debug")&&console.debug("Created new schema",w(e,t,!0)),w(e,t)}function w(e,t,i=!1){try{var n,r;const s=function(e,t=!1){const i=new Array;return i.push(function(e,t,i=!1){const n={indexCount:0,fields:{}},r="featureReduction"in e&&e.featureReduction,s=r?"aggregate":"feature";switch(e.renderer.type){case"heatmap":{const{blurRadius:t,fieldOffset:i,field:r}=e.renderer;return{type:"heatmap",aggregateFields:[],attributes:n,target:s,storage:null,mesh:{blurRadius:t,fieldOffset:i,field:I(n,{target:s,field:r,resultType:"numeric"}).field}}}default:{const t=[],o="aggregate"===s?Object(u.b)(t,e.renderer,r,null):e.renderer;!function(e,t){const i={mesh:!0,storage:!0};for(const n of t){const{name:t,outStatistic:r}=n,{statisticType:s,onStatisticField:o}=r;let a=null,l=null,c=null;const u="numeric",h="feature";"onStatisticValueExpression"in r?l=j(e,{type:"expression",target:h,valueExpression:r.onStatisticValueExpression,resultType:u}).fieldIndex:"onStatisticNormalizationField"in r?(a=j(e,{type:"field",target:h,field:o,resultType:u}).field,c=r.onStatisticNormalizationField):a=j(e,{type:"field",target:h,field:o,resultType:u}).field,j(e,{type:"statistic",target:"aggregate",name:t,context:i,inField:a,inNormalizationField:c,inFieldIndex:l,statisticType:s})}}(n,t);const l=P(n,s,o,i),c=function(e,t,i){switch(i.type){case"dot-density":return function(e,t,i){return i&&i.length?{type:"dot-density",mapping:i.map((i,n)=>{const{field:r,fieldIndex:s}=I(e,{valueExpression:i.valueExpression,field:i.field,resultType:"numeric",target:t});return{binding:n,field:r,fieldIndex:s}}),target:t}:{type:"dot-density",mapping:[],target:t}}(e,t,i.attributes);case"simple":case"class-breaks":case"unique-value":return function(e,t,i){if(!i||!i.length)return{type:"visual-variable",mapping:[],target:t};const n={storage:!0},r="numeric";return{type:"visual-variable",mapping:Object(m.b)(i).map(i=>{var s;const o=Object(f.l)(i.type),{field:a,fieldIndex:l}=I(e,{target:t,valueExpression:i.valueExpression,field:i.field,context:n,resultType:r});switch(i.type){case"size":return"$view.scale"===i.valueExpression?null:{type:"size",binding:o,field:a,fieldIndex:l,normalizationField:I(e,{target:t,field:i.normalizationField,context:n,resultType:r}).field,valueRepresentation:null!=(s=i.valueRepresentation)?s:null};case"color":return{type:"color",binding:o,field:a,fieldIndex:l,normalizationField:I(e,{target:t,field:i.normalizationField,context:n,resultType:r}).field};case"opacity":return{type:"opacity",binding:o,field:a,fieldIndex:l,normalizationField:I(e,{target:t,field:i.normalizationField,context:n,resultType:r}).field};case"rotation":return{type:"rotation",binding:o,field:a,fieldIndex:l}}}).filter(e=>e),target:t}}(e,t,i.visualVariables);case"heatmap":case"dictionary":return null}}(n,s,o),h=Object(_.a)(e.geometryType);let d=e.labelsVisible&&e.labelingInfo||[],p=[];if(r){if("selection"===r.type)throw new a.a("ValidationError","Mapview does not support `selection` reduction type",r);p=r&&r.labelsVisible&&r.labelingInfo||[]}d=O(d,h),p=O(p,h);let g=0;const y=[...d.map(e=>E(o,n,e,"feature",g++,i)),...p.map(e=>E(o,n,e,"aggregate",g++,i))];return{type:"symbol",target:s,attributes:n,aggregateFields:t,storage:c,mesh:{matcher:l,labels:y}}}}}(e)),i}(e.layer,i),o={};return s.map(t=>function(e,t,i){switch(i.target){case"feature":return void M(e,C(t),i);case"aggregate":{const n=t.layer.featureReduction;if("selection"===n.type)throw new a.a("ValidationError","Mapview does not support `selection` reduction type",n);return M(e,C(t),i),void function(e,t,i){e.aggregate||(e.aggregate={name:"aggregate",input:"feature",filters:null,attributes:{},params:{clusterRadius:Object(l.h)(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(Object(l.h)(t.clusterMaxSize)/64),fields:i.aggregateFields}}),T(e.aggregate,i.attributes.fields)}(e,n,i)}}}(o,e,t)),{source:{definitionExpression:e.layer.definitionExpression,fields:e.layer.fields.map(e=>e.toJSON()),gdbVersion:"feature"===e.layer.type?e.layer.gdbVersion:void 0,historicMoment:"feature"===e.layer.type?null==(n=e.layer.historicMoment)?void 0:n.getTime():void 0,outFields:e.availableFields,pixelBuffer:t,spatialReference:e.layer.spatialReference.toJSON(),timeExtent:null==(r=e.layer.timeExtent)?void 0:r.toJSON()},attributes:{fields:{},indexCount:0},processors:s,targets:o}}catch(e){if("ValidationError"===e.fieldName)return g.error(e),null;throw e}}function T(e,t){for(const i in t){const n=t[i];if(n.target!==e.name)continue;const r=e.attributes[i];r?(r.context.mesh=r.context.mesh||n.context.mesh,r.context.storage=r.context.storage||n.context.storage):e.attributes[i]=n}return e}function C(e){var t,i,n,r,s;return[null!=(t=null==(i=e.filter)?void 0:i.toJSON())?t:null,null!=(n=null==(r=e.effect)||null==(s=r.filter)?void 0:s.toJSON())?n:null]}function M(e,t,i){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),T(e.feature,i.attributes.fields),e}function I(e,t){return t.field?j(e,{...t,type:"field",field:t.field}):t.valueExpression?j(e,{...t,type:"expression",valueExpression:t.valueExpression}):{field:null,fieldIndex:null}}function j(e,t){switch(t.type){case"expression":{const i=t.valueExpression;if(!e.fields[i]){const n=e.indexCount++;e.fields[i]={...t,name:i,fieldIndex:n}}return{fieldIndex:e.fields[i].fieldIndex}}case"label-expression":{const i=JSON.stringify(t.label);if(!e.fields[i]){const n=e.indexCount++;e.fields[i]={...t,name:i,fieldIndex:n}}return{fieldIndex:e.fields[i].fieldIndex}}case"field":{const i=t.field;return"aggregate"===t.target&&e.fields[i]||(e.fields[i]={...t,name:i}),{field:i}}case"statistic":return e.fields[t.name]={...t},{field:t.name}}}function E(e,t,i,n,r,s=!1){const o=j(t,{type:"label-expression",target:n,context:{mesh:!0},resultType:"string",label:{labelExpression:i.labelExpression,labelExpressionInfo:i.labelExpressionInfo?{expression:i.labelExpressionInfo.expression}:null,symbol:!!i.symbol,where:i.where}}),{fieldIndex:a}=o;return{...b(i,e,s),fieldIndex:a,target:n,index:r}}function P(e,t,i,n=!1){const r=Object(s.n)(e,{indexCount:0,fields:{}});switch(i.type){case"simple":case"dot-density":return function(e,t,i,n=!1){const r=t.getSymbols();return{type:"simple",symbol:b(r.length?r[0]:null,t,n),isDotDensity:i}}(0,i,"dot-density"===i.type,n);case"class-breaks":return function(e,t,i,n=!1){const r=i.backgroundFillSymbol,{field:s,fieldIndex:o}=I(e,{target:t,field:i.field,valueExpression:i.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}}),a=i.normalizationType,l="log"===a?"esriNormalizeByLog":"percent-of-total"===a?"esriNormalizeByPercentOfTotal":"field"===a?"esriNormalizeByField":null,c=i.classBreakInfos.map(e=>({symbol:b(e.symbol,i,n),min:e.minValue,max:e.maxValue})).sort((e,t)=>e.min-t.min);return{type:"interval",field:s,fieldIndex:o,backgroundFillSymbol:b(r,i,n),defaultSymbol:b(i.defaultSymbol,i,n),intervals:c,normalizationField:i.normalizationField,normalizationTotal:i.normalizationTotal,normalizationType:l,isMaxInclusive:i.isMaxInclusive}}(r,t,i,n);case"unique-value":return function(e,t,i,n=!1){const r=[],s=i.backgroundFillSymbol,o={target:t,context:{mesh:!0},resultType:"string"};if(i.field&&"string"!=typeof i.field)throw new a.a("ValidationError","Expected renderer.field to be a string",i);const{field:l,fieldIndex:c}=I(e,{...o,field:i.field,valueExpression:i.valueExpression});for(const e of i.uniqueValueInfos)r.push({value:""+e.value,symbol:b(e.symbol,i,n)});return{type:"map",field:l,fieldIndex:c,field2:I(e,{...o,field:i.field2}).field,field3:I(e,{...o,field:i.field3}).field,fieldDelimiter:i.fieldDelimiter,backgroundFillSymbol:b(s,i),defaultSymbol:b(i.defaultSymbol,i),map:r}}(r,t,i,n);case"dictionary":return function(e,t,i=!1){return{type:"dictionary",renderer:t.toJSON()}}(0,i,n)}}},451:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i(4),r=i(83);const s=1/Object(n.a)("mapview-transitions-duration");class o extends r.a{constructor(){super(...arguments),this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}setTransform(e){}processRender(e){this.stage&&(this.updateTransitionProperties(e.deltaTime),this.computedVisible&&this.doRender(e))}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.onDetach(),this.emit("detach")}updateTransitionProperties(e){if(this.fadeTransitionEnabled){const t=this.visible?this.opacity:0,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const n=e*s;this.computedOpacity=i>t?Math.max(t,i-n):Math.min(t,i+n),this.computedVisible=this.computedOpacity>0;const r=t===this.computedOpacity;this.inFadeTransition=!r,r||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},452:function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return R})),i.d(t,"c",(function(){return V})),i.d(t,"d",(function(){return F})),i.d(t,"e",(function(){return k})),i.d(t,"f",(function(){return M})),i.d(t,"g",(function(){return C})),i.d(t,"h",(function(){return A})),i.d(t,"i",(function(){return N}));var n=i(4),r=i(8),s=i(34),o=i(28),a=i(220),l=i(213),c=i(59),u=i(23),h=i(259),d=i(303),f=i(26),p=i(72),m=i(298),_=i(260),g=i(420),y=i(491),v=i(441),x=i(467);const b=Math.PI/180,O=Object(m.a)(),S=Object(_.a)(),w=Object(h.d)();function T(e,t,i,r,o,a,u){if(!r||!i.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;const h=r;if(!Object(c.f)(h)){Object(l.a)(e,h);let r=t[0];0===r&&(r=function e(t){switch(t.symbol.type){case"esriSFS":case"esriPFS":{const e=t.symbol.outline;return e?e.width:0}case"esriSLS":return t.symbol.width;case"esriSMS":return t.symbol.size;case"esriPMS":return Math.max(t.symbol.width,t.symbol.height);case"esriTS":{const e=[0,0,0,0];k(e,t.symbol,t.mosaicItem);const i=Math.max(Math.abs(e[0]),Math.abs(e[1]));return Math.max(e[2],e[3])+i}case"expanded-cim":{const e=x.a.getEnvelope(t.symbol.data);return Math.sqrt(e.width*e.width+e.height*e.height)}case"composite-symbol":{if(!t.symbol.layers.length)return 0;const i=t.symbol.layers.length-1;return e({symbol:t.symbol.layers[i],mosaicItem:null})}case"label":default:return Object(n.a)("esri-2d-debug")&&console.debug(`Resource of type ${t.symbol.type} not valid for graphics`),0}}(i),t[0]=r);const s=o*r/2;return e[0]-=s,e[1]-=s,e[2]+=s,e[3]+=s,e}{const n=h.x,r=h.y;"esriTS"===i.symbol.type&&0===t[2]&&0===t[3]&&k(t,i.symbol,i.mosaicItem),function(e,t,i,n,r,o,a,l){let c;switch(n.type){case"esriSMS":case"esriPMS":c=V(t,i,n,o,a,0);break;case"esriTS":c=F(t,i,n,r,o,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":c=R(t,i,n,o,a,0)}let u,h,f=0;for(let e=0;e<c.rings[0].length-1;e++)h=c.rings[0][e],u=(t-h[0])*(t-h[0])+(i-h[1])*(i-h[1]),f=Math.max(f,u);f=Math.sqrt(f);let p=Object(d.b)(t-f,l),m=Object(d.b)(t+f,l);if(p>m){const e=Object(s.d)(l);if(e){const[t,i]=e.valid;p=t,m=i}}e[0]=p,e[1]=i-f,e[2]=m,e[3]=i+f}(e,n,r,i.symbol,t,o,a,u)}return e}function C(e){return"simple-marker"===e||"picture-marker"===e||"text"===e}function M(e){switch(Object(r.m)(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}const I=Object(_.a)(),j=Object(_.a)(),E=Object(_.a)(),P=Object(_.a)(),D=Object(_.a)(),L=Object(_.a)(),z=Object(_.a)();function A(e,t,i,n){Object(f.m)(E,t,i);const r=e.paths;let s,o,a,l,c,u,h,d,p,m=1/0;for(let e=0;e<r.length;e++){const _=r[e];if(!(_.length<2))for(let e=1;e<_.length;e++)s=_[e-1][0],a=_[e-1][1],o=_[e][0],l=_[e][1],c=Math.min(s,o)-n,u=Math.min(a,l)-n,h=Math.max(s,o)+n,d=Math.max(a,l)+n,t<c||t>h||i<u||i>d||(Object(f.m)(I,s,a),Object(f.m)(j,o,l),Object(f.d)(P,j,I),Object(f.d)(D,I,E),Object(f.a)(L,P,Object(f.g)(P,D)/Object(f.g)(P,P)),Object(f.d)(z,D,L),p=Object(f.g)(z,z),m>p&&(m=p))}return Math.sqrt(m)<=n}function V(e,t,i,n,r,s){let o,a;const l=Object(u.h)(i.xoffset),c=Object(u.h)(i.yoffset),h=b*i.angle,d=b*s;switch(i.type){case"esriSMS":o=a=Object(u.h)(i.size);break;case"esriPMS":o=Object(u.h)(i.width),a=Object(u.h)(i.height)}r<.04&&(n=.04*n/r);const m=Object(p.d)(O);Object(p.h)(m,m,Object(f.m)(S,e,t)),Object(p.f)(m,m,d-h),Object(p.g)(m,m,Object(f.m)(S,n,-n)),Object(p.h)(m,m,Object(f.m)(S,l,-c));const _=[0,0];Object(f.n)(_,Object(f.m)(S,-.5*o,-.5*a),m);const g=[0,0];Object(f.n)(g,Object(f.m)(S,-.5*o,.5*a),m);const y=[0,0];Object(f.n)(y,Object(f.m)(S,.5*o,-.5*a),m);const v=[0,0];return Object(f.n)(v,Object(f.m)(S,.5*o,.5*a),m),{rings:[[_,y,v,g,_]]}}function R(e,t,i,n,r,s){const o=x.a.getEnvelope(i.data);if(!o)return null;r<.04&&(n=.04*n/r);const a=Object(u.h)(o.width),l=Object(u.h)(o.height),c=Object(u.h)(o.x),h=Object(u.h)(o.y),d=0*b,m=b*s,_=Object(p.d)(O);Object(p.h)(_,_,Object(f.m)(S,e,t)),Object(p.f)(_,_,m-d),Object(p.g)(_,_,Object(f.m)(S,n,n));const g=[0,0];Object(f.n)(g,Object(f.m)(S,c,h+l),_);const y=[0,0];Object(f.n)(y,Object(f.m)(S,c,h),_);const v=[0,0];Object(f.n)(v,Object(f.m)(S,c+a,h+l),_);const w=[0,0];return Object(f.n)(w,Object(f.m)(S,c+a,h),_),{rings:[[g,v,w,y,g]]}}function F(e,t,i,n,r,s){const o=Object(u.h)(i.xoffset),a=Object(u.h)(i.yoffset),l=b*i.angle,c=b*s,h=Object(p.d)(O);Object(p.h)(h,h,Object(f.m)(S,e,t)),Object(p.f)(h,h,c),Object(p.g)(h,h,Object(f.m)(S,r,-r));const d=n[0]+n[2]/2,m=n[1]+n[3]/2;Object(p.h)(h,h,Object(f.m)(S,o,-a)),Object(p.h)(h,h,Object(f.m)(S,d,m)),Object(p.f)(h,h,l),Object(p.h)(h,h,Object(f.m)(S,-d,-m));const _=[0,0];Object(f.n)(_,Object(f.m)(S,n[0],n[1]),h);const g=[0,0];Object(f.n)(g,Object(f.m)(S,n[0],n[1]+n[3]),h);const y=[0,0];Object(f.n)(y,Object(f.m)(S,n[0]+n[2],n[1]),h);const v=[0,0];return Object(f.n)(v,Object(f.m)(S,n[0]+n[2],n[1]+n[3]),h),{rings:[[_,y,v,g,_]]}}function N(e){let t,i,n,r,o,u,h,d,f,p=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,i=Object(s.d)(t),!i)return e.toJSON();n=t.isWebMercator,u=n?102100:4326,r=U[u].maxX,o=U[u].minX,h=U[u].plus180Line,d=U[u].minus180Line;const m=e.toJSON();if(Object(c.f)(m))f=W(m,r,o);else if(Object(c.e)(m))m.points=m.points.map(e=>W(e,r,o)),f=m;else if(Object(c.d)(m))f=function(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:n,ymax:r}=e,s=e.xmax-e.xmin,o=e.xmin,a=e.xmax;let l;const[c,u]=t.valid;l=B(e.xmin,t);const h=l.x,d=l.frameId;l=B(e.xmax,t);const f=l.x,p=l.frameId,m=h===f&&s>0;if(s>2*u){const e={xmin:o<a?h:f,ymin:n,xmax:u,ymax:r},t={xmin:c,ymin:n,xmax:o<a?f:h,ymax:r},s={xmin:0,ymin:n,xmax:u,ymax:r},l={xmin:c,ymin:n,xmax:0,ymax:r},m=[],_=[];H(e,s)&&m.push(d),H(e,l)&&_.push(d),H(t,s)&&m.push(p),H(t,l)&&_.push(p);for(let e=d+1;e<p;e++)m.push(e),_.push(e);i.push({extent:e,frameIds:[d]},{extent:t,frameIds:[p]},{extent:s,frameIds:m},{extent:l,frameIds:_})}else h>f||m?i.push({extent:{xmin:h,ymin:n,xmax:u,ymax:r},frameIds:[d]},{extent:{xmin:c,ymin:n,xmax:f,ymax:r},frameIds:[p]}):i.push({extent:{xmin:h,ymin:n,xmax:f,ymax:r},frameIds:[d]});return i}(e,t).map(e=>e.extent);return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}(m,i);else if(Object(c.g)(m)||Object(c.h)(m)){const e=w;Object(l.a)(e,m);const t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=G(t.xmin,o)*(2*r),n=0===i?m:function(e,t){const i=function(e){return Object(c.g)(e)?e.rings:e.paths}(e);for(const e of i)for(const i of e)i[0]+=t;return e}(m,i);t.xmin+=i,t.xmax+=i,Object(a.a)(t,h)&&t.xmax!==r||Object(a.a)(t,d)&&t.xmin!==o?p=n:f=n}else f=e.clone();return null!==p?(new Y).cut(p,r):f}function k(e,t,i){if(!i||0===i.glyphMosaicItems.length)return e;const n=Object(v.a)(t.text)[1],r=i.glyphMosaicItems,s=Object(y.a)(r,n,{scale:Object(u.h)(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:Object(g.d)(t.horizontalAlignment||"center"),vAlign:Object(g.f)(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=s.x-s.halfWidth,e[1]=s.y-s.halfHeight,e[2]=s.width,e[3]=s.height,e}const U={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:o.a.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:o.a.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:o.a.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:o.a.WGS84}}};function G(e,t){return Math.ceil((e-t)/(2*t))}function B(e,t){const[i,n]=t.valid,r=2*n;let s,o=0;return e>n?(s=Math.ceil(Math.abs(e-n)/r),e-=s*r,o=s):e<i&&(s=Math.ceil(Math.abs(e-i)/r),e+=s*r,o=-s),{x:e,frameId:o}}function H(e,t){const{xmin:i,ymin:n,xmax:r,ymax:s}=t;return q(e,i,n)&&q(e,i,s)&&q(e,r,s)&&q(e,r,n)}function q(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function W(e,t,i){if(Array.isArray(e)){const n=e[0];if(n>t){const i=G(n,t);e[0]=n+i*(-2*t)}else if(n<i){const t=G(n,i);e[0]=n+t*(-2*i)}}else{const n=e.x;if(n>t){const i=G(n,t);e.x+=i*(-2*t)}else if(n<i){const t=G(n,i);e.x+=t*(-2*i)}}return e}class Y{cut(e,t){let i;if(e.rings)this.closed=!0,i=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,i=e.paths,this.minPts=2}const n=i.length,r=-2*t;for(let e=0;e<n;e++){const t=i[e];if(t&&t.length>=this.minPts){const e=[];for(const i of t)e.push([i[0]+r,i[1]]);i.push(e)}}return this.closed?e.rings=i:e.paths=i,e}}},453:function(e,t,i){"use strict";i.d(t,"a",(function(){return ne})),i.d(t,"b",(function(){return re}));var n=i(12),r=i(59),s=i(401);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i){return new a(e,t,i)}}o.instance=null;class a{constructor(e,t,i){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(Object(r.g)(e)){this._isClosed=!0;const t=Object(n.a)(e);return this._processMultipath(t.rings),t}if(Object(r.h)(e)){this._isClosed=!1;const t=Object(n.a)(e);return this._processMultipath(t.paths),t}if(Object(r.d)(e)){if(this._maxCosAngle)return e;this._isClosed=!0;const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return this._processPath(t),{rings:[t]}}e=this._inputGeometries.next()}return null}_processMultipath(e){if(e)for(const t of e)this._processPath(t)}_processPath(e){if(e){let t,i,n,r,o,a,l=e.length,c=e[0];this._isClosed&&++l;for(let u=1;u<l;++u){let h;h=this._isClosed&&u===l-1?e[0]:e[u];const d=h[0]-c[0],f=h[1]-c[1],p=Math.sqrt(d*d+f*f);u>1&&p>0&&n>0&&(t*d+i*f)/p/n<=this._maxCosAngle&&Object(s.j)(c,1),1===u&&(r=d,o=f,a=p),p>0&&(c=h,t=d,i=f,n=p)}this._isClosed&&n>0&&a>0&&(t*r+i*o)/a/n<=this._maxCosAngle&&Object(s.j)(e[0],1)}}}class l{constructor(){this._path=[]}path(){return this._path}addPath(e,t){t||e.reverse(),Array.prototype.push.apply(this._path,e),t||e.reverse()}static mergePath(e,t){t&&Array.prototype.push.apply(e,t)}startPath(e){this._path.push(e)}lineTo(e){this._path.push(e)}close(){const e=this._path;e.length>1&&(e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]))}}class c{constructor(e=0,t=!1){}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t}calculateLength(e,t){const i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)}calculateSegLength(e,t){return this.calculateLength(e[t],e[t+1])}calculatePathLength(e){let t=0;const i=e?e.length:0;for(let n=0;n<i-1;++n)t+=this.calculateSegLength(e,n);return t}calculatePathArea(e){let t=0;const i=e?e.length:0;for(let n=0;n<i-1;++n)t+=(e[n+1][0]-e[n][0])*(e[n+1][1]+e[n][1]);return t/2}getCoord2D(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]}getSegCoord2D(e,t,i){return this.getCoord2D(e[t],e[t+1],i)}getAngle(e,t,i){const n=t[0]-e[0],r=t[1]-e[1];return Math.atan2(r,n)}getSegAngle(e,t,i){return this.getAngle(e[t],e[t+1],i)}getAngleCS(e,t,i){const n=t[0]-e[0],r=t[1]-e[1],s=Math.sqrt(n*n+r*r);return s>0?[n/s,r/s]:[1,0]}getSegAngleCS(e,t,i){return this.getAngleCS(e[t],e[t+1],i)}cut(e,t,i,n){return[i<=0?e[t]:this.getSegCoord2D(e,t,i),n>=1?e[t+1]:this.getSegCoord2D(e,t,n)]}addSegment(e,t,i){i&&e.push(t[0]),e.push(t[1])}getSubCurve(e,t,i){const n=[];return this.appendSubCurve(n,e,t,i)?n:null}appendSubCurve(e,t,i,n){const r=t?t.length-1:0;let s=0,o=!0,a=0;for(;a<r;){const r=this.calculateSegLength(t,a);if(0!==r){if(o){if(s+r>i){const l=(i-s)/r;let c=1,u=!1;s+r>=n&&(c=(n-s)/r,u=!0);const h=this.cut(t,a,l,c);if(h&&this.addSegment(e,h,o),u)break;o=!1}}else{if(s+r>n){const i=this.cut(t,a,0,(n-s)/r);i&&this.addSegment(e,i,o);break}this.addSegment(e,[t[a],t[a+1]],o)}s+=r,++a}else++a}return!0}getCIMPointAlong(e,t){const i=e?e.length-1:0;let n=0,r=-1;for(;r<i;){++r;const i=this.calculateSegLength(e,r);if(0!==i){if(n+i>t){const s=(t-n)/i;return this.getCoord2D(e[r],e[r+1],s)}n+=i}}return null}isEmpty(e,t){if(!e||e.length<=1)return!0;const i=e?e.length-1:0;let n=-1;for(;n<i;){if(++n,e[n+1][0]!==e[n][0]||e[n+1][1]!==e[n][1])return!1;if(t&&e[n+1][2]!==e[n][2])return!1}return!0}offset(e,t,i,n,r){if(!e||e.length<2)return null;let s=e.length;const o=e[0][0]===e[s-1][0]&&e[0][1]===e[s-1][1];if(o){if(e.length<3)return null;--s}const a=[];let l=o?e[s-1]:null,c=e[0];for(let r=0;r<s;r++){const u=r===s-1?o?e[0]:null:e[r+1];if(l)if(u){const e=[u[0]-c[0],u[1]-c[1]];this.normalize(e);const r=[c[0]-l[0],c[1]-l[1]];this.normalize(r);const s=r[0]*e[1]-r[1]*e[0],o=r[0]*e[0]+r[1]*e[1];if(s>=0==t<=0){const i=[e[0]-r[0],e[1]-r[1]];this.normalize(i);const n=Math.sqrt((1+o)/2),s=-Math.abs(t)/n;a.push([c[0]-i[0]*s,c[1]-i[1]*s])}else switch(i){case"Mitered":{const i=Math.sqrt((1+o)/2);if(i>0&&1/i<n){const n=[e[0]-r[0],e[1]-r[1]];this.normalize(n);const s=Math.abs(t)/i;a.push([c[0]-n[0]*s,c[1]-n[1]*s]);break}}case"Bevelled":a.push([c[0]+r[1]*t,c[1]-r[0]*t]),a.push([c[0]+e[1]*t,c[1]-e[0]*t]);break;case"Rounded":{a.push([c[0]+r[1]*t,c[1]-r[0]*t]);const i=5,n=1/i;let s=n;for(let o=1;o<i;o++,s+=n){const i=[r[1]*(1-s)+e[1]*s,-r[0]*(1-s)-e[0]*s];this.normalize(i),a.push([c[0]+i[0]*t,c[1]+i[1]*t])}a.push([c[0]+e[1]*t,c[1]-e[0]*t]);break}case"Square":default:if(s<0)a.push([c[0]+(r[1]+r[0])*t,c[1]+(r[1]-r[0])*t]),a.push([c[0]+(e[1]-e[0])*t,c[1]-(e[0]+e[1])*t]);else{const i=Math.sqrt((1+Math.abs(o))/2),n=[e[0]-r[0],e[1]-r[1]];this.normalize(n);const s=t/i;a.push([c[0]-n[0]*s,c[1]-n[1]*s])}}}else{const e=[c[0]-l[0],c[1]-l[1]];this.normalize(e),a.push([c[0]+e[1]*t,c[1]-e[0]*t])}else{const e=[u[0]-c[0],u[1]-c[1]];this.normalize(e),a.push([c[0]+e[1]*t,c[1]-e[0]*t])}l=c,c=u}return o&&a.push([a[0][0],a[0][1]]),a}}class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,i){return new h(e,t,i)}}u.instance=null;class h extends s.a{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new c,this._width=(void 0!==t.width?t.width:5)*i,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:"OpenEnded",this._offsetFlattenError=.03*i}processPath(e){switch(this._arrowType){case"OpenEnded":default:return this._constructSimpleArrow(e,!0);case"Block":return this._constructSimpleArrow(e,!1);case"Crossed":return this._constructCrossedArrow(e)}}_constructSimpleArrow(e,t){const i=this._curveHelper.calculatePathLength(e);let n=this._width;i<2*n&&(n=i/2);const r=this._curveHelper.getSubCurve(e,0,i-n);if(!r)return null;const s=n/2;if(this._curveHelper.isEmpty(r,!1))return null;const o=this._constructOffset(r,-s);if(!o)return null;const a=this._constructOffset(r,s);if(!a)return null;const c=this._constructArrowBasePoint(o,-s/2);if(!c)return null;const u=this._constructArrowBasePoint(a,s/2);if(!u)return null;const h=e[e.length-1];t||(this._makeControlPoint(a,!0),this._makeControlPoint(o,!0));const d=new l;return d.addPath(a,!0),d.lineTo(u),this._makeControlPoint(d.path()),d.lineTo(h),this._makeControlPoint(d.path()),d.lineTo(c),this._makeControlPoint(d.path()),d.addPath(o,!1),t?{paths:[d.path()]}:(d.close(),{rings:[d.path()]})}_constructCrossedArrow(e){const t=this._curveHelper.calculatePathLength(e);let i=this._width;t<3.732050807568877*i&&(i=t/3.732050807568877);const n=this._curveHelper.getSubCurve(e,0,t-2.732050807568877*i);if(!n)return null;const r=i/2;if(this._curveHelper.isEmpty(n,!1))return null;const s=this._constructOffset(n,r);if(!s)return null;const o=this._constructOffset(n,-r);if(!o)return null;const a=this._curveHelper.getSubCurve(e,0,t-i);if(!a)return null;if(this._curveHelper.isEmpty(a,!1))return null;const c=this._constructOffset(a,r);if(!c)return null;const u=this._constructOffset(a,-r);if(!u)return null;const h=c[c.length-1],d=this._constructArrowBasePoint(c,r/2);if(!d)return null;const f=u[u.length-1],p=this._constructArrowBasePoint(u,-r/2);if(!p)return null;const m=e[e.length-1];this._makeControlPoint(s,!1),this._makeControlPoint(o,!1);const _=new l;return _.addPath(s,!0),this._makeControlPoint(_.path()),_.lineTo(f),_.lineTo(p),this._makeControlPoint(_.path()),_.lineTo(m),this._makeControlPoint(_.path()),_.lineTo(d),this._makeControlPoint(_.path()),_.lineTo(h),this._makeControlPoint(_.path()),_.addPath(o,!1),{paths:[_.path()]}}_constructOffset(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const i=e[e.length-2],n=e[e.length-1],r=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(r),[n[0]+r[1]*t,n[1]-r[0]*t]}_makeControlPoint(e,t=!1){Object(s.j)(t?e[0]:e[e.length-1],1)}}class d{static local(){return null===d.instance&&(d.instance=new d),d.instance}execute(e,t,i){return new f(e,t,i)}}d.instance=null;class f{constructor(e,t,i){this._inputGeometries=e,this._curveHelper=new c,this._size=(void 0!==t.size?t.size:1)*i,this._offsetFlattenError=.03*i}next(){let e=this._inputGeometries.next();for(;e;){if(Object(r.d)(e))if(this._size>0){const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],i=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError);if(i)return{rings:[i]}}else{if(!(this._size<0))return e;if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return{xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size}}if(Object(r.g)(e)){if(0===this._size)return e;const t=[];for(const i of e.rings){const e=this._curveHelper.offset(i,this._size,"Rounded",4,this._offsetFlattenError);e&&t.push(e)}if(t.length)return{rings:t}}if(Object(r.h)(e)&&this._size>0){const t=[];for(const i of e.paths)if(i&&i.length>1){const e=this._curveHelper.offset(i,this._size,"Rounded",4,this._offsetFlattenError),n=this._curveHelper.offset(i,-this._size,"Rounded",4,this._offsetFlattenError);if(e&&n){for(let t=n.length-1;t>=0;t--)e.push(n[t]);e.push([e[0][0],e[0][1]]),t.push(e)}}if(t.length)return{rings:t}}Object(r.f)(e)&&this._size,e=this._inputGeometries.next()}return null}}class p{static local(){return null===p.instance&&(p.instance=new p),p.instance}execute(e,t,i){return new m(e,t,i)}}p.instance=null;class m extends s.a{constructor(e,t,i){super(e,!0,!0),this._curveHelper=new c,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*i,this._endCut=(void 0!==t.endCut?t.endCut:1)*i,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*i,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const t=this._beginCut,i=this._endCut,n=this._middleCut,r=this._curveHelper.calculatePathLength(e),s=[];if(this._invert)if(0===t&&0===i&&0===n);else if(t+i+n>=r)s.push(e);else{let o=this._curveHelper.getSubCurve(e,0,t);o&&s.push(o),o=this._curveHelper.getSubCurve(e,.5*(r-n),.5*(r+n)),o&&s.push(o),o=this._curveHelper.getSubCurve(e,r-i,i),o&&s.push(o)}else if(0===t&&0===i&&0===n)s.push(e);else if(t+i+n>=r);else if(0===n){const n=this._curveHelper.getSubCurve(e,t,r-i);n&&s.push(n)}else{let o=this._curveHelper.getSubCurve(e,t,.5*(r-n));o&&s.push(o),o=this._curveHelper.getSubCurve(e,.5*(r+n),r-i),o&&s.push(o)}return 0===s.length?null:{paths:s}}}class _{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,i=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let n=Math.abs(e[t]);i&&n<1e-7&&(n=1e-7),this._values.push(n),this._length+=n}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let i=0;i<t;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class g{constructor(){this.reset()}reset(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return-1!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class y extends c{constructor(e=0,t=!1){super(e,t),this._tolerance=.03,this._currentPosition=new g}updateTolerance(e){this._tolerance=.03*e}init(e,t,i=!0){return i?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=e,this._seg=-1,this.setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=0){const i=new g;return!!this._nextPosition(e,i,null,t)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,i]=this._getAngle(this._currentPosition);e.ca=t,e.sa=i}nextPointAndAngle(e,t,i=0){const n=new g;if(!this._nextPosition(e,n,null,i))return!1;n.copyTo(this._currentPosition),t.pt=this._getPoint(n);const[r,s]=this._getAngle(n);return t.ca=r,t.sa=s,!0}nextCurve(e){if(0===e)return null;const t=[],i=new g;return this._nextPosition(e,i,t,1)?(i.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]}_nextPosition(e,t,i,n){if(this._currentPosition.isPathEnd)return!1;let r=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(r/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(i){if(0===i.length)if(0===r){const e=this._path[t.segment];i.push([e[0],e[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,r));const e=this._path[t.segment+1];i.push([e[0],e[1]])}if(r=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this.nextSegment(),t.segmentLength=this.calculateSegLength(this._path,t.segment),t.abscissa=0,this._partSegCount--;else{if(!this.setPosAtNextPart())return 0!==n&&(t.segmentLength=this.calculateSegLength(this._path,t.segment),t.isPartEnd=!0,1===n?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,i){if(0===i.length)if(0===r){const e=this._path[t.segment];i.push([e[0],e[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,r));const e=t.abscissa/t.segmentLength;if(1===e){const e=this._path[t.segment+1];i.push([e[0],e[1]])}else i.push(this.getSegCoord2D(this._path,t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){if(-1===e.segment)throw new Error("missing segment");const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._path,e.segment,t)}_getAngle(e){if(-1===e.segment)throw new Error("missing segment");const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._path,e.segment,t)}setPosAtNextPart(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===Object(s.f)(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}let e=this._partSegCount;for(;e;)this.previousSegment(),--e;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this.getStartPointIndex();this._ctrlPtBegin=1===Object(s.f)(this._path[t]);let i=t+this._partSegCount+1;if(i>=this._path.length&&(i=0),this._ctrlPtEnd=1===Object(s.f)(this._path[i]),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(e+t))/this._patternLength);i<=0&&(i=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}hasNextSegment(){return this._seg<this._path.length-2}previousSegment(){return--this._seg}nextSegment(){return++this._seg}getStartPointIndex(){return this._seg}getEndPointIndex(){return this._seg+1}}class v{static local(){return null===v.instance&&(v.instance=new v),v.instance}execute(e,t,i){return new x(e,t,i)}}v.instance=null;class x extends s.a{constructor(e,t,i){super(e,!0,!0),this._walker=new y,this._walker.updateTolerance(i),this._endings=t.lineDashEnding,this._customDashPos=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._offsetAtEnd=void 0!==t.customEndingOffset?t.customEndingOffset*i:0,this._pattern=new _,this._pattern.init(t.dashTemplate,!0),this._pattern.scale(i)}processPath(e){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[e]};if(!this.iteratePath){let t=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(t=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=this._walker.calculatePathLength(e);if(this._pattern.isEmpty()||i<.1*this._pattern.length())return{paths:[e]};if(!this._walker.init(e,this._pattern,t))return{paths:[e]}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let e;switch(this._endings){case"HalfPattern":default:e=.5*this._pattern.firstValue();break;case"HalfGap":e=.5*-this._pattern.lastValue();break;case"FullGap":e=-this._pattern.lastValue();break;case"FullPattern":e=0;break;case"NoConstraint":case"Custom":e=-this._customDashPos}let i=e/this._pattern.length();i-=Math.floor(i),e=i*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let n=!1;for(;e>=t;)e-=t,t=this._pattern.nextValue(),n=!n;t-=e,n?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let i=this._walker.nextCurve(t);return i?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),l.mergePath(i,this._firstCurve),this._firstCurve=null)):(t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null),{paths:[i]}}}class b{static local(){return null===b.instance&&(b.instance=new b),b.instance}execute(e,t,i){return new O(e,t,i)}}b.instance=null;class O{constructor(e,t,i){switch(this._inputGeometries=e,this._curveHelper=new c,this._width=(void 0!==t.width?t.width:2)*i,t.method){case"Mitered":default:this._method="Mitered";break;case"Bevelled":this._method="Bevelled";break;case"Rounded":case"TrueBuffer":this._method="Rounded";break;case"Square":this._method="Square"}this._option=t.option,this._offsetFlattenError=.03*i,this._option}next(){let e=this._inputGeometries.next();for(;e;){if(Object(r.d)(e)&&this._width>0){if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0)return e;const t=[];return t.push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:t}}if(Object(r.g)(e)&&this._width>0){const t=[];for(const i of e.rings){const e=this._curveHelper.calculatePathLength(i),n=this._curveHelper.offset(i,this._width,this._method,4,this._offsetFlattenError);n&&(e<0&&n.reverse(),t.push(n))}if(t.length)return{rings:t}}e=this._inputGeometries.next()}return null}}class S{static local(){return null===S.instance&&(S.instance=new S),S.instance}execute(e,t,i){return new w(e,t,i)}}S.instance=null;class w extends s.a{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new c,this._length=(void 0!==t.length?t.length:20)*i,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){if(this._curveHelper.isEmpty(e,!1))return null;const t=e[0],i=e[e.length-1],n=[i[0]-t[0],i[1]-t[1]];this._curveHelper.normalize(n);const r=[t[0]+(i[0]-t[0])*this._position/100,t[1]+(i[1]-t[1])*this._position/100],s=Math.cos((90-this._angle)/180*Math.PI);let o=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(o=-o),this._mirror=!this._mirror,{paths:[[t,[r[0]-this._length/2*s,r[1]-this._length/2*o],[r[0]+this._length/2*s,r[1]+this._length/2*o],i]]}}}class T{static local(){return null===T.instance&&(T.instance=new T),T.instance}execute(e,t,i){return new C(e,t,i)}}T.instance=null;class C{constructor(e,t,i){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?-t.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(Object(r.d)(e))return{xmin:e.xmin+this._offsetX,xmax:e.xmax+this._offsetX,ymin:e.ymin+this._offsetY,ymax:e.ymax+this._offsetY};if(Object(r.g)(e)){const t=Object(n.a)(e);return this._moveMultipath(t.rings,this._offsetX,this._offsetY),t}if(Object(r.h)(e)){const t=Object(n.a)(e);return this._moveMultipath(t.paths,this._offsetX,this._offsetY),t}if(Object(r.e)(e)){const t=Object(n.a)(e);return this._movePath(t.points,this._offsetX,this._offsetY),t}if(Object(r.f)(e))return{x:e.x+this._offsetX,y:e.y+this._offsetY};e=this._inputGeometries.next()}return null}_moveMultipath(e,t,i){if(e)for(const n of e)this._movePath(n,t,i)}_movePath(e,t,i){if(e)for(const n of e)n[0]+=t,n[1]+=i}}class M{static local(){return null===M.instance&&(M.instance=new M),M.instance}execute(e,t,i){return new I(e,t,i)}}M.instance=null;class I{constructor(e,t,i){this._inputGeometries=e,this._curveHelper=new c,this._offset=(void 0!==t.offset?t.offset:1)*i,this._method=t.method,this._option=t.option,this._offsetFlattenError=.03*i,this._option}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._offset)return e;if(Object(r.d)(e)){if("Rounded"===this._method&&this._offset>0){const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],i=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError);return i?{rings:[i]}:null}if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return{xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset}}if(Object(r.g)(e)){const t=[];for(const i of e.rings){const e=this._curveHelper.offset(i,this._offset,this._method,4,this._offsetFlattenError);e&&t.push(e)}if(t.length)return{rings:t}}if(Object(r.h)(e)){const t=[];for(const i of e.paths){const e=this._curveHelper.offset(i,this._offset,this._method,4,this._offsetFlattenError);e&&t.push(e)}if(t.length)return{paths:t}}e=this._inputGeometries.next()}return null}}class j{static local(){return null===j.instance&&(j.instance=new j),j.instance}execute(e,t,i){return new E(e,t,i)}}j.instance=null;class E{constructor(e,t,i){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(Object(r.h)(e)){const t=Object(n.a)(e);return Object(s.h)(t.paths),t}e=this._inputGeometries.next()}return null}}var P,D,L=i(213),z=i(259);class A{static local(){return null===A.instance&&(A.instance=new A),A.instance}execute(e,t,i){return new V(e,t,i)}}A.instance=null;class V{constructor(e,t,i){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?-t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle)return e;const t=Object(z.d)();Object(L.a)(t,e);const i=(t[2]+t[0])/2,s=(t[3]+t[1])/2;if(Object(r.d)(e)){const t={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._rotateMultipath(t.rings,i,s),t}if(Object(r.g)(e)){const t=Object(n.a)(e);return this._rotateMultipath(t.rings,i,s),t}if(Object(r.h)(e)){const t=Object(n.a)(e);return this._rotateMultipath(t.paths,i,s),t}if(Object(r.e)(e)){const t=Object(n.a)(e);return this._rotatePath(t.points,i,s),t}if(Object(r.f)(e))return e;e=this._inputGeometries.next()}return null}_rotateMultipath(e,t,i){if(e)for(const n of e)this._rotatePath(n,t,i)}_rotatePath(e,t,i){if(e){const n=Math.cos(this._rotateAngle),r=Math.sin(this._rotateAngle);for(const s of e){const e=s[0]-t,o=s[1]-i;s[0]=t+e*n-o*r,s[1]=i+e*r+o*n}}}}class R{static local(){return null===R.instance&&(R.instance=new R),R.instance}execute(e,t,i){return new F(e,t,i)}}R.instance=null;class F{constructor(e,t,i){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){let e=this._inputGeometries.next();for(;e;){if(1===this._xFactor&&1===this._yFactor)return e;const t=Object(z.d)();Object(L.a)(t,e);const i=(t[2]+t[0])/2,s=(t[3]+t[1])/2;if(Object(r.d)(e)){const t={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._scaleMultipath(t.rings,i,s),t}if(Object(r.g)(e)){const t=Object(n.a)(e);return this._scaleMultipath(t.rings,i,s),t}if(Object(r.h)(e)){const t=Object(n.a)(e);return this._scaleMultipath(t.paths,i,s),t}if(Object(r.e)(e)){const t=Object(n.a)(e);return this._scalePath(t.points,i,s),t}if(Object(r.f)(e))return e;e=this._inputGeometries.next()}return null}_scaleMultipath(e,t,i){if(e)for(const n of e)this._scalePath(n,t,i)}_scalePath(e,t,i){if(e)for(const n of e){const e=(n[0]-t)*this._xFactor,r=(n[1]-i)*this._yFactor;n[0]=t+e,n[1]=i+r}}}class N{static local(){return null===N.instance&&(N.instance=new N),N.instance}execute(e,t,i){return new k(e,t,i)}}N.instance=null;class k{constructor(e,t,i){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*i,this._period=(void 0!==t.period?t.period:3)*i,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new _,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new y,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;if(Object(r.h)(e)){const t=this._processGeom(e.paths);if(t.length)return{paths:t}}if(Object(r.g)(e)){const t=this._processGeom(e.rings);if(t.length)return{rings:t}}e=this._inputGeometries.next()}return null}_processGeom(e){const t=[];for(const i of e)if(this._walker.init(i,this._pattern))switch(this._style){case"Sinus":default:t.push(this._constructCurve(i,!1));break;case"Square":t.push(this._constructSquare(i));break;case"Triangle":t.push(this._constructTriangle(i));break;case"Random":t.push(this._constructCurve(i,!0))}else t.push(i);return t}_constructCurve(e,t){const i=new l,n=this._walker.calculatePathLength(e);let r=Math.round(n/this._period);0===r&&(r=1);const s=16*r+1,o=n/r,a=this._period/16,c=1/s,u=2*Math.PI*n/o,h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),p=.75-Math.random()/2,m=.75-Math.random()/2,_={};this._walker.curPointAndAngle(_),i.startPath(_.pt);let g=0;for(;;){if(!this._walker.nextPointAndAngle(a,_)){i.lineTo(e[e.length-1]);break}{const e=g;let n;if(g+=c,t){const t=this._height/2*(1+.3*Math.sin(p*u*e+h));n=t*Math.sin(u*e+d),n+=t*Math.sin(m*u*e+f),n/=2}else n=.5*this._height*Math.sin(.5*u*e);i.lineTo([_.pt[0]-n*_.sa,_.pt[1]+n*_.ca])}}return i.path()}_constructSquare(e){const t=new l,i=this._walker.calculatePathLength(e);let n=Math.round(i/this._period);0===n&&(n=1);let r=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const i={};this._walker.curPointAndAngle(i);const n={};if(this._walker.nextPointAndAngle(this._period,n)){const s={};this._walker.nextPointAndAngle(this._period,s)&&(r?(t.startPath(i.pt),r=!1):t.lineTo(i.pt),t.lineTo([i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca]),t.lineTo([n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca]),t.lineTo([n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca]),t.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca]),e=!0)}}if(!e){t.lineTo(this._walker.getPathEnd());break}}return t.path()}_constructTriangle(e){const t=new l,i=this._walker.calculatePathLength(e);let n=Math.round(i/this._period);0===n&&(n=1);let r=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const i={};this._walker.curPointAndAngle(i);const n={};if(this._walker.nextPointAndAngle(this._period/2,n)){const s={};this._walker.nextPointAndAngle(this._period,s)&&(this._walker.nextPosition(this._period/2)&&(r?(t.startPath(i.pt),r=!1):t.lineTo(i.pt),t.lineTo([n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca]),t.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca])),e=!0)}}if(!e){t.lineTo(this._walker.getPathEnd());break}}return t.path()}}(D=P||(P={})).NoConstraint="NoConstraint",D.WithMarkers="WithMarkers",D.WithFullGap="WithFullGap",D.WithHalfGap="WithHalfGap",D.Custom="Custom";class U{static local(){return null===U.instance&&(U.instance=new U),U.instance}execute(e,t,i){return new G(e,t,i)}}U.instance=null;class G extends s.b{constructor(e,t,i){super(e,!0,!0),this._grometryWalker=new y,this._grometryWalker.updateTolerance(i),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._originalEndings=t.endings,this._offsetAtEnd=void 0!==t.customEndingOffset?t.customEndingOffset*i:0,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._pattern=new _,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===P.WithFullGap&&this.isClosed?this._endings=P.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,n=!0;switch(this._endings){case P.NoConstraint:i=-this._position,i=this._adjustPosition(i),n=!1;break;case P.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case P.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case P.WithMarkers:i=0;break;case P.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._grometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let r=0;for(;i>r;)i-=r,r=this._pattern.nextValue();r-=i,t=r,this.iteratePath=!0}const i={};return this._grometryWalker.nextPointAndAngle(t,i)?this._endings===P.WithFullGap&&this._grometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===P.WithMarkers&&this._grometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]+this._offset*i.sa,i.pt[1]-this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}class B{static local(){return null===B.instance&&(B.instance=new B),B.instance}execute(e,t,i){return new H(e,t,i)}}B.instance=null;class H extends s.b{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new c,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._beginProcessed=!1}processPath(e){let t;switch(this._type){case"Both":default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);break;case"None":}return t}_atExtremities(e,t,i){const n=e.length;if(n<2)return null;const r=i?1:n-2,o=i?n:-1,a=i?1:-1;let l,c=0,u=i?e[0]:e[n-1];for(let i=r;i!==o;i+=a){l=u,u=e[i];const n=this._curveHelper.calculateLength(l,u);if(c+n>t){const e=(t-c)/n,[i,r]=this._curveHelper.getAngleCS(l,u,e),o=Object(s.e)(l,u,e);return this.internalPlacement.setTranslate(o[0]-this._offset*r,o[1]+this._offset*i),this._angleToLine&&this.internalPlacement.setRotateCS(-i,-r),this.internalPlacement}c+=n}return null}}class q{static local(){return null===q.instance&&(q.instance=new q),q.instance}execute(e,t,i){return new W(e,t,i)}}q.instance=null;class W extends s.b{constructor(e,t,i){super(e,!0,!0),this._walker=new y,this._walker.updateTolerance(i),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*i:0,this._endGap=void 0!==t.endPosition?t.endPosition*i:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new _,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+e;t=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(e)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+i;t=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}const i={};if(!this._walker.nextPointAndAngle(t,i,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]+this._offset*i.sa,i.pt[1]-this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let r,s;return this._angleToLine?(r=i.ca,s=i.sa):(r=1,s=0),n&&(r=-r,s=-s),this.internalPlacement.setRotateCS(r,s),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}var Y=i(421);class X{static local(){return null===X.instance&&(X.instance=new X),X.instance}execute(e,t,i){return new Z(e,t,i)}}X.instance=null;class Z{constructor(e,t,i){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._stepX=(void 0!==t.stepX?Math.abs(t.stepX):16)*i,this._stepY=(void 0!==t.stepY?Math.abs(t.stepY):16)*i,0!==this._stepX&&0!==this._stepY&&e&&void 0!==e.rings&&e.rings){if(this._gridType=void 0!==t.gridType?t.gridType:"Fixed","Random"===this._gridType)this._randomness=void 0!==t.randomness?t.randomness/100:1,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0;else{if(this._randomness=0,this._gridAngle=void 0!==t.gridAngle?t.gridAngle:0,this._shiftOddRows=void 0!==t.shiftOddRows&&t.shiftOddRows,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginX=0,this._graphicOriginY=0,this._internalPlacement=new Y.a,this._calculateMinMax(e),this._geometry=e}}next(){return this._geometry?this._nextInside():null}_calculateMinMax(e){let t,i,n,r,s,o,a,l;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,s=o=Number.MAX_VALUE,a=l=-Number.MAX_VALUE;for(const c of e.rings){const e=c?c.length:0;for(let u=0;u<e;++u)t=c[u][0]-this._graphicOriginX-this._offsetX,i=c[u][1]-this._graphicOriginY-this._offsetY,n=this._cosAngle*t-this._sinAngle*i,r=this._sinAngle*t+this._cosAngle*i,s=Math.min(s,n),a=Math.max(a,n),o=Math.min(o,r),l=Math.max(l,r)}s+=this._graphicOriginX,a+=this._graphicOriginX,o+=this._graphicOriginY,l+=this._graphicOriginY,this._xMin=Math.round(s/this._stepX),this._xMax=Math.round(a/this._stepX),this._yMin=Math.round(o/this._stepY),this._yMax=Math.round(l/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let i,n;return this._currentX++,"Random"===this._gridType?(i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Math.random())*2/3,n=this._graphicOriginY+t+this._stepY*this._randomness*(.5-Math.random())*2/3):(i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,n=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t),this._internalPlacement.setTranslate(i,n),this._internalPlacement}}}class K{static local(){return null===K.instance&&(K.instance=new K),K.instance}execute(e,t,i){return new J(e,t,i)}}K.instance=null;class J extends s.b{constructor(e,t,i){super(e,!0,!0),this._curveHelper=new c,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*i:0,this._epsilon=.001*i}processPath(e){const t=this._position;if("SegmentMidpoint"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){const t=this._curSegment;this._curSegment++;const i=e[t-1],n=e[t],r=this._curveHelper.calculateLength(i,n);if(r<this._epsilon)continue;const o=.5+this._position/r,[a,l]=this._curveHelper.getAngleCS(i,n,o),c=Object(s.e)(i,n,o);return this.internalPlacement.setTranslate(c[0]-this._offset*l,c[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}return this.iteratePath=!1,null}"LineEnd"===this._relativeTo&&Object(s.i)(e);const i=this.onLine(e,t);return"LineEnd"===this._relativeTo&&Object(s.i)(e),i}onLine(e,t){let i,n=!1;switch(this._relativeTo){case"LineMiddle":default:i=this._curveHelper.calculatePathLength(e)/2+t;break;case"LineBeginning":i=t;break;case"LineEnd":i=t,n=!0}const r=e.length;let o,a=0,l=e[0];for(let t=1;t<r;++t){o=l,l=e[t];const r=this._curveHelper.calculateLength(o,l);if(a+r>i){const e=(i-a)/r,[t,c]=this._curveHelper.getAngleCS(o,l,e),u=Object(s.e)(o,l,e),h=n?this._offset:-this._offset;return this.internalPlacement.setTranslate(u[0]-h*c,u[1]+h*t),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-t,-c):this.internalPlacement.setRotateCS(t,c)),this.internalPlacement}a+=r}return null}}class Q{static local(){return null===Q.instance&&(Q.instance=new Q),Q.instance}execute(e,t,i){return new $(e,t,i)}}Q.instance=null;class $ extends s.b{constructor(e,t,i){super(e,!0,!0),this._curveHelper=new c,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let i=t[0],n=t[1];if(0!==this._offset){const e=Math.cos(t[2]),r=Math.sin(t[2]);i-=this._offset*r,n+=this._offset*e}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0;const t=Object(s.g)(e),i=e.length-1;let n,r,o=0,a=0,l=0,c=0,u=0;for(;o<i;){o++,n=e[o-1],r=e[o];const h=Object(s.f)(n),d=Object(s.f)(r);(this._angleToLine||0!==this._offset)&&(c=this._curveHelper.getAngle(n,r,0)),1===o?t?(a=c,l=h):this._endPoints&&this._tags.push([n[0],n[1],c]):1===h?this._controlPoints&&this._tags.push([n[0],n[1],ee(u,c)]):this._regularVertices&&this._tags.push([n[0],n[1],ee(u,c)]),(this._angleToLine||0!==this._offset)&&(u=this._curveHelper.getAngle(n,r,1)),o===i&&(t?1===d||1===l?this._controlPoints&&this._tags.push([r[0],r[1],ee(u,a)]):this._regularVertices&&this._tags.push([r[0],r[1],ee(u,a)]):this._endPoints&&this._tags.push([r[0],r[1],u]))}this._tagIterator=0}}function ee(e,t){const i=Math.PI;for(;Math.abs(t-e)>i+2e-15;)t-e>i?t-=2*i:t+=2*i;return(e+t)/2}class te{static local(){return null===te.instance&&(te.instance=new te),te.instance}execute(e,t,i){return new ie(e,t,i)}}te.instance=null;class ie{constructor(e,t,i){this._geometry=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0,this._method=void 0!==t.method?t.method:"OnPolygon",this._internalPlacement=new Y.a}next(){const e=this._geometry;return this._geometry=null,e&&void 0!==e.rings?this._polygonCenter(e):null}_polygonCenter(e){let t=!1;switch(this._method){case"OnPolygon":default:case"CenterOfMass":case"BoundingBoxCenter":{const i=Object(z.d)();Object(L.a)(i,e),this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2-this._offsetY),t=!0;break}}return t?this._internalPlacement:null}}function ne(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return o.local();case"CIMGeometricEffectArrow":return u.local();case"CIMGeometricEffectBuffer":return d.local();case"CIMGeometricEffectCut":return p.local();case"CIMGeometricEffectDashes":return v.local();case"CIMGeometricEffectDonut":return b.local();case"CIMGeometricEffectJog":return S.local();case"CIMGeometricEffectMove":return T.local();case"CIMGeometricEffectOffset":return M.local();case"CIMGeometricEffectReverse":return j.local();case"CIMGeometricEffectRotate":return A.local();case"CIMGeometricEffectScale":return R.local();case"CIMGeometricEffectWave":return N.local()}return null}function re(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return U.local();case"CIMMarkerPlacementAtExtremities":return B.local();case"CIMMarkerPlacementAtRatioPositions":return q.local();case"CIMMarkerPlacementInsidePolygon":return X.local();case"CIMMarkerPlacementOnLine":return K.local();case"CIMMarkerPlacementOnVertices":return Q.local();case"CIMMarkerPlacementPolygonCenter":return te.local()}return null}},460:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));var n=i(404);function r(e){let t="";for(const i in e){const n=e[i];if("boolean"==typeof n)n&&(t+=`#define ${i}\n`);else if("number"==typeof n)t+=`#define ${i} ${n.toFixed()}\n`;else if("object"==typeof n){const e=n.options;let r=0;for(const i in e)t+=`#define ${e[i]} ${(r++).toFixed()}\n`;t+=`#define ${i} ${e[n.value]}\n`}}return t}function s(e,t,i,r){i=i||{},r=r||"";const s="function"==typeof t.shaders?t.shaders(i):t.shaders;return new n.a(e,r+s.vertexShader,r+s.fragmentShader,t.attributes)}},461:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));const n={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const n=new r(e.getPointX(t),e.getPointY(t),i),s=e.hasZ(t),o=e.hasM(t);return s&&(n.z=e.getPointZ(t)),o&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,i){return new s(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,i){return new o(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,i){return new a(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,i){const n=e.hasZ(t),r=e.hasM(t),s=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(n){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(r){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s}};class r{constructor(e,t,i){this.x=e,this.y=t,this.spatialReference=i,this.z=void 0,this.m=void 0}}class s{constructor(e,t,i,n){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class o{constructor(e,t,i,n){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class a{constructor(e,t,i,n){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class l{constructor(e,t,i,n,r){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=n,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},463:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return x})),i.d(t,"e",(function(){return b})),i.d(t,"f",(function(){return O})),i.d(t,"g",(function(){return S}));var n=i(59);const r=(e,t,i)=>[t,i],s=(e,t,i)=>[t,i,e[2]],o=(e,t,i)=>[t,i,e[2],e[3]];function a(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null}function l({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function c({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function u(e,t,i){const n=[];let r,s,o,a;for(let u=0;u<i.length;u++){const h=i[u];u>0?(o=l(e,h[0]),a=c(e,h[1]),o===r&&a===s||(n.push(t(h,o-r,a-s)),r=o,s=a)):(r=l(e,h[0]),s=c(e,h[1]),n.push(t(h,r,s)))}return n.length>0?n:null}function h({scale:e,translate:t},i){return i*e[0]+t[0]}function d({scale:e,translate:t},i){return t[1]-i*e[1]}function f(e,t,i){const n=new Array(i.length);if(!i.length)return n;const[r,s]=e.scale;let o=h(e,i[0][0]),a=d(e,i[0][1]);n[0]=t(i[0],o,a);for(let e=1;e<i.length;e++){const l=i[e];o+=l[0]*r,a-=l[1]*s,n[e]=t(l,o,a)}return n}function p(e,t,i){const n=new Array(i.length);for(let r=0;r<i.length;r++)n[r]=f(e,t,i[r]);return n}function m(e,t,i,n,a){return t.points=function(e,t,i,n){return u(e,i?n?o:s:n?s:r,t)}(e,i.points,n,a),t}function _(e,t,i,n,r){return t.x=l(e,i.x),t.y=c(e,i.y),t!==i&&(n&&(t.z=i.z),r&&(t.m=i.m)),t}function g(e,t,i,n,a){const l=function(e,t,i,n){const a=[],l=i?n?o:s:n?s:r;for(let i=0;i<t.length;i++){const n=u(e,l,t[i]);n&&n.length>=3&&a.push(n)}return a.length?a:null}(e,i.rings,n,a);return l?(t.rings=l,t):null}function y(e,t,i,n,a){const l=function(e,t,i,n){const a=[],l=i?n?o:s:n?s:r;for(let i=0;i<t.length;i++){const n=u(e,l,t[i]);n&&n.length>=2&&a.push(n)}return a.length?a:null}(e,i.paths,n,a);return l?(t.paths=l,t):null}function v(e,t){return e&&t?Object(n.f)(t)?_(e,{},t,!1,!1):Object(n.h)(t)?y(e,{},t,!1,!1):Object(n.g)(t)?g(e,{},t,!1,!1):Object(n.e)(t)?m(e,{},t,!1,!1):Object(n.d)(t)?(o=!1,a=!1,(r={}).xmin=l(i=e,(s=t).xmin),r.ymin=c(i,s.ymin),r.xmax=l(i,s.xmax),r.ymax=c(i,s.ymax),r!==s&&(o&&(r.zmin=s.zmin,r.zmax=s.zmax),a&&(r.mmin=s.mmin,r.mmax=s.mmax)),r):null:null;var i,r,s,o,a}function x(e,t,i,n,a){return t.points=function(e,t,i,n){return f(e,i?n?o:s:n?s:r,t)}(e,i.points,n,a),t}function b(e,t,i,n,r){return t.x=h(e,i.x),t.y=d(e,i.y),t!==i&&(n&&(t.z=i.z),r&&(t.m=i.m)),t}function O(e,t,i,n,a){return t.rings=function(e,t,i,n){return p(e,i?n?o:s:n?s:r,t)}(e,i.rings,n,a),t}function S(e,t,i,n,a){return t.paths=function(e,t,i,n){return p(e,i?n?o:s:n?s:r,t)}(e,i.paths,n,a),t}},464:function(e,t,i){"use strict";function n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function s(e,t){return new Float64Array(e,t,16)}i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return s}));const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze({__proto__:null,create:n,clone:r,fromValues:function(e,t,i,n,r,s,o,a,l,c,u,h,d,f,p,m){return[e,t,i,n,r,s,o,a,l,c,u,h,d,f,p,m]},createView:s,IDENTITY:o})},465:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(531);function r(e,t){if(!(this instanceof r))return new r(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function s(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,i,n,r){r||(r=m(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s,o=t;o<i;o++)s=e.children[o],l(r,e.leaf?n(s):s);return r}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(e,t,i,r,s){for(var o,a=[t,i];a.length;)(i=a.pop())-(t=a.pop())<=r||(o=t+Math.ceil((i-t)/r/2)*r,Object(n.a)(e,o,t,i,s),a.push(t,o,o,i))}r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],n=this.toBBox;if(!p(e,t))return i;for(var r,s,o,a,l=[];t;){for(r=0,s=t.children.length;r<s;r++)o=t.children[r],p(e,a=t.leaf?n(o):o)&&(t.leaf?i.push(o):f(e,a)?this._all(o,i):l.push(o));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!p(e,t))return!1;for(var n,r,s,o,a=[];t;){for(n=0,r=t.children.length;n<r;n++)if(s=t.children[n],p(e,o=t.leaf?i(s):s)){if(t.leaf||f(e,o))return!0;a.push(s)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(e,t){if(!e)return this;for(var i,n,r,o,a=this.data,l=this.toBBox(e),c=[],u=[];a||c.length;){if(a||(a=c.pop(),n=c[c.length-1],i=u.pop(),o=!0),a.leaf&&-1!==(r=s(e,a.children,t)))return a.children.splice(r,1),c.push(a),this._condense(c),this;o||a.leaf||!f(a,l)?n?(i++,a=n.children[i],o=!1):a=null:(c.push(a),u.push(i),i=0,n=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,n){var r,s=i-t+1,a=this._maxEntries;if(s<=a)return o(r=m(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,n-1))),(r=m([])).leaf=!1,r.height=n;var l,c,u,h,d=Math.ceil(s/a),f=d*Math.ceil(Math.sqrt(a));for(_(e,t,i,f,this.compareMinX),l=t;l<=i;l+=f)for(_(e,l,u=Math.min(l+f-1,i),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),r.children.push(this._build(e,c,h,n-1));return o(r,this.toBBox),r},_chooseSubtree:function(e,t,i,n){for(var r,s,o,a,l,c,u,d,f,p;n.push(t),!t.leaf&&n.length-1!==i;){for(u=d=1/0,r=0,s=t.children.length;r<s;r++)l=h(o=t.children[r]),f=e,p=o,(c=(Math.max(p.maxX,f.maxX)-Math.min(p.minX,f.minX))*(Math.max(p.maxY,f.maxY)-Math.min(p.minY,f.minY))-l)<d?(d=c,u=l<u?l:u,a=o):c===d&&l<u&&(u=l,a=o);t=a||t.children[0]}return t},_insert:function(e,t,i){var n=this.toBBox,r=i?e:n(e),s=[],o=this._chooseSubtree(r,this.data,t,s);for(o.children.push(e),l(o,r);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(r,s,t)},_split:function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var s=this._chooseSplitIndex(i,r,n),a=m(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var n,r,s,o,l,c,u,d,f,p,m,_,g,y;for(c=u=1/0,n=t;n<=i-t;n++)f=r=a(e,0,n,this.toBBox),p=s=a(e,n,i,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(f.minX,p.minX),_=Math.max(f.minY,p.minY),g=Math.min(f.maxX,p.maxX),y=Math.min(f.maxY,p.maxY),o=Math.max(0,g-m)*Math.max(0,y-_),l=h(r)+h(s),o<c?(c=o,d=n,u=l<u?l:u):o===c&&l<u&&(u=l,d=n);return d},_chooseSplitAxis:function(e,t,i){var n=e.leaf?this.compareMinX:c,r=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)},_allDistMargin:function(e,t,i,n){e.children.sort(n);var r,s,o=this.toBBox,c=a(e,0,t,o),u=a(e,i-t,i,o),h=d(c)+d(u);for(r=t;r<i-t;r++)s=e.children[r],l(c,e.leaf?o(s):s),h+=d(c);for(r=i-t-1;r>=t;r--)s=e.children[r],l(u,e.leaf?o(s):s),h+=d(u);return h},_adjustParentBBoxes:function(e,t,i){for(var n=i;n>=0;n--)l(t[n],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():o(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},467:function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return C})),i.d(t,"c",(function(){return T}));var n=i(5),r=i(69),s=i(35),o=i(421),a=i(213),l=i(59),c=i(259),u=i(499),h=i(453),d=i(472);const f=Math.PI/180,p=n.a.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class m{constructor(e){this._t=e}static createIdentity(){return new m([1,0,0,0,1,0])}clone(){const e=this._t;return new m(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new m([e,0,0,0,t,0])}scale(e,t){const i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=t,i[4]*=t,i[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new m([0,0,e,0,0,t])}translate(e,t){const i=this._t;return i[2]+=e,i[5]+=t,this}static createRotate(e){const t=Math.cos(e),i=Math.sin(e);return new m([t,-i,0,i,t,0])}rotate(e){return this.multiply(m.createRotate(e))}multiply(e){const t=this._t,i=e._t,n=t[0]*i[0]+t[3]*i[1],r=t[1]*i[0]+t[4]*i[1],s=t[2]*i[0]+t[5]*i[1]+i[2],o=t[0]*i[3]+t[3]*i[4],a=t[1]*i[3]+t[4]*i[4],l=t[2]*i[3]+t[5]*i[4]+i[5];return t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,this}}class _{constructor(e){this._transfos=[],this._sizeTransfos=[],this._transfos.push(e||m.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}back(){return this._transfos[this._transfos.length-1]}push(e,t){const i=t?e.scaleRatio():1;e.multiply(this.back()),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t)}}drawMultiLayerSymbol(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;const n=e.effects;if(n){const e=this.executeEffects(n,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(i,t),t=e.next()}}else this.drawSymbolLayers(i,t)}executeEffects(e,t){let i=new u.a(t);for(const t of e){const e=Object(h.a)(t);e&&(i=e.execute(i,t,1))}return i}drawSymbolLayers(e,t){let i=e.length;for(;i--;){const n=e[i];if(!n||!1===n.enable)continue;const r=n.effects;if(r){const e=this.executeEffects(r,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayer(n,t),t=e.next()}}else this.drawSymbolLayer(n,t)}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const i=this._buildHatchPolyline(e,t,1);i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}drawMarkerLayer(e,t){const i=e.markerPlacement;if(i){const n=Object(h.b)(i);if(n){const r="CIMMarkerPlacementInsidePolygon"===i.type;r&&this.pushClipPath(t);const s=1,o=n.execute(t,i,s);if(o){let t=o.next();for(;t;)this.drawMarker(e,t),t=o.next()}r&&this.popClipPath()}}else{const i=new o.a;i.tx=t.x,i.ty=t.y,this.drawMarker(e,i)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){}drawVectorMarker(e,t){if(!e)return;const i=e.markerGraphics;if(!i)return;const n=e.size,r=e.frame,s=r?r.ymax-r.ymin:0,o=n&&s?n/s:1,a=m.createIdentity();r&&a.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const l=e.anchorPoint;if(l){let t=l.x,i=l.y;"Absolute"!==e.anchorPointUnits&&r&&(t*=r.xmax-r.xmin,i*=r.ymax-r.ymin),a.translate(-t,-i)}1!==o&&a.scale(o,o),e.rotation&&a.rotate(e.rotation*f),a.translate(e.offsetX||0,e.offsetY||0),a.translate(t.tx,t.ty),this.push(a,e.scaleSymbolsProportionally);for(const e of i)e&&e.symbol&&e.geometry||p.error("Invalid marker graphic",e),this.drawSymbol(e.symbol,e.geometry);this.pop()}_buildHatchPolyline(e,t,i){let n=(void 0!==e.separation?e.separation:4)*i,r=void 0!==e.rotation?e.rotation:0;if(0===n)return null;n<0&&(n=-n);let s=0;const o=.5*n;for(;s>o;)s-=n;for(;s<-o;)s+=n;const l=Object(c.d)();Object(a.a)(l,t),l[0]-=o,l[1]-=o,l[2]+=o,l[3]+=o;const u=[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]];for(;r>180;)r-=180;for(;r<0;)r+=180;const h=Math.cos(r*f),d=Math.sin(r*f),p=-n*d,m=n*h;let _,g,y,v;s=(void 0!==e.offsetX?e.offsetX*i:0)*d-(void 0!==e.offsetY?e.offsetY*i:0)*h,_=y=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const e of u){const t=e[0],i=e[1],n=h*t+d*i,r=-d*t+h*i;_=Math.min(_,n),y=Math.min(y,r),g=Math.max(g,n),v=Math.max(v,r)}y=Math.floor(y/n)*n;let x=h*_-d*y-p*s/n,b=d*_+h*y-m*s/n,O=h*g-d*y-p*s/n,S=d*g+h*y-m*s/n;const w=1+Math.round((v-y)/n),T=[];for(let e=0;e<w;e++)x+=p,b+=m,O+=p,S+=m,T.push([[x,b],[O,S]]);return{paths:T}}}class g extends _{constructor(){super(),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new d.a(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}drawSolidFill(e){!e||this._clipCount>0||(Object(l.g)(e)?this._processPath(e.rings,0):Object(l.h)(e)&&this._processPath(e.paths,0))}drawSolidStroke(e,t,i){if(!e||this._clipCount>0)return;const n=.5*this.transformSize(i);Object(l.g)(e)?this._processPath(e.rings,n):Object(l.h)(e)&&this._processPath(e.paths,n)}pushClipPath(e){this.drawSolidFill(e),++this._clipCount}popClipPath(){--this._clipCount}_processPath(e,t){if(e)for(const i of e){const e=i?i.length:0;if(e>1){this._merge(this.transformPt(i[0]),t);for(let n=1;n<e;++n)this._merge(this.transformPt(i[n]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}class y extends _{constructor(e,t){super(t),this._ctx=e}drawSolidFill(e,t){if(!e)return;if(Object(l.g)(e))this._buildPath(e.rings,!0);else{if(!Object(l.h)(e))return;this._buildPath(e.paths,!0)}const i=this._ctx;i.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",i.fill("evenodd")}drawSolidStroke(e,t,i,n,r,s){if(!e||!t||0===i)return;if(Object(l.g)(e))this._buildPath(e.rings,!0);else{if(!Object(l.h)(e))return;this._buildPath(e.paths,!1)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",o.lineWidth=this.transformSize(i)+.5,this._setCapStyle(n),this._setJoinStyle(r),o.miterLimit=s,o.stroke()}pushClipPath(e){this._ctx.save(),Object(l.g)(e)?this._buildPath(e.rings,!0):Object(l.h)(e)&&this._buildPath(e.paths,!0),this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}_buildPath(e,t){const i=this._ctx;if(i.beginPath(),e)for(const n of e){const e=n?n.length:0;if(e>1){let r=this.transformPt(n[0]);i.moveTo(r[0],r[1]);for(let t=1;t<e;++t)r=this.transformPt(n[t]),i.lineTo(r[0],r[1]);t&&i.closePath()}}}_setCapStyle(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}}var v=i(500);const x=Math.PI,b=x/2,O=n.a.getLogger("esri.symbols.cim.CIMSymbolHelper");function S(e,t){switch(t.type){case"CIMSymbolReference":{const i={type:"point",x:0,y:0};e.drawSymbol(t.symbol,i);break}case"CIMPointSymbol":{const i={type:"point",x:0,y:0};e.drawSymbol(t,i);break}case"CIMTextSymbol":break;case"CIMVectorMarker":{const i=new o.a;e.drawMarker(t,i);break}}return e.envelope()}class w{static getEnvelope(e){const t=new g;if(Array.isArray(e)){let i;for(const n of e)i?i.union(S(t,n)):i=S(t,n);return i}return S(t,e)}static getTextureAnchor(e){const t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return[0,0,0];const i=96/72,n=(t.x+.5*t.width)*i,r=-(t.y+.5*t.height)*i,s=t.width*i+2,o=t.height*i+2;return[n/s,r/o,o]}static rasterize(e,t,i,n=!0){const r=i||this.getEnvelope(t);if(!r||r.width<=0||r.height<=0)return[null,0,0,0,0];const s=96/72,a=(r.x+.5*r.width)*s,l=(r.y+.5*r.height)*s;e.width=r.width*s,e.height=r.height*s,i||(e.width+=2,e.height+=2);const c=e.getContext("2d"),u=m.createScale(s,-s);u.translate(.5*e.width-a,.5*e.height+l);const h=new y(c,u);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};h.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new o.a;h.drawMarker(t,e);break}}const d=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(d.data);if(n){let e;for(let t=0;t<f.length;t+=4)e=f[t+3]/255,f[t]=f[t]*e,f[t+1]=f[t+1]*e,f[t+2]=f[t+2]*e}return[f,e.width,e.height,-a/e.width,-l/e.height]}static fromSimpleMarker(e){const t=50;let i,n;const r=e.style;if("circle"===r||"esriSMSCircle"===r){const e=.25;let r=Math.acos(1-e/t),s=Math.ceil(x/r/4);0===s&&(s=1),r=b/s,s*=4;const o=[];o.push([t,0]);for(let e=1;e<s;e++)o.push([t*Math.cos(e*r),-50*Math.sin(e*r)]);o.push([t,0]),i={rings:[o]},n={xmin:-50,ymin:-50,xmax:t,ymax:t}}else if("cross"===r||"esriSMSCross"===r){const e=0;i={rings:[[[e,t],[e,e],[t,e],[t,-e],[e,-e],[e,-50],[-e,-50],[-e,-e],[-50,-e],[-50,e],[-e,e],[-e,t],[e,t]]]},n={xmin:-50,ymin:-50,xmax:t,ymax:t}}else if("diamond"===r||"esriSMSDiamond"===r)i={rings:[[[-50,0],[0,t],[t,0],[0,-50],[-50,0]]]},n={xmin:-50,ymin:-50,xmax:t,ymax:t};else if("square"===r||"esriSMSSquare"===r)i={rings:[[[-50,-50],[-50,t],[t,t],[t,-50],[-50,-50]]]},n={xmin:-50,ymin:-50,xmax:t,ymax:t};else if("x"===r||"esriSMSX"===r){const e=0;i={rings:[[[0,e],[t-e,t],[t,t-e],[e,0],[t,e-t],[t-e,-50],[0,-e],[e-t,-50],[-50,e-t],[-e,0],[-50,t-e],[e-t,t],[0,e]]]},n={xmin:-50,ymin:-50,xmax:t,ymax:t}}else if("triangle"===r||"esriSMSTriangle"===r){const e=57.735026918962575,t=-e,r=2/3*100,s=r-100;i={rings:[[[t,s],[0,r],[e,s],[t,s]]]},n={xmin:t,ymin:s,xmax:e,ymax:r}}else"arrow"!==r&&"esriSMSArrow"!==r||(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-50,ymin:-50,xmax:t,ymax:t});let s;if(i&&n){const t=[{type:"CIMSolidFill",enable:!0,color:e.color}];e.outline&&t.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color});const r={type:"CIMPolygonSymbol",symbolLayers:t};s={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:n,markerGraphics:[{type:"CIMMarkerGraphic",geometry:i,symbol:r}]}]}}return s}static fromCIMHatchFill(e){const t=void 0!==e.separation?e.separation:4,i=t/2;let n=this._getLineSymbolPeriod(e.lineSymbol)||4;for(;n<4;)n*=2;const r=n/2;return{type:"CIMVectorMarker",frame:{xmin:-r,xmax:r,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-r,0],[r,0]]]},symbol:e.lineSymbol}],size:t}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers){const e=this._getEffectsRepeat(t.effects);if(e)return e;if(t){const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const i of e)t+=i;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:O.error("unsupported geometric effect type "+t.type)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const i of t)e+=i;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,i=t.stepX/2,n=t.stepY/2,r={xmin:-i,xmax:i,ymin:-n,ymax:n},s={type:e.type,...e};return s.markerPlacement=null,s.anchorPoint=null,{type:"CIMVectorMarker",frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[s]}}],size:t.stepY}}static getFillColor(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=w.getFillColor(t);if(null!=e)return e}break;case"CIMTextSymbol":return w.getFillColor(e.symbol);case"CIMSolidFill":return e.color}}static getStrokeColor(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=w.getStrokeColor(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return w.getStrokeColor(e.symbol);case"CIMSolidStroke":return e.color}}static getStrokeWidth(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=w.getStrokeWidth(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return w.getStrokeWidth(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}static getSize(e){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers){const e=w.getSize(i);e>t&&(t=e)}return t}case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return e.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return e.size}}static getMarkerScaleRatio(e){if(e)switch(e.type){case"CIMVectorMarker":if(!1!==e.scaleSymbolsProportionally&&e.frame){const t=e.frame.ymax-e.frame.ymin;return e.size/t}}return 1}}class T{static rasterizeSimpleFill(e,t,i){"solid"!==t&&"none"!==t&&"esriSFSSolid"!==t&&"esriSFSNull"!==t||console.error("Unexpected: style does not require rasterization");const n=Object(r.j)(Math.ceil(i)),s=16*n,o=2*n;e.width=s,e.height=s;const a=e.getContext("2d");a.strokeStyle="#FFFFFF",a.lineWidth=n,a.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(a.moveTo(s/2,-o),a.lineTo(s/2,s+o)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(a.moveTo(-o,s/2),a.lineTo(s+o,s/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(a.moveTo(-o,-o),a.lineTo(s+o,s+o),a.moveTo(s-o,-o),a.lineTo(s+o,o),a.moveTo(-o,s-o),a.lineTo(o,s+o)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(a.moveTo(s+o,-o),a.lineTo(-o,s+o),a.moveTo(o,-o),a.lineTo(-o,o),a.moveTo(s+o,s-o),a.lineTo(s-o,s+o)),a.stroke();const l=a.getImageData(0,0,e.width,e.height),c=new Uint8Array(l.data);let u;for(let e=0;e<c.length;e+=4)u=c[e+3]/255,c[e]=c[e]*u,c[e+1]=c[e+1]*u,c[e+2]=c[e+2]*u;return[c,e.width,e.height]}static rasterizeSimpleLine(e,t){let i;switch(t){case"butt":i="Butt";break;case"square":i="Square";break;default:i="Round"}const n="Butt"===i;let r;switch(e){case"dash":case"esriSLSDash":r=n?[4,3]:[3,4];break;case"dash-dot":case"esriSLSDashDot":r=n?[4,3,1,3]:[3,4,0,4];break;case"dot":case"esriSLSDot":r=n?[1,3]:[0,4];break;case"long-dash":case"esriSLSLongDash":r=n?[8,3]:[7,4];break;case"long-dash-dot":case"esriSLSLongDashDot":r=n?[8,3,1,3]:[7,4,0,4];break;case"long-dash-dot-dot":case"esriSLSDashDotDot":r=n?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case"short-dash":case"esriSLSShortDash":r=n?[4,1]:[3,2];break;case"short-dash-dot":case"esriSLSShortDashDot":r=n?[4,1,1,1]:[3,2,0,2];break;case"short-dash-dot-dot":case"esriSLSShortDashDotDot":r=n?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case"short-dot":case"esriSLSShortDot":r=n?[1,1]:[0,2];break;case"solid":case"esriSLSSolid":case"none":O.error("Unexpected: style does not require rasterization"),r=[0,0];break;default:O.error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),r=[0,0]}return this.rasterizeDash(r,i)}static rasterizeDash(e,t){const i="Butt"===t,n="Square"===t,r=!i&&!n;let s=0;for(const t of e)s+=t;const o=15*s,a=31*o,l=new Float32Array(a),c=r?225:15;for(let e=0;e<a;++e)l[e]=c;const u=7.5;let h=0,d=0,f=!0;for(const t of e){h=d,d+=15*t;let e=h;for(;e<d;){let t=0;for(;t<31;){const s=t*o+e,a=r?(t-15)*(t-15):Math.abs(t-15);l[s]=f?i?Math.max(Math.max(h+u-e,a),Math.max(e-d+u,a)):a:r?Math.min((e-h)*(e-h)+a,(e-d)*(e-d)+a):n?Math.min(Math.max(e-h,a),Math.max(d-e,a)):Math.min(Math.max(e-h+u,a),Math.max(d+u-e,a)),t++}e++}f=!f}const p=l.length,m=new Uint8Array(4*p);for(let e=0;e<p;++e){const t=(r?Math.sqrt(l[e]):l[e])/15;Object(v.a)(t,m,4*e)}return[m,o,31]}}class C{static findApplicableOverrides(e,t,i){if(t){if(e.primitiveName){let n=!1;for(const t of i)if(t.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const n of t)n.primitiveName===e.primitiveName&&i.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)C.findApplicableOverrides(n,t,i);if(e.symbolLayers)for(const n of e.symbolLayers)C.findApplicableOverrides(n,t,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)C.findApplicableOverrides(n,t,i);if(e.markerPlacement&&C.findApplicableOverrides(e.markerPlacement,t,i),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const n of e.markerGraphics)C.findApplicableOverrides(n,t,i),C.findApplicableOverrides(n.symbol,t,i)}else"CIMCharacterMarker"===e.type?C.findApplicableOverrides(e.symbol,t,i):"CIMHatchFill"===e.type&&C.findApplicableOverrides(e.lineSymbol,t,i)}}}static applyOverrides(e,t,i,n){if(t){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(r=s.propertyName)?r.charAt(0).toLowerCase()+r.substr(1):r;if(n&&n.push({cim:e,nocapPropertyName:t,value:e[t]}),s.expression&&(s.value=C.toValue(s.propertyName,s.expression)),i){let t=!1;for(const n of i)n.primitiveName===e.primitiveName&&(t=!0);t||i.push(s)}e[t]=s.value}var r;switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)C.applyOverrides(r,t,i,n);if(e.symbolLayers)for(const r of e.symbolLayers)C.applyOverrides(r,t,i,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const r of e.effects)C.applyOverrides(r,t,i,n);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)C.applyOverrides(r,t,i,n),C.applyOverrides(r.symbol,t,i,n)}}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const i of e)void 0!==i.value&&(t+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map(e=>Number(e));if("Color"===e){const e=new s.a(t).toRgba();return e[3]*=255,e}return t}}},470:function(e,t,i){"use strict";function n(){return new Float32Array(4)}function r(e,t,i,n){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function s(){return n()}function o(){return r(1,1,1,1)}function a(){return r(1,0,0,0)}function l(){return r(0,1,0,0)}function c(){return r(0,0,1,0)}function u(){return r(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));const h=s(),d=o(),f=a(),p=l(),m=c(),_=u();Object.freeze({__proto__:null,create:n,clone:function(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:r,createView:function(e,t){return new Float32Array(e,t,4)},zeros:s,ones:o,unitX:a,unitY:l,unitZ:c,unitW:u,ZEROS:h,ONES:d,UNIT_X:f,UNIT_Y:p,UNIT_Z:m,UNIT_W:_})},471:function(e,t,i){"use strict";function n(e,t,i){const n=e=>{let t=e.length;for(;t--;)if(-1===" /-,\n".indexOf(e.charAt(t)))return!1;return!0},s=[];let o=0,a=-1;do{if(a=t.indexOf("[",o),a>=o){if(a>o){const e=t.substr(o,a-o);s.push([e,null,n(e)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const i=e[t.substr(o,a-o)];i&&s.push([null,i,!1])}o=a+1}}}while(-1!==a);if(o<t.length-1){const e=t.substr(o);s.push([e,null,n(e)])}return e=>{let t="",n=null;for(const i of s){const[r,s,o]=i;if(r)o?n=r:(n&&(t+=n,n=null),t+=r);else{const i=e.attributes[s];i&&(n&&(t+=n,n=null),t+=i)}}return r(t,i)}}function r(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function s(e,t,i,n,r,s,o=!0){const a=t/r,l=i/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let i=0;i<s;i++)for(let h=0;h<r;h++){const d=4*(h+(o?s-i-1:i)*r);let f=0,p=0,m=0,_=0,g=0,y=0,v=0;const x=(i+.5)*l;for(let n=Math.floor(i*l);n<(i+1)*l;n++){const i=Math.abs(x-(n+.5))/u,r=(h+.5)*a,s=i*i;for(let i=Math.floor(h*a);i<(h+1)*a;i++){let o=Math.abs(r-(i+.5))/c;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(f=2*a*a*a-3*a*a+1,f>0&&(o=4*(i+n*t),v+=f*e[o+3],m+=f,e[o+3]<255&&(f=f*e[o+3]/250),_+=f*e[o],g+=f*e[o+1],y+=f*e[o+2],p+=f))}}n[d]=_/p,n[d+1]=g/p,n[d+2]=y/p,n[d+3]=v/m}}function o(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function a(e){var t;return null==(t=e.data)?void 0:t.symbol}function l(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function c(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function u(e){return"CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type}function h(e){return"CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return s})),i.d(t,"i",(function(){return a}))},472:function(e,t,i){"use strict";t.a=class{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},473:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(4),r=i(148),s=i(147),o=i(216),a=i(451);class l extends a.a{constructor(e,t,i,n=i){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:Object(o.b)(),tileMat3:Object(o.b)()},this.triangleCount=0,this.key=new s.a(e),this.bounds=t,this.size=i,this.coordRange=n}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,t){Object(n.a)("esri-2d-debug")&&null==t&&console.debug("Tried to set tile transform but lod resolution was null");const i=t/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[o,a]=e.toScreenNoRotation([0,0],this.coords),l=this.size[0]/this.coordRange[0]*i,c=this.size[1]/this.coordRange[1]*i;Object(r.j)(s,l,0,0,0,c,0,o,a,1),Object(r.g)(this.transforms.dvs,e.displayViewMat3,s)}}},474:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(5),r=i(14),s=i(397),o=i(398);const a=n.a.getLogger("esri.views.2d.engine.webgl");function l(e){return Object(o.n)(e.minDataValue)&&Object(o.n)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?s.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?s.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?s.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?s.e.SIZE_UNIT_VALUE:(a.error(new r.a("mapview-bad-type","Found invalid size VisualVariable",e)),s.e.NONE)}},476:function(e,t,i){"use strict";i.r(t);var n,r=i(0),s=(i(4),i(9),i(12)),o=i(73),a=i(8),l=i(5),c=(i(6),i(1)),u=i(2),h=i(14),d=(i(3),i(10),i(7)),f=i(65),p=(i(11),i(56)),m=i(301),_=i(144),g=i(35),y=i(265),v=i(424),x=i(533),b=i(519);const O=l.a.getLogger("esri.renderers.DictionaryRenderer");let S=n=class extends(Object(x.a)(v.a)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new b.a(100),this.config=null,this.description=null,this.fieldMap=null,this.label=null,this.scaleExpression=null,this.url=null,this.type="dictionary"}clone(){return new n({config:Object(s.a)(this.config),scaleExpression:Object(s.a)(this.scaleExpression),description:Object(s.a)(this.description),fieldMap:Object(s.a)(this.fieldMap),label:Object(s.a)(this.label),url:Object(s.a)(this.url),visualVariables:Object(s.a)(this.visualVariables)})}async getSymbolAsync(e,t){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{i=await this._dictionaryPromise}catch(e){if(Object(d.b)(e))return this._dictionaryPromise=null,null}const n={};for(const t of this._symbolAttributes){const i=this.fieldMap[t];if(i&&null!==e.attributes[i]&&void 0!==e.attributes[i]){const r=""+e.attributes[i];n[t]=r}else n[t]=""}const r=i(n,t);if(!r||"string"!=typeof r)return null;const s=Object(o.b)(r).toString(),a=this._symbolCache.get(s);if(a)return a.catch(()=>{this._symbolCache.pop(s)}),a;const l=r.split(";"),c=[],u=[];for(const e of l)if(e&&0!==e.length)if(-1===e.indexOf("po:"))if(-1!==e.indexOf("|"))for(const t of e.split("|"))this._itemNames.has(t)&&c.push(t);else this._itemNames.has(e)&&c.push(e);else{const t=e.substr(3).split("|");if(3===t.length){const e=t[0],i=t[1];let n=t[2];if("DashTemplate"===i)n=n.split(" ").map(e=>Number(e));else if("Color"===i){const e=new g.a(n).toRgba();n=[e[0],e[1],e[2],255*e[3]]}else n=Number(n);u.push({primitiveName:e,propertyName:i,value:n})}}const h=this._cimPartsToCIMSymbol(c,u,t);return this._symbolCache.put(s,h,1),h}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Object(_.a)(e,t,this.scaleExpression);const i=t.map(e=>e.name);for(const t in this.fieldMap)i.indexOf(this.fieldMap[t])<0||e.add(this.fieldMap[t])}get arcadeRequired(){return!0}async fetchResources(e){if(!this.url)return void O.error("no valid URL!");const t=Object(a.h)(e)?e.abortOptions:null,i=Object(f.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...t}),[{data:n}]=await Object(d.a)([i,Object(m.e)()]);if(!n)throw new h.a("esri.renderers.DictionaryRenderer","Bad dictionary data!");const r=n.expression,s=n.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+n.cimRefTemplateUrl,this._itemNames=Object(p.a)(n.itemsNames),this._symbolAttributes=s.symbol;const o={};if(this.config){const e=this.config;for(const t in e)o[t]=e[t]}for(const e of s.configuration)o.hasOwnProperty(e.name)||(o[e.name]=e.value);const l=[];if(Object(a.h)(e)&&e.fields)for(const t of this._symbolAttributes){const i=this.fieldMap[t],n=e.fields.filter(e=>e.name===i);n.length>0&&l.push({...n[0],name:t})}const c=await Object(m.b)(r,Object(a.h)(e)?e.spatialReference:null,l,o),u={scale:0};return(e,t)=>{const i=c.repurposeFeature({geometry:null,attributes:e});return u.scale=Object(a.h)(t)?t.scale:void 0,c.evaluate({$feature:i,$view:u})}}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(e=>e.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),n=Object(f.default)(i,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,n);try{return(await n).data}catch(t){return this._ongoingRequests.delete(e),Object(d.h)(t)}}_combineSymbolParts(e,t){if(!e||0===e.length)return null;if(1===e.length)return{type:"CIMSymbolReference",symbol:e[0],primitiveOverrides:t};const i={...e[0]};i.symbolLayers=[];for(const t of e){const e=t;i.symbolLayers.unshift(...e.symbolLayers)}return{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,i){const n=new Array(e.length);for(let t=0;t<e.length;t++)n[t]=this._getSymbolPart(e[t],i);const r=await Object(d.a)(n);return new y.a({data:this._combineSymbolParts(r,t)})}};Object(r.a)([Object(c.b)({type:Object,json:{write:!0}})],S.prototype,"config",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],S.prototype,"description",void 0),Object(r.a)([Object(c.b)({type:Object,json:{write:!0}})],S.prototype,"fieldMap",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],S.prototype,"label",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],S.prototype,"scaleExpression",void 0),Object(r.a)([Object(c.b)({type:String,json:{write:!0}})],S.prototype,"url",void 0),S=n=Object(r.a)([Object(u.a)("esri.renderers.DictionaryRenderer")],S);var w=S;t.default=w},477:function(e,t,i){"use strict";var n,r=i(0),s=(i(4),i(9),i(12)),o=(i(5),i(6),i(1)),a=i(19),l=i(2),c=(i(3),i(10),i(7)),u=(i(11),i(424)),h=i(533),d=i(591);let f=n=class extends(Object(h.a)(u.a)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Object(c.a)([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Object(c.a)(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new n({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Object(s.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],f.prototype,"description",void 0),Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],f.prototype,"label",void 0),Object(r.a)([Object(o.b)(d.b)],f.prototype,"symbol",void 0),Object(r.a)([Object(a.a)({simple:"simple"})],f.prototype,"type",void 0),f=n=Object(r.a)([Object(l.a)("esri.renderers.SimpleRenderer")],f);var p=f;t.a=p},479:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return u}));i(49),i(8);var n=i(104),r=i(219),s=i(223),o=i(190),a=i(525);s.a.fromJSON(a.a),n.a.fromJSON(a.c),r.a.fromJSON(a.b);const l=o.a.fromJSON(a.d);const c=s.a.fromJSON(a.e),u=n.a.fromJSON(a.g),h=r.a.fromJSON(a.f)},480:function(e,t,i){"use strict";var n=i(440),r=i(426),s=i(439);class o{constructor(e){this.insertAfter=null,this.id=e,this.displayRecords=[],this.metrics=[]}copy(){const e=new o(this.id);return e.set(this),e}clone(){const e=new o(this.id);return e.displayRecords=this.displayRecords.map(e=>e.clone()),e.metrics=this.metrics.map(e=>e.clone()),e.insertAfter=this.insertAfter,e}set(e){this.id=e.id,this.displayRecords=e.displayRecords,this.metrics=e.metrics,this.insertAfter=e.insertAfter}serialize(e){return e.push(this.id),Object(r.b)(e,this.metrics),Object(r.b)(e,this.displayRecords),e}static deserialize(e){const t=e.readInt32(),i=new o(t),a={id:t},l=Object(r.a)(e,s.a);return l.length&&(i.metrics=l),i.displayRecords=Object(r.a)(e,n.a,a),i}}t.a=o},482:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(59),r=(i(54),i(418)),s=i(413),o=i(515);let a=0;class l{constructor(e){this.type="FeatureSetReader",this.instance=0,this._tx=0,this._ty=0,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._joined=[],this.instance=e}static createInstance(){return a++,a=a>65535?0:a,a}get _hasFilter(){return-1!==this._xmin}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t){const i=this.copy();return i._tx=e,i._ty=t,i}extent(e,t,i,n){const r=this.copy();return r._xmin=e,r._xmax=i,r._ymin=t,r._ymax=n,r}hasFilter(){return this._hasFilter}readAttribute(e,t=!1){const i=this._readAttribute(e,t);if(void 0!==i)return i;for(const i of this._joined){i.setIndex(this.getIndex());const n=i._readAttribute(e,t);if(void 0!==n)return n}}readAttributes(){return this._readAttributes()}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=Object(s.k)(e,this.geometryType,this.hasZ,this.hasM),i=Object(n.a)(t);return i.spatialReference=this._arcadeSpatialReference,i}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=this.getQuantizationTransform();return Object(o.a)(new r.a,e,this.hasM,this.hasZ,t)}copyInto(e){e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._xmin=this._xmin,e._xmax=this._xmax,e._ymin=this._ymin,e._ymax=this._ymax}}},483:function(e,t,i){"use strict";var n=i(397),r=i(538),s=i(534),o=i(524);const a=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;t.a=class extends o.a{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(a),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)}}prepareRenderPasses(e){const t=e.registerRenderPass({name:"stencil",brushes:[s.a],drawPhase:n.c.DEBUG|n.c.MAP,target:()=>this.getStencilTarget()}),i=e.registerRenderPass({name:"tileInfo",brushes:[r.a],drawPhase:n.c.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(e),t,i]}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}},485:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h}));var n=i(424),r=i(475),s=i(484),o=i(476),a=i(486),l=i(487),c=i(477);const u={key:"type",base:n.a,typeMap:{heatmap:l.a,simple:c.a,"unique-value":s.a,"class-breaks":r.a,"dot-density":a.a,dictionary:o.default},errorContext:"renderer"},h={key:"type",base:n.a,typeMap:{simple:c.a,"unique-value":s.a,"class-breaks":r.a},errorContext:"renderer"}},486:function(e,t,i){"use strict";var n,r=i(0),s=(i(4),i(9),i(12)),o=i(5),a=i(6),l=i(1),c=i(25),u=i(19),h=i(2),d=(i(3),i(10),i(11),i(144)),f=i(35),p=i(104),m=i(219),_=i(424),g=i(533),y=i(38),v=i(15);const x=o.a.getLogger("esri.renderers.support.AttributeColorInfo");let b=n=class extends v.a{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(x.error(".field: field must be a string value"),null):Object(a.l)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new n({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};Object(r.a)([Object(l.b)({type:f.a,json:{type:[Number],write:!0}})],b.prototype,"color",void 0),Object(r.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"field",void 0),Object(r.a)([Object(y.a)("field")],b.prototype,"castField",null),Object(r.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"label",void 0),Object(r.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"valueExpression",void 0),Object(r.a)([Object(l.b)({type:String,json:{write:!0}})],b.prototype,"valueExpressionTitle",void 0),b=n=Object(r.a)([Object(h.a)("esri.renderers.support.AttributeColorInfo")],b);var O,S=b;let w=O=class extends v.a{constructor(){super(...arguments),this.unit=null}clone(){return new O({unit:this.unit})}};Object(r.a)([Object(l.b)({type:String,json:{write:!0}})],w.prototype,"unit",void 0),w=O=Object(r.a)([Object(h.a)("esri.renderers.support.DotDensityLegendOptions")],w);var T,C=w;let M=T=class extends(Object(g.a)(_.a)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new f.a([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new p.a,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new m.a({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new T({attributes:Object(s.a)(this.attributes),backgroundColor:Object(s.a)(this.backgroundColor),dotBlendingEnabled:Object(s.a)(this.dotBlendingEnabled),dotShape:Object(s.a)(this.dotShape),dotSize:Object(s.a)(this.dotSize),dotValue:Object(s.a)(this.dotValue),legendOptions:Object(s.a)(this.legendOptions),outline:Object(s.a)(this.outline),referenceScale:Object(s.a)(this.referenceScale),visualVariables:Object(s.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Object(d.a)(e,t,i.valueExpression),i.field&&e.add(i.field)}};Object(r.a)([Object(l.b)({type:[S],json:{write:!0}})],M.prototype,"attributes",void 0),Object(r.a)([Object(l.b)({type:f.a,json:{write:!0}})],M.prototype,"backgroundColor",void 0),Object(r.a)([Object(l.b)({type:Boolean}),Object(c.a)("dotBlendingEnabled")],M.prototype,"blendDots",void 0),Object(r.a)([Object(l.b)({type:Boolean,json:{write:!0}})],M.prototype,"dotBlendingEnabled",void 0),Object(r.a)([Object(l.b)({type:String,json:{write:!0}})],M.prototype,"dotShape",void 0),Object(r.a)([Object(l.b)({type:Number,json:{write:!0}})],M.prototype,"dotSize",void 0),Object(r.a)([Object(l.b)({type:C,json:{write:!0}})],M.prototype,"legendOptions",void 0),Object(r.a)([Object(l.b)({type:p.a,json:{default:null,write:!0}})],M.prototype,"outline",void 0),Object(r.a)([Object(l.b)({type:Number,json:{write:!0}})],M.prototype,"dotValue",void 0),Object(r.a)([Object(l.b)({type:Number}),Object(c.a)("dotValue")],M.prototype,"referenceDotValue",void 0),Object(r.a)([Object(l.b)({type:Number,json:{write:!0}})],M.prototype,"referenceScale",void 0),Object(r.a)([Object(l.b)({type:Number,json:{write:!0}})],M.prototype,"seed",void 0),Object(r.a)([Object(u.a)({dotDensity:"dot-density"})],M.prototype,"type",void 0),M=T=Object(r.a)([Object(h.a)("esri.renderers.DotDensityRenderer")],M);var I=M;t.a=I},487:function(e,t,i){"use strict";var n,r=i(0),s=(i(4),i(9),i(12)),o=(i(5),i(6),i(1)),a=i(19),l=i(2),c=(i(3),i(10),i(11),i(144)),u=i(35),h=i(424),d=i(15);let f=n=class extends d.a{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new n({color:this.color,ratio:this.ratio})}};Object(r.a)([Object(o.b)({type:u.a,json:{write:!0}})],f.prototype,"color",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],f.prototype,"ratio",void 0),f=n=Object(r.a)([Object(l.a)("esri.renderers.support.HeatmapColorStop")],f);var p,m=f;let _=p=class extends h.a{constructor(e){super(e),this.blurRadius=10,this.colorStops=[new m({ratio:0,color:new u.a("rgba(255, 140, 0, 0)")}),new m({ratio:.75,color:new u.a("rgba(255, 140, 0, 1)")}),new m({ratio:.9,color:new u.a("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}async collectRequiredFields(e,t){const i=this.field;i&&"string"==typeof i&&Object(c.d)(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new p({blurRadius:this.blurRadius,colorStops:Object(s.a)(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],_.prototype,"blurRadius",void 0),Object(r.a)([Object(o.b)({type:[m],json:{write:!0}})],_.prototype,"colorStops",void 0),Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],_.prototype,"field",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:null==i})}}})],_.prototype,"fieldOffset",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],_.prototype,"maxPixelIntensity",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],_.prototype,"minPixelIntensity",void 0),Object(r.a)([Object(a.a)({heatmap:"heatmap"})],_.prototype,"type",void 0),_=p=Object(r.a)([Object(l.a)("esri.renderers.HeatmapRenderer")],_);var g=_;t.a=g},488:function(e,t,i){"use strict";t.a=class{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},489:function(e,t,i){"use strict";var n=i(69),r=i(260);class s{constructor(e,t,i,n){this.center=Object(r.b)(e,t),this.centerT=Object(r.a)(),this.halfWidth=i/2,this.halfHeight=n/2,this.width=i,this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new s(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const i=Math.abs(e.centerT[0]-this.centerT[0]),r=Math.abs(e.centerT[1]-this.centerT[1]),s=(e.halfWidth+this.halfWidth+t)/i,o=(e.halfHeight+this.halfHeight+t)/r,a=Math.min(s,o);return Object(n.h)(a)}extend(e){const t=Math.min(this.xmin,e.xmin),i=Math.min(this.ymin,e.ymin),n=Math.max(this.xmax,e.xmax)-t,r=Math.max(this.ymax,e.ymax)-i,s=t+n/2,o=i+r/2;this.width=n,this.height=r,this.halfWidth=n/2,this.halfHeight=r/2,this.x=s,this.y=o}static deserialize(e){const t=e.readF32(),i=e.readF32(),n=e.readInt32(),r=e.readInt32();return new s(t,i,n,r)}}t.a=s},490:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(398);class r{constructor(e,t,i){this.data=e,this.stride=t,this.vertexCount=i}static decode(e){const t=Object(n.c)(e.data,e.stride),i=e.stride,s=e.vertexCount;return new r(t,i,s)}static fromVertexVector(e){const t=Object(n.c)(e.data.buffer(),e.stride),i=e.stride,s=e.vertexCount;return new r(t,i,s)}}class s{constructor(e,t,i){this.geometryType=e,this.indexBuffer=new Uint32Array(t),this.namedBuffers=i}static decode(e){const t=e.geometryType,i=e.indexBuffer,n={};for(const t in e.namedBuffers)n[t]=r.decode(e.namedBuffers[t]);return new s(t,i,n)}static fromVertexVectors(e){const t=e.geometryType,i=e.indexVector.buffer(),n={};for(const t in e.namedVectors)n[t]=r.fromVertexVector(e.namedVectors[t]);return new s(t,i,n)}}},491:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var n=i(26),r=i(72),s=i(298),o=i(260),a=i(420),l=i(402),c=i(488),u=i(489);const h=Math.PI/180;class d{constructor(e,t,i,n){this._rotationT=Object(s.a)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255;const r=i.rect,o=new Float32Array(8);e*=n,t*=n;const a=i.code?r.width*n:i.metrics.width,l=i.code?r.height*n:i.metrics.height;o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(r),this._scale=n,this._mosaic=i,this.x=e,this.y=t}get width(){return this._mosaic.metrics.width*this._scale}get mosaic(){return this._mosaic}set angle(e){this._angle=e,Object(r.d)(this._rotationT),Object(r.f)(this._rotationT,this._rotationT,-e),this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(this._data),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){const{height:e,width:t}=this._mosaic.metrics,i=t*this._scale,n=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+n,o[6]=this.x+i,o[7]=this.y+n;const a=Object(r.e)(Object(s.a)(),this._rotationT,this._T);Object(s.b)(o,o,a);let l=1/0,c=1/0,h=0,d=0;for(let e=0;e<4;e++){const t=o[2*e],i=o[2*e+1];l=Math.min(l,t),c=Math.min(c,i),h=Math.max(h,t),d=Math.max(d,i)}const f=h-l,p=d-c;return new u.a(l+f/2,c+p/2,f,p)}setTransform(e){this._T=e,this._offsets=null}_setOffsets(e){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const t=this._offsets,i=new Float32Array(8),n=Object(r.e)(Object(s.a)(),this._rotationT,this._T);Object(s.b)(i,e,n),t.upperLeft=Object(l.a)(8*i[0],8*i[1]),t.upperRight=Object(l.a)(8*i[2],8*i[3]),t.lowerLeft=Object(l.a)(8*i[4],8*i[5]),t.lowerRight=Object(l.a)(8*i[6],8*i[7])}_setTextureCoords({x:e,y:t,width:i,height:n}){this._texcoords={upperLeft:Object(l.a)(e,t),upperRight:Object(l.a)(e+i,t),lowerLeft:Object(l.a)(e,t+n),lowerRight:Object(l.a)(e+i,t+n)}}}const f=(e,t)=>({code:0,page:0,sdf:!0,rect:new c.a(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});class p{constructor(e,t,i){this._rotation=0,this._decorate(e,t,i),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==i.angle,this._T=this._createGlyphTransform(this.bounds,i);for(const t of e)t.setTransform(this._T)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const t=this._T,i=Object(r.b)(Object(s.a)(),e);Object(r.e)(t,i,t);for(const e of this.glyphs)e.setTransform(this._T)}_decorate(e,t,i){if(!i.decoration||"none"===i.decoration||!e.length)return;const n=i.scale,r="underline"===i.decoration?30:20,s=e[0].textureBinding;for(const i of t){const t=i.startX*n,o=i.startY*n,a=(i.width+i.glyphWidthEnd)*n;e.push(new d(t,o+r*n,f(a,s),1))}}get boundsT(){const e=this.bounds,t=Object(n.m)(Object(o.a)(),e.x,e.y);if(Object(n.n)(t,t,this._T),this._hasRotation){const i=Math.max(e.width,e.height);return new u.a(t[0],t[1],i,i)}return new u.a(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,i=1/0,n=0,r=0;for(const s of e)t=Math.min(t,s.xTopLeft),i=Math.min(i,s.yTopLeft),n=Math.max(n,s.xTopLeft+s.width),r=Math.max(r,s.yBottomRight);const s=n-t,o=r-i;return new u.a(t+s/2,i+o/2,s,o)}_createGlyphTransform(e,t){const i=h*t.angle,a=Object(s.a)(),l=Object(o.a)();return Object(r.h)(a,a,Object(n.m)(l,t.xOffset,-t.yOffset)),t.isCIM?Object(r.f)(a,a,i):(Object(r.h)(a,a,Object(n.m)(l,e.x,e.y)),Object(r.f)(a,a,i),Object(r.h)(a,a,Object(n.m)(l,-e.x,-e.y))),a}}class m{constructor(e,t,i,n,r,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,i)),this.end=Math.max(0,Math.max(t,i)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=n,this.yMin=r,this.yMax=s}}const _=e=>10===e,g=e=>32===e;function y(e,t,i){const n=i.scale,r=new Array,s=function(e,t,i){const n=new Array,r=1/i.scale,s=i.maxLineWidth*r,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,u=0,h=0,d=c,f=d,p=0,y=1/0,v=0;for(;c!==a;){const{code:t,metrics:i}=e[c],r=Math.abs(i.top);if(_(t)||g(t)||(y=Math.min(y,r),v=Math.max(v,r+i.height)),_(t))c!==o&&(n.push(new m(e,d,c-l,u,y,v)),y=1/0,v=0),u=0,d=c+l,f=c+l,h=0;else if(g(t))f=c+l,h=0,p=i.advance,u+=i.advance;else if(u>s){if(f!==d){const t=f-2*l;u-=p,n.push(new m(e,d,t,u-h,y,v)),y=1/0,v=0,d=f,u=h}else n.push(new m(e,d,c-l,u,y,v)),y=1/0,v=0,d=c,f=c,u=0;u+=i.advance,h+=i.advance}else u+=i.advance,h+=i.advance;c+=l}const x=new m(e,d,c-l,u,y,v);return x.start>=0&&x.end<e.length&&n.push(x),n}(e,t,i),o=function(e,t){let i=0;for(let t=0;t<e.length;t++){const{width:n}=e[t];i=Math.max(n,i)}const n="underline"===t.decoration?4:0,r=e[0].yMin;return{x:0,y:r,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+n-r,width:i}}(s,i),{vAlign:l,hAlign:c}=i,u=l===a.a.Baseline?1:0,h=u?0:l-1,f=(1-u)*-o.y+h*(o.height/2)+-26*(u?1:0);for(let t=0;t<s.length;t++){const{start:o,end:a,width:l}=s[t];let u=-1*(c+1)*(l/2)-3;const h=t*i.lineHeight+f-3;s[t].startX=u,s[t].startY=h;for(let t=o;t<=a;t++){const i=e[t];if(_(i.code))continue;const s=new d(u+i.metrics.left,h-i.metrics.top,i,n);u+=i.metrics.advance,r.push(s)}}return new p(r,s,i)}},492:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return a}));var n=i(396),r=i(448),s=i(530);class o{constructor(e,t,i){this.ratio=e,this.x=t,this.y=i}}class a{constructor(e,t,i,r=8,s=8){this.lines=[],this.starts=[],this.pixelRatio=r,this.pixelMargin=s,this.tileSize=n.F*r,this.dz=e,this.yPos=t,this.xPos=i}setExtent(e){this.finalRatio=this.tileSize/e*(1<<this.dz);let t=this.pixelRatio*this.pixelMargin;t/=this.finalRatio;const i=e>>this.dz;t>i&&(t=i),this.margin=t,this.xmin=i*this.xPos-t,this.ymin=i*this.yPos-t,this.xmax=this.xmin+i+2*t,this.ymax=this.ymin+i+2*t}reset(e){this.type=e,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new s.a(e,t),this._firstPt=new s.a(e,t),this._dist=0}lineTo(e,t){const i=this._isIn(e,t),n=new s.a(e,t),r=s.a.distance(this._prevPt,n);let a,l,c,u,h,d,f,p;if(i)this._prevIsIn?this._lineTo(e,t,!0):(a=this._prevPt,l=n,c=this._intersect(l,a),this.start=this._dist+r*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=n,c=this._intersect(l,a),this._lineTo(c.x,c.y,!0),this._lineTo(a.x,a.y,!1);else{const e=this._prevPt,t=n;if(e.x<=this.xmin&&t.x<=this.xmin||e.x>=this.xmax&&t.x>=this.xmax||e.y<=this.ymin&&t.y<=this.ymin||e.y>=this.ymax&&t.y>=this.ymax)this._lineTo(t.x,t.y,!1);else{const i=[];if((e.x<this.xmin&&t.x>this.xmin||e.x>this.xmin&&t.x<this.xmin)&&(u=(this.xmin-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this.ymin?d=!1:p>=this.ymax?d=!0:i.push(new o(u,this.xmin,p))),(e.x<this.xmax&&t.x>this.xmax||e.x>this.xmax&&t.x<this.xmax)&&(u=(this.xmax-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this.ymin?d=!1:p>=this.ymax?d=!0:i.push(new o(u,this.xmax,p))),(e.y<this.ymin&&t.y>this.ymin||e.y>this.ymin&&t.y<this.ymin)&&(u=(this.ymin-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this.xmin?h=!1:f>=this.xmax?h=!0:i.push(new o(u,f,this.ymin))),(e.y<this.ymax&&t.y>this.ymax||e.y>this.ymax&&t.y<this.ymax)&&(u=(this.ymax-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this.xmin?h=!1:f>=this.xmax?h=!0:i.push(new o(u,f,this.ymax))),0===i.length)h?d?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):d?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this.start=this._dist+r*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this.start=this._dist+r*i[0].ratio;for(let e=0;e<i.length;e++)this._lineTo(i[e].x,i[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=r,this._prevIsIn=i,this._prevPt=n}close(){if(this.line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const i=this.line;let n=i.length;for(;n>=4&&(i[0].x===i[1].x&&i[0].x===i[n-2].x||i[0].y===i[1].y&&i[0].y===i[n-2].y);)i.pop(),i[0].x=i[n-2].x,i[0].y=i[n-2].y,--n}}result(e=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&e&&c.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error("Only valid for lines");this._pushLine();const e=this.lines,t=e.length;if(0===t)return null;const i=[];for(let n=0;n<t;n++)i.push({line:e[n],start:this.starts[n]||0});return i}_isIn(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}_intersect(e,t){let i,n,r;if(t.x>=this.xmin&&t.x<=this.xmax)n=t.y<=this.ymin?this.ymin:this.ymax,r=(n-e.y)/(t.y-e.y),i=e.x+r*(t.x-e.x);else if(t.y>=this.ymin&&t.y<=this.ymax)i=t.x<=this.xmin?this.xmin:this.xmax,r=(i-e.x)/(t.x-e.x),n=e.y+r*(t.y-e.y);else{n=t.y<=this.ymin?this.ymin:this.ymax,i=t.x<=this.xmin?this.xmin:this.xmax;const s=(i-e.x)/(t.x-e.x),o=(n-e.y)/(t.y-e.y);s<o?(r=s,n=e.y+s*(t.y-e.y)):(r=o,i=e.x+o*(t.x-e.x))}return this._r=r,new s.a(i,n)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(e,t,i){3!==this.type?i&&(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new s.a(e,t))):(i||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new s.a(e,t)),this._is_h=!1,this._is_v=!1)}_lineTo(e,t,i){let n,r;if(3!==this.type)if(i){if(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(n=this.line[this.line.length-1],n.equals(e,t)))return;this.line.push(new s.a(e,t))}else this.line&&this.line.length>0&&this._pushLine();else if(i||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){n=this.line[this.line.length-1];const i=n.x===e,o=n.y===t;if(i&&o)return;this._is_h&&i||this._is_v&&o?(n.x=e,n.y=t,r=this.line[this.line.length-2],r.x===e&&r.y===t?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(r=this.line[this.line.length-2],this._is_h=r.x===e,this._is_v=r.y===t)):(this._is_h=r.x===e,this._is_v=r.y===t)):(this.line.push(new s.a(e,t)),this._is_h=i,this._is_v=o)}else this.line.push(new s.a(e,t))}}class l{setExtent(e){this._ratio=4096===e?1:4096/e}reset(e){this.type=e,this.lines=[],this.line=null}moveTo(e,t){this.line&&this.lines.push(this.line),this.line=[];const i=this._ratio;this.line.push(new s.a(Math.round(e*i),Math.round(t*i)))}lineTo(e,t){const i=this._ratio;this.line.push(new s.a(Math.round(e*i),Math.round(t*i)))}close(){const e=this.line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:(3===this.type&&1!==this._ratio&&c.simplify(4096,64,this.lines),this.lines)}}class c{static simplify(e,t,i){if(!i)return;const n=-t,r=e+t,s=-t,o=e+t,a=[],l=[],u=i.length;for(let e=0;e<u;++e){const t=i[e];if(!t||t.length<2)continue;let c,u=t[0];const h=t.length;for(let i=1;i<h;++i)c=t[i],u.x===c.x&&(u.x<=n&&(u.y>c.y?(a.push(e),a.push(i),a.push(0),a.push(-1)):(l.push(e),l.push(i),l.push(0),l.push(-1))),u.x>=r&&(u.y<c.y?(a.push(e),a.push(i),a.push(1),a.push(-1)):(l.push(e),l.push(i),l.push(1),l.push(-1)))),u.y===c.y&&(u.y<=s&&(u.x<c.x?(a.push(e),a.push(i),a.push(2),a.push(-1)):(l.push(e),l.push(i),l.push(2),l.push(-1))),u.y>=o&&(u.x>c.x?(a.push(e),a.push(i),a.push(3),a.push(-1)):(l.push(e),l.push(i),l.push(3),l.push(-1)))),u=c}if(0===a.length||0===l.length)return;c.fillParent(i,l,a),c.fillParent(i,a,l);const h=[];c.calcDeltas(h,l,a),c.calcDeltas(h,a,l),c.addDeltas(h,i)}static fillParent(e,t,i){const n=i.length,s=t.length;for(let o=0;o<s;o+=4){const s=t[o],a=t[o+1],l=t[o+2],c=e[s][a-1],u=e[s][a];let h=8092,d=-1;for(let t=0;t<n;t+=4){if(i[t+2]!==l)continue;const n=i[t],s=i[t+1],o=e[n][s-1],a=e[n][s];switch(l){case 0:case 1:if(Object(r.a)(c.y,o.y,a.y)&&Object(r.a)(u.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<h&&(h=e,d=t)}break;case 2:case 3:if(Object(r.a)(c.x,o.x,a.x)&&Object(r.a)(u.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<h&&(h=e,d=t)}}}t[o+3]=d}}static calcDeltas(e,t,i){const n=t.length;for(let r=0;r<n;r+=4){const n=[],s=c.calcDelta(r,t,i,n);e.push(t[r]),e.push(t[r+1]),e.push(t[r+2]),e.push(s)}}static calcDelta(e,t,i,n){const r=t[e+3];if(-1===r)return 0;const s=n.length;return s>1&&n[s-2]===r?0:(n.push(r),c.calcDelta(r,i,t,n)+1)}static addDeltas(e,t){const i=e.length;let n=0;for(let t=0;t<i;t+=4){const i=e[t+3];i>n&&(n=i)}for(let r=0;r<i;r+=4){const i=t[e[r]],s=e[r+1],o=n-e[r+3];switch(e[r+2]){case 0:i[s-1].x-=o,i[s].x-=o,1===s&&(i[i.length-1].x-=o),s===i.length-1&&(i[0].x-=o);break;case 1:i[s-1].x+=o,i[s].x+=o,1===s&&(i[i.length-1].x+=o),s===i.length-1&&(i[0].x+=o);break;case 2:i[s-1].y-=o,i[s].y-=o,1===s&&(i[i.length-1].y-=o),s===i.length-1&&(i[0].y-=o);break;case 3:i[s-1].y+=o,i[s].y+=o,1===s&&(i[i.length-1].y+=o),s===i.length-1&&(i[0].y+=o)}}}}},493:function(e,t,i){"use strict";function n(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}i.d(t,"a",(function(){return n}))},494:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const n=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),r=!1},495:function(e,t,i){"use strict";function n(){return[1,0,0,0,1,0,0,0,1]}function r(e,t){return new Float64Array(e,t,9)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,create:n,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,i,n,r,s,o,a,l){return[e,t,i,n,r,s,o,a,l]},createView:r})},496:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i(4),r=i(451),s=i(264),o=i(582),a=i(588);function l(e){switch(e){case"grayscale":case"sepia":case"invert":return new o.c(e,0);case"saturate":case"brightness":case"contrast":return new o.c(e,1);case"opacity":return new o.f(1);case"hue-rotate":return new o.e(0);case"radial-blur":case"blur":return new o.b(e,0);case"drop-shadow":return new o.d(0,0,0,[...Object(s.a)("transparent")]);case"bloom":return new o.a(0,0,0)}}const c=Object(n.a)("mapview-transitions-duration");class u extends r.a{constructor(){super(...arguments),this._childrenSet=new Set,this.children=[],this._effectList=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e)}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectList)?void 0:t.effect)?e:""}set effect(e){(this._effectList||e)&&(this._effectList||(this._effectList=new class{constructor(e=200){this.duration=e,this._from=null,this._to=null,this._toNumEffects=0,this._time=0,this._effects=[],this._effect=""}get effects(){return this._effects}get effect(){return this._effect}set effect(e){if(this._effect=e,e){const t=Object(a.a)(e);t.error?(this._from=this._to=null,this._toNumEffects=0,this._effects=[]):this._transitionTo(t.effects)}else this._transitionTo([])}get transitioning(){return null!==this._to}transitionStep(e){if(!this._to)return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let e=0;e<this._effects.length;e++){const i=this._effects[e],n=this._from[e],r=this._to[e];i.interpolate(n,r,t)}1===t&&(this._effects.length=this._toNumEffects,this._from=this._to=null,this._toNumEffects=0)}_transitionTo(e){const t=this._effects,i=t.length>e.length?t:e,n=t.length>e.length?e:t;if(n.every((e,t)=>e.type===i[t].type)){this._toNumEffects=e.length;for(let e=n.length;e<i.length;e++)n.push(l(i[e].type));this._from=t.map(e=>e.clone()),this._to=e,this._time=0}else this._from=this._to=null,this._toNumEffects=0,this._effects=e}}(c)),this._effectList.effect=e,this.requestRender())}updateTransitionProperties(e){super.updateTransitionProperties(e),this._effectList&&(this._effectList.transitionStep(e),this._effectList.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear();for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){let t;return e<0||e>=this.children.length?null:(t=this.children.splice(e,1)[0],this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t)}sortChildren(e){return this.children.sort(e)}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){const t=this.children,i=t.length;for(let n=0;n<i;n++)t[n].processRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}}},497:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i(440),r=i(426),s=i(439),o=i(480),a=class{constructor(e){this._pos=0,this._buffer=e,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}},l=i(443);class c{constructor(e,t){this.vertexVectorsMap=e,this._currentIndex=-1,this._currentRecordOffset=0,this._currentMetricOffset=0;const i=4*(4*t.features+1),n=4*(8*t.records+1),r=4*(20*t.metrics+1);this._bufDisplayObjects=new l.a(Uint32Array,i+4),this._bufDisplayRecords=new l.a(Uint32Array,n+4),this._bufMetrics=new l.a(Uint32Array,r+4),this._bufDisplayObjects.push(0),this._bufDisplayRecords.push(0),this._bufMetrics.push(0)}get vertexBuffersMap(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(let e=0;e<this.vertexVectorsMap.length;e++)this._vertexBuffersMap[e]=this.vertexVectorsMap[e].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap}get(e){return this.vertexVectorsMap[e]}currentDisplayRecordCount(){return this._bufDisplayRecords[this._currentRecordOffset]}writeDisplayObject(e,t){this._bufDisplayObjects.incr(0),this._currentIndex=this._bufDisplayObjects.push(e),this._bufDisplayObjects.push(t),this._bufDisplayObjects.push(0),this._bufDisplayObjects.push(0),this._currentRecordOffset=0,this._currentMetricOffset=0}hasDisplayRecords(){return!(0===this._currentRecordOffset)}endDisplayObject(){this.hasDisplayRecords()||this._rollbackDisplayObject()}writeDisplayRecord(e,t,i,n,r,s,o=0,a=0){0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset)),this._bufDisplayRecords.incr(this._currentRecordOffset),this._bufDisplayRecords.push(e),this._bufDisplayRecords.push(t),this._bufDisplayRecords.push(i),this._bufDisplayRecords.push(n),this._bufDisplayRecords.push(r),this._bufDisplayRecords.push(s),this._bufDisplayRecords.push(o),this._bufDisplayRecords.push(a)}writeMetrics(e){0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length),Object(r.b)(this._bufMetrics,e)}static deserializeDisplayObjects(e){const{bufDisplayObjects:t,bufMetrics:i,bufRecords:l}=e,c=new a(t),u=new a(l),h=new a(i),d=[];let f=c.readInt32();for(u.readInt32(),h.readInt32();f--;){const e=c.readInt32(),t=c.readInt32(),i=c.readInt32(),a=c.readInt32(),l=new o.a(e);0!==t&&(l.insertAfter=t),0!==i&&(l.displayRecords=Object(r.a)(u,n.a,{id:e})),0!==a&&(l.metrics=Object(r.a)(h,s.a)),d.push(l)}return d}encode(e,t){const i={};for(let e=0;e<this.vertexVectorsMap.length;e++){const n=this.vertexVectorsMap[e];i[e]={},n.transfer(i[e],t)}e.bufDisplayObjects=this._bufDisplayObjects.buffer(),e.bufRecords=this._bufDisplayRecords.buffer(),e.bufMetrics=this._bufMetrics.buffer(),t.push(e.bufDisplayObjects),t.push(e.bufMetrics),t.push(e.bufRecords),e.vertexBuffersMap=i,this.destroy()}destroy(){this.vertexVectorsMap=null,this._bufDisplayObjects=null,this._bufDisplayRecords=null,this._bufMetrics=null}_rollbackDisplayObject(){this._bufDisplayObjects.decr(0),this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4),this._currentIndex=this._bufDisplayObjects.length}}},499:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i(12);class n{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}}},500:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));const n=[1,256,65536,16777216],r=[1/256,1/65536,1/16777216,1/4294967296],s=function(e,t=0){let i=0;for(let n=0;n<4;n++)i+=e[t+n]*r[n];return i}(new Uint8ClampedArray([255,255,255,255]));function o(e,t,i=0){const r=function(e,t,i){return e<0?0:e>i?i:e}(e,0,s);for(let e=0;e<4;e++)t[i+e]=Math.floor(256*((o=r*n[e])-Math.floor(o)));var o}},501:function(e,t,i){"use strict";i.d(t,"a",(function(){return F})),i.d(t,"b",(function(){return x}));var n=i(73),r=i(5),s=i(7),o=i(301),a=i(35),l=i(23),c=i(471),u=i(502),h=i(467),d=i(543);const f=r.a.getLogger("esri.symbols.cim.cimAnalyzer");function p(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function m(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function _(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function g(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function y(e,t,i,n){let r;e[t]?r=e[t]:(r={},e[t]=r),r[i]=n}function v(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function x(e,t,i,n){const r=i||[];if(!e)return r;let a,l;const c={};if("CIMSymbolReference"!==e.type)return f.error("Expect cim type to be 'CIMSymbolReference'"),r;if(a=e.symbol,l=e.primitiveOverrides,l){const e=[];for(const i of l){const n=i.valueExpressionInfo;if(n&&t){const r=n.expression,s=Object(o.d)(r,t.spatialReference,t.fields).then(e=>{e&&y(c,i.primitiveName,i.propertyName,e)});e.push(s)}else null!=i.value&&y(c,i.primitiveName,i.propertyName,i.value)}await Object(s.a)(e)}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,i,n,r,s){if(!e)return;const o=e.symbolLayers;if(!o)return;let a;const l=h.a.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(a=1);let c=o.length;for(;c--;){const u=o[c];if(!u||!1===u.enable)continue;const d=[];switch(h.b.findApplicableOverrides(u,t,d),u.type){case"CIMSolidFill":b(u,i,d,n,r);break;case"CIMPictureFill":O(u,i,d,n,r);break;case"CIMHatchFill":S(u,i,d,n,r);break;case"CIMGradientFill":w(u,i,d,n,r);break;case"CIMSolidStroke":T(u,i,d,n,r,"CIMPolygonSymbol"===e.type,l);break;case"CIMPictureStroke":C(u,i,d,n,r,"CIMPolygonSymbol"===e.type,l);break;case"CIMGradientStroke":M(u,i,d,n,r,"CIMPolygonSymbol"===e.type,l);break;case"CIMCharacterMarker":if(I(u,i,d,n,r))break;break;case"CIMPictureMarker":if(I(u,i,d,n,r))break;"CIMLineSymbol"===e.type&&(a=v(u)),j(u,i,d,n,r,a,l);break;case"CIMVectorMarker":if(I(u,i,d,n,r))break;"CIMLineSymbol"===e.type&&(a=v(u)),E(u,i,d,n,r,a,l,s);break;default:f.error("Cannot analyze CIM layer",u.type)}}}(a,l,c,t,r,n)}return r}function b(e,t,i,r,s){const o=e.primitiveName,a=Object(c.c)(e.color),l=Object(n.b)(JSON.stringify(e)).toString();s.push({type:"fill",templateHash:l,materialHash:0===i.length?l:()=>l,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:V(o,t,"Color",r,a,A),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function O(e,t,i,r,s){const o=e.primitiveName,a=e.tintColor?Object(c.c)(e.tintColor):{r:255,g:255,b:255,a:1},l=Object(n.b)(JSON.stringify(e)).toString(),u=Object(n.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();s.push({type:"fill",templateHash:l,materialHash:0===i.length?u:()=>u,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:V(o,t,"TintColor",r,a,A),height:V(o,t,"Height",r,e.height),scaleX:V(o,t,"ScaleX",r,e.scaleX),angle:V(o,t,"Rotation",r,e.rotation),offsetX:V(o,t,"OffsetX",r,e.offsetX),offsetY:V(o,t,"OffsetY",r,e.offsetY)})}function S(e,t,i,r,s){const o=["Rotation","OffsetX","OffsetY"],a=i.filter(t=>t.primitiveName!==e.primitiveName&&-1===o.indexOf(t.propertyName)),l=e.primitiveName,c=Object(n.b)(JSON.stringify(e)).toString(),u=Object(n.b)(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();s.push({type:"fill",templateHash:c,materialHash:0===i.length?u:R(u,t,a,r),cim:e,materialOverrides:a,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:V(l,t,"Separation",r,e.separation),scaleX:1,angle:V(l,t,"Rotation",r,e.rotation),offsetX:V(l,t,"OffsetX",r,e.offsetX),offsetY:V(l,t,"OffsetY",r,e.offsetY)})}function w(e,t,i,r,s){const o=Object(n.b)(JSON.stringify(e)).toString();s.push({type:"fill",templateHash:o,materialHash:0===i.length?o:R(o,t,i,r),cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function T(e,t,i,r,s,o,a){const l=Object(n.b)(JSON.stringify(e)).toString(),u=e.primitiveName,h=Object(c.c)(e.color),d=void 0!==e.width?e.width:4,f=p(e.capStyle),_=m(e.joinStyle),g=e.miterLimit;s.push({type:"line",templateHash:l,materialHash:0===i.length?l:()=>l,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:V(u,t,"Color",r,h,A),width:V(u,t,"Width",r,d),cap:V(u,t,"CapStyle",r,f),join:V(u,t,"JoinStyle",r,_),miterLimit:V(u,t,"MiterLimit",r,g),referenceWidth:a,zOrder:z(e.name),isDashed:!1})}function C(e,t,i,r,s,o,a){const l=Object(n.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),u=e.primitiveName,h=Object(c.c)(e.tintColor),d=void 0!==e.width?e.width:4,f=p(e.capStyle),_=m(e.joinStyle),g=e.miterLimit,y=Object(n.b)(JSON.stringify(e)).toString();s.push({type:"line",templateHash:y,materialHash:0===i.length?l:()=>l,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:V(u,t,"TintColor",r,h,A),width:V(u,t,"Width",r,d),cap:V(u,t,"CapStyle",r,f),join:V(u,t,"JoinStyle",r,_),miterLimit:V(u,t,"MiterLimit",r,g),referenceWidth:a,zOrder:z(e.name),isDashed:!1})}function M(e,t,i,r,s,o,a){const l=e.primitiveName,c=void 0!==e.width?e.width:4,u=p(e.capStyle),h=m(e.joinStyle),d=e.miterLimit,f=Object(n.b)(JSON.stringify(e)).toString();s.push({type:"line",templateHash:f,materialHash:0===i.length?f:R(f,t,i,r),cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:V(l,t,"Width",r,c),cap:V(l,t,"CapStyle",r,u),join:V(l,t,"JoinStyle",r,h),miterLimit:V(l,t,"MiterLimit",r,d),referenceWidth:a,zOrder:z(e.name),isDashed:!1})}function I(e,t,i,r,s){const o=e.markerPlacement;if(!o||"CIMMarkerPlacementInsidePolygon"!==o.type)return!1;const a=o,l=["Rotation","OffsetX","OffsetY"],c=i.filter(t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName)),u=Object(n.b)(JSON.stringify(e)).toString();return s.push({type:"fill",templateHash:u,materialHash:0===i.length?u:R(u,t,c,r),cim:e,materialOverrides:c,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:V(a.primitiveName,t,"StepY",r,a.stepY),scaleX:1,angle:V(a.primitiveName,t,"GridAngle",r,a.gridAngle),offsetX:V(a.primitiveName,t,"OffsetX",r,a.offsetX),offsetY:V(a.primitiveName,t,"OffsetY",r,a.offsetY)}),!0}function j(e,t,i,r,s,o,a){const l=e.primitiveName,u=e.size,h=e.scaleX,d=e.rotation,f=e.offsetX,p=e.offsetY,m=Object(c.c)(e.tintColor),_=Object(n.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();let g=!1,y="";for(const e of i)e.primitiveName===l&&(void 0!==e.value?y+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(g=!0));s.push({type:"marker",templateHash:Object(n.b)(JSON.stringify(e)+y).toString(),materialHash:g?()=>_:_,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:o,size:V(l,t,"Size",r,u),scaleX:V(l,t,"ScaleX",r,h),rotation:V(l,t,"Rotation",r,d),offsetX:V(l,t,"OffsetX",r,f),offsetY:V(l,t,"OffsetY",r,p),color:V(l,t,"TintColor",r,m,A),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:a,sizeRatio:1,markerPlacement:e.markerPlacement})}function E(e,t,i,n,r,s,o,a){const l=e.markerGraphics;if(!l)return;let c=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(c=t.ymax-t.ymin)}for(const u of l)if(u){const l=u.symbol;if(!l)continue;switch(l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":D(e,u,i,t,n,r,s,o,c,a);break;case"CIMTextSymbol":P(e,u,t,i,n,r,s,o,c)}}}function P(e,t,i,r,s,o,a,l,u){h.b.findApplicableOverrides(t,r,[]);const d=t.geometry;if(!("x"in d)||!("y"in d))return;const f=t.symbol,p=(m=f).underline?"underline":m.strikethrough?"line-through":"none";var m;const y=function(e){let t="normal",i="normal";if(e){const n=e.toLowerCase();-1!==n.indexOf("italic")?t="italic":-1!==n.indexOf("oblique")&&(t="oblique"),-1!==n.indexOf("bold")?i="bold":-1!==n.indexOf("light")&&(i="lighter")}return{style:t,weight:i}}(f.fontStyleName);f.font={family:f.fontFamilyName,decoration:p,...y};const v=e.frame,x=d.x-.5*(v.xmin+v.xmax),b=d.y-.5*(v.ymin+v.ymax),O=e.size/u,S=e.primitiveName,w=(f.height||0)*O,T=f.angle||0,C=((f.offsetX||0)+x)*O,M=((f.offsetY||0)+b)*O,I=Object(c.c)(h.a.getFillColor(f));let j=Object(c.c)(h.a.getStrokeColor(f)),E=h.a.getStrokeWidth(f);E||(j=Object(c.c)(h.a.getFillColor(f.haloSymbol)),E=f.haloSize*O);let P="";for(const e of r)e.primitiveName===S&&void 0!==e.value&&(P+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const D=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),L=Object(n.b)(JSON.stringify(t)+D+P).toString();o.push({type:"text",templateHash:L,materialHash:()=>Object(n.b)(JSON.stringify(f.font)).toString(),cim:f,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:a,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:f.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:V(S,i,"Size",s,w),angle:V(S,i,"Rotation",s,T),offsetX:V(S,i,"OffsetX",s,C),offsetY:V(S,i,"OffsetY",s,M),horizontalAlignment:_(f.horizontalAlignment),verticalAlignment:g(f.verticalAlignment),text:V(t.primitiveName,i,"TextString",s,t.textString,c.a,f.textCase),color:I,outlineColor:j,outlineSize:E,referenceSize:l,sizeRatio:1,markerPlacement:e.markerPlacement})}function D(e,t,i,r,s,o,a,l,u,f){const p=t.symbol,m=t.geometry;if(!m)return;const _=p.symbolLayers;if(!_)return;if(f)return void L(e,t,r,i,s,o,a,l,u);let g=_.length;for(;g--;){const f=_[g];if(f&&!1!==f.enable)switch(f.type){case"CIMSolidFill":case"CIMSolidStroke":{const p=Object(d.b)(m);if(!p)continue;const[_,g,y]=Object(d.d)(p,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),v="CIMSolidFill"===f.type,x={type:"sdf",geom:m,asFill:v},b=e.primitiveName,O=e.size,S=e.rotation||0,w=e.offsetX,T=e.offsetY,C=f.primitiveName,M=Object(c.c)(v?h.a.getFillColor(f):h.a.getStrokeColor(f)),I=v?{r:0,g:0,b:0,a:0}:Object(c.c)(h.a.getStrokeColor(f)),j=h.a.getStrokeWidth(f);if(!v&&!j)break;let E=!1,P="";for(const e of i)e.primitiveName!==C&&e.primitiveName!==b||(void 0!==e.value?P+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(E=!0));const D=JSON.stringify({...e,markerGraphics:null}),L=Object(n.b)(JSON.stringify(x)).toString(),z={type:"marker",templateHash:Object(n.b)(JSON.stringify(t)+JSON.stringify(f)+D+P).toString(),materialHash:E?()=>L:L,cim:x,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:g,y:y},isAbsoluteAnchorPoint:!1,size:V(e.primitiveName,r,"Size",s,O),rotation:V(e.primitiveName,r,"Rotation",s,S),offsetX:V(e.primitiveName,r,"OffsetX",s,w),offsetY:V(e.primitiveName,r,"OffsetY",s,T),scaleX:1,frameHeight:u,rotateClockwise:e.rotateClockwise,referenceSize:l,sizeRatio:_,color:V(C,r,"Color",s,M,A),outlineColor:V(C,r,"Color",s,I,A),outlineWidth:V(C,r,"Width",s,j),markerPlacement:e.markerPlacement};o.push(z);break}default:L(e,t,r,i,s,o,a,l,u)}}}function L(e,t,i,r,s,o,a,c,u){const d=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,t);let f=[];const p=["Rotation","OffsetX","OffsetY"];f=r.filter(t=>t.primitiveName!==e.primitiveName||-1===p.indexOf(t.propertyName));let m="";for(const e of r)void 0!==e.value&&(m+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const[_,g,y]=h.a.getTextureAnchor(d),v=e.primitiveName,x=e.rotation||0,b=e.offsetX||0,O=e.offsetY||0,S=Object(n.b)(JSON.stringify(d)+m).toString(),w={type:"marker",templateHash:S,materialHash:0===f.length?S:R(S,i,f,s),cim:d,materialOverrides:f,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:_,y:g},isAbsoluteAnchorPoint:!1,size:e.size,rotation:V(v,i,"Rotation",s,x),offsetX:V(v,i,"OffsetX",s,b),offsetY:V(v,i,"OffsetY",s,O),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:u,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:y/Object(l.h)(e.size),markerPlacement:e.markerPlacement};o.push(w)}function z(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function A(e){if(!e||0===e.length)return null;const t=new a.a(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function V(e,t,i,n,r,s,a){const l=t[e];if(l){const e=l[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return s?s.call(null,e,a):e;if(null!=e&&e instanceof o.a)return(t,i,o)=>{let l=Object(u.a)(e,t,{$view:o},n.geometryType,i);return null!==l&&s&&(l=s.call(null,l,a)),null!==l?l:r}}return r}function R(e,t,i,r){for(const e of i)if(e.valueExpressionInfo){const i=t[e.primitiveName]&&t[e.primitiveName][e.propertyName];i instanceof o.a&&(e.fn=(e,t,n)=>Object(u.a)(i,e,{$view:n},r.geometryType,t))}return(t,r,s)=>{for(const e of i)e.fn&&(e.value=e.fn(t,r,s));return Object(n.b)(e+h.b.buildOverrideKey(i)).toString()}}function F(e,t){if(!t||0===t.length)return e;const i=JSON.parse(JSON.stringify(e));return h.b.applyOverrides(i,t),i}},502:function(e,t,i){"use strict";var n=i(5),r=i(14),s=i(463);const o=new Map;t.a=function(e,t,i,a,l){const c=e.referencesGeometry()&&l?function(e,t,i){const{transform:a,hasZ:l,hasM:c}=i;o.has(t)||o.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,n,r)=>Object(s.e)(i,t,e,n,r);case"esriGeometryPolygon":return(e,i,n,r)=>Object(s.f)(i,t,e,n,r);case"esriGeometryPolyline":return(e,i,n,r)=>Object(s.g)(i,t,e,n,r);case"esriGeometryMultipoint":return(e,i,n,r)=>Object(s.d)(i,t,e,n,r);default:return n.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.a("mapview-arcade","Unable to handle geometryType: "+e)),e=>e}}(t));const u=o.get(t)(e.geometry,a,l,c);return{...e,geometry:u}}(t,a,l):t,u=e.repurposeFeature(c);try{return e.evaluate({...i,$feature:u})}catch(e){return n.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}},505:function(e,t,i){"use strict";var n=i(23),r=i(420),s=i(441),o=i(399),a=i(410),l=i(506),c=i(422);class u extends(Object(l.a)(c.a)){constructor(e,t,i,s,a,l,c,u,h,d,f,p,m,_,g,y,v,x=!1){super(),this._xOffset=Object(n.h)(p),this._yOffset=Object(n.h)(m),this._decoration=h||"none",this._color=s,this._haloColor=a,this._haloSize=Math.min(Math.floor(5*Object(n.h)(Object(n.j)(i))),127),this._size=Math.min(Math.round(Object(n.h)(t)),127);const b=Math.min(Math.round(Object(n.h)(t)),127);this._referenceSize=Math.round(Math.sqrt(256*b)),this._scale=this._size/24,this._angle=f,this._justify=Object(r.c)(l||"center"),this._xAlignD=Object(r.d)(l||"center"),this._yAlignD=Object(r.f)(c||"baseline"),this._baseline="baseline"===(c||"baseline"),this._bitset=(1===u?1:0)|(d?1:0)<<1;const O=o.e.load(e);O.sdf=!0,this._materialKey=O.data,this._lineWidth=Object(n.h)(_)||512,this._lineHeight=g||1,this._textPlacement=y,this.effects=v,this._isCIM=x}static fromText(e,t){const i=new u(e.materialKey,e.font.size,e.haloSize||0,e.color&&Object(a.d)(e.color)||0,e.haloColor&&Object(a.d)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1),[,n]=Object(s.a)(e.text);return i.bindTextInfo(t,n),i}static fromCIMText(e,t){const i=e.scaleFactor||1,n=new u(e.materialKey,e.size*e.sizeRatio*i,e.outlineSize*e.sizeRatio,Object(a.c)(e.color),Object(a.c)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*i,e.offsetY*e.sizeRatio*i,512,1,e.markerPlacement,e.effects,!0),[,r]=Object(s.a)(e.text);return n.bindTextInfo(t,r),n}}t.a=u},506:function(e,t,i){"use strict";var n=i(8),r=i(23),s=i(413),o=i(396),a=i(402),l=i(491),c=i(397),u=i(399),h=i(507);t.a=e=>class extends e{constructor(...e){super(...e),this._isCIM=!1,this.geometryType=c.d.TEXT,this._aux=Object(a.b)(0,0,this._referenceSize,this._bitset)}bindTextInfo(e,t){e&&e.length?this._shapingInfo=Object(n.a)(e,e=>Object(l.a)(e,t,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:o.n*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):this._shapingInfo=null}writeMeshWithGeometry(e,t,i,r,o,a){if(Object(n.h)(this._textPlacement)){const n=null!=a?a:i.readLegacyGeometry();return this._writePlacedText(e,t,o,n)}const l=a?Object(s.p)(Object(s.d)(a),2):"esriGeometryPolygon"===r?i.readCentroid():i.readUnquantizedGeometry();if(l){if(l.isPoint){const[i,n]=l.coords;return this._writeGlyphs(e,t,o,{x:i,y:n})}l.forEachVertex((i,n)=>this._writeGlyphs(e,t,o,{x:i,y:n}))}}_writePlacedText(e,t,i,s){const o=this._shapingInfo;if(Object(n.g)(o))return;const l=u.e.load(this._materialKey),c=Object(n.m)(this._textPlacement),d=h.a.getPlacement(s,c,Object(r.h)(1));if(!d)return;let f,p,m=d.next();for(;null!=m;){p=Object(a.a)(Math.round(8*m.tx),Math.round(8*m.ty)),f=m.getAngle(),o.setRotation(f);for(const n of o.glyphs){l.textureBinding=n.textureBinding;const r=t.getVector("geometry").vertexCount,s=t.indexVector.length,o=this._writeIndices(t),a=this._writeVertex(t,i,p,n);e.writeDisplayRecord(this.geometryType,l.data,r,a,s,o)}o.setRotation(-f),m=d.next()}}_writeGlyphs(e,t,i,r){const s=this._shapingInfo;if(Object(n.g)(s))return;const o=u.e.load(this._materialKey),l=Object(a.a)(Math.round(8*r.x),Math.round(8*r.y));for(const n of s.glyphs){o.textureBinding=n.textureBinding;const r=t.getVector("geometry").vertexCount,s=t.indexVector.length,a=this._writeIndices(t),c=this._writeVertex(t,i,l,n);e.writeDisplayRecord(this.geometryType,o.data,r,c,s,a)}}_writeVertexCommon(e,t,i,n){const r=this._color,s=this._haloColor,o=Object(a.b)(0,0,this._referenceSize,this._bitset),l=Object(a.b)(0,0,this._size,this._haloSize);e.push(i),e.push(t),e.push(r),e.push(s),e.push(l),e.push(o)}_writeVertex(e,t,i,n){const r=e.get("geometry");return this._writeVertexCommon(r,t,i,n),r.push(n.offsets.upperLeft),r.push(n.texcoords.upperLeft),this._writeVertexCommon(r,t,i,n),r.push(n.offsets.upperRight),r.push(n.texcoords.upperRight),this._writeVertexCommon(r,t,i,n),r.push(n.offsets.lowerLeft),r.push(n.texcoords.lowerLeft),this._writeVertexCommon(r,t,i,n),r.push(n.offsets.lowerRight),r.push(n.texcoords.lowerRight),4}_writeIndices(e){const t=e.getVector("geometry").vertexCount,i=e.indexVector;return i.push(t+0),i.push(t+1),i.push(t+2),i.push(t+1),i.push(t+3),i.push(t+2),6}}},507:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(401),r=i(453);class s{static getPlacement(e,t,i){const s=Object(r.b)(t);if(!s)return null;const o=Object(n.c)(e);return s.execute(o,t,i)}}},508:function(e,t,i){"use strict";var n=i(8),r=i(23),s=i(396),o=i(298),a=i(260),l=i(402),c=i(399),u=i(410),h=i(422),d=i(509);class f extends(Object(d.a)(h.a)){constructor(e,t,i,n,r,u,h,d,f,p,m,_,g,y,v,x,b,O,S,w,T){super(),this.angle=n,this.height=h,this.width=u,this.xOffset=t*S,this.yOffset=i*S,this._markerPlacement=w,this.effects=T,this._anchorX=.5-(.5+x)*v.width/v.width,this._anchorY=.5-(.5+b)*v.height/v.height;const C=(1===y?1:0)|(m?1:0)<<1|(g?1:0)<<2|(_?1:0)<<3,M=v&&v.sdf,I=c.d.load(e);I.sdf=M,I.pattern=!0,I.textureBinding=v.textureBinding,this._materialKey=I.data,this._fillColor=r,this._outlineColor=f,this._sizeOutlineWidth=Object(l.b)(Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*h),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*d),255)));const j=v.rect.x+s.r,E=v.rect.y+s.r,P=j+v.width,D=E+v.height;this._texUpperLeft=Object(l.a)(j,E),this._texUpperRight=Object(l.a)(P,E),this._texBottomLeft=Object(l.a)(j,D),this._texBottomRight=Object(l.a)(P,D),u*=O,h*=O,u*=S,h*=S;const L=Math.round(Math.min(64*O,255));this._bitestAndDistRatio=Object(l.b)(0,0,C,L),this._computedWidth=u,this._computedHeight=h;const z=Object(a.a)(),A=Object(o.a)();this._applyTransformation(A,z)}static fromCIMMarker(e,t){const i=t&&t.width||1,s=t&&t.height||1,o=e.size,a=i/s*e.scaleX,l=e.scaleSymbolsProportionally&&e.frameHeight?o/e.frameHeight:1,c=Object(u.c)(e.color),h=Object(u.c)(e.outlineColor),d=Object(r.h)(o),p=d*a,m=Object(r.h)(e.offsetX||0),_=Object(r.h)(e.offsetY||0),g=Object(r.h)(e.outlineWidth||0)*l,y=e.alignment||0,v=Object(r.h)(e.referenceSize);let x=e.rotation||0;e.rotateClockwise||(x=-x);let b=0,O=0;const S=e.anchorPoint;return S&&(e.isAbsoluteAnchorPoint?o&&(b=-S.x/(o*a),O=S.y/o):(b=S.x,O=S.y)),new f(e.materialKey,m,_,x,c,p,d,v,h,g,e.colorLocked,e.scaleSymbolsProportionally,!1,y,t,b,O,e.sizeRatio,Object(n.n)(e.scaleFactor,1),e.markerPlacement,e.effects)}static fromPictureMarker(e,t){const i=Math.round(Object(r.h)(e.width)),n=Math.round(Object(r.h)(e.height)),o=s.q,a=Math.round(Object(r.h)(e.xoffset||0)),l=Math.round(Object(r.h)(e.yoffset||0));return new f(e.materialKey,a,l,e.angle,o,i,n,n,0,0,!1,!1,!1,0,t,0,0,1,1,null,null)}static fromSimpleMarker(e,t){const i=Object(u.d)(e.color),n=Math.round(Object(r.h)(e.size)),s=n,o=Math.round(Object(r.h)(e.xoffset||0)),a=Math.round(Object(r.h)(e.yoffset||0)),l=e.style,c=e.outline,h=0|(c&&c.color&&Object(u.d)(c.color)),d=0|(c&&c.width&&Math.round(Object(r.h)(c.width))),p=new f(e.materialKey,o,a,e.angle,i,n,s,s,h,d,!1,!1,"esriSMSCross"===l||"esriSMSX"===l,0,t,0,0,126/64,1,null,null);return p.boundsType="esriSMSCircle"===l?"circle":"square",p}static fromLineSymbolMarker(e,t){const i=Object(u.d)(e.color),n=Math.round(Object(r.h)(6*e.lineWidth)),s=n,o="cross"===e.style||"x"===e.style;let a;switch(e.placement){case"begin-end":a="Both";break;case"begin":a="JustBegin";break;case"end":a="JustEnd";break;default:a="None"}const l={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:a,offsetAlongLine:0},c=new f(e.materialKey,0,0,0,i,n,s,s/6,i,o?Math.round(Object(r.h)(e.lineWidth)):0,!1,!1,o,1,t,0,0,126/64,1,l,null);return c.boundsType="circle"===e.style?"circle":"square",c}}t.a=f},509:function(e,t,i){"use strict";var n=i(8),r=i(23),s=i(413),o=i(26),a=i(72),l=i(298),c=i(260),u=i(402),h=i(397),d=i(507);t.a=e=>class extends e{constructor(...e){super(...e),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this.geometryType=h.d.MARKER}writeMeshWithGeometry(e,t,i,r,o,a){const l=t.indexVector,c=t.get("geometry"),u=t.getVector("geometry"),h=u.vertexCount,d=h,f=l.length;if(Object(n.h)(this._markerPlacement)){const e=null!=a?a:i.readLegacyGeometry();this._writePlacedMarkers(c,l,h,o,e)}else{const e=a?Object(s.p)(Object(s.d)(a),2):"esriGeometryPolygon"===r?i.readCentroid():i.readUnquantizedGeometry();if(!e)return;if(e.isPoint){const[t,i]=e.coords;this._writeVertices(c,o,this._getPos(t,i)),this._writeIndices(l,h)}else e.forEachVertex((e,t)=>{const i=u.vertexCount;this._writeVertices(c,o,this._getPos(e,t)),this._writeIndices(l,i)})}const p=t.getVector("geometry").vertexCount-d,m=l.length-f;e.writeDisplayRecord(this.geometryType,this._materialKey,d,p,f,m)}_applyTransformation(e,t,i=0){Object(a.d)(e),Object(a.h)(e,e,Object(c.b)(this.xOffset,-this.yOffset)),this.angle+i!==0&&Object(a.f)(e,e,.017453292519944444*(this.angle+i));const n=this._computedWidth,r=this._computedHeight,s=(this._anchorX-.5)*n,l=(this._anchorY-.5)*r;Object(o.m)(t,s,l),Object(o.n)(t,t,e),this._offsetUpperLeft=Object(u.a)(16*t[0],16*t[1]),Object(o.m)(t,s+n,l),Object(o.n)(t,t,e),this._offsetUpperRight=Object(u.a)(16*t[0],16*t[1]),Object(o.m)(t,s,l+r),Object(o.n)(t,t,e),this._offsetBottomLeft=Object(u.a)(16*t[0],16*t[1]),Object(o.m)(t,s+n,l+r),Object(o.n)(t,t,e),this._offsetBottomRight=Object(u.a)(16*t[0],16*t[1])}_writePlacedMarkers(e,t,i,s,o){const a=d.a.getPlacement(o,Object(n.m)(this._markerPlacement),Object(r.h)(1));if(!a)return;const u=Object(c.a)(),h=Object(l.a)();let f=0,p=a.next();for(;null!=p;)p.tx>=-128&&p.tx<=640&&p.ty>=-128&&p.ty<=640&&(this._applyTransformation(h,u,p.getAngle()/.017453292519944444),this._writeVertices(e,s,this._getPos(p.tx,p.ty)),this._writeIndices(t,i+f),f+=4),p=a.next()}_getPos(e,t){return Object(u.a)(Math.round(8*e),Math.round(8*t))}_writeVertices(e,t,i){e.push(i),e.push(this._offsetUpperLeft),e.push(this._texUpperLeft),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth),e.push(i),e.push(this._offsetUpperRight),e.push(this._texUpperRight),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth),e.push(i),e.push(this._offsetBottomLeft),e.push(this._texBottomLeft),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth),e.push(i),e.push(this._offsetBottomRight),e.push(this._texBottomRight),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth)}_writeIndices(e,t){const i=t;e.push(i+0),e.push(i+1),e.push(i+2),e.push(i+1),e.push(i+3),e.push(i+2)}}},510:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return c}));var n=i(49),r=i(52),s=i(113),o=i(149),a=i(14),l=i(485);function c(e,t,i,s){const o=function(e,t){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;case"heatmap":case"dictionary":case"dot-density":return!1;default:return Object(n.a)(e),!1}}(e,t)?e.write({},t):(t.messages&&t.messages.push(new a.a("renderer:unsupported",`Renderer of type '${e.declaredClass}' are not supported in scenes.`,{renderer:e,context:t})),null):null}(e,s);o&&Object(r.c)(i,o,t)}function u(e,t){return d(e,null,t)}const h=Object(o.b)({types:l.a});function d(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(i&&i.messages&&i.messages.push(new s.a("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):h(e,t,i):null}},512:function(e,t,i){"use strict";i.d(t,"a",(function(){return We})),i.d(t,"b",(function(){return qe}));var n=i(5),r=i(14),s=i(7),o=i(479),a=i(430),l=i(450),c=i(505),u=i(508),h=i(69),d=i(23),f=i(396),p=i(402),m=i(399),_=i(410),g=i(448),y=i(415),v=i(413),x=i(397),b=i(418),O=(i(545),i(492));function S(e,t,i,n,r,s,o){W=0;const a=(n-i)*s,l=r&&r.length,c=l?(r[0]-i)*s:a;let u,h,d,f,p,m=w(t,i,n,0,c,s,!0);if(m&&m.next!==m.prev){if(l&&(m=function(e,t,i,n,r,s){const o=new Array;for(let r=0,a=n.length;r<a;r++){const l=w(e,t,i,n[r]*s,r<a-1?n[r+1]*s:i*s,s,!1);l===l.next&&(l.steiner=!0),o.push(P(l))}o.sort(N);for(const e of o)D(e,r),r=T(r,r.next);return r}(t,i,n,r,m,s)),a>80*s){u=d=t[0+i*s],h=f=t[1+i*s];for(let e=s;e<c;e+=s){const n=t[e+i*s],r=t[e+1+i*s];u=Math.min(u,n),h=Math.min(h,r),d=Math.max(d,n),f=Math.max(f,r)}p=Math.max(d-u,f-h),p=0!==p?1/p:0}C(m,e,s,u,h,p,o,0)}}function w(e,t,i,n,r,s,o){let a;if(o===function(e,t,i,n,r,s){let o=0;for(let i=n,a=r-s;i<r;i+=s)o+=(e[a+t*s]-e[i+t*s])*(e[i+1+t*s]+e[a+1+t*s]),a=i;return o}(e,t,0,n,r,s)>0)for(let i=n;i<r;i+=s)a=j(i+t*s,e[i+t*s],e[i+1+t*s],a);else for(let i=r-s;i>=n;i-=s)a=j(i+t*s,e[i+t*s],e[i+1+t*s],a);return a&&F(a,a.next)&&(E(a),a=a.next),a}function T(e,t=e){if(!e)return e;let i,n=e;do{if(i=!1,n.steiner||!F(n,n.next)&&0!==L(n.prev,n,n.next))n=n.next;else{if(E(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function C(e,t,i,n,r,s,o,a){if(!e)return;!a&&s&&(e=function e(t,i,n,r){for(let s;s!==t;s=s.next){if(s=s||t,null===s.z&&(s.z=R(s.x,s.y,i,n,r)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,e(t,i,n,r);s.prevZ=s.prev,s.nextZ=s.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){let t,i=1;for(;;){let n,r=e;e=null,t=null;let s=0;for(;r;){s++,n=r;let o=0;for(;o<i&&n;o++)n=n.nextZ;let a=i;for(;o>0||a>0&&n;){let i;0===o?(i=n,n=n.nextZ,a--):0!==a&&n?r.z<=n.z?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,o--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}r=n}if(t.nextZ=null,i*=2,s<2)return e}}(t)}(e,n,r,s));let l=e;for(;e.prev!==e.next;){const c=e.prev,u=e.next;if(s?I(e,n,r,s):M(e))t.push(c.index/i+o),t.push(e.index/i+o),t.push(u.index/i+o),E(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?C(e=k(e,t,i,o),t,i,n,r,s,o,2):2===a&&U(e,t,i,n,r,s,o):C(T(e),t,i,n,r,s,o,1);break}}}function M(e){const t=e.prev,i=e,n=e.next;if(L(t,i,n)>=0)return!1;let r=e.next.next;const s=r;let o=0;for(;r!==e.prev&&(0===o||r!==s);){if(o++,A(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&L(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function I(e,t,i,n){const r=e.prev,s=e,o=e.next;if(L(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=R(a,l,t,i,n),d=R(c,u,t,i,n);let f=e.prevZ,p=e.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&A(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&L(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&A(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&L(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&A(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&L(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&A(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&L(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function j(e,t,i,n){const r=H.create(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function D(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===o)return s.prev;const a=s,l=s.x,c=s.y;let u,h=1/0;for(i=s.next;i!==a;)n>=i.x&&i.x>=l&&n!==i.x&&A(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),(u<h||u===h&&i.x>s.x)&&V(i,e)&&(s=i,h=u)),i=i.next;return s}(e,t)){const i=B(t,e);T(i,i.next)}}function L(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function z(e,t,i,n){return!!(F(e,t)&&F(i,n)||F(e,n)&&F(i,t))||L(e,t,i)>0!=L(e,t,n)>0&&L(i,n,e)>0!=L(i,n,t)>0}function A(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function V(e,t){return L(e.prev,e,e.next)<0?L(e,t,e.next)>=0&&L(e,e.prev,t)>=0:L(e,t,e.prev)<0||L(e,e.next,t)<0}function R(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function F(e,t){return e.x===t.x&&e.y===t.y}function N(e,t){return e.x-t.x}function k(e,t,i,n){let r=e;do{const s=r.prev,o=r.next.next;!F(s,o)&&z(s,r,r.next,o)&&V(s,o)&&V(o,s)&&(t.push(s.index/i+n),t.push(r.index/i+n),t.push(o.index/i+n),E(r),E(r.next),r=e=o),r=r.next}while(r!==e);return r}function U(e,t,i,n,r,s,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.index!==e.index&&G(a,e)){let l=B(a,e);return a=T(a,a.next),l=T(l,l.next),C(a,t,i,n,r,s,o,0),void C(l,t,i,n,r,s,o,0)}e=e.next}a=a.next}while(a!==e)}function G(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&z(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&V(e,t)&&V(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)}function B(e,t){const i=H.create(e.index,e.x,e.y),n=H.create(t.index,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}class H{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,t,i){const n=q[W++];return n.index=e,n.x=t,n.y=i,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}const q=new Array;let W=0;for(let e=0;e<8096;e++)q.push(new H);var Y=i(211),X=Object(Y.b)((function(e){var t;void 0!==(t=function(){var e={DEBUG:!1,assert:function(t,i){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(i?": "+i:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};return e.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.geom.edgeEval=function(t,i,n){e.assert(e.geom.vertLeq(t,i)&&e.geom.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?r<s?i.t-t.t+(t.t-n.t)*(r/(r+s)):i.t-n.t+(n.t-t.t)*(s/(r+s)):0},e.geom.edgeSign=function(t,i,n){e.assert(e.geom.vertLeq(t,i)&&e.geom.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?(i.t-n.t)*r+(i.t-t.t)*s:0},e.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.geom.transEval=function(t,i,n){e.assert(e.geom.transLeq(t,i)&&e.geom.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?r<s?i.s-t.s+(t.s-n.s)*(r/(r+s)):i.s-n.s+(n.s-t.s)*(s/(r+s)):0},e.geom.transSign=function(t,i,n){e.assert(e.geom.transLeq(t,i)&&e.geom.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?(i.s-n.s)*r+(i.s-t.s)*s:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.geom.vertCCW=function(e,t,i){return e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)>=0},e.geom.interpolate_=function(e,t,i,n){return(e=e<0?0:e)<=(i=i<0?0:i)?0===i?(t+n)/2:t+e/(e+i)*(n-t):n+i/(e+i)*(t-n)},e.geom.edgeIntersect=function(t,i,n,r,s){var o,a,l;e.geom.vertLeq(t,i)||(l=t,t=i,i=l),e.geom.vertLeq(n,r)||(l=n,n=r,r=l),e.geom.vertLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.geom.vertLeq(n,i)?e.geom.vertLeq(i,r)?((o=e.geom.edgeEval(t,n,i))+(a=e.geom.edgeEval(n,i,r))<0&&(o=-o,a=-a),s.s=e.geom.interpolate_(o,n.s,a,i.s)):((o=e.geom.edgeSign(t,n,i))+(a=-e.geom.edgeSign(t,r,i))<0&&(o=-o,a=-a),s.s=e.geom.interpolate_(o,n.s,a,r.s)):s.s=(n.s+i.s)/2,e.geom.transLeq(t,i)||(l=t,t=i,i=l),e.geom.transLeq(n,r)||(l=n,n=r,r=l),e.geom.transLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.geom.transLeq(n,i)?e.geom.transLeq(i,r)?((o=e.geom.transEval(t,n,i))+(a=e.geom.transEval(n,i,r))<0&&(o=-o,a=-a),s.t=e.geom.interpolate_(o,n.t,a,i.t)):((o=e.geom.transSign(t,n,i))+(a=-e.geom.transSign(t,r,i))<0&&(o=-o,a=-a),s.t=e.geom.interpolate_(o,n.t,a,r.t)):s.t=(n.t+i.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var i=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(i,t.vHead),e.mesh.makeVertex_(i.sym,t.vHead),e.mesh.makeFace_(i,t.fHead),i},e.mesh.meshSplice=function(t,i){var n=!1,r=!1;t!==i&&(i.org!==t.org&&(r=!0,e.mesh.killVertex_(i.org,t.org)),i.lFace!==t.lFace&&(n=!0,e.mesh.killFace_(i.lFace,t.lFace)),e.mesh.splice_(i,t),r||(e.mesh.makeVertex_(i,t.org),t.org.anEdge=t),n||(e.mesh.makeFace_(i,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var i=t.sym,n=!1;t.lFace!==t.rFace()&&(n=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),n||e.mesh.makeFace_(t,t.lFace)),i.oNext===i?(e.mesh.killVertex_(i.org,null),e.mesh.killFace_(i.lFace,null)):(t.lFace.anEdge=i.oPrev(),i.org.anEdge=i.oNext,e.mesh.splice_(i,i.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var i=e.mesh.makeEdgePair_(t),n=i.sym;return e.mesh.splice_(i,t.lNext),i.org=t.dst(),e.mesh.makeVertex_(n,i.org),i.lFace=n.lFace=t.lFace,i},e.mesh.splitEdge=function(t){var i=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,i),t.sym.org=i.org,i.dst().anEdge=i.sym,i.sym.lFace=t.rFace(),i.winding=t.winding,i.sym.winding=t.sym.winding,i},e.mesh.connect=function(t,i){var n=!1,r=e.mesh.makeEdgePair_(t),s=r.sym;return i.lFace!==t.lFace&&(n=!0,e.mesh.killFace_(i.lFace,t.lFace)),e.mesh.splice_(r,t.lNext),e.mesh.splice_(s,i),r.org=t.dst(),s.org=i.org,r.lFace=s.lFace=t.lFace,t.lFace.anEdge=s,n||e.mesh.makeFace_(r,t.lFace),r},e.mesh.zapFace=function(t){var i,n=t.anEdge,r=n.lNext;do{if(r=(i=r).lNext,i.lFace=null,null===i.rFace()){i.oNext===i?e.mesh.killVertex_(i.org,null):(i.org.anEdge=i.oNext,e.mesh.splice_(i,i.oPrev()));var s=i.sym;s.oNext===s?e.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,e.mesh.splice_(s,s.oPrev())),e.mesh.killEdge_(i)}}while(i!==n);var o=t.prev,a=t.next;a.prev=o,o.next=a},e.mesh.meshUnion=function(e,t){var i=e.fHead,n=e.vHead,r=e.eHead,s=t.fHead,o=t.vHead,a=t.eHead;return s.next!==s&&(i.prev.next=s.next,s.next.prev=i.prev,s.prev.next=i,i.prev=s.prev),o.next!==o&&(n.prev.next=o.next,o.next.prev=n.prev,o.prev.next=n,n.prev=o.prev),a.next!==a&&(r.sym.next.sym.next=a.next,a.next.sym.next=r.sym.next,a.sym.next.sym.next=r,r.sym.next=a.sym.next),e},e.mesh.deleteMesh=function(e){},e.mesh.makeEdgePair_=function(t){var i=new e.GluHalfEdge,n=new e.GluHalfEdge,r=t.sym.next;return n.next=r,r.sym.next=i,i.next=t,t.sym.next=n,i.sym=n,i.oNext=i,i.lNext=n,n.sym=i,n.oNext=n,n.lNext=i,i},e.mesh.splice_=function(e,t){var i=e.oNext,n=t.oNext;i.sym.lNext=t,n.sym.lNext=e,e.oNext=n,t.oNext=i},e.mesh.makeVertex_=function(t,i){var n=i.prev,r=new e.GluVertex(i,n);n.next=r,i.prev=r,r.anEdge=t;var s=t;do{s.org=r,s=s.oNext}while(s!==t)},e.mesh.makeFace_=function(t,i){var n=i.prev,r=new e.GluFace(i,n);n.next=r,i.prev=r,r.anEdge=t,r.inside=i.inside;var s=t;do{s.lFace=r,s=s.lNext}while(s!==t)},e.mesh.killEdge_=function(e){var t=e.next,i=e.sym.next;t.sym.next=i,i.sym.next=t},e.mesh.killVertex_=function(e,t){var i=e.anEdge,n=i;do{n.org=t,n=n.oNext}while(n!==i);var r=e.prev,s=e.next;s.prev=r,r.next=s},e.mesh.killFace_=function(e,t){var i=e.anEdge,n=i;do{n.lFace=t,n=n.lNext}while(n!==i);var r=e.prev,s=e.next;s.prev=r,r.next=s},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,i,n,r){var s=!1,o=[i,n,r];0===i&&0===n&&0===r&&(e.normal.computeNormal_(t,o),s=!0);var a,l=e.normal.longAxis_(o),c=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(o);var u=[0,0,0],h=[0,0,0];u[l]=0,u[(l+1)%3]=e.normal.S_UNIT_X_,u[(l+2)%3]=e.normal.S_UNIT_Y_;var d=e.normal.dot_(u,o);for(u[0]-=d*o[0],u[1]-=d*o[1],u[2]-=d*o[2],e.normal.normalize_(u),h[0]=o[1]*u[2]-o[2]*u[1],h[1]=o[2]*u[0]-o[0]*u[2],h[2]=o[0]*u[1]-o[1]*u[0],e.normal.normalize_(h),a=c.next;a!==c;a=a.next)a.s=e.normal.dot_(a.coords,u),a.t=e.normal.dot_(a.coords,h)}else{var f=(l+1)%3,p=(l+2)%3,m=o[l]>0?1:-1;for(a=c.next;a!==c;a=a.next)a.s=a.coords[f],a.t=m*a.coords[p]}s&&e.normal.checkOrientation_(t)},e.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.normal.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e.assert(i>0),i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.normal.computeNormal_=function(t,i){var n,r=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],s=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],o=[],a=[],l=t.mesh.vHead;for(n=l.next;n!==l;n=n.next)for(var c=0;c<3;++c){var u=n.coords[c];u<s[c]&&(s[c]=u,a[c]=n),u>r[c]&&(r[c]=u,o[c]=n)}var h=0;if(r[1]-s[1]>r[0]-s[0]&&(h=1),r[2]-s[2]>r[h]-s[h]&&(h=2),s[h]>=r[h])return i[0]=0,i[1]=0,void(i[2]=1);var d=0,f=a[h],p=o[h],m=[0,0,0],_=[f.coords[0]-p.coords[0],f.coords[1]-p.coords[1],f.coords[2]-p.coords[2]],g=[0,0,0];for(n=l.next;n!==l;n=n.next){g[0]=n.coords[0]-p.coords[0],g[1]=n.coords[1]-p.coords[1],g[2]=n.coords[2]-p.coords[2],m[0]=_[1]*g[2]-_[2]*g[1],m[1]=_[2]*g[0]-_[0]*g[2],m[2]=_[0]*g[1]-_[1]*g[0];var y=m[0]*m[0]+m[1]*m[1]+m[2]*m[2];y>d&&(d=y,i[0]=m[0],i[1]=m[1],i[2]=m[2])}d<=0&&(i[0]=i[1]=i[2]=0,i[e.normal.longAxis_(_)]=1)},e.normal.checkOrientation_=function(e){for(var t=0,i=e.mesh.fHead,n=i.next;n!==i;n=n.next){var r=n.anEdge;if(!(r.winding<=0))do{t+=(r.org.s-r.dst().s)*(r.org.t+r.dst().t),r=r.lNext}while(r!==n.anEdge)}if(t<0)for(var s=e.mesh.vHead,o=s.next;o!==s;o=o.next)o.t=-o.t},e.render={},e.render.renderMesh=function(t,i,n){for(var r=!1,s=-1,o=i.fHead.prev;o!==i.fHead;o=o.prev)if(o.inside){r||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),r=!0);var a=o.anEdge;e.assert(a.lNext.lNext.lNext===a,"renderMesh called with non-triangulated mesh");do{if(n){var l=a.rFace().inside?0:1;s!==l&&(s=l,t.callEdgeFlagCallback(!!s))}t.callVertexCallback(a.org.data),a=a.lNext}while(a!==o.anEdge)}r&&t.callEndCallback()},e.render.renderBoundary=function(t,i){for(var n=i.fHead.next;n!==i.fHead;n=n.next)if(n.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var r=n.anEdge;do{t.callVertexCallback(r.org.data),r=r.lNext}while(r!==n.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){var i;for(t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);null!==(i=t.pq.extractMin());){for(;;){var n=t.pq.minimum();if(null===n||!e.geom.vertEq(n,i))break;n=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,i.anEdge,n.anEdge)}e.sweep.sweepEvent_(t,i)}var r=t.dict.getMin().getKey();t.event=r.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},e.sweep.edgeLeq_=function(t,i,n){var r=t.event,s=i.eUp,o=n.eUp;return s.dst()===r?o.dst()===r?e.geom.vertLeq(s.org,o.org)?e.geom.edgeSign(o.dst(),s.org,o.org)<=0:e.geom.edgeSign(s.dst(),o.org,s.org)>=0:e.geom.edgeSign(o.dst(),r,o.org)<=0:o.dst()===r?e.geom.edgeSign(s.dst(),r,s.org)>=0:e.geom.edgeEval(s.dst(),r,s.org)>=e.geom.edgeEval(o.dst(),r,o.org)},e.sweep.deleteRegion_=function(t,i){i.fixUpperEdge&&e.assert(0===i.eUp.winding),i.eUp.activeRegion=null,t.dict.deleteNode(i.nodeUp),i.nodeUp=null},e.sweep.fixUpperEdge_=function(t,i){e.assert(t.fixUpperEdge),e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=i,i.activeRegion=t},e.sweep.topLeftRegion_=function(t){var i=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===i);if(t.fixUpperEdge){var n=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,n),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},e.sweep.addRegionBelow_=function(t,i,n){var r=new e.ActiveRegion;return r.eUp=n,r.nodeUp=t.dict.insertBefore(i.nodeUp,r),n.activeRegion=r,r},e.sweep.isWindingInside_=function(t,i){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&i);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==i;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return i>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return i<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return i>=2||i<=-2}return e.assert(!1),!1},e.sweep.computeWinding_=function(t,i){i.windingNumber=i.regionAbove().windingNumber+i.eUp.winding,i.inside=e.sweep.isWindingInside_(t,i.windingNumber)},e.sweep.finishRegion_=function(t,i){var n=i.eUp,r=n.lFace;r.inside=i.inside,r.anEdge=n,e.sweep.deleteRegion_(t,i)},e.sweep.finishLeftRegions_=function(t,i,n){for(var r=i,s=i.eUp;r!==n;){r.fixUpperEdge=!1;var o=r.regionBelow(),a=o.eUp;if(a.org!==s.org){if(!o.fixUpperEdge){e.sweep.finishRegion_(t,r);break}a=e.mesh.connect(s.lPrev(),a.sym),e.sweep.fixUpperEdge_(o,a)}s.oNext!==a&&(e.mesh.meshSplice(a.oPrev(),a),e.mesh.meshSplice(s,a)),e.sweep.finishRegion_(t,r),s=o.eUp,r=o}return s},e.sweep.addRightEdges_=function(t,i,n,r,s,o){var a=!0,l=n;do{e.assert(e.geom.vertLeq(l.org,l.dst())),e.sweep.addRegionBelow_(t,i,l.sym),l=l.oNext}while(l!==r);null===s&&(s=i.regionBelow().eUp.rPrev());for(var c,u=i,h=s;(l=(c=u.regionBelow()).eUp.sym).org===h.org;)l.oNext!==h&&(e.mesh.meshSplice(l.oPrev(),l),e.mesh.meshSplice(h.oPrev(),l)),c.windingNumber=u.windingNumber-l.winding,c.inside=e.sweep.isWindingInside_(t,c.windingNumber),u.dirty=!0,!a&&e.sweep.checkForRightSplice_(t,u)&&(e.sweep.addWinding_(l,h),e.sweep.deleteRegion_(t,u),e.mesh.deleteEdge(h)),a=!1,u=c,h=l;u.dirty=!0,e.assert(u.windingNumber-l.winding===c.windingNumber),o&&e.sweep.walkDirtyRegions_(t,u)},e.sweep.callCombine_=function(t,i,n,r,s){var o=[i.coords[0],i.coords[1],i.coords[2]];i.data=null,i.data=t.callCombineCallback(o,n,r),null===i.data&&(s?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):i.data=n[0])},e.sweep.spliceMergeVertices_=function(t,i,n){var r=[null,null,null,null];r[0]=i.org.data,r[1]=n.org.data,e.sweep.callCombine_(t,i.org,r,[.5,.5,0,0],!1),e.mesh.meshSplice(i,n)},e.sweep.vertexWeights_=function(t,i,n,r,s){var o=e.geom.vertL1dist(i,t),a=e.geom.vertL1dist(n,t),l=s,c=s+1;r[l]=.5*a/(o+a),r[c]=.5*o/(o+a),t.coords[0]+=r[l]*i.coords[0]+r[c]*n.coords[0],t.coords[1]+=r[l]*i.coords[1]+r[c]*n.coords[1],t.coords[2]+=r[l]*i.coords[2]+r[c]*n.coords[2]},e.sweep.getIntersectData_=function(t,i,n,r,s,o){var a=[0,0,0,0],l=[n.data,r.data,s.data,o.data];i.coords[0]=i.coords[1]=i.coords[2]=0,e.sweep.vertexWeights_(i,n,r,a,0),e.sweep.vertexWeights_(i,s,o,a,2),e.sweep.callCombine_(t,i,l,a,!0)},e.sweep.checkForRightSplice_=function(t,i){var n=i.regionBelow(),r=i.eUp,s=n.eUp;if(e.geom.vertLeq(r.org,s.org)){if(e.geom.edgeSign(s.dst(),r.org,s.org)>0)return!1;e.geom.vertEq(r.org,s.org)?r.org!==s.org&&(t.pq.remove(r.org.pqHandle),e.sweep.spliceMergeVertices_(t,s.oPrev(),r)):(e.mesh.splitEdge(s.sym),e.mesh.meshSplice(r,s.oPrev()),i.dirty=n.dirty=!0)}else{if(e.geom.edgeSign(r.dst(),s.org,r.org)<0)return!1;i.regionAbove().dirty=i.dirty=!0,e.mesh.splitEdge(r.sym),e.mesh.meshSplice(s.oPrev(),r)}return!0},e.sweep.checkForLeftSplice_=function(t,i){var n,r=i.regionBelow(),s=i.eUp,o=r.eUp;if(e.assert(!e.geom.vertEq(s.dst(),o.dst())),e.geom.vertLeq(s.dst(),o.dst())){if(e.geom.edgeSign(s.dst(),o.dst(),s.org)<0)return!1;i.regionAbove().dirty=i.dirty=!0,n=e.mesh.splitEdge(s),e.mesh.meshSplice(o.sym,n),n.lFace.inside=i.inside}else{if(e.geom.edgeSign(o.dst(),s.dst(),o.org)>0)return!1;i.dirty=r.dirty=!0,n=e.mesh.splitEdge(o),e.mesh.meshSplice(s.lNext,o.sym),n.rFace().inside=i.inside}return!0},e.sweep.checkForIntersect_=function(t,i){var n=i.regionBelow(),r=i.eUp,s=n.eUp,o=r.org,a=s.org,l=r.dst(),c=s.dst(),u=new e.GluVertex;if(e.assert(!e.geom.vertEq(c,l)),e.assert(e.geom.edgeSign(l,t.event,o)<=0),e.assert(e.geom.edgeSign(c,t.event,a)>=0),e.assert(o!==t.event&&a!==t.event),e.assert(!i.fixUpperEdge&&!n.fixUpperEdge),o===a)return!1;if(Math.min(o.t,l.t)>Math.max(a.t,c.t))return!1;if(e.geom.vertLeq(o,a)){if(e.geom.edgeSign(c,o,a)>0)return!1}else if(e.geom.edgeSign(l,a,o)<0)return!1;e.geom.edgeIntersect(l,o,c,a,u),e.assert(Math.min(o.t,l.t)<=u.t),e.assert(u.t<=Math.max(a.t,c.t)),e.assert(Math.min(c.s,l.s)<=u.s),e.assert(u.s<=Math.max(a.s,o.s)),e.geom.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t);var h=e.geom.vertLeq(o,a)?o:a;if(e.geom.vertLeq(h,u)&&(u.s=h.s,u.t=h.t),e.geom.vertEq(u,o)||e.geom.vertEq(u,a))return e.sweep.checkForRightSplice_(t,i),!1;if(!e.geom.vertEq(l,t.event)&&e.geom.edgeSign(l,t.event,u)>=0||!e.geom.vertEq(c,t.event)&&e.geom.edgeSign(c,t.event,u)<=0){if(c===t.event)return e.mesh.splitEdge(r.sym),e.mesh.meshSplice(s.sym,r),r=(i=e.sweep.topLeftRegion_(i)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,i.regionBelow(),n),e.sweep.addRightEdges_(t,i,r.oPrev(),r,r,!0),!0;if(l===t.event){e.mesh.splitEdge(s.sym),e.mesh.meshSplice(r.lNext,s.oPrev()),n=i;var d=(i=e.sweep.topRightRegion_(i)).regionBelow().eUp.rPrev();return n.eUp=s.oPrev(),s=e.sweep.finishLeftRegions_(t,n,null),e.sweep.addRightEdges_(t,i,s.oNext,r.rPrev(),d,!0),!0}return e.geom.edgeSign(l,t.event,u)>=0&&(i.regionAbove().dirty=i.dirty=!0,e.mesh.splitEdge(r.sym),r.org.s=t.event.s,r.org.t=t.event.t),e.geom.edgeSign(c,t.event,u)<=0&&(i.dirty=n.dirty=!0,e.mesh.splitEdge(s.sym),s.org.s=t.event.s,s.org.t=t.event.t),!1}return e.mesh.splitEdge(r.sym),e.mesh.splitEdge(s.sym),e.mesh.meshSplice(s.oPrev(),r),r.org.s=u.s,r.org.t=u.t,r.org.pqHandle=t.pq.insert(r.org),e.sweep.getIntersectData_(t,r.org,o,l,a,c),i.regionAbove().dirty=i.dirty=n.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,i){for(var n=i.regionBelow();;){for(;n.dirty;)i=n,n=n.regionBelow();if(!i.dirty&&(n=i,null===(i=i.regionAbove())||!i.dirty))return;i.dirty=!1;var r=i.eUp,s=n.eUp;if(r.dst()!==s.dst()&&e.sweep.checkForLeftSplice_(t,i)&&(n.fixUpperEdge?(e.sweep.deleteRegion_(t,n),e.mesh.deleteEdge(s),s=(n=i.regionBelow()).eUp):i.fixUpperEdge&&(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(r),r=(i=n.regionAbove()).eUp)),r.org!==s.org)if(r.dst()===s.dst()||i.fixUpperEdge||n.fixUpperEdge||r.dst()!==t.event&&s.dst()!==t.event)e.sweep.checkForRightSplice_(t,i);else if(e.sweep.checkForIntersect_(t,i))return;r.org===s.org&&r.dst()===s.dst()&&(e.sweep.addWinding_(s,r),e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(r),i=n.regionAbove())}},e.sweep.connectRightVertex_=function(t,i,n){var r,s=n.oNext,o=i.regionBelow(),a=i.eUp,l=o.eUp,c=!1;a.dst()!==l.dst()&&e.sweep.checkForIntersect_(t,i),e.geom.vertEq(a.org,t.event)&&(e.mesh.meshSplice(s.oPrev(),a),s=(i=e.sweep.topLeftRegion_(i)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,i.regionBelow(),o),c=!0),e.geom.vertEq(l.org,t.event)&&(e.mesh.meshSplice(n,l.oPrev()),n=e.sweep.finishLeftRegions_(t,o,null),c=!0),c?e.sweep.addRightEdges_(t,i,n.oNext,s,s,!0):(r=e.geom.vertLeq(l.org,a.org)?l.oPrev():a,r=e.mesh.connect(n.lPrev(),r),e.sweep.addRightEdges_(t,i,r,r.oNext,r.oNext,!1),r.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,i))},e.sweep.connectLeftDegenerate_=function(t,i,n){var r=i.eUp;if(e.geom.vertEq(r.org,n))return e.assert(e.sweep.TOLERANCE_NONZERO_),void(e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,r,n.anEdge));if(!e.geom.vertEq(r.dst(),n))return e.mesh.splitEdge(r.sym),i.fixUpperEdge&&(e.mesh.deleteEdge(r.oNext),i.fixUpperEdge=!1),e.mesh.meshSplice(n.anEdge,r),void e.sweep.sweepEvent_(t,n);if(e.assert(e.sweep.TOLERANCE_NONZERO_),e.sweep.TOLERANCE_NONZERO_){var s=(i=e.sweep.topRightRegion_(i)).regionBelow(),o=s.eUp.sym,a=o.oNext,l=a;s.fixUpperEdge&&(e.assert(a!==o),e.sweep.deleteRegion_(t,s),e.mesh.deleteEdge(o),o=a.oPrev()),e.mesh.meshSplice(n.anEdge,o),e.geom.edgeGoesLeft(a)||(a=null),e.sweep.addRightEdges_(t,i,o.oNext,l,a,!0)}},e.sweep.connectLeftVertex_=function(t,i){var n=new e.ActiveRegion;n.eUp=i.anEdge.sym;var r=t.dict.search(n).getKey(),s=r.regionBelow(),o=r.eUp,a=s.eUp;if(0!==e.geom.edgeSign(o.dst(),i,o.org)){var l,c=e.geom.vertLeq(a.dst(),o.dst())?r:s;r.inside||c.fixUpperEdge?(l=c===r?e.mesh.connect(i.anEdge.sym,o.lNext):e.mesh.connect(a.dNext(),i.anEdge).sym,c.fixUpperEdge?e.sweep.fixUpperEdge_(c,l):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,r,l)),e.sweep.sweepEvent_(t,i)):e.sweep.addRightEdges_(t,r,i.anEdge,i.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,r,i)},e.sweep.sweepEvent_=function(t,i){t.event=i;for(var n=i.anEdge;null===n.activeRegion;)if((n=n.oNext)===i.anEdge)return void e.sweep.connectLeftVertex_(t,i);var r=e.sweep.topLeftRegion_(n.activeRegion),s=r.regionBelow(),o=s.eUp,a=e.sweep.finishLeftRegions_(t,s,null);a.oNext===o?e.sweep.connectRightVertex_(t,r,a):e.sweep.addRightEdges_(t,r,a.oNext,o,o,!0)},e.sweep.addSentinel_=function(t,i){var n=new e.ActiveRegion,r=e.mesh.makeEdge(t.mesh);r.org.s=e.sweep.SENTINEL_COORD_,r.org.t=i,r.dst().s=-e.sweep.SENTINEL_COORD_,r.dst().t=i,t.event=r.dst(),n.eUp=r,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=t.dict.insert(n)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var i,n=0;null!==(i=t.dict.getMin().getKey());)i.sentinel||(e.assert(i.fixUpperEdge),e.assert(1==++n)),e.assert(0===i.windingNumber),e.sweep.deleteRegion_(t,i);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var i,n=t.mesh.eHead,r=n.next;r!==n;r=i){i=r.next;var s=r.lNext;e.geom.vertEq(r.org,r.dst())&&r.lNext.lNext!==r&&(e.sweep.spliceMergeVertices_(t,s,r),e.mesh.deleteEdge(r),s=(r=s).lNext),s.lNext===r&&(s!==r&&(s!==i&&s!==i.sym||(i=i.next),e.mesh.deleteEdge(s)),r!==i&&r!==i.sym||(i=i.next),e.mesh.deleteEdge(r))}},e.sweep.initPriorityQ_=function(t){var i=new e.PriorityQ;t.pq=i;var n,r=t.mesh.vHead;for(n=r.next;n!==r;n=n.next)n.pqHandle=i.insert(n);i.init()},e.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i){i=n.next;var r=n.anEdge;e.assert(r.lNext!==r),r.lNext.lNext===r&&(e.sweep.addWinding_(r.oNext,r),e.mesh.deleteEdge(r))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){var i=t.anEdge;for(e.assert(i.lNext!==i&&i.lNext.lNext!==i);e.geom.vertLeq(i.dst(),i.org);i=i.lPrev());for(;e.geom.vertLeq(i.org,i.dst());i=i.lNext);for(var n,r=i.lPrev();i.lNext!==r;)if(e.geom.vertLeq(i.dst(),r.org)){for(;r.lNext!==i&&(e.geom.edgeGoesLeft(r.lNext)||e.geom.edgeSign(r.org,r.dst(),r.lNext.dst())<=0);)r=(n=e.mesh.connect(r.lNext,r)).sym;r=r.lPrev()}else{for(;r.lNext!==i&&(e.geom.edgeGoesRight(i.lPrev())||e.geom.edgeSign(i.dst(),i.org,i.lPrev().org)>=0);)n=e.mesh.connect(i,i.lPrev()),i=n.sym;i=i.lNext}for(e.assert(r.lNext!==i);r.lNext.lNext!==i;)r=(n=e.mesh.connect(r.lNext,r)).sym},e.tessmono.tessellateInterior=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)i=n.next,n.inside&&e.tessmono.tessellateMonoRegion_(n)},e.tessmono.discardExterior=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)i=n.next,n.inside||e.mesh.zapFace(n)},e.tessmono.setWindingNumber=function(t,i,n){for(var r,s=t.eHead.next;s!==t.eHead;s=r)r=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?i:-i:n?e.mesh.deleteEdge(s):s.winding=0},e.Dict=function(t,i){this.head_=new e.DictNode,this.frame_=t,this.leq_=i},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,i){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,i));var n=new e.DictNode(i,t.next,t);return t.next.prev=n,t.next=n,n},e.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},e.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},e.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(e,t,i){this.key=e||null,this.next=t||this,this.prev=i||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,i){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var n=i;switch(n){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=n)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=this.windingRule;return e.assert(i===e.windingRule.GLU_TESS_WINDING_ODD||i===e.windingRule.GLU_TESS_WINDING_NONZERO||i===e.windingRule.GLU_TESS_WINDING_POSITIVE||i===e.windingRule.GLU_TESS_WINDING_NEGATIVE||i===e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),i;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return e.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(e,t,i){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=i},e.GluTesselator.prototype.gluTessCallback=function(t,i){var n=i||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=n);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=n);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=n);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=n);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=n);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=n);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=n);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,i){var n=!1,r=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var s=0;s<3;++s){var o=t[s];o<-e.GLU_TESS_MAX_COORD&&(o=-e.GLU_TESS_MAX_COORD,n=!0),o>e.GLU_TESS_MAX_COORD&&(o=e.GLU_TESS_MAX_COORD,n=!0),r[s]=o}n&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(r,i)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var i=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,i)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,i){var n=this.lastEdge_;null===n?(n=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(n,n.sym)):(e.mesh.splitEdge(n),n=n.lNext),n.org.data=i,n.org.coords[0]=t[0],n.org.coords[1]=t[1],n.org.coords[2]=t[2],n.winding=1,n.sym.winding=-1,this.lastEdge_=n},e.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(e,t,i){return this.combineCallback_&&this.combineCallback_(e,t,i,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},e.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.inside=!1},e.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,i,n,r=this.fHead,s=this.vHead,o=this.eHead,a=r;for(a=r;(i=a.next)!==r;a=i){e.assert(i.prev===a),t=i.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.lFace===i),t=t.lNext}while(t!==i.anEdge)}e.assert(i.prev===a&&null===i.anEdge);var l=s;for(l=s;(n=l.next)!==s;l=n){e.assert(n.prev===l),t=n.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.org===n),t=t.oNext}while(t!==n.anEdge)}e.assert(n.prev===l&&null===n.anEdge&&null===n.data);var c=o;for(c=o;(t=c.next)!==o;c=t)e.assert(t.sym.next===c.sym),e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(null!==t.org),e.assert(null!==t.dst()),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t);e.assert(t.sym.next===c.sym&&t.sym===this.eHeadSym&&t.sym.sym===t&&null===t.org&&null===t.dst()&&null===t.lFace&&null===t.rFace())}},e.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var i,n=(i=this.verts_,function(t,n){return e.geom.vertLeq(i[t],i[n])?1:-1});if(this.order_.sort(n),this.initialized_=!0,this.heap_.init(),e.DEBUG){var r=0+this.size_-1;for(t=0;t<r;++t)e.assert(e.geom.vertLeq(this.verts_[this.order_[t+1]],this.verts_[this.order_[t]]))}},e.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var i=this.heap_.minimum();if(e.geom.vertLeq(i,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var i=this.heap_.minimum();if(e.geom.vertLeq(i,t))return i}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),e.assert(t<this.verts_.length&&null!==this.verts_[t]),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(e,t){for(var i=new Array(t),n=0;n<e.length;n++)i[n]=e[n];for(;n<t;n++)i[n]=0;return i},e.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var i,n=++this.size_;return 2*n>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?i=n:(i=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[i]=t,this.handles_[i]=n,this.heap_[n]=i,this.initialized_&&this.floatUp_(n),i},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,i=this.handles_,n=e[1],r=t[n];return this.size_>0&&(e[1]=e[this.size_],i[e[1]]=1,t[n]=null,i[n]=this.freeList_,this.freeList_=n,--this.size_>0&&this.floatDown_(1)),r},e.PriorityQHeap.prototype.remove=function(t){var i=this.heap_,n=this.verts_,r=this.handles_;e.assert(t>=1&&t<=this.max_&&null!==n[t]);var s=r[t];if(i[s]=i[this.size_],r[i[s]]=s,s<=--this.size_)if(s<=1)this.floatDown_(s);else{var o=n[i[s]],a=n[i[s>>1]];e.geom.vertLeq(a,o)?this.floatDown_(s):this.floatUp_(s)}n[t]=null,r[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var i=this.heap_,n=this.verts_,r=this.handles_,s=t,o=i[s];;){var a=s<<1;a<this.size_&&e.geom.vertLeq(n[i[a+1]],n[i[a]])&&(a+=1),e.assert(a<=this.max_);var l=i[a];if(a>this.size_||e.geom.vertLeq(n[o],n[l]))return i[s]=o,void(r[o]=s);i[s]=l,r[l]=s,s=a}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var i=this.heap_,n=this.verts_,r=this.handles_,s=t,o=i[s];;){var a=s>>1,l=i[a];if(0===a||e.geom.vertLeq(n[l],n[o]))return i[s]=o,void(r[o]=s);i[s]=l,r[l]=s,s=a}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e}())&&(e.exports=t)}));const Z=n.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");const K=new class{constructor(){this._currentVertexIndex=0,this._indexCounter=0,this._triangleIndices=[-1,-1,-1],this.glu=new X.GluTesselator,this.glu.gluTessCallback(X.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this)),this.glu.gluTessCallback(X.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this)),this.glu.gluTessCallback(X.gluEnum.GLU_TESS_END,this._endcallback.bind(this)),this.glu.gluTessCallback(X.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this)),this.glu.gluTessCallback(X.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this)),this.glu.gluTessCallback(X.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this)),this.glu.gluTessProperty(X.gluEnum.GLU_TESS_WINDING_RULE,X.windingRule.GLU_TESS_WINDING_ODD)}beginPolygon(e,t){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0,this._indexCounter=0,this.glu.gluTessBeginPolygon(e),this._indices=t}endPolygon(){this.glu.gluTessEndPolygon()}beginContour(){this.glu.gluTessBeginContour()}endContour(){this.glu.gluTessEndContour()}addVertex(e,t){this.glu.gluTessVertex(e,t)}_vertexCallback(e,t){if(t[t.length]=e[0],t[t.length]=e[1],this._triangleIndices[this._currentVertexIndex]=-1,this._currentVertexIndex>=2){for(let e=0;e<3;e++)-1===this._triangleIndices[e]&&(this._triangleIndices[e]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[e];this._currentVertexIndex=0}else this._currentVertexIndex++}_begincallback(){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0}_endcallback(){this._currentVertexIndex=0}_errorcallback(e){Z.error("Encountered error during tesselation: "+e)}_combinecallback(e){return[e[0],e[1],e[2]]}_edgeCallback(){}},J=new O.b(0,0,0,1,128);function Q(e,t,i){let n=0;for(let r=1;r<i;r++){const i=e[2*(t+r-1)],s=e[2*(t+r-1)+1];n+=(e[2*(t+r)]-i)*(e[2*(t+r)+1]+s)}return n}function $(e,t,i,n,r){let s=0;for(let o=i;o<n;o+=3){const i=2*(e.getValue(o)-r),n=2*(e.getValue(o+1)-r),a=2*(e.getValue(o+2)-r);s+=Math.abs((t[i]-t[a])*(t[n+1]-t[i+1])-(t[i]-t[n])*(t[a+1]-t[i+1]))}return s}J.setExtent(f.F);var ee=e=>class extends e{constructor(...e){super(...e),this.forceLibtess=!1,this.geometryType=x.d.FILL}writeMeshWithGeometry(e,t,i,n,r,s){const o=m.a.load(this._materialKey),a=t.indexVector,l=t.getVector("geometry"),c=l.vertexCount,u=a.length;let h=s?Object(v.p)(Object(v.d)(s),2):i.readUnquantizedGeometry();if(!h)return;if(h=function(e){if(!function(e,t,i){let n=0;for(let t=0;t<e.lengths.length;t++){const r=e.lengths[t];for(let t=0;t<r;t++){const r=e.coords[2*(t+n)],s=e.coords[2*(t+n)+1];if(r<-128||r>i||s<-128||s>i)return!0}n+=r}return!1}(e,0,f.F+128))return e;J.reset(3);let t=0;for(let i=0;i<e.lengths.length;i++){const n=e.lengths[i];let r=e.coords[2*(0+t)],s=e.coords[2*(0+t)+1];J.moveTo(r,s);for(let i=1;i<n;i++)r=e.coords[2*(i+t)],s=e.coords[2*(i+t)+1],J.lineTo(r,s);J.close(),t+=n}const i=J.result(!1);if(!i)return null;const n=[],r=[];for(const e of i){let t=0;for(const i of e)r.push(i.x),r.push(i.y),t++;n.push(t)}return new b.a(n,r)}(h),!h)return;let d=h.coords;!this.forceLibtess&&function(e,t,i){const{coords:n,lengths:r,hasIndeterminateRingOrder:s}=t;if(s)return!1;const o=e.length;let a=0;for(let t=0;t<r.length;){let s=t,l=r[t],c=Q(n,a,l);const u=[];for(;++s<r.length;){const e=r[s],t=Q(n,a+l,e);if(!(t>0))break;c+=t,u.push(a+l),l+=e}const h=e.length;S(e,n,a,a+l,u,2,i);const d=$(e,n,h,e.length,i),f=Math.abs(c);if(Math.abs((d-f)/Math.max(1e-7,f))>1e-5)return e.seek(o),!1;t=s,a+=l}return!0}(a,h,c)||(d=[],function(e,t,i,n){const r=[],{coords:s,lengths:o}=i;K.beginPolygon(e,r);let a=0;for(let e=0;e<o.length;e++){const t=i.lengths[e];K.beginContour();for(let e=0;e<t;e++){const t=[s[2*(a+e)],s[2*(a+e)+1],0];K.addVertex(t,t)}K.endContour(),a+=t}K.endPolygon();for(let e=0;e<r.length;e++)t.push(r[e]+n)}(d,a,h,c)),this._write(l,i,r,d,o);const p=l.vertexCount-c,_=a.length-u;e.writeDisplayRecord(this.geometryType,this._materialKey,c,p,u,_)}_write(e,t,i,n,r){for(let s=0;s<n.length;s+=2){const o=Object(p.a)(1*n[s],1*n[s+1]);e.data.push(o),e.data.push(i),r.dotDensity?e.data.writeF32(1/Math.abs(t.readGeometryArea())):(e.data.push(this.fillColor),e.data.push(this.tl),e.data.push(this.br),e.data.push(this.aux1),e.data.push(this.aux2),e.data.push(this.aux3))}}},te=i(501),ie=i(422);const ne=n.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");var re=class extends ie.a{constructor(e){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=e}analyze(e,t,i,n){const r=t.readLegacyFeature(),o=this._materialCache,a=this._cimLayer.materialHash;if(!a)return ne.error("A Dynamic mesh template must have a material hash value or function!"),Object(s.h)(null);const l="function"==typeof a?a(r,i,n):a;if(o.has(l)){const e=o.get(l);return Object(s.r)(e)}if(this._ongoingMaterialRequestMap.has(l))return this._ongoingMaterialRequestMap.get(l);const c=Object(te.a)(this._cimLayer.cim,this._cimLayer.materialOverrides);c.mosaicHash=l;const u=e.getMosaicItem(c).then(e=>(this._ongoingMaterialRequestMap.delete(l),o.set(l,e),e)).catch(e=>(this._ongoingMaterialRequestMap.delete(l),ne.error(".analyze()",e.message),null));return this._ongoingMaterialRequestMap.set(l,u),u}};class se extends(ee(re)){constructor(e){if(super(e),Object(y.c)(e.color)){const t=(t,i,n)=>{const r=e.color(t,i,n);return r&&Object(_.c)(r)||0};this._dynamicPropertyMap.set("_fillColor",t)}else{const t=e.color;this.fillColor=t&&Object(_.c)(t)||0}let t=0;Object(y.c)(e.height)||(t=e.height||0),this._dynamicPropertyMap.set("_height",(i,n,r)=>Object(y.c)(e.height)?e.height(i,n,r):t);let i=0;Object(y.c)(e.offsetX)||(i=Object(d.h)(e.offsetX||0)+128,i>255&&(i=255)),this._dynamicPropertyMap.set("_offsetX",(t,n,r)=>{if(Object(y.c)(e.offsetX)){let i=Object(d.h)(e.offsetX(t,n,r))+128;return i>255&&(i=255),i}return i});let n=1;Object(y.c)(e.scaleX)||(n=e.scaleX||1),this._dynamicPropertyMap.set("_scaleX",(t,i,r)=>Object(y.c)(e.scaleX)?e.scaleX(t,i,r):n);let r=0;Object(y.c)(e.offsetY)||(r=Object(d.h)(-e.offsetY||0)+128,r>255&&(r=255)),this._dynamicPropertyMap.set("_offsetY",(t,i,n)=>{if(Object(y.c)(e.offsetY)){let r=Object(d.h)(-e.offsetY(t,i,n))+128;return r>255&&(r=255),r}return r});let s=0;Object(y.c)(e.angle)||(s=Object(g.d)(e.angle)||0),this._dynamicPropertyMap.set("_angle",(t,i,n)=>Object(y.c)(e.angle)?Object(g.d)(e.angle(t,i,n)):s),this.effects=e.effects,this._cimFillLayer=e,this._fillMaterialKey=m.a.load(e.materialKey)}static fromCIMFill(e){return new se(e)}bindFeature(e,t,i){const n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((e,r)=>{this[r]=e(n,t,i)});const r=this._fillMaterialKey,s=this._materialCache,o=this._cimFillLayer;this.aux3=Object(p.b)(0,0,this._angle,o.colorLocked?1:0);const l=(0,o.materialHash)(n,t,i),c=s.get(l);let u=null;if(c&&Object(a.a)(c.spriteMosaicItem)&&(u=c.spriteMosaicItem),u){const{rect:e,width:t,height:i}=u,n=e.x+f.r,s=e.y+f.r,o=n+t,a=s+i;let l=Object(h.i)(Object(d.h)(this._height));l>255?l=255:l<=0&&(l=Object(h.i)(a-s));let c=Object(h.i)(Object(d.h)(this._height/i*t||0));c>255?c=255:c<=0&&(c=Object(h.i)(o-n));const m=this._scaleX,_=1;this.tl=Object(p.a)(n,s),this.br=Object(p.a)(o,a),this.aux1=Object(p.b)(c,l,this._offsetX,this._offsetY),this.aux2=Object(p.a)(128*m,128*_),r.sdf=u.sdf,r.pattern=!0,r.textureBinding=u.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,r.sdf=!1,r.pattern=!1,r.textureBinding=0;this._materialKey=r.data}}var oe=se,ae=i(4),le=i(546);const ce=f.F+16,ue=new O.b(0,0,0,1,16);ue.setExtent(f.F);let he=0,de=0;Object(ae.a)("esri-tiles-performance")&&setInterval(()=>{console.log("New (FL)","feat="+de,"secs="+he,"tris=0","tris/sec="+Math.round(0/he))},1e4);const fe=new Uint32Array(9),pe=new Uint32Array(36),me=new Uint32Array(3),_e=new Uint32Array(6),ge=e=>t=>{const i=Math.ceil(1024*e._halfWidth),n=Math.ceil(1024*e._halfReferenceWidth);t.entry0=e.offset+e.vertexCount++;{const r=Object(p.a)(t.distance,i),s=Object(p.b)(Math.round(31*t.prevNormal.x),Math.round(31*t.prevNormal.y),Math.round(0),Math.round(-31)),o=Object(p.b)(0,0,0,e._bitset);pe[0]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),pe[1]=e.id,pe[2]=e._fillColor,pe[3]=s,pe[4]=r,pe[5]=e._tl,pe[6]=e._br,pe[7]=o,pe[8]=Object(p.a)(n,0)}t.entry2=e.offset+e.vertexCount++;{const r=Object(p.a)(t.distance,i),s=Object(p.b)(Math.round(31*-t.prevNormal.x),Math.round(31*-t.prevNormal.y),Math.round(0),Math.round(31)),o=Object(p.b)(0,0,0,e._bitset);pe[9]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),pe[10]=e.id,pe[11]=e._fillColor,pe[12]=s,pe[13]=r,pe[14]=e._tl,pe[15]=e._br,pe[16]=o,pe[17]=Object(p.a)(n,0)}t.exit0=e.offset+e.vertexCount++;{const r=Object(p.a)(t.distance,i),s=Object(p.b)(Math.round(31*t.nextNormal.x),Math.round(31*t.nextNormal.y),Math.round(0),Math.round(-31)),o=Object(p.b)(0,0,0,e._bitset);pe[18]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),pe[19]=e.id,pe[20]=e._fillColor,pe[21]=s,pe[22]=r,pe[23]=e._tl,pe[24]=e._br,pe[25]=o,pe[26]=Object(p.a)(n,0)}t.exit2=e.offset+e.vertexCount++;{const r=Object(p.a)(t.distance,i),s=Object(p.b)(Math.round(31*-t.nextNormal.x),Math.round(31*-t.nextNormal.y),Math.round(0),Math.round(31)),o=Object(p.b)(0,0,0,e._bitset);pe[27]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),pe[28]=e.id,pe[29]=e._fillColor,pe[30]=s,pe[31]=r,pe[32]=e._tl,pe[33]=e._br,pe[34]=o,pe[35]=Object(p.a)(n,0)}e.geometryBuf.writeRegion(pe)},ye=e=>t=>{_e[0]=t.leftExit0,_e[1]=t.rightEntry0,_e[2]=t.leftExit2,_e[3]=t.rightEntry0,_e[4]=t.rightEntry2,_e[5]=t.leftExit2,e.indexCount+=6,e.indexBuf.writeRegion(_e)};var ve=e=>class extends e{constructor(...e){super(...e),this.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null},this._tessellationOptions={},this.geometryType=x.d.LINE}writeMeshWithGeometry(e,t,i,n,r,s){const o=t.indexVector,a=t.get("geometry"),l=t.getVector("geometry").vertexCount,c=o.length,u=null!=s?s:i.readLegacyGeometry();if(!u)return;switch(n){case"esriGeometryPolyline":{const e=this._clipLines(u.paths);if(0===e.length)return;this._write(o,a,l,r,e);break}case"esriGeometryPolygon":{const e=this._clipLines(u.rings);if(0===e.length)return;this._write(o,a,l,r,e);break}}const h=this.tessellationProperties.vertexCount,d=this.tessellationProperties.indexCount;e.writeDisplayRecord(this.geometryType,this._materialKey,l,h,c,d)}_clipLines(e){const t=[];let i=!1,n=0;for(;n<e.length;){const r=[],s=e[n];ue.reset(2);let[o,a]=s[0];if(i)ue.moveTo(o,a);else{if(o<-16||o>ce||a<-16||a>ce){i=!0;continue}r.push({x:o,y:a})}let l=!1;const c=s.length;for(let e=1;e<c;++e)if(o+=s[e][0],a+=s[e][1],i)ue.lineTo(o,a);else{if(o<-16||o>ce||a<-16||a>ce){l=!0;break}r.push({x:o,y:a})}if(l)i=!0;else{if(i){const e=ue.resultWithStarts();if(e)for(const i of e)t.push(i)}else t.push({line:r,start:0});n++,i=!1}}return t}_write(e,t,i,n,r){let s;Object(ae.a)("esri-tiles-performance")&&(s=performance.now()),this.tessellationProperties.id=n,this.tessellationProperties.indexBuf=e,this.tessellationProperties.indexCount=0,this.tessellationProperties.geometryBuf=t,this.tessellationProperties.vertexCount=0,this.tessellationProperties.offset=i;for(const e of r){const t=e.line;t.length<2||(this._tessellationOptions.initialDistance=e.start%65535,this._tessellationCallbacks instanceof le.a&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),Object(le.d)(t,this._tessellationOptions,this._tessellationCallbacks),Object(le.b)(),Object(ae.a)("esri-tiles-performance")&&de++)}Object(ae.a)("esri-tiles-performance")&&(he+=(performance.now()-s)/1e3)}_initializeTessellator(e){const t=m.c.load(this._materialKey);if(this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern,this._tessellationOptions.thin=!e&&this.tessellationProperties._halfWidth<f.E/2&&!(t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue),this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.thin)this._tessellationCallbacks={vertex:ge(this.tessellationProperties),bridge:ye(this.tessellationProperties)};else{const e=new le.a((e=>(t,i,n,r,s,o,a,l,c)=>{const u=Object(p.a)(c,Math.ceil(1024*e._halfWidth)),h=Object(p.b)(Math.round(31*s),Math.round(31*o),Math.round(31*a),Math.round(31*l)),d=Object(p.b)(31*n,31*r,0,e._bitset);return fe[0]=Object(p.a)(8*t,8*i),fe[1]=e.id,fe[2]=e._fillColor,fe[3]=h,fe[4]=u,fe[5]=e._tl,fe[6]=e._br,fe[7]=d,fe[8]=Object(p.a)(Math.ceil(1024*e._halfReferenceWidth),0),e.geometryBuf.writeRegion(fe),e.offset+e.vertexCount++})(this.tessellationProperties),(e=>(t,i,n)=>{me[0]=t,me[1]=i,me[2]=n,e.indexCount+=3,e.indexBuf.writeRegion(me)})(this.tessellationProperties));e.miterLimitCosine=this._miterLimitCosine,e.textured=this._isDashed||this._hasPattern,e.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=e}}};class xe extends(ve(re)){constructor(e){super(e),this._cimLineLayer=e;let t=0;if(Object(y.c)(e.width)||(t=.5*Object(d.h)(e.width)),this._dynamicPropertyMap.set("_halfWidth",(i,n,r)=>Object(y.c)(e.width)?.5*Object(d.h)(e.width(i,n,r)):t),Object(y.c)(e.cap)?this._dynamicPropertyMap.set("_capType",e.cap):this._capType=e.cap,Object(y.c)(e.join)?this._dynamicPropertyMap.set("_joinType",e.join):this._joinType=e.join,Object(y.c)(e.color)){const t=(t,i,n)=>{const r=e.color(t,i,n);return r&&Object(_.c)(r)||0};this._dynamicPropertyMap.set("_fillColor",t)}else{const t=e.color;this._fillColor=t&&Object(_.c)(t)||0}if(Object(y.c)(e.miterLimit)){const t=(t,i,n)=>Object(y.b)(e.miterLimit(t,i,n));this._dynamicPropertyMap.set("_miterLimitCosine",t)}else this._miterLimitCosine=Object(y.b)(e.miterLimit);this._scaleFactor=e.scaleFactor||1,this._isDashed=e.isDashed,this.effects=e.effects,this.tessellationProperties._bitset=e.colorLocked?1:0,this._materialKey=e.materialKey,this._initializeTessellator(!0)}static fromCIMLine(e){return new xe(e)}bindFeature(e,t,i){const n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((e,r)=>{this[r]=e(n,t,i)}),this._halfWidth*=this._scaleFactor;const r=this._materialCache,s=(0,this._cimLineLayer.materialHash)(n,t,i),o=r.get(s);let l=null;if(o&&Object(a.a)(o.spriteMosaicItem)&&(l=o.spriteMosaicItem),l){this._hasPattern=!0;const{rect:e,width:t,height:i}=l,n=e.x+f.r,r=e.y+f.r,s=n+t,o=r+i;this.tessellationProperties._tl=Object(p.a)(n,r),this.tessellationProperties._br=Object(p.a)(s,o)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const c=m.c.load(this._materialKey);l&&(c.sdf=l.sdf,c.pattern=!0,c.textureBinding=l.textureBinding),this._materialKey=c.data}}var be=xe,Oe=i(8),Se=i(298),we=i(260),Te=i(509);const Ce=Object(we.a)(),Me=Object(Se.a)(),Ie=n.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class je extends(Object(Te.a)(re)){constructor(e){if(super(e),this._cimMarkerLayer=e,Object(y.c)(e.color)){const t=(t,i,n)=>Object(_.c)(e.color(t,i,n));this._dynamicPropertyMap.set("_fillColor",t)}else this._fillColor=Object(_.c)(e.color);if(Object(y.c)(e.outlineColor)){const t=(t,i,n)=>Object(_.c)(e.outlineColor(t,i,n));this._dynamicPropertyMap.set("_outlineColor",t)}else this._outlineColor=Object(_.c)(e.outlineColor);if(Object(y.c)(e.size)){const t=(t,i,n)=>Object(d.h)(e.size(t,i,n));this._dynamicPropertyMap.set("_size",t)}else this._size=Object(d.h)(e.size);if(Object(y.c)(e.scaleX)?this._dynamicPropertyMap.set("_scaleX",e.scaleX):this._scaleX=e.scaleX,Object(y.c)(e.offsetX)){const t=(t,i,n)=>Object(d.h)(e.offsetX(t,i,n));this._dynamicPropertyMap.set("xOffset",t)}else this.xOffset=Object(d.h)(e.offsetX);if(Object(y.c)(e.offsetY)){const t=(t,i,n)=>Object(d.h)(e.offsetY(t,i,n));this._dynamicPropertyMap.set("yOffset",t)}else this.yOffset=Object(d.h)(e.offsetY);if(Object(y.c)(e.outlineWidth)){const t=(t,i,n)=>Object(d.h)(e.outlineWidth(t,i,n));this._dynamicPropertyMap.set("_outlineWidth",t)}else this._outlineWidth=Object(d.h)(e.outlineWidth);Object(y.c)(e.rotation)?this._dynamicPropertyMap.set("_angle",e.rotation):this._angle=e.rotation,this._scaleFactor=Object(Oe.n)(e.scaleFactor,1),this._markerPlacement=e.markerPlacement,this.effects=e.effects,this._bitSet=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,this._materialKey=e.materialKey}static fromCIMMarker(e){return new je(e)}bindFeature(e,t,i){const n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((e,r)=>{this[r]=e(n,t,i)});const s=this._cimMarkerLayer.materialHash,o="function"==typeof s?s(n,t,i):s,l=this._materialCache.get(o);if(!l||!Object(a.a)(l.spriteMosaicItem)||!l.spriteMosaicItem)return void Ie.error(new r.a("mapview-cim","Encountered an error when binding feature"));const c=l.spriteMosaicItem,u=this._cimMarkerLayer.sizeRatio,h=c.width/c.height*this._scaleX,_=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let g=this._size,y=g*h;const v=this.xOffset,x=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const b=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(d.h)(this._cimMarkerLayer.frameHeight):1,O=this._outlineWidth*b,S=Object(d.h)(this._cimMarkerLayer.referenceSize);let w=0,T=0;const C=this._cimMarkerLayer.anchorPoint;C&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(w=-C.x/(this._size*h),T=C.y/this._size):(w=C.x,T=C.y)),this._sizeOutlineWidth=Object(p.b)(Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*g),255)),Math.round(Math.min(Math.sqrt(128*O),255)),Math.round(Math.min(Math.sqrt(128*S),255))),this.angle=_;const M=Math.round(Math.min(64*u,255));this._bitestAndDistRatio=Object(p.b)(0,0,this._bitSet,M);const I=c.rect.x+f.r,j=c.rect.y+f.r,E=I+c.width,P=j+c.height;this._texUpperLeft=Object(p.a)(I,j),this._texUpperRight=Object(p.a)(E,j),this._texBottomLeft=Object(p.a)(I,P),this._texBottomRight=Object(p.a)(E,P);const D=m.d.load(this._materialKey);D.sdf=c.sdf,D.pattern=!0,D.textureBinding=c.textureBinding,this._materialKey=D.data,this._anchorX=.5-(.5+w)*c.width/c.width,this._anchorY=.5-(.5+T)*c.height/c.height,y*=u,g*=u,y*=this._scaleFactor,g*=this._scaleFactor,y*=c.rect.width/c.width,g*=c.rect.height/c.height,this._computedWidth=y,this._computedHeight=g,this._applyTransformation(Me,Ce),this.xOffset=v,this.yOffset=x}}var Ee=je,Pe=i(493),De=i(420),Le=i(506);class ze extends(Object(Le.a)(re)){constructor(e){super(e),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map;const t=e.scaleFactor||1;if(this._cimTextLayer=e,Object(y.c)(e.color)){const t=(t,i,n)=>Object(_.c)(e.color(t,i,n));this._dynamicPropertyMap.set("_color",t)}else this._color=Object(_.c)(e.color);if(Object(y.c)(e.color)){const t=(t,i,n)=>Object(_.c)(e.outlineColor(t,i,n));this._dynamicPropertyMap.set("_haloColor",t)}else this._haloColor=Object(_.c)(e.outlineColor);let i,n,r;if(Object(y.c)(e.size)||(i=Math.min(Math.round(Object(d.h)(e.size*e.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(t,n,r)=>Object(y.c)(e.size)?Math.min(Math.round(Object(d.h)(e.size(t,n,r)*e.sizeRatio)),127):i),Object(y.c)(e.outlineSize)){const t=(t,i,n)=>Math.min(Math.floor(5*Object(d.h)(e.outlineSize(t,i,n)*e.sizeRatio)),127);this._dynamicPropertyMap.set("_haloSize",t)}else this._haloSize=Math.min(Math.floor(5*Object(d.h)(e.outlineSize*e.sizeRatio)),127);Object(y.c)(e.offsetX)||(n=Math.round(Object(d.h)(e.offsetX*e.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(t,i,r)=>Object(y.c)(e.offsetX)?Math.round(Object(d.h)(e.offsetX(t,i,r)*e.sizeRatio)):n),Object(y.c)(e.offsetY)||(r=Math.round(Object(d.h)(e.offsetY*e.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(t,i,n)=>Object(y.c)(e.offsetY)?Math.round(Object(d.h)(e.offsetY(t,i,n)*e.sizeRatio)):r),Object(y.c)(e.angle)?this._dynamicPropertyMap.set("_angle",e.angle):this._angle=e.angle,Object(y.c)(e.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):this._horizontalAlignment=e.horizontalAlignment,Object(y.c)(e.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):this._verticalAlignment=e.verticalAlignment,this._scaleFactor=t,Object(y.c)(e.text)?this._dynamicPropertyMap.set("_text",e.text):this._text=e.text;const s=Math.min(Math.round(Object(d.h)(e.referenceSize*e.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*s)),this._materialKey=e.materialKey;const o=m.f.load(this._materialKey);o.sdf=!0,this._bitset=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1,this._materialKey=o.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=e.markerPlacement,this.effects=e.effects,this._isCIM=!0}static fromCIMText(e){return new ze(e)}async analyze(e,t,i,n){const r=t.readLegacyFeature(),s=function(e,t,i,n){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,i,n):""}(this._cimTextLayer,r,i,n),o=await e.getMosaicItem(this._cimTextLayer.cim,Object(Pe.a)(s));return this._textToGlyphs.set(s,o.glyphMosaicItems),o}bindFeature(e,t,i){const n=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((e,r)=>{this[r]=e(n,t,i)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(De.d)(this._horizontalAlignment||"center"),this._yAlignD=Object(De.f)(this._verticalAlignment||"baseline");const r=this._textToGlyphs.get(this._text);this.bindTextInfo(r,!1)}}var Ae=ze;class Ve extends(ee(ie.a)){constructor(e,t,i,n,r,s,o,a,l){super(),this.effects=l;const c=m.a.load(e);t&&(c.sdf=t.sdf,c.pattern=!0,c.textureBinding=t.textureBinding),this.fillColor=i,this.tl=n,this.br=r,this.aux1=s,this.aux2=o,this.aux3=a,this._materialKey=c.data}static fromCIMFill(e,t){const i=e.color,n=i&&Object(_.c)(i)||0,r=e.materialKey;if(!t){const t=Object(p.b)(0,0,0,e.colorLocked?1:0);return new Ve(r,null,n,0,0,0,0,t,e.effects)}const{rect:s,width:o,height:a}=t,l=s.x+f.r,c=s.y+f.r,u=l+o,m=c+a;let y=Object(h.i)(Object(d.h)(e.height||0));y>255?y=255:y<=0&&(y=Object(h.i)(m-c));let v=Object(h.i)(Object(d.h)(e.height/a*o||0));v>255?v=255:v<=0&&(v=Object(h.i)(u-l));let x=Object(d.h)(e.offsetX||0)+128;x>255&&(x=255);let b=Object(d.h)(-e.offsetY||0)+128;b>255&&(b=255);const O=e.scaleX||1,S=Object(p.a)(l,c),w=Object(p.a)(u,m),T=Object(p.b)(v,y,x,b),C=Object(p.a)(128*O,128),M=Object(p.b)(0,0,Object(g.b)(e.angle),e.colorLocked?1:0);return new Ve(r,t,n,S,w,T,C,M,e.effects)}static fromSimpleFill(e,t,i=!1){const{color:n}=e,r=n&&"esriSFSNull"!==e.style&&Object(_.d)(n)||0,s=Object(p.b)(0,0,0,i?255:0),o=e.materialKey;if(!t)return new Ve(o,null,r,0,0,0,0,s,null);const{rect:a,width:l,height:c}=t,u=a.x+f.r,d=a.y+f.r,m=u+l,g=d+c,y=Object(p.a)(u,d),v=Object(p.a)(m,g),x=Object(p.b)(Object(h.i)(m-u),Object(h.i)(g-d),0,0),b=Object(p.a)(128,128);return new Ve(o,t,r,y,v,x,b,s,null)}static fromPictureFill(e,t,i=!1){const n=f.q,{rect:r,width:s,height:o}=t,a=r.x+f.r,l=r.y+f.r,c=a+s,u=l+o,m=Object(p.a)(a,l),_=Object(p.a)(c,u);let g=Object(h.i)(Object(d.h)(e.width));g>255&&(g=255);let y=Object(h.i)(Object(d.h)(e.height));y>255&&(y=255);let v=Object(d.h)(e.xoffset)+128;v>255&&(v=255);let x=Object(d.h)(-e.yoffset)+128;x>255&&(x=255);const b=Object(p.b)(g,y,v,x),O=Object(p.a)(128*e.xscale,128*e.yscale),S=Object(p.b)(0,0,0,i?255:0),w=e.materialKey;return new Ve(w,t,n,m,_,b,O,S,null)}}var Re=Ve,Fe=i(398);const Ne=n.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class ke extends(ve(ie.a)){constructor(e,t,i,n,r,s,o,a,l,c,u,h,d,f,p,_){super();const g=m.c.load(e);t&&(g.sdf=t.sdf,g.pattern=!0,g.textureBinding=t.textureBinding),this._capType=n,this._joinType=r,this._miterLimitCosine=Object(y.b)(s),this.tessellationProperties._fillColor=o,this.tessellationProperties._tl=a,this.tessellationProperties._br=l,this._hasPattern=c,this._isDashed=u,this._joinOnUTurn=p,this._isColorLocked=h,this._zOrder=f,this.effects=_,this._materialKey=g.data,this.tessellationProperties._bitset=h?1:0,this.tessellationProperties._halfWidth=.5*i,this.tessellationProperties._halfReferenceWidth=.5*d,this._initializeTessellator(!1)}static fromCIMLine(e,t,i){const n=e.color,r=e.scaleFactor||1,s=e.isDashed;let o=e.cap;s&&1===o&&(o=2);const a=e.join,l=Object(d.h)(e.width)*r,c=Object(d.h)(e.referenceWidth),u=Object(d.h)(e.miterLimit),h=n&&Object(_.c)(n)||0;if(!t)return new ke(e.materialKey,t,l,o,a,u,h,0,0,!1,s,e.colorLocked,c,e.zOrder,i,e.effects);const{rect:m,width:g,height:y}=t,v=m.x+f.r,x=m.y+f.r,b=v+g,O=x+y,S=Object(p.a)(v,x),w=Object(p.a)(b,O);return new ke(e.materialKey,t,l,o,a,u,h,S,w,!0,s,e.colorLocked,c,e.zOrder,i,e.effects)}static fromSimpleLine(e,t,i){const{color:n}=e,r="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,s=Object(Fe.g)(e.cap||"round",r),o=Object(Fe.h)(e.join||"round");let a=n&&"esriSLSNull"!==e.style&&Object(_.d)(n)||0;"esriSLSNull"===e.style&&(a=0);const l=Object(d.h)(e.width),c=e.miterLimit;if(!t)return new ke(e.materialKey,t,l,s,o,c,a,0,0,!1,r,!1,l,0,i,null);const{rect:u,width:h,height:m}=t,g=u.x+f.r,y=u.y+f.r,v=g+h,x=y+m,b=Object(p.a)(g,y),O=Object(p.a)(v,x);return new ke(e.materialKey,t,l,s,o,c,a,b,O,!0,r,!1,l,0,i,null)}static fromPictureLineSymbol(e,t,i,n){return Ne.error("PictureLineSymbol support does not exist!"),null}}var Ue=ke;const Ge=n.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Be=new Array;function He(e,t){const i=e.length;return e.push(null),t.then(t=>e[i]=t),e}function qe(e){return!!(1&e)}class We{constructor(e,t){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new class{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){return this._resolver?this._resolver.promise.then(()=>this.acquire()):(this._resolver=Object(s.g)(),Object(s.r)())}release(){const e=this._resolver;this._resolver=null,e.resolve()}},this._fetchResource=e,this._joinOnUTurn=t}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(e,t){this._initErrorTemplates();const i=e.hash;if(this._symbolToTemplate.has(i))return this._symbolToTemplate.get(i);const n=new Array;t&&this._createMeshTemplates(n,t,!0),this._createMeshTemplates(n,e,!1);const r=this._createGroupId("expanded-cim"===e.type);return this._idToTemplateGroup.set(r,n),this._symbolToTemplate.set(i,r),r}getTemplateGroup(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):Be}getDynamicTemplateGroup(e){return this._idToTemplateGroup.has(e)?(qe(e)||Ge.error("mapview-template-store",`Id ${e} does not refer to a dynamic template`),this._idToTemplateGroup.get(e)):Be}getMosaicItem(e,t){const i=this._createTemplateId(),n=Object(s.f)(e=>this._idToResolver.set(i,e));return this._fetchQueue.push({symbol:e,id:i,glyphIds:t}),n}finalize(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,i){return e.acquire().then(()=>t(i)).then(()=>e.release()).catch(t=>{throw e.release(),t})}(this._lock,this._fetchAllQueuedResources.bind(this),e):Object(s.r)()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Object(l.c)(o.c),!1),marker:this._createMeshTemplates([],Object(l.c)(o.b),!1),line:this._createMeshTemplates([],Object(l.c)(o.d),!1)})}_fetchAllQueuedResources(e){if(!this._fetchQueue.length)return Object(s.r)();const t=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Object(s.a)(i).then(()=>this._fetchResource(t,e).then(e=>{for(const{id:t,mosaicItem:i}of e)this._idToResolver.get(t)(i),this._idToResolver.delete(t)})).catch(e=>{Object(s.b)(e)?this._fetchQueue=this._fetchQueue.concat(t):Ge.error(new r.a("mapview-template-store","Unable to fetch requested texture resources",e))})}_createGroupId(e){return this._idCounter++<<1|(e?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(e){const{spriteMosaicItem:t}=await this.getMosaicItem(e);return Object(a.a)(t,Ge)?u.a.fromSimpleMarker(e,t):this._markerError}async _createPMS(e){const{spriteMosaicItem:t}=await this.getMosaicItem(e);return Object(a.a)(t,Ge)?u.a.fromPictureMarker(e,t):this._markerError}async _createSFS(e,t){const{spriteMosaicItem:i}=await this.getMosaicItem(e);return Object(a.a)(i,Ge)?Re.fromSimpleFill(e,i,t):this._fillError}async _createPFS(e,t){const{spriteMosaicItem:i}=await this.getMosaicItem(e);return Object(a.a)(i,Ge)?Re.fromPictureFill(e,i,t):this._fillError}async _createSLS(e,t){const{spriteMosaicItem:i}=await this.getMosaicItem(e);return Object(a.a)(i,Ge)?Ue.fromSimpleLine(e,i,this._joinOnUTurn):this._lineError}async _createLMS(e){const{spriteMosaicItem:t}=await this.getMosaicItem(e);return Object(a.a)(t,Ge)?u.a.fromLineSymbolMarker(e,t):this._markerError}async _createTS(e){const{glyphMosaicItems:t}=await this.getMosaicItem(e);return c.a.fromText(e,t)}async _createCIMText(e){const{glyphMosaicItems:t}=await this.getMosaicItem(e.cim,Object(Pe.a)(e.text));return e.cim.mosaicHash=e.materialHash,Object(a.a)(t,Ge)?c.a.fromCIMText(e,t):this._textError}async _createCIMFill(e){e.cim.mosaicHash=e.materialHash;const{spriteMosaicItem:t}=await this.getMosaicItem(e.cim);return Object(a.a)(t,Ge)?Re.fromCIMFill(e,t):this._fillError}async _createCIMLine(e){e.cim.mosaicHash=e.materialHash;const{spriteMosaicItem:t}=await this.getMosaicItem(e.cim);return Object(a.a)(t,Ge)?Ue.fromCIMLine(e,t,this._joinOnUTurn):this._lineError}async _createCIMMarker(e){e.cim.mosaicHash=e.materialHash;const{spriteMosaicItem:t}=await this.getMosaicItem(e.cim);return Object(a.a)(t,Ge)?u.a.fromCIMMarker(e,t):this._markerError}async _createCIM(e){const t=e.templateHash;if(this._cimTemplateCache.has(t))return this._cimTemplateCache.get(t);let i;switch(e.type){case"marker":i=this._createCIMMarker(e);break;case"line":i=this._createCIMLine(e);break;case"fill":i=this._createCIMFill(e);break;case"text":i=this._createCIMText(e)}return i.then(e=>this._cimTemplateCache.set(t,e)),i}_createDynamicCIM(e){const t=e.templateHash;if(this._cimTemplateCache.has(t))return this._cimTemplateCache.get(t);let i;switch(e.type){case"marker":i=Ee.fromCIMMarker(e);break;case"line":i=be.fromCIMLine(e);break;case"fill":i=oe.fromCIMFill(e);break;case"text":i=Ae.fromCIMText(e)}return this._cimTemplateCache.set(t,i),i}_createPrimitiveMeshTemplates(e,t,i){switch(t.type){case"esriSMS":return He(e,this._createSMS(t));case"esriPMS":return He(e,this._createPMS(t));case"esriSFS":return He(e,this._createSFS(t,i));case"line-marker":return He(e,this._createLMS(t));case"esriPFS":return He(e,this._createPFS(t,i));case"esriSLS":return He(e,this._createSLS(t,!1));case"esriTS":return He(e,this._createTS(t));default:return Ge.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}_createMeshTemplates(e,t,i){if(-1!==t.type.indexOf("3d"))return Ge.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){for(const i of t.layers)"function"==typeof i.materialHash?e.push(this._createDynamicCIM(i)):He(e,this._createCIM(i));return e}if("composite-symbol"===t.type){for(const n of t.layers)this._createPrimitiveMeshTemplates(e,n,i);return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,i)}}},513:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var n=i(4),r=i(8),s=i(527),o=i(26),a=i(396),l=i(72),c=i(298),u=i(260),h=i(473),d=i(397),f=i(398);function p(e,t,i){if(!e.allDirty)if(null!=e.from&&null!=e.count){const n=Math.min(e.from,t),r=Math.max(e.from+e.count,t+i)-n;e.from=n,e.count=r}else e.from=t,e.count=i}var m=class{constructor(){this._dirties=Object(f.e)(()=>({indices:{from:null,count:null,allDirty:!1}}),()=>({vertices:{from:null,count:null,allDirty:!1}}))}hasDirty(){for(const e of this._dirties)if(null!==e.data.indices.count||e.data.indices.allDirty)return!0;return!1}markAllClean(){for(const e of this._dirties){e.data.indices.from=null,e.data.indices.count=null,e.data.indices.allDirty=!1;for(const t in e.buffers)e.buffers[t].data.vertices.from=null,e.buffers[t].data.vertices.count=null,e.buffers[t].data.vertices.allDirty=!1}}markAllDirty(){for(const e of this._dirties){e.data.indices.allDirty=!0;for(const t in e.buffers)e.buffers[t].data.vertices.allDirty=!0}}forEach(e){for(let t=0;t<this._dirties.length;++t){const i=this._dirties[t],n={};for(const e in i.buffers){const t=i.buffers[e].data.vertices;(t.allDirty||null!=t.from&&null!=t.count&&t.count>0)&&(n[e]=t)}const r=i.data.indices;let s;s=r.allDirty||null!=r.from&&null!=r.count&&r.count>0?{indices:r,vertices:n}:{indices:null,vertices:n},(s.indices||Object.keys(s).length>0)&&e(s,t)}}markDirtyIndices(e,t,i){p(this._dirties[e].data.indices,t,i)}markDirtyVertices(e,t,i,n){p(this._dirties[e].buffers[t].data.vertices,i,n)}};class _{constructor(e){this._largestRange=null,this._parent=e,this._updateLargestRange()}get largestRange(){return this._largestRange}rangeCreated(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}rangeResized(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}findBestRange(e){let t=this._parent._freeHead,i=null;for(;null!==t;)t.count>=e&&(!i||t.count-e<i.count-e)&&(i=t),t=t.next;return i}findAdjacentRanges(e,t){let i=!0,n=!1,r=null,s=this._parent._freeHead;for(;i&&!n;){const o=null!==r?r.from+r.count:0,a=null!==s?s.from:this._parent._size;e>=o&&e+t<=a?(i=!1,n=!0):null!==s?(r=s,s=s.next):i=!1}return[r,s]}_updateLargestRange(){let e=null,t=this._parent._freeHead;for(;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}class g{constructor(e,t){this._allocated=0,this._size=e,this._freeHead=e>0?{from:0,count:e,prev:null,next:null}:null,this._bookKeeper=t||new _(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(e){const t=this._bookKeeper.findBestRange(e);if(null===t)return-1;const i=t.from,n=t.count;if(t.from+=e,t.count-=e,this._bookKeeper.rangeResized(t,i,n),this._allocated+=e,0===t.count){const e=null!==t.prev?this._freeHead:t.next;g._removeRange(t),this._freeHead=e}return i}free(e,t){const[i,n]=this._bookKeeper.findAdjacentRanges(e,t),r={from:e,count:t,prev:i,next:n};if(null!==i&&(i.next=r),null!==n&&(n.prev=r),this._bookKeeper.rangeCreated(r),this._allocated-=t,null!==n&&r.from+r.count===n.from){const e=r.from,t=r.count;g._fuse(r,n),g._removeRange(n),this._bookKeeper.rangeResized(r,e,t),this._bookKeeper.rangeResized(n,void 0,0)}if(null!==i&&i.from+i.count===r.from){const e=i.from,t=i.count;g._fuse(i,r),g._removeRange(r),this._bookKeeper.rangeResized(i,e,t),this._bookKeeper.rangeResized(r,void 0,0)}this._freeHead=null!==r.prev?this._freeHead:r}get fragmentation(){const e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}static _removeRange(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}static _fuse(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}const y=["FILL","LINE","MARKER","TEXT","LABEL"];class v{constructor(e,t,i,n){this._strides=e,this._displayList=t,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=i;for(const t in e){this._freeListsAndStorage[t]={vtxFreeList:n?new g(n):null,idxFreeList:n?new g(n):null,vertexBuffers:{},indexBuffer:n?new Uint32Array(n):null};for(const i in e[t])this._freeListsAndStorage[t].vertexBuffers[i]={data:n?Object(f.b)(n,e[t][i]):null,stride:e[t][i]}}}static fromTileData(e,t){const i=function(e){const t=e.getStrides(),i={};for(let e=0;e<t.length;e++)i[y[e]]=t[e];return i}(e),n=[0,0,0,0,0],r=[0,0,0,0,0],s=e.tileDisplayData.displayObjects;for(const e of s)for(const t of e.displayRecords)n[t.geometryType]=Math.max(n[t.geometryType],t.vertexFrom+t.vertexCount),r[t.geometryType]=Math.max(r[t.geometryType],t.indexFrom+t.indexCount);const o=new v(i,e.tileDisplayData.displayList,t,null);for(let t=0;t<e.tileBufferData.geometries.length;++t){const i=n[t],s=r[t],a=e.tileBufferData.geometries[t],l=y[t],c=o._storageFor(l),u=e.tileBufferData.geometries[t].indexBuffer;let h;c.indexBuffer=u,c.idxFreeList=new g(u.length),c.idxFreeList.allocate(s);for(const i in a.vertexBuffer){const n=e.tileBufferData.geometries[t].vertexBuffer[i];c.vertexBuffers[i].data=n.data,c.vertexBuffers[i].stride=n.stride;const r=Object(f.o)(n.stride),s=n.data.length*r/n.stride;h||(h=s)}c.vtxFreeList=new g(h),c.vtxFreeList.allocate(i)}return o}delete(e){const t=y[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}setMeshData(e,t,i,n,r){const s=y[e.geometryType];e.meshData=null;let o=void 0,a=void 0;void 0===e.vertexFrom?(a=t.vertexCount,o=this._allocateVertices(s,a)):t.vertexCount>e.vertexCount?(this._freeVertices(s,e.vertexFrom,e.vertexCount),a=t.vertexCount,o=this._allocateVertices(s,a)):t.vertexCount===e.vertexCount?(o=e.vertexFrom,a=e.vertexCount):(this._freeVertices(s,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),o=e.vertexFrom,a=t.vertexCount);let l=!0,c=void 0,u=void 0,h=void 0;if(void 0===e.indexFrom?(c=r,h=t.indexCount,u=this._allocateIndices(s,h)):t.indexCount>e.indexCount?(c=this._displayList.removeFromList(e),this._freeIndices(s,e.indexFrom,e.indexCount),h=t.indexCount,u=this._allocateIndices(s,h)):t.indexCount===e.indexCount?(l=!1,u=e.indexFrom,h=e.indexCount):(c=this._displayList.removeFromList(e),this._freeIndices(s,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),u=e.indexFrom,h=t.indexCount),-1!==o&&-1!==u){const r=this._storageFor(s);if(Object(f.d)(o,u,r.vertexBuffers,r.indexBuffer,t,i,n),e.vertexFrom=o,e.indexFrom=u,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in i)this._dirtyMap.markDirtyVertices(e.geometryType,t,e.vertexFrom,e.vertexCount)}return l&&this._displayList.addToList(e,c),!0}return-1!==o&&this._freeVertices(s,o,a),-1!==u&&this._freeIndices(s,u,h),e.setMeshDataFromBuffers(t,i,n),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}tryAddMeshData(e,t){const i=t.vertexBuffer,n=t.indexBuffer,r=y[e.geometryType],s=this._allocateVertices(r,e.vertexCount);if(-1===s)return this._freeVertices(r,s,e.vertexCount),!1;const o=this._allocateIndices(r,e.indexCount);if(-1===o)return this._freeVertices(r,s,e.vertexCount),this._freeIndices(r,o,e.indexCount),!1;const a=this._storageFor(r);if(Object(f.d)(s,o,a.vertexBuffers,a.indexBuffer,e,i,n),e.vertexFrom=s,e.indexFrom=o,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in i)this._dirtyMap.markDirtyVertices(e.geometryType,t,s,e.vertexCount)}return this._displayList.addToList(e),!0}_allocateVertices(e,t){const i=this._storageFor(e),n=i.vtxFreeList.allocate(t);return-1===n||i.vtxFreeList.fragmentation>.5?-1:n}_freeVertices(e,t,i){const r=this._storageFor(e);if(r.vtxFreeList.free(t,i),Object(n.a)("esri-feature-tiles-debug"))for(const n in r.vertexBuffers){const s=r.vertexBuffers[n].data,o=this._stridesFor(e,n),a=Object(f.o)(o),l=t*o/a,c=i*o/a;for(let e=l;e<l+c;++e)s[e]=0}}_freeIndices(e,t,i){const r=this._storageFor(e);if(r.idxFreeList.free(t,i),Object(n.a)("esri-feature-tiles-debug")){const e=r.indexBuffer;for(let n=t;n<t+i;++n)e[n]=0}}_allocateIndices(e,t){const i=this._storageFor(e),n=i.idxFreeList.allocate(t);return-1===n||i.idxFreeList.fragmentation>.5?-1:n}_storageFor(e){return this._freeListsAndStorage[e]}_stridesFor(e,t){return this._strides[e][t]}}var x=v,b=(i(404),i(405));i(406),i(407),i(408),i(409),i(411);const O=new Set;class S extends h.a{constructor(e,t,i=!1){super(e,t,[a.F,a.F]),this._data=null,this._displayList=null,this._wglBuffers=null,this._deferPatches=!1,this._dirtyMap=new m,this._labelIndex=null,this._lastCommitTime=0,this._patchQueue=new s.a(100),this.fader=new class{constructor(e=400){this.duration=e,this._lastTime=0,this._elapsed=0,this._value=0,this._finished=!1}get value(){return this._value}reset(){this._lastTime=0,this._elapsed=0,this._value=0}step(){const e=performance.now();if(0===this._lastTime)return this._lastTime=e,this._value=0,!0;if(this._elapsed>=this.duration)return!0;const t=e-this._lastTime;return this._elapsed+=t,this._lastTime=e,this._value=Math.min(this._elapsed/this.duration,1),!1}},this._patchCount=0,this._dirty=!0,this._replaceBuffers=!1,this._uploadsLocked=!1,this._hasData=!1,this._invalidated=!1,this.transforms.labelMat2d=Object(c.a)(),this._ensureCorrectZOrder=i,this._deferPatches=!i}destroy(){super.destroy(),this.clear()}get displayObjects(){var e;return null!=(e=this._displayObjects)?e:[]}get isDirty(){return this._dirty}get hasData(){return!!this._hasData}get labelIndex(){return this._labelIndex}set isDirty(e){this._dirty=e,this.requestRender()}get patchCount(){return this._patchCount}getGeometry(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}getDisplayList(){return this._displayList}setTransform(e,t){super.setTransform(e,t);const i=this.transforms.labelMat2d,n=e.getScreenTransform(i,t),r=Object(u.a)();Object(o.n)(r,this.coords,n),Object(l.d)(i),Object(l.h)(i,i,r),Object(l.e)(i,e.viewMat2d,i)}setData(e){const t=e.addOrUpdate,i=e.remove;e.clear&&(this.clear(),this._patchQueue.clear(),this._hasData=!1),"replace"===e.type&&(this._replaceBuffers=!0,this._patchQueue.clear(),this._data=null),!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new m,this._dispRecStore=x.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._patchCount++,this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||i.length)?this._deferPatches?this._patchQueue.enqueue(e):this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}lockUploads(){this._uploadsLocked=!0}unlockUploads(){this._uploadsLocked=!1,this.requestRender()}commitChanges(e){if(!e.time||e.time!==this._lastCommitTime){if(this._lastCommitTime=e.time,this.fader.step()||this.requestRender(),this._patchQueue.size){const e=this._patchQueue.dequeue();Object(r.h)(e)&&(e.end&&this.ready(),this._patchCount++,this._doPatchData(e),this.requestRender(),this._hasData=!0)}this._uploadsLocked?this.requestRender():this.visible&&this._data&&(this._replaceBuffers&&(this._wglBuffers&&this._wglBuffers.dispose(),this._wglBuffers=null,this._replaceBuffers=!1),this._wglBuffers||(this._wglBuffers=new class{constructor(e){this.geometryMap=Object(f.e)(()=>({indexBuffer:b.a.createIndex(e,35044),vao:null}),(t,i)=>({vertexBuffer:b.a.createVertex(e,f.a[i])}))}dispose(){for(let e=0;e<5;e++){const t=this.geometryMap[e];if(t){t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose();for(const e in t.buffers)t.buffers[e]&&t.buffers[e].data.vertexBuffer.dispose()}}}get(e){const t=this.geometryMap[e],i={};for(const e in t.buffers)i[e]=t.buffers[e].data.vertexBuffer;return{indexBuffer:t.data.indexBuffer,get vao(){return t.data.vao},set vao(e){t.data.vao=e},vertexBufferMap:i}}has(e){return null!=this.geometryMap[e]}upload(e,t){t.forEach((t,i)=>{this._upload(t,i,e)})}_upload(e,t,i){if(e.indices&&(e.indices.allDirty?this._uploadIndices(i,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(i,t,e.indices.from,e.indices.count)),e.vertices){const n=e.vertices;for(const e in n){const r=n[e];r.allDirty?this._uploadVertices(i,t,e):null!=r.from&&null!=r.count&&this._uploadVertices(i,t,e,r.from,r.count)}}}_uploadVertices(e,t,i,n,r){const s=this.geometryMap[t];if(!s)return;const o=e.geometries[t].vertexBuffer[i];if(!o)return;const a=o.stride,l=o.data.buffer;s.buffers[i]&&l.byteLength>0&&(null!=n&&null!=r?s.buffers[i].data.vertexBuffer.setSubData(l,n*a,n*a,(n+r)*a):s.buffers[i].data.vertexBuffer.setData(l))}_uploadIndices(e,t,i,n){const r=this.geometryMap[t];if(!r)return;const s=e.geometries[t].indexBuffer.buffer;r.data.indexBuffer&&s.byteLength>0&&(null!=i&&null!=n?r.data.indexBuffer.setSubData(s,4*i,4*i,4*(i+n)):r.data.indexBuffer.setData(s))}}(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._rebuildLabelIndex(),this._dirtyMap.markAllClean()))}}clear(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}_doPatchData(e){try{if("new"===e.type){if(!e.addOrUpdate)return;this._invalidated=!0;const t=this._bulkAddFeatures(e);t&&(this._dirtyMap.markAllDirty(),this._data.reshuffleV2(e,t.objectIndex,t.recordIndex),this._dispRecStore=x.fromTileData(this._data,this._dirtyMap))}else this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=x.fromTileData(this._data,this._dirtyMap))}catch(e){Object(n.a)("esri-2d-debug")&&console.debug("Encountered an error while patching:",e)}this.requestRender()}_rebuildLabelIndex(){var e,t;if(null==(e=this._data)||null==(t=e.tileBufferData.geometries[d.d.LABEL])?void 0:t.indexBuffer.length){this.isDirty=!0,this._labelIndex=this._initLabelIndex();for(const e of this.displayObjects)for(const t of e.metrics)this._insertIntoLabelIndex(t)}}_insertIntoLabelIndex(e){e.xBucket<0||e.yBucket<0||e.yBucket>3||e.xBucket>3||this.labelIndex[e.yBucket][e.xBucket].push(e)}_initLabelIndex(){const e=[];for(let t=0;t<a.F/a.d;t++){e.push([]);for(let i=0;i<a.F/a.d;i++)e[t].push([])}return e}_bulkAddFeatures(e){const t=e.addOrUpdate.tileDisplayData.displayObjects,i=this._data.tileDisplayData.displayObjects;for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.displayRecords.length;++t){const i=r.displayRecords[t],s=e.addOrUpdate.tileBufferData.geometries[i.geometryType];if(!this._dispRecStore.tryAddMeshData(i,s))return{objectIndex:n,recordIndex:t}}this._data.tileDisplayData.hasRegistry&&this._data.tileDisplayData.displayObjectRegistry.set(r.id,r),i.push(r)}return null}_patchData(e){let t=!0;const i=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],n=(e.remove||[]).slice();for(const e of i)null!=e.insertAfter&&n.push(e.id);for(const e of n){const t=this._data.tileDisplayData.displayObjectRegistry.get(e);if(t){this._data.tileDisplayData.displayList.removeFromList(t.displayRecords);for(const e of t.displayRecords)this._dispRecStore.delete(e);this._data.tileDisplayData.displayObjectRegistry.delete(e);const i=this._data.tileDisplayData.displayObjects.indexOf(t);this._data.tileDisplayData.displayObjects.splice(i,1)}}for(const n of i){let i,r=this._data.tileDisplayData.displayObjectRegistry.get(n.id);if(r){const e=r.displayRecords;r.set(n),r.displayRecords=e;const t=r.displayRecords.length;for(let e=0;e<t;++e){const t=r.displayRecords[e],i=n.displayRecords[e];(e>=n.displayRecords.length||t.geometryType!==i.geometryType||t.symbolLevel!==i.symbolLevel||t.zOrder!==i.zOrder||t.materialKey!==i.materialKey)&&(this._dispRecStore.delete(r.displayRecords[e]),e<n.displayRecords.length&&(r.displayRecords[e]=void 0))}r.displayRecords.length=n.displayRecords.length,r.metrics=n.metrics}else{let e;r=n.copy(),r.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(n.id,r);const t=this._data.tileDisplayData.displayObjects;if(null!=r.insertAfter)if(i={},r.insertAfter>=0){const i=this._data.tileDisplayData.displayObjectRegistry.get(r.insertAfter);i?(e=t.indexOf(i)+1,e<t.length?t.splice(e,0,r):(t.push(r),e=t.length)):(t.push(r),e=t.length)}else t.unshift(r),e=0;else t.push(r),e=t.length;if(i){let r;if(this._data.tileDisplayData.displayList.unified)r=n.displayRecords.length>0?1:0;else{O.clear();for(const e of n.displayRecords){const t=this._data.tileDisplayData.displayList.getDPInfoType(e.geometryType);O.add(t)}r=O.size}let s=0;for(let n=e-1;n>=0&&s<r;--n)for(let e=t[n].displayRecords.length-1;e>=0&&s<r;--e){const r=t[n].displayRecords[e],o=this._data.tileDisplayData.displayList.getDPInfoType(r.geometryType);i[o]||(i[o]=r,++s)}}}const s=n.displayRecords.length;for(let o=0;o<s;++o){const s=n.displayRecords[o];let a=r.displayRecords[o];a?(a.meshData=s.meshData,a.materialKey=s.materialKey):(a=s.copy(),a.vertexFrom=void 0,a.indexFrom=void 0,r.displayRecords[o]=a);const l=s.geometryType,c=this._data.tileDisplayData.displayList.getDPInfoType(l),u=e.addOrUpdate.tileBufferData.geometries[l],h=u.vertexBuffer,d=u.indexBuffer;let f=void 0;i&&(f=i[c]?this._data.tileDisplayData.displayList.splitAfter(i[c]):-1),t=this._dispRecStore.setMeshData(a,s,h,d,f)&&t,i&&null!=a.indexFrom&&null!=a.indexFrom&&(i[c]=a)}}return t}}},515:function(e,t,i){"use strict";function n(e,t){return e?t?4:3:t?3:2}function r(e,t,i,r,a){if(!t||!t.lengths.length)return null;const l="upperLeft"===(null==a?void 0:a.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const c=e.coords,u=[],h=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=t,p=n(i,r);let m=0;for(const e of d){const t=s(h,f,m,e,i,r,l);t&&u.push(t),m+=e*p}if(u.sort((e,t)=>{let n=l*e[2]-l*t[2];return 0===n&&i&&(n=e[4]-t[4]),n}),u.length){let e=6*u[0][2];c[0]=u[0][0]/e,c[1]=u[0][1]/e,i&&(e=6*u[0][4],c[2]=0!==e?u[0][3]/e:0),(c[0]<h[0]||c[0]>h[1]||c[1]<h[2]||c[1]>h[3]||i&&(c[2]<h[4]||c[2]>h[5]))&&(c.length=0)}if(!c.length){const e=t.lengths[0]?o(f,0,d[0],i,r):null;if(!e)return null;c[0]=e[0],c[1]=e[1],i&&e.length>2&&(c[2]=e[2])}return e}function s(e,t,i,r,s,o,a=1){const l=n(s,o);let c=i,u=i+l,h=0,d=0,f=0,p=0,m=0;for(let i=0,n=r-1;i<n;i++,c+=l,u+=l){const i=t[c],n=t[c+1],r=t[c+2],o=t[u],a=t[u+1],l=t[u+2];let _=i*a-o*n;p+=_,h+=(i+o)*_,d+=(n+a)*_,s&&(_=i*l-o*r,f+=(r+l)*_,m+=_),i<e[0]&&(e[0]=i),i>e[1]&&(e[1]=i),n<e[2]&&(e[2]=n),n>e[3]&&(e[3]=n),s&&(r<e[4]&&(e[4]=r),r>e[5]&&(e[5]=r))}if(p*a>0&&(p*=-1),m*a>0&&(m*=-1),!p)return null;const _=[h,d,.5*p];return s&&(_[3]=f,_[4]=.5*m),_}function o(e,t,i,r,s){const o=n(r,s);let h=t,d=t+o,f=0,p=0,m=0,_=0;for(let t=0,n=i-1;t<n;t++,h+=o,d+=o){const t=e[h],i=e[h+1],n=e[h+2],s=e[d],o=e[d+1],g=e[d+2],y=r?l(t,i,n,s,o,g):a(t,i,s,o);if(y)if(f+=y,r){const e=u(t,i,n,s,o,g);p+=y*e[0],m+=y*e[1],_+=y*e[2]}else{const e=c(t,i,s,o);p+=y*e[0],m+=y*e[1]}}return f>0?r?[p/f,m/f,_/f]:[p/f,m/f]:i>0?r?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,i,n){const r=i-e,s=n-t;return Math.sqrt(r*r+s*s)}function l(e,t,i,n,r,s){const o=n-e,a=r-t,l=s-i;return Math.sqrt(o*o+a*a+l*l)}function c(e,t,i,n){return[e+.5*(i-e),t+.5*(n-t)]}function u(e,t,i,n,r,s){return[e+.5*(n-e),t+.5*(r-t),i+.5*(s-i)]}i.d(t,"a",(function(){return r}))},517:function(e,t,i){"use strict";i.d(t,"a",(function(){return E}));var n=i(398),r=class{constructor(){this._byGeometryType=null}get satisfied(){return!this._byGeometryType}reset(){this._byGeometryType=null}verticesFor(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}indicesFor(e){return this._byGeometryType?this._byGeometryType[e].indices:0}needMore(e,t,i){if(!t&&!i)return;this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);const n=this._byGeometryType[e];n.vertices+=t,n.indices+=i}};class s{constructor(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}clone(){const e=new s;for(let t=0;t<this.geometries.length;t++){const i=this.geometries[t],n=e.geometries[t];n.indexBuffer=i.indexBuffer.slice(),n.vertexBuffer={};for(const e in i.vertexBuffer){const{data:t,stride:r}=i.vertexBuffer[e];n.vertexBuffer[e]={data:t.slice(),stride:r}}}return e}static deserialize(e){const t=new s;for(let i=0;i<5;++i){t.geometries[i].indexBuffer=new Uint32Array(e.geometries[i].indexBuffer),t.geometries[i].vertexBuffer={};for(const r in e.geometries[i].vertexBuffer)t.geometries[i].vertexBuffer[r]={data:Object(n.c)(e.geometries[i].vertexBuffer[r].data,e.geometries[i].vertexBuffer[r].stride),stride:e.geometries[i].vertexBuffer[r].stride}}return t}serialize(){const e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]};for(let t=0;t<5;++t)for(const i in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[i]={data:this.geometries[t].vertexBuffer[i].data.buffer,stride:this.geometries[t].vertexBuffer[i].stride};return e}getBuffers(){const e=[];for(let t=0;t<5;++t){e.push(this.geometries[t].indexBuffer.buffer);for(const i in this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[i].data.buffer)}return e}}var o=s,a=i(440),l=i(5),c=i(397);const u=l.a.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");function h(e,t,i,...n){t<e.length?e.splice(t,i,...n):e.push(...n)}const d=new Map;d.set(c.c.MAP,[c.d.FILL,c.d.LINE,c.d.MARKER,c.d.TEXT]),d.set(c.c.LABEL,[c.d.LABEL]),d.set(c.c.LABEL_ALPHA,[c.d.LABEL]);class f{constructor(e=!1){this.symbolLevels=[],this.unified=e}replay(e,t,i){if(this.unified)for(const n of this.symbolLevels)for(const r of n.zLevels){const n=r.geometryDPInfo;for(const r in n)if(n[r])for(const s of n[r]){const n=e.painter.getGeometryBrush(s.geometryType),r=t.getGeometry(s.geometryType);n.prepareState(e,t),n.drawGeometry(e,t,s,r,i)}}}get empty(){return!this.symbolLevels||0===this.symbolLevels.length}clear(){this.symbolLevels.length=0}addToList(e,t){if(Array.isArray(e))for(const i of e)this._addToList(i,t);else this._addToList(e,t)}removeFromList(e){Array.isArray(e)||(e=[e]);let t=null;for(const i of e)t=this._removeFromList(i);return t}byType(e,t){for(const i of this.symbolLevels)for(const n of i.zLevels){const i=n.geometryDPInfo,r=this.getDPInfoType(e);if(i[r])for(const e of i[r])t(e)}}clone(){const e=new f(this.unified);for(const t of this.symbolLevels)e.symbolLevels.push(t.clone());return e}splitAfter(e){const t=this._getDisplayList(e.symbolLevel,e.zOrder,e.geometryType),i=t.length,n=e.indexFrom+e.indexCount;for(let r=0;r<i;++r){const i=t[r];if(i.geometryType===e.geometryType&&n>i.indexFrom&&n<=i.indexFrom+i.indexCount){if(n<i.indexFrom+i.indexCount){const e=new p;e.geometryType=i.geometryType,e.materialKey=i.materialKey,e.indexFrom=n,e.indexCount=i.indexFrom+i.indexCount-n,t.splice(r+1,0,e),i.indexCount=n-i.indexFrom}return r}}}_addToList(e,t){const i=e.symbolLevel,n=e.zOrder,r=this._getDisplayList(i,n,e.geometryType),s=null!=t?t:r.length-1,o=s>=0&&s<r.length?r[s]:null;if(null===o||o.materialKey!==e.materialKey||o.indexFrom+o.indexCount!==e.indexFrom||this.unified&&o.geometryType!==e.geometryType){const t=new p;t.indexFrom=e.indexFrom,t.indexCount=e.indexCount,t.materialKey=e.materialKey,t.geometryType=e.geometryType,h(r,s+1,0,t)}else o.indexCount+=e.indexCount}_removeFromList(e){const t=e.symbolLevel,i=e.zOrder,n=this._getDisplayList(t,i,e.geometryType),r=n.length;let s=void 0;for(let t=0;t<r;++t){const i=n[t];if(e.indexFrom+e.indexCount>i.indexFrom&&e.indexFrom<i.indexFrom+i.indexCount&&(!this.unified||i.geometryType===e.geometryType)){s=t;break}}if(void 0!==s){const t=n[s];if(e.indexFrom===t.indexFrom)return t.indexCount-=e.indexCount,t.indexFrom+=e.indexCount,0===t.indexCount&&h(n,s,1),s-1;if(e.indexFrom+e.indexCount===t.indexFrom+t.indexCount)return t.indexCount-=e.indexCount,0===t.indexCount?(h(n,s,1),s-1):s;{const i=t.indexFrom,r=e.indexFrom-t.indexFrom,o=e.indexCount,a=t.indexFrom+t.indexCount-(e.indexFrom+e.indexCount);t.indexCount=r;const l=new p;return l.geometryType=t.geometryType,l.materialKey=t.materialKey,l.indexFrom=i+r+o,l.indexCount=a,h(n,s+1,0,l),s}}return null}_getDisplayList(e,t,i){let n;const r=this.symbolLevels.length;for(let t=0;t<r;t++)if(this.symbolLevels[t].symbolLevel===e){n=this.symbolLevels[t];break}let s;n||(n=new g,n.symbolLevel=e,this.symbolLevels.push(n));const o=n.zLevels.length;for(let e=0;e<o;e++)if(n.zLevels[e].zLevel===t){s=n.zLevels[e];break}let a;if(s||(s=new _,s.geometryDPInfo=new m,s.zLevel=t,n.zLevels.push(s)),this.unified)s.geometryDPInfo.unified||(s.geometryDPInfo.unified=[]),a=s.geometryDPInfo.unified;else switch(i){case c.d.FILL:s.geometryDPInfo.fill||(s.geometryDPInfo.fill=[]),a=s.geometryDPInfo.fill;break;case c.d.LINE:s.geometryDPInfo.line||(s.geometryDPInfo.line=[]),a=s.geometryDPInfo.line;break;case c.d.MARKER:s.geometryDPInfo.marker||(s.geometryDPInfo.marker=[]),a=s.geometryDPInfo.marker;break;case c.d.TEXT:s.geometryDPInfo.text||(s.geometryDPInfo.text=[]),a=s.geometryDPInfo.text;break;case c.d.LABEL:s.geometryDPInfo.label||(s.geometryDPInfo.label=[]),a=s.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+i+"'.")}return a}getDPInfoType(e){if(this.unified)return"unified";switch(e){case c.d.FILL:return"fill";case c.d.LINE:return"line";case c.d.MARKER:return"marker";case c.d.TEXT:return"text";case c.d.LABEL:return"label";default:return void u.error("DisplayList: Tried to convert unknown geometryType: "+e)}}}class p{constructor(){this.materialKey=null,this.indexFrom=0,this.indexCount=0}clone(){const e=new p;return e.geometryType=this.geometryType,e.materialKey=this.materialKey,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e}}class m{constructor(){this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}clone(){const e=new m;return e.fill=this.fill&&this.fill.map(e=>e.clone()),e.line=this.line&&this.line.map(e=>e.clone()),e.marker=this.marker&&this.marker.map(e=>e.clone()),e.text=this.text&&this.text.map(e=>e.clone()),e.label=this.label&&this.label.map(e=>e.clone()),e.unified=this.unified&&this.unified.map(e=>e.clone()),e}}class _{constructor(){this.geometryDPInfo=new m}clone(){const e=new _;return e.zLevel=this.zLevel,e.geometryDPInfo=this.geometryDPInfo.clone(),e}}class g{constructor(){this.zLevels=[]}clone(){const e=new g;e.symbolLevel=this.symbolLevel;for(const t of this.zLevels)e.zLevels.push(t.clone());return e}}var y=f,v=i(426),x=i(480);function b(e){const t=[[],[],[],[],[]],i=e;for(const e of i)for(const i of e.displayRecords)t[i.geometryType].push(i);return t}class O{constructor(){}get hasRegistry(){return!!this._displayObjectRegistry}get displayObjectRegistry(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(const e of this.displayObjects)this._displayObjectRegistry.set(e.id,e)}return this._displayObjectRegistry}get displayList(){return this._displayList}computeDisplayList(e){if(this._displayList=new y(e),e)for(const e of this.displayObjects)for(const t of e.displayRecords)this._displayList.addToList(t);else{const e=b(this.displayObjects),t=e.length;for(let i=0;i<t;++i){const t=e[i];this._displayList.addToList(t)}}}clone(){const e=new O;return this.displayObjects&&(e.displayObjects=this.displayObjects.map(e=>e.clone())),e}serialize(e){return Object(v.b)(e,this.displayObjects),e}_deserializeObjects(e){const t=e.readInt32(),i=new Array(t),n=new Map;for(let t=0;t<i.length;++t){const r=x.a.deserialize(e);i[t]=r,n.set(r.id,r)}this.displayObjects=i,this._displayList=null,this._displayObjectRegistry=n}static deserialize(e){const t=new O;return t._deserializeObjects(e),t}}var S=O,w=i(443),T=i(497),C=i(490);const M=new r,I=new r;function j(e,t){const i={};for(const r in e){const s={data:Object(n.b)(t,e[r]),stride:e[r]};i[r]=s}return i}class E{constructor(){this.tileDisplayData=null,this.tileBufferData=null}reshuffle(){M.reset();const e=b(this.tileDisplayData.displayObjects);for(const t of e)for(const e of t)e&&M.needMore(e.geometryType,e.meshData?e.meshData.vertexCount:e.vertexCount,e.meshData?e.meshData.indexData.length:e.indexCount);const t=e.length,i=new o;for(let e=0;e<t;++e){i.geometries[e].indexBuffer=new Uint32Array(Math.round(1.5*M.indicesFor(e)));const t=[];for(const i in this.tileBufferData.geometries[e].vertexBuffer)t.push(this.tileBufferData.geometries[e].vertexBuffer[i].stride);const r=E._computeVertexAlignment(t),s=Math.round(1.5*M.verticesFor(e)),o=E._align(s,r);for(const t in this.tileBufferData.geometries[e].vertexBuffer){const r=this.tileBufferData.geometries[e].vertexBuffer[t].stride;i.geometries[e].vertexBuffer[t]={stride:r,data:Object(n.b)(o,r)}}}I.reset(),this.tileDisplayData.displayList.clear();for(let r=0;r<t;++r){const t=e[r];for(const e of t){if(e.meshData)e.writeMeshDataToBuffers(I.verticesFor(r),i.geometries[r].vertexBuffer,I.indicesFor(r),i.geometries[r].indexBuffer),e.meshData=null;else{const t=this.tileBufferData.geometries[r].vertexBuffer,s=this.tileBufferData.geometries[r].indexBuffer,o=i.geometries[r].vertexBuffer,a=i.geometries[r].indexBuffer,l=I.verticesFor(r),c=I.indicesFor(r);Object(n.d)(l,c,o,a,e,t,s),e.vertexFrom=l,e.indexFrom=c}I.needMore(r,e.vertexCount,e.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(t)}if(this.tileDisplayData.displayList.unified)for(const e of this.tileDisplayData.displayObjects)this.tileDisplayData.displayList.addToList(e.displayRecords);this.tileBufferData=i}reshuffleV2(e,t,i){const r=e.addOrUpdate.tileDisplayData.displayObjects,s=this.tileDisplayData.displayObjects;M.reset();for(let e=0;e<s.length;e++){const t=s[e];for(let e=0;e<t.displayRecords.length;e++){const i=t.displayRecords[e];M.needMore(i.geometryType,i.vertexCount,i.indexCount)}}for(let e=t;e<r.length;e++){const n=r[e];for(let r=e===t?i:0;r<n.displayRecords.length;r++){const e=n.displayRecords[r];M.needMore(e.geometryType,e.vertexCount,e.indexCount)}}const a=new o;for(let e=0;e<5;e++){a.geometries[e].indexBuffer=new Uint32Array(Math.round(1.5*M.indicesFor(e)));const t=[],i=this.tileBufferData.geometries[e].vertexBuffer;for(const e in i)t.push(i[e].stride);const r=E._computeVertexAlignment(t),s=Math.round(1.5*M.verticesFor(e)),o=E._align(s,r);for(const t in i){const r=i[t].stride,s=Object(n.b)(o,r);a.geometries[e].vertexBuffer[t]={stride:r,data:s}}}I.reset(),this.tileDisplayData.displayList.clear();for(let e=0;e<s.length;e++){const t=s[e];for(let e=0;e<t.displayRecords.length;e++){const i=t.displayRecords[e],r=i.geometryType,s=this.tileBufferData.geometries[r].vertexBuffer,o=this.tileBufferData.geometries[r].indexBuffer,l=a.geometries[r].vertexBuffer,c=a.geometries[r].indexBuffer,u=I.verticesFor(r),h=I.indicesFor(r);Object(n.d)(u,h,l,c,i,s,o),i.vertexFrom=u,i.indexFrom=h,I.needMore(r,i.vertexCount,i.indexCount),this.tileDisplayData.displayList.addToList(i)}}if(0!==i){const e=r[t];for(let t=0;t<i;t++){const i=e.displayRecords[t],r=i.geometryType,s=this.tileBufferData.geometries[r].vertexBuffer,o=this.tileBufferData.geometries[r].indexBuffer,l=a.geometries[r].vertexBuffer,c=a.geometries[r].indexBuffer,u=I.verticesFor(r),h=I.indicesFor(r);Object(n.d)(u,h,l,c,i,s,o),i.vertexFrom=u,i.indexFrom=h,I.needMore(r,i.vertexCount,i.indexCount),this.tileDisplayData.displayList.addToList(i)}}for(let s=t;s<r.length;s++){const o=r[s];for(let r=s===t?i:0;r<o.displayRecords.length;r++){const t=o.displayRecords[r],i=t.geometryType,s=e.addOrUpdate.tileBufferData.geometries[i],l=s.vertexBuffer,c=s.indexBuffer,u=a.geometries[i].vertexBuffer,h=a.geometries[i].indexBuffer,d=I.verticesFor(i),f=I.indicesFor(i);Object(n.d)(d,f,u,h,t,l,c),t.vertexFrom=d,t.indexFrom=f,I.needMore(i,t.vertexCount,t.indexCount),this.tileDisplayData.displayList.addToList(t)}this.tileDisplayData.hasRegistry&&this.tileDisplayData.displayObjectRegistry.set(o.id,o),this.tileDisplayData.displayObjects.push(o)}this.tileBufferData=a}getStrides(){const e=[];for(let t=0;t<this.tileBufferData.geometries.length;++t){const i=this.tileBufferData.geometries[t];e[t]={};for(const n in i.vertexBuffer)e[t][n]=i.vertexBuffer[n].stride}return e}clone(){const e=new E;return e.tileBufferData=this.tileBufferData.clone(),e.tileDisplayData=this.tileDisplayData.clone(),e}_guessSize(){const{displayObjects:e}=this.tileDisplayData,t=Math.min(e.length,4);let i=0;for(let n=0;n<t;n++)i=Math.max(i,e[n].displayRecords.length);return 2*(12*e.length+e.length*i*40)}serialize(){const e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),i=this.tileDisplayData.serialize(new w.a(Int32Array,this._guessSize())).buffer();return t.push(i),{result:{displayData:i,bufferData:e},transferList:t}}static decode(e){const t=T.a.deserializeDisplayObjects(e),i={};for(const t in e.vertexBuffersMap)i[t]=C.a.decode(e.vertexBuffersMap[t]);return E.fromMeshData({displayObjects:t,vertexBuffersMap:i})}static fromMeshData(e){const t=new E,i=new S,n=new o;i.displayObjects=e.displayObjects;for(const t in e.vertexBuffersMap){const i=e.vertexBuffersMap[t];n.geometries[t].indexBuffer=i.indexBuffer,n.geometries[t].vertexBuffer=i.namedBuffers}return t.tileDisplayData=i,t.tileBufferData=n,t}static bind(e,t){const i=new E;return i.tileDisplayData=e,i.tileBufferData=t,i}static create(e,t){const i=new E;i.tileDisplayData=new S,i.tileDisplayData.displayObjects=e;const n=[0,0,0,0,0],r=[0,0,0,0,0],s=[[],[],[],[],[]];for(const t of e)for(const e of t.displayRecords)s[e.geometryType].push(e),n[e.geometryType]+=e.meshData.vertexCount,r[e.geometryType]+=e.meshData.indexData.length;const l=new o,c=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(t);for(let e=0;e<5;e++){const t=new Uint32Array(r[e]),i=j(c[e],n[e]);a.a.writeAllMeshDataToBuffers(s[e],i,t),l.geometries[e]={indexBuffer:t,vertexBuffer:i}}return i.tileBufferData=l,i}static _align(e,t){const i=e%t;return 0===i?e:e+(t-i)}static _computeVertexAlignment(e){let t=!1,i=!1;for(const n of e)n%4==2?t=!0:n%4!=0&&(i=!0);return i?4:t?2:1}}},518:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));i(7);var n=i(155),r=(i(214),i(501)),s=i(397),o=i(399);const a={marker:s.d.MARKER,fill:s.d.FILL,line:s.d.LINE,text:s.d.TEXT};class l{constructor(e,t,i){this.layers=e,this.data=t,this.hash=this._createHash(),this.rendererKey=i;for(const t of e){const e=a[t.type];t.materialKey=Object(o.g)(e,this.rendererKey,!1,!1)}}get type(){return"expanded-cim"}_createHash(){let e="";for(const t of this.layers)e+=t.templateHash;return e}}const c=async(e,t)=>new l(await Object(r.b)(e.data,t),e.data,e.rendererKey),u=async(e,t,i)=>{if(!e)return null;if("cim"===e.type)return c(e,t);if("web-style"===e.type){const r=n.a.fromJSON(e),s={type:"cim",data:(await r.fetchCIMSymbol(i)).data,rendererKey:e.rendererKey};return c(s,t)}return e}},519:function(e,t,i){"use strict";var n=i(520);t.a=class{constructor(e,t){this._storage=new n.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,i){this._storage.put(e,t,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},521:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return n}));const n={Base64:0,Hex:1,String:2,Raw:3};function r(e,t){const i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function s(e,t,i,n,s,o){return r((a=r(r(t,e),r(n,o)))<<(l=s)|a>>>32-l,i);var a,l}function o(e,t,i,n,r,o,a){return s(t&i|~t&n,e,t,r,o,a)}function a(e,t,i,n,r,o,a){return s(t&n|i&~n,e,t,r,o,a)}function l(e,t,i,n,r,o,a){return s(t^i^n,e,t,r,o,a)}function c(e,t,i,n,r,o,a){return s(i^(t|~n),e,t,r,o,a)}function u(e,t=n.Hex){const i=t||n.Base64,s=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let i=1732584193,n=-271733879,s=-1732584194,u=271733878;for(let t=0;t<e.length;t+=16){const h=i,d=n,f=s,p=u;i=o(i,n,s,u,e[t+0],7,-680876936),u=o(u,i,n,s,e[t+1],12,-389564586),s=o(s,u,i,n,e[t+2],17,606105819),n=o(n,s,u,i,e[t+3],22,-1044525330),i=o(i,n,s,u,e[t+4],7,-176418897),u=o(u,i,n,s,e[t+5],12,1200080426),s=o(s,u,i,n,e[t+6],17,-1473231341),n=o(n,s,u,i,e[t+7],22,-45705983),i=o(i,n,s,u,e[t+8],7,1770035416),u=o(u,i,n,s,e[t+9],12,-1958414417),s=o(s,u,i,n,e[t+10],17,-42063),n=o(n,s,u,i,e[t+11],22,-1990404162),i=o(i,n,s,u,e[t+12],7,1804603682),u=o(u,i,n,s,e[t+13],12,-40341101),s=o(s,u,i,n,e[t+14],17,-1502002290),n=o(n,s,u,i,e[t+15],22,1236535329),i=a(i,n,s,u,e[t+1],5,-165796510),u=a(u,i,n,s,e[t+6],9,-1069501632),s=a(s,u,i,n,e[t+11],14,643717713),n=a(n,s,u,i,e[t+0],20,-373897302),i=a(i,n,s,u,e[t+5],5,-701558691),u=a(u,i,n,s,e[t+10],9,38016083),s=a(s,u,i,n,e[t+15],14,-660478335),n=a(n,s,u,i,e[t+4],20,-405537848),i=a(i,n,s,u,e[t+9],5,568446438),u=a(u,i,n,s,e[t+14],9,-1019803690),s=a(s,u,i,n,e[t+3],14,-187363961),n=a(n,s,u,i,e[t+8],20,1163531501),i=a(i,n,s,u,e[t+13],5,-1444681467),u=a(u,i,n,s,e[t+2],9,-51403784),s=a(s,u,i,n,e[t+7],14,1735328473),n=a(n,s,u,i,e[t+12],20,-1926607734),i=l(i,n,s,u,e[t+5],4,-378558),u=l(u,i,n,s,e[t+8],11,-2022574463),s=l(s,u,i,n,e[t+11],16,1839030562),n=l(n,s,u,i,e[t+14],23,-35309556),i=l(i,n,s,u,e[t+1],4,-1530992060),u=l(u,i,n,s,e[t+4],11,1272893353),s=l(s,u,i,n,e[t+7],16,-155497632),n=l(n,s,u,i,e[t+10],23,-1094730640),i=l(i,n,s,u,e[t+13],4,681279174),u=l(u,i,n,s,e[t+0],11,-358537222),s=l(s,u,i,n,e[t+3],16,-722521979),n=l(n,s,u,i,e[t+6],23,76029189),i=l(i,n,s,u,e[t+9],4,-640364487),u=l(u,i,n,s,e[t+12],11,-421815835),s=l(s,u,i,n,e[t+15],16,530742520),n=l(n,s,u,i,e[t+2],23,-995338651),i=c(i,n,s,u,e[t+0],6,-198630844),u=c(u,i,n,s,e[t+7],10,1126891415),s=c(s,u,i,n,e[t+14],15,-1416354905),n=c(n,s,u,i,e[t+5],21,-57434055),i=c(i,n,s,u,e[t+12],6,1700485571),u=c(u,i,n,s,e[t+3],10,-1894986606),s=c(s,u,i,n,e[t+10],15,-1051523),n=c(n,s,u,i,e[t+1],21,-2054922799),i=c(i,n,s,u,e[t+8],6,1873313359),u=c(u,i,n,s,e[t+15],10,-30611744),s=c(s,u,i,n,e[t+6],15,-1560198380),n=c(n,s,u,i,e[t+13],21,1309151649),i=c(i,n,s,u,e[t+4],6,-145523070),u=c(u,i,n,s,e[t+11],10,-1120210379),s=c(s,u,i,n,e[t+2],15,718787259),n=c(n,s,u,i,e[t+9],21,-343485551),i=r(i,h),n=r(n,d),s=r(s,f),u=r(u,p)}return[i,n,s,u]}(function(e){const t=[];for(let i=0,n=8*e.length;i<n;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}(e),8*e.length);switch(i){case n.Raw:return s;case n.Hex:return function(e){const t="0123456789abcdef",i=[];for(let n=0,r=4*e.length;n<r;n++)i.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return i.join("")}(s);case n.String:return function(e){const t=[];for(let i=0,n=32*e.length;i<n;i+=8)t.push(String.fromCharCode(e[i>>5]>>>i%32&255));return t.join("")}(s);case n.Base64:return function(e){const t=[];for(let i=0,n=4*e.length;i<n;i+=3){const n=(e[i>>2]>>i%4*8&255)<<16|(e[i+1>>2]>>(i+1)%4*8&255)<<8|e[i+2>>2]>>(i+2)%4*8&255;for(let r=0;r<4;r++)8*i+6*r>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-r)&63))}return t.join("")}(s)}}},524:function(e,t,i){"use strict";var n=i(8),r=i(397),s=i(496),o=i(549),a=i(5),l=i(14),c=i(407),u=i(451),h=i(418),d=i(413),f=i(47),p=i(545),m=i(26),_=i(405),g=i(402);const y=a.a.getLogger("esri.views.2d.engine.webgl.Mesh2D"),v=(e,t,i,n)=>{let r=0;for(let n=1;n<i;n++){const i=e[2*(t+n-1)],s=e[2*(t+n-1)+1];r+=(e[2*(t+n)]-i)*(e[2*(t+n)+1]+s)}return n?r>0:r<0},x=({coords:e,lengths:t},i)=>{const n=[];for(let r=0,s=0;r<t.length;s+=t[r],r+=1){const o=s,a=[];for(;r<t.length-1&&v(e,s+t[r],t[r+1],i);r+=1,s+=t[r])a.push(s+t[r]-o);const l=e.slice(2*o,2*(s+t[r])),c=Object(p.a)(l,a,2);for(const e of c)n.push(e+o)}return n};class b{constructor(e,t,i,n=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=i,this.isMapSpace=n}static fromRect({x:e,y:t,width:i,height:n}){const r=e,s=t,o=r+i,a=s+n;return b.fromScreenExtent({xmin:r,ymin:s,xmax:o,ymax:a})}static fromPath(e){const t=Object(d.f)(new h.a,e.path,!1,!1),i=t.coords,n=new Uint32Array(x(t,!0)),r=new Uint32Array(i.length/2);for(let e=0;e<r.length;e++)r[e]=Object(g.a)(Math.floor(i[2*e]),Math.floor(i[2*e+1]));return new b({geometry:r},n,4)}static fromGeometry(e,t){const i=t.geometry.type;switch(i){case"polygon":return b.fromPolygon(e,t.geometry);case"extent":return b.fromMapExtent(e,t.geometry);default:return y.error(new l.a("mapview-bad-type","Unable to create a mesh from type "+i,t)),b.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const i=Object(d.g)(new h.a,t,!1,!1),n=i.coords,r=new Uint32Array(x(i,!1)),s=new Uint32Array(n.length/2),o=Object(f.a)(),a=Object(f.a)();for(let t=0;t<s.length;t++)Object(m.m)(o,n[2*t],n[2*t+1]),e.toScreen(a,o),s[t]=Object(g.a)(Math.floor(a[0]),Math.floor(a[1]));return new b({geometry:s},r,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:i,ymax:n}){const r={geometry:new Uint32Array([Object(g.a)(e,i),Object(g.a)(t,i),Object(g.a)(e,n),Object(g.a)(e,n),Object(g.a)(t,i),Object(g.a)(t,n)])},s=new Uint32Array([0,1,2,3,4,5]);return new b(r,s,4)}static fromMapExtent(e,t){const[i,n]=e.toScreen([0,0],[t.xmin,t.ymin]),[r,s]=e.toScreen([0,0],[t.xmax,t.ymax]),o={geometry:new Uint32Array([Object(g.a)(i,n),Object(g.a)(r,n),Object(g.a)(i,s),Object(g.a)(i,s),Object(g.a)(r,n),Object(g.a)(r,s)])},a=new Uint32Array([0,1,2,3,4,5]);return new b(o,a,4)}destroy(){Object(n.h)(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)Object(n.h)(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return(e=>{switch(this.indices.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new l.a("Cannot get DataType of array")}})()}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=_.a.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((i,n)=>({...i,[n]:_.a.createVertex(e,t,this.vertices[n])}),{})),this._cache.vertexBuffers}}var O=b;const S=a.a.getLogger("esri.views.2d.engine.webgl.ClippingInfo"),w=e=>parseFloat(e)/100;class T extends u.a{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=t.watch("version",()=>this._invalidate()),this.ready()}static fromClipArea(e,t){return new T(e,t)}_destroyGL(){Object(n.h)(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),Object(n.h)(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(e,t,i,r){const[s,o]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===s&&this._lastHeight===o||(this._lastWidth=s,this._lastHeight=o,this._destroyGL()),Object(n.g)(this._cache.vao)){const n=this._createMesh(t,this._clip),s=n.getIndexBuffer(e),o=n.getVertexBuffers(e);this._cache.mesh=n,this._cache.vao=new c.a(e,i,r,o,s)}return this._cache.vao}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(e,t){const[i,n]=e.size,r="string"==typeof t.left?w(t.left)*i:t.left,s="string"==typeof t.right?w(t.right)*i:t.right,o="string"==typeof t.top?w(t.top)*n:t.top,a="string"==typeof t.bottom?w(t.bottom)*n:t.bottom,l=r,c=o;return{x:l,y:c,width:Math.max(i-s-l,0),height:Math.max(n-a-c,0)}}_createMesh(e,t){switch(t.type){case"rect":return O.fromRect(this._createScreenRect(e,t));case"path":return O.fromPath(t);case"geometry":return O.fromGeometry(e,t);default:return S.error(new l.a("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),O.fromRect({x:0,y:0,width:1,height:1})}}}var C=T;t.a=class extends s.a{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e),this._updateClippingInfo()}doRender(e){this.updateTransitionProperties(e.deltaTime);const t=this.createRenderParams(e),{painter:i,globalOpacity:n,profiler:s,drawPhase:o}=t,a=o===r.c.LABEL?1:n*this.computedOpacity;s.recordContainerStart(this.name),i.beforeRenderLayer(t,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(t),i.compositeLayer(t,a),s.recordContainerEnd()}renderChildren(e){Object(n.g)(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const t of this._renderPasses)t.render(e)}createRenderParams(e){return e}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[o.a.clip],target:()=>this._clippingInfos,drawPhase:r.c.MAP|r.c.LABEL|r.c.LABEL_ALPHA|r.c.DEBUG})]}updateTransforms(e){for(const t of this.children)t.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(Object(n.h)(this._clippingInfos)&&(this._clippingInfos.forEach(e=>e.destroy()),this._clippingInfos=null),!this.stage)return;const e=this._clips;Object(n.h)(e)&&e.length&&(this._clippingInfos=e.items.map(e=>C.fromClipArea(this.stage,e))),this.requestRender()}}},525:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c}));const n=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},o={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},a={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},l={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},u={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},527:function(e,t,i){"use strict";var n=i(8);t.a=class{constructor(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}clear(){for(;Object(n.h)(this.dequeue()););}}},529:function(e,t,i){"use strict";class n{constructor(e=null,t={},i,n){this.displayId=0,this.geohashIndexed=!1,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),i&&(this.centroid=i),null!=n&&(this.objectId=n)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){const e=new n(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashIndexed=this.geohashIndexed,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}t.a=n},530:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e,t){this.x=e,this.y=t}clone(){return new n(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){this.x=e,this.y=t}normalize(){const e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}rightPerpendicular(){const e=this.x;this.x=this.y,this.y=-e}move(e,t){this.x+=e,this.y+=t}assign(e){this.x=e.x,this.y=e.y}assignAdd(e,t){this.x=e.x+t.x,this.y=e.y+t.y}assignSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}rotate(e,t){const i=this.x,n=this.y;this.x=i*e-n*t,this.y=i*t+n*e}scale(e){this.x*=e,this.y*=e}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}static distance(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}static add(e,t){return new n(e.x+t.x,e.y+t.y)}static sub(e,t){return new n(e.x-t.x,e.y-t.y)}}},531:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(211),r=Object(n.b)((function(e){var t;void 0!==(t=function(){function e(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,l=n-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*u/a+h)),Math.min(s,Math.floor(n+(a-l)*u/a+h)),o)}var d=i[n],f=r,p=s;for(t(i,r,n),o(i[s],d)>0&&t(i,r,s);f<p;){for(t(i,f,p),f++,p--;o(i[f],d)<0;)f++;for(;o(i[p],d)>0;)p--}0===o(i[r],d)?t(i,r,p):t(i,++p,s),p<=n&&(r=p+1),n<=p&&(s=p-1)}}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}return function(t,n,r,s,o){e(t,n,r||0,s||t.length-1,o||i)}}())&&(e.exports=t)}))},534:function(e,t,i){"use strict";i(404);var n=i(405),r=(i(406),i(407)),s=(i(408),i(409),i(411),i(460)),o=i(470),a=i(436),l=i(568);t.a=class extends a.a{constructor(){super(...arguments),this._color=Object(o.b)(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:e},t){e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunctionSeparate(1032,516,t.stencilRef,255)}draw(e,t){const{context:i}=e;this._initialized||this._initialize(i),i.bindVAO(this._solidVertexArrayObject),i.bindProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),this._solidProgram.setUniform2fv("u_coord_range",t.coordRange),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),i.drawArrays(5,0,4),i.bindVAO()}_initialize(e){if(this._initialized)return!0;const t=Object(s.a)(e,l.a);if(!t)return!1;const i=new Int8Array([0,0,1,0,0,1,1,1]),o=n.a.createVertex(e,35044,i),a=new r.a(e,l.a.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:o});return this._solidProgram=t,this._solidVertexArrayObject=a,this._initialized=!0,!0}}},535:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const n=new(i(32).a)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function r(e){return n.toJSON(e)}},536:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(413),r=i(482);class s extends r.a{constructor(e,t,i){super(e),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=i,this._features=t}static fromFeatures(e,t,i){const r=Object(n.c)([],e,t,!1,!1,i);for(let t=0;t<r.length;t++)r[t].displayId=e[t].displayId;return s.fromOptimizedFeatures(r,t)}static fromFeatureSet(e,t){const i=Object(n.b)(e,t);return s.fromOptimizedFeatureSet(i)}static fromOptimizedFeatureSet(e){const{features:t,geometryType:i}=e,n=s.fromOptimizedFeatures(t,i);n._exceededTransferLimit=e.exceededTransferLimit,n._transform=e.transform;for(const t of e.fields)"esriFieldTypeDate"===t.type&&n._dateFields.add(t.name);return n}static fromOptimizedFeatures(e,t,i){const n=r.a.createInstance(),o=new s(n,e,t);return o._transform=i,o}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}getGroupId(){return this._current.groupId}setGroupId(e){this._current.groupId=e}copy(){const e=new s(this.instance,this._features,this.geometryType);return this.copyInto(e),e}next(){if(!this._hasFilter)return++this._featureIndex<this._features.length;for(;++this._featureIndex<this._features.length&&!this._passesFilter(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(n.i)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){const e=this.readGeometry();return e?{x:e.coords[0],y:e.coords[1]}:null}readLegacyGeometry(){const e=this.readGeometry();return Object(n.k)(e,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const e=this.readCentroid();return e?{x:e.coords[0],y:e.coords[1]}:null}readGeometryArea(){return Object(n.s)(this._current.geometry,2)}readUnquantizedGeometry(){const e=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!e)return e;const t=e.clone();return function({coords:e,lengths:t}){let i=0;for(const n of t){for(let t=1;t<n;t++)e[2*(i+t)]+=e[2*(i+t)-2],e[2*(i+t)+1]+=e[2*(i+t)-1];i+=n}}(t),t}readHydratedGeometry(){const e=this._current.geometry;if(!e)return null;const t=e.clone();return Object(n.y)(t,t,this.hasZ,this.hasM,this._transform),t}getXHydrate(){const e=this._current.geometry.coords[0]+this._tx,t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]}getYHydrate(){const e=this._current.geometry.coords[1]+this._ty,t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]}readGeometry(){if(!this._current.hasGeometry)return null;const e=this._current.geometry.clone();if(e.isPoint)return e.coords[0]+=this._tx,e.coords[1]+=this._ty,e;let t=0;for(const i of e.lengths)e.coords[2*t]+=this._tx,e.coords[2*t+1]+=this._ty,t+=i;return e}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const e=this._computeCentroid();if(!e)return null;e.coords[0]-=this._tx,e.coords[1]-=this._ty,this._current.centroid=e}const e=this._current.centroid.clone();return e.coords[0]+=this._tx,e.coords[1]+=this._ty,e}_readAttribute(e,t){const i=this._current.attributes[e];if(void 0!==i)return t&&this._dateFields.has(e)?new Date(i):i;const n=this.readAttributes(),r=e.toLocaleLowerCase().trim();for(const e in n)if(e.toLocaleLowerCase().trim()===r){const t=this._current.attributes[e];return this._dateFields.has(e)?new Date(t):t}}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;let e=0,t=0;switch(this.geometryType){case"esriGeometryPoint":{const i=this._current.geometry;if(!i)return!1;[e,t]=i.coords;break}case"esriGeometryPolygon":{const i=this.readCentroid();if(!i)return!1;[e,t]=i.coords,e-=this._tx,t-=this._ty;break}default:return!1}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}}},538:function(e,t,i){"use strict";i(404);var n=i(405),r=i(406),s=i(407),o=(i(408),i(409),i(411),i(460)),a=i(470),l=i(436),c=i(568),u=i(560);const h={name:"tileInfo",shaders:{vertexShader:Object(u.a)("tileInfo/tileInfo.vert"),fragmentShader:Object(u.a)("tileInfo/tileInfo.frag")},attributes:{a_pos:0}};t.a=class extends l.a{constructor(){super(...arguments),this._color=Object(a.b)(1,0,0,1)}dispose(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null),this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null),this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null),this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null),this._canvas=null}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1)}draw(e,t){const{context:i}=e;if(!t.isReady)return;this._loadWGLResources(i),i.bindVAO(this._outlineVertexArrayObject),i.bindProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),this._outlineProgram.setUniform2f("u_coord_range",t.coordRange[0],t.coordRange[1]),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),i.drawArrays(3,0,4),i.bindVAO();const n=this._getTexture(i,t);n&&(i.bindVAO(this._tileInfoVertexArrayObject),i.bindProgram(this._tileInfoProgram),i.bindTexture(n,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",t.coordRange[0]/t.size[0],t.coordRange[1]/t.size[1]),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",n.descriptor.width,n.descriptor.height),i.drawArrays(5,0,4),i.bindVAO())}_loadWGLResources(e){if(this._outlineProgram&&this._tileInfoProgram)return;const t=Object(o.a)(e,c.a),i=Object(o.a)(e,h),r={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},a=new Int8Array([0,0,1,0,1,1,0,1]),l=n.a.createVertex(e,35044,a),u=new s.a(e,c.a.attributes,r,{geometry:l}),d=new Int8Array([0,0,1,0,0,1,1,1]),f=n.a.createVertex(e,35044,d),p=new s.a(e,h.attributes,r,{geometry:f});this._outlineProgram=t,this._tileInfoProgram=i,this._outlineVertexArrayObject=u,this._tileInfoVertexArrayObject=p}_getTexture(e,t){if(t.texture&&t.triangleCountReportedInDebug===t.triangleCount)return t.texture;t.triangleCountReportedInDebug=t.triangleCount,this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));const i=t.triangleCount;let n=t.key.id;t.triangleCount>0&&(n+=", "+i);const s=this._canvas,o=s.getContext("2d");return o.font="24px sans-serif",o.textAlign="left",o.textBaseline="top",o.clearRect(0,0,300,32),i>1e5?(o.fillStyle="red",o.fillRect(0,0,300,32),o.fillStyle="black"):(o.clearRect(0,0,300,32),o.fillStyle="blue"),o.fillText(n,0,0),t.texture=new r.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071},s),t.texture}}},539:function(e,t,i){"use strict";function n(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const s=n();Object.freeze({__proto__:null,create:n,clone:r,fromValues:function(e,t,i,n,r,s,o,a,l,c,u,h,d,f,p,m){const _=new Float32Array(16);return _[0]=e,_[1]=t,_[2]=i,_[3]=n,_[4]=r,_[5]=s,_[6]=o,_[7]=a,_[8]=l,_[9]=c,_[10]=u,_[11]=h,_[12]=d,_[13]=f,_[14]=p,_[15]=m,_},createView:function(e,t){return new Float32Array(e,t,16)},IDENTITY:s})},540:function(e,t,i){"use strict";i.d(t,"a",(function(){return A})),i.d(t,"b",(function(){return P}));var n=i(23),r=i(396),s=i(49),o=i(69),a=i(110),l=i(45),c=i(455),u=i(403),h=(i(495),i(464)),d=(i(148),i(0)),f=(i(4),i(9),i(5),i(6),i(1)),p=i(2),m=(i(3),i(10),i(11),i(18));let _=class extends m.a{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TERRAIN_DEBUG_POPUP=!1,this.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,this.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,this.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.ENABLE_PROFILE_DEPTH_RANGE=!1,this.DISABLE_FAST_UPDATES=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(d.a)([Object(f.b)()],_.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(d.a)([Object(f.b)()],_.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(d.a)([Object(f.b)()],_.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),Object(d.a)([Object(f.b)()],_.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(d.a)([Object(f.b)()],_.prototype,"LABELS_SHOW_BORDER",void 0),Object(d.a)([Object(f.b)()],_.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(d.a)([Object(f.b)()],_.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(d.a)([Object(f.b)()],_.prototype,"SHOW_POI",void 0),Object(d.a)([Object(f.b)()],_.prototype,"TERRAIN_DEBUG_POPUP",void 0),Object(d.a)([Object(f.b)()],_.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(d.a)([Object(f.b)()],_.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(d.a)([Object(f.b)()],_.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(d.a)([Object(f.b)()],_.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(d.a)([Object(f.b)()],_.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(d.a)([Object(f.b)()],_.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(d.a)([Object(f.b)()],_.prototype,"DISABLE_FAST_UPDATES",void 0),Object(d.a)([Object(f.b)()],_.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(d.a)([Object(f.b)()],_.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(d.a)([Object(f.b)()],_.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),_=Object(d.a)([Object(p.a)("esri.views.3d.support.DebugFlags")],_);var g;new _;function y(e){return null!=e}function v(e){return"number"==typeof e}function x(e){return"string"==typeof e}function b(e,t){e&&e.push(t)}function O(e,t,i,n,r){const s=e.minSize,o=e.maxSize;if(e.expression)return b(r,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=n.symbolSize[i];return t.minSize[i]=e,t.maxSize[i]=e,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=1,!0}if(y(e.field))return y(e.stops)?2===e.stops.length&&v(e.stops[0].size)&&v(e.stops[1].size)?(S(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=1,!0):(b(r,"Could not convert size info: stops only supported with 2 elements"),!1):v(s)&&v(o)&&y(e.minDataValue)&&y(e.maxDataValue)?(S(s,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=1,!0):null!=u.a[e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/u.a[e.valueUnit],t.type[i]=1,!0):"unknown"===e.valueUnit?(b(r,"Could not convert size info: proportional size not supported"),!1):(b(r,"Could not convert size info: scale-dependent size not supported"),!1);if(!y(e.field)){if(e.stops&&e.stops[0]&&v(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=1,!0;if(v(s))return t.minSize[i]=s,t.maxSize[i]=s,t.offset[i]=s,t.factor[i]=0,t.type[i]=1,!0}return b(r,"Could not convert size info: unsupported variant of sizeInfo"),!1}function S(e,t,i,n,r,s){const o=Math.abs(n-i)>0?(t-e)/(n-i):0;r.minSize[s]=o>0?e:t,r.maxSize[s]=o>0?t:e,r.offset[s]=e-i*o,r.factor[s]=o}function w(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function T(e,t,i){const n=2===i&&"arithmetic"===e.rotationType;t.offset[i]=n?90:0,t.factor[i]=n?-1:1,t.type[i]=1}function C(e,t,i){if(!e)return null;const n=!t.supportedTypes||!!t.supportedTypes.size,r=!t.supportedTypes||!!t.supportedTypes.color,o=!t.supportedTypes||!!t.supportedTypes.rotation,a=!!t.supportedTypes&&!!t.supportedTypes.opacity,l=e.reduce((e,l)=>{if(!e)return e;if(l.valueExpression)return b(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case"size":return n?function(e,t,i,n){if(e.normalizationField||e.valueRepresentation)return b(n,"Could not convert size info: unsupported property"),null;if(null!=(r=e.field)&&!x(r))return b(n,"Could not convert size info: field is not a string"),null;var r;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return b(n,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};let s;switch(e.axis){case"width":return s=O(e,t.size,0,i,n),s?t:null;case"height":return s=O(e,t.size,2,i,n),s?t:null;case"depth":return s=O(e,t.size,1,i,n),s?t:null;case"width-and-depth":return s=O(e,t.size,0,i,n),s&&O(e,t.size,1,i,n),s?t:null;case null:case void 0:case"all":return s=O(e,t.size,0,i,n),s=s&&O(e,t.size,1,i,n),s=s&&O(e,t.size,2,i,n),s?t:null;default:return b(n,`Could not convert size info: unknown axis "${e.axis}""`),null}}(l,e,t,i):e;case"color":return r?function(e,t,i){if(e.normalizationField)return b(i,"Could not convert color info: unsupported property"),null;if(x(e.field)){if(!e.stops)return b(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return b(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const n=e.stops;for(let e=0;e<8;++e){const i=n[Math.min(e,n.length-1)];t.color.values[e]=i.value,w(t.color.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return b(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,w(t.color.colors,e,i)}}return t}(l,e,i):e;case"opacity":return a?function(e,t,i){if(e.normalizationField)return b(i,"Could not convert opacity info: unsupported property"),null;if(x(e.field)){if(!e.stops)return b(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return b(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const n=e.stops;for(let e=0;e<8;++e){const i=n[Math.min(e,n.length-1)];t.opacity.values[e]=i.value,t.opacity.opacityValues[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return b(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}(l,e,i):null;case"rotation":return o?function(e,t,i){if(!x(e.field))return b(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return b(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return T(e,t.rotation,0),t;case"roll":return T(e,t.rotation,1),t;case null:case void 0:case"heading":return T(e,t.rotation,2),t;default:return b(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(l,e,i):e;default:return Object(s.a)(l),null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!function(e,t,i){for(let i=0;i<3;++i){let n=t.unitInMeters;1===e.type[i]&&(n*=t.modelSize[i],e.type[i]=2),e.minSize[i]=e.minSize[i]/n,e.maxSize[i]=e.maxSize[i]/n,e.offset[i]=e.offset[i]/n,e.factor[i]=e.factor[i]/n}let n;if(0!==e.type[0])n=0;else if(0!==e.type[1])n=1;else{if(0===e.type[2])return b(i,"No size axis contains a valid size or scale"),!1;n=2}for(let t=0;t<3;++t)0===e.type[t]&&(e.minSize[t]=e.minSize[n],e.maxSize[t]=e.maxSize[n],e.offset[t]=e.offset[n],e.factor[t]=e.factor[n],e.type[t]=e.type[n]);return!0}(l.size,t,i)?null:l:null}!function(e){const t=Object(h.b)(),i=Object(a.e)();e.evaluateModelTransform=function(e,n,r){if(!e.vvSizeEnabled)return r;Object(c.c)(t,r);const s=e.vvSymbolRotationMatrix;Object(c.d)(M,s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1),Object(c.j)(t,t,M);for(let t=0;t<3;++t){const r=e.vvSizeOffset[t]+n[0]*e.vvSizeFactor[t];i[t]=Object(o.c)(r,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return Object(c.n)(t,t,i),Object(c.o)(t,t,e.vvSymbolAnchor),t},e.evaluateModelTransformScale=function(e,t,i){if(!t.vvSizeEnabled)return Object(l.r)(e,1,1,1);for(let n=0;n<3;++n){const r=t.vvSizeOffset[n]+i[0]*t.vvSizeFactor[n];e[n]=Object(o.c)(r,t.vvSizeMinSize[n],t.vvSizeMaxSize[n])}return e}}(g||(g={}));const M=Object(h.b)();g.evaluateModelTransform,g.evaluateModelTransformScale;var I=i(397),j=i(410),E=i(474);function P(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function D(e){return e.map(e=>{return{value:(t=e).value,size:Object(n.j)(t.size)};var t})}function L(e){if("string"==typeof e||"number"==typeof e)return Object(n.j)(e);const t=e;return{type:"size",expression:t.expression,stops:D(t.stops)}}const z=e=>{const t=[],i=[],s=D(e),o=s.length;for(let e=0;e<6;e++){const a=s[Math.min(e,o-1)];t.push(a.value),i.push(null==a.size?r.p:Object(n.h)(a.size))}return{values:new Float32Array(t),sizes:new Float32Array(i)}};function A(e){const t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};for(const n of e){const e=n.type;if(n.field&&(t[e]=n.field),"size"===e){i.size||(i.size={});const e=n;switch(Object(E.a)(e)){case I.e.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:L(e.minSize),maxSize:L(e.maxSize)};break;case I.e.SIZE_SCALE_STOPS:i.size.scaleStops={stops:D(e.stops)};break;case I.e.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const i in e.levels)t[i]=z(e.levels[i]);i.size.fieldStops={type:"level-dependent",levels:t}}else i.size.fieldStops={type:"static",...z(e.stops)};break;case I.e.SIZE_UNIT_VALUE:i.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===e){const e=C([n],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});if(!e)continue;i.color=e.color;for(let e=0;e<32;e+=4)Object(j.b)(i.color.colors,e,!0)}else if("opacity"===e)i.opacity=V(n);else if("rotation"===e){const e=n;i.rotation={type:e.rotationType}}}return{vvFields:t,vvRanges:i}}function V(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const i=e.stops;for(let e=0;e<8;++e){const n=i[Math.min(e,i.length-1)];t.values[e]=n.value,t.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=i}}return t}},541:function(e,t,i){"use strict";const n=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],r=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],c=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],u=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],p=["ء","ف"],m=["غ","ي"],_=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],v=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],x=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];function b(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function O(e,t){const i=e.split(""),n=[];return S(i,n,t),function(e,t,i){if(0!==i.hiLevel&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let i=0;i<e.length;i++)1===t[i]&&(e[i]=D(e[i]))}(i,n,t),E(2,i,n,t),E(1,i,n,t),B=n,i.join("")}function S(e,t,i){const n=e.length,r=i.dir?g:_;let s=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let t=0;t<n;t++)a[t]=w(e[t]);for(let c=0;c<n;c++){const n=s,u=P(e,a,l,c,i);l[c]=u,s=r[n][u];const h=240&s;s&=15;const d=r[s][q];if(t[c]=d,h>0)if(16===h){for(let e=o;e<c;e++)t[e]=1;o=-1}else o=-1;if(r[s][W])-1===o&&(o=c);else if(o>-1){for(let e=o;e<c;e++)t[e]=d;o=-1}5===a[c]&&(t[c]=0),i.hiLevel|=d}i.hasUbatS&&function(e,t,i,n){for(let r=0;r<i;r++)if(6===e[r]){t[r]=n.dir;for(let i=r-1;i>=0&&8===e[i];i--)t[i]=n.dir}}(a,t,n,i)}function w(e){const t=e.charCodeAt(0),i=v[t>>8];return i<100?i:x[i-100][255&t]}function T(e,t){const i=e.split("");if(t){const e=[];S(i,e,t),B=e}return i.reverse(),U.reverse(),i.join("")}function C(e,t,i){for(let n=0;n<t;n++)if(e[n]===i)return n;return-1}function M(e){for(let t=0;t<p.length;t++)if(e>=p[t]&&e<=m[t])return!0;return!1}function I(e,t,i,n){for(;t*i<n&&V(e[t]);)t+=i;return!!(t*i<n&&M(e[t]))}function j(e,t,i,n){for(;t*i<n&&V(e[t]);)t+=i;let s=" ";if(!(t*i<n))return!1;s=e[t];for(let e=0;e<r.length;e++)if(r[e]===s)return!0;return!1}function E(e,t,i,n){if(n.hiLevel<e)return;if(1===e&&n.dir===X&&!n.hasUbatB)return t.reverse(),void U.reverse();const r=t.length;let s,o,a,l,c,u=0;for(;u<r;){if(i[u]>=e){for(s=u+1;s<r&&i[s]>=e;)s++;for(o=u,a=s-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,c=U[o],U[o]=U[a],U[a]=c;u=s}u++}}function P(e,t,i,n,r){const s=t[n];return{UBAT_L:()=>(r.lastArabic=!1,0),UBAT_R:()=>(r.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>r.lastArabic?3:2,UBAT_AL:()=>(r.lastArabic=!0,r.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let e,s;return n<1||n+1>=t.length||2!==(e=i[n-1])&&3!==e||2!==(s=t[n+1])&&3!==s?4:(r.lastArabic&&(s=3),s===e?s:4)},UBAT_ES:()=>2===(n>0?i[n-1]:5)&&n+1<t.length&&2===t[n+1]?2:4,UBAT_ET:()=>{if(n>0&&2===i[n-1])return 2;if(r.lastArabic)return 4;let e=n+1;const s=t.length;for(;e<s&&11===t[e];)e++;return e<s&&2===t[e]?2:4},UBAT_NSM:()=>{if("VLTR"===r.inFormat){const i=t.length;let r=n+1;for(;r<i&&12===t[r];)r++;if(r<i){const i=e[n].charCodeAt[0],s=i>=1425&&i<=2303||64286===i,o=t[r];if(s&&(1===o||7===o))return 1}}return n<1||5===t[n-1]?4:i[n-1]},UBAT_B:()=>(r.lastArabic=!0,r.hasUbatB=!0,r.dir),UBAT_S:()=>(r.hasUbatS=!0,4),UBAT_LRE:()=>(r.lastArabic=!1,4),UBAT_RLE:()=>(r.lastArabic=!1,4),UBAT_LRO:()=>(r.lastArabic=!1,4),UBAT_RLO:()=>(r.lastArabic=!1,4),UBAT_PDF:()=>(r.lastArabic=!1,4),UBAT_BN:()=>4}[y[s]]()}function D(e){let t,i=0,r=n.length-1;for(;i<=r;)if(t=Math.floor((i+r)/2),e<n[t][0])r=t-1;else{if(!(e>n[t][0]))return n[t][1];i=t+1}return e}function L(e){for(let t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function z(e){for(let t=0;t<a.length;t++)if(e===a[t])return u[t];return e}function A(e,t){for(let i=0;i<a.length;i++)if(e===a[i])return t[i];return e}function V(e){return e>="ً"&&e<="ٕ"}function R(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function F(e,t,i,n){for(;t*i<n&&V(e[t]);)t+=i;return t*i<n&&(e[t]=" ",!0)}function N(e,t){for(let i=0;i<r.length;i++)if(e===r[i])return t[i];return e}function k(e,t,i,n){for(let r=0;r<e.length;r++)(e[r]>t||!i&&e[r]===t)&&(e[r]+=n)}let U=[],G=[],B=[];const H={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},q=5,W=6,Y=0,X=1,Z=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,K=/[\u0591-\u06ff\ufb1d-\ufefc]/;t.a=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,i){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,i){U=[],B=[];for(let n=0;n<i;n++)e[n]=n,t[n]=n,U[n]=n}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,i))return e;t=this.inputFormat,i=this.outputFormat;let n=e;const a=H,u=R(t.charAt(1)),d=R(i.charAt(1)),p=("I"===t.charAt(0)?"L":t.charAt(0))+u,m=("I"===i.charAt(0)?"L":i.charAt(0))+d,_=t.charAt(2)+i.charAt(2);a.defInFormat=p,a.defOutFormat=m,a.defSwap=_;const g=function e(t,i,n,r,s){const o=function(e,t,i){if(void 0===t.inFormat&&(t.inFormat=i.defInFormat),void 0===t.outFormat&&(t.outFormat=i.defOutFormat),void 0===t.swap&&(t.swap=i.defSwap),t.inFormat===t.outFormat)return t;const n=t.inFormat.substring(0,1),r=t.outFormat.substring(0,1);let s,o=t.inFormat.substring(1,4),a=t.outFormat.substring(1,4);return"C"===o.charAt(0)&&(s=b(e),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=n+o),"C"===a.charAt(0)&&(s=b(e),"rtl"===s?a="RTL":"ltr"===s?(s=function(e){const t=e.split("");return t.reverse(),b(t.join(""))}(e),a=s.toUpperCase()):a="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=r+a),t}(t,{inFormat:i,outFormat:n,swap:r},s);if(o.inFormat===o.outFormat)return t;i=o.inFormat,n=o.outFormat,r=o.swap;const a=i.substring(0,1),l=i.substring(1,4),c=n.substring(0,1),u=n.substring(1,4);if(s.inFormat=i,s.outFormat=n,s.swap=r,"L"===a&&"VLTR"===n){if("LTR"===l)return s.dir=Y,O(t,s);if("RTL"===l)return s.dir=X,O(t,s)}if("V"===a&&"V"===c)return s.dir="RTL"===l?X:Y,T(t,s);if("L"===a&&"VRTL"===n)return"LTR"===l?(s.dir=Y,t=O(t,s)):(s.dir=X,t=O(t,s)),T(t);if("VLTR"===i&&"LLTR"===n)return s.dir=Y,O(t,s);if("V"===a&&"L"===c&&l!==u)return t=T(t),"RTL"===l?e(t,"LLTR","VLTR",r,s):e(t,"LRTL","VRTL",r,s);if("VRTL"===i&&"LRTL"===n)return e(t,"LRTL","VRTL",r,s);if("L"===a&&"L"===c){const i=s.swap;return s.swap=i.substr(0,1)+"N","RTL"===l?(s.dir=X,t=O(t,s),s.swap="N"+i.substr(1,2),s.dir=Y,t=O(t,s)):(s.dir=Y,t=O(t,s),s.swap="N"+i.substr(1,2),t=e(t,"VLTR","LRTL",s.swap,s)),t}return t}(e,p,m,_,a);let y=!1;return"R"===i.charAt(1)?y=!0:"C"!==i.charAt(1)&&"D"!==i.charAt(1)||(y="rtl"===this.checkContextual(g)),this.sourceToTarget=U,this.targetToSource=function(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[e[i]]=i;return t}(this.sourceToTarget),G=this.targetToSource,n=t.charAt(3)===i.charAt(3)?g:"S"===i.charAt(3)?function(e,t,i){if(0===t.length)return"";void 0===e&&(e=!0),void 0===i&&(i=!0);const n=(t=String(t)).split("");let r=0,a=1,u=n.length;e||(r=n.length-1,a=-1,u=1);const d=function(e,t,i,n,r){let a=0;const u=[];let d=0;for(let f=t;f*i<n;f+=i)if(M(e[f])||V(e[f])){if("ل"===e[f]&&j(e,f+i,i,n)){e[f]=N(e[f+i],0===a?s:o),f+=i,F(e,f,i,n),r&&(u[d]=f,d++),a=0;continue}const t=e[f];1===a?e[f]=I(e,f+i,i,n)?z(e[f]):A(e[f],c):!0===I(e,f+i,i,n)?e[f]=A(e[f],h):e[f]=A(e[f],l),V(t)||(a=1),!0===L(t)&&(a=0)}else a=0;return u}(n,r,a,u,i);let f="";for(let t=0;t<n.length;t++)i&&C(d,d.length,t)>-1?(k(G,t,!e,-1),U.splice(t,1)):f+=n[t];return f}(y,g,!0):function(e,t,i){if(0===e.length)return"";void 0===i&&(i=!0),void 0===t&&(t=!0);let n="";const s=(e=String(e)).split("");for(let o=0;o<e.length;o++){let a=!1;if(s[o]>="ﹰ"&&s[o]<"\ufeff"){const l=e.charCodeAt(o);s[o]>="ﻵ"&&s[o]<="ﻼ"?(t?(o>0&&i&&" "===s[o-1]?n=n.substring(0,n.length-1)+"ل":(n+="ل",a=!0),n+=r[(l-65269)/2]):(n+=r[(l-65269)/2],n+="ل",o+1<e.length&&i&&" "===s[o+1]?o++:a=!0),a&&(k(G,o,!0,1),U.splice(o,0,U[o]))):n+=f[l-65136]}else n+=s[o]}return n}(g,y,!0),this.sourceToTarget=U,this.targetToSource=G,this.levels=B,n}_inputFormatSetter(e){if(!Z.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!Z.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=b(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return K.test(e)}}},542:function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return w}));var n,r=i(4),s=i(8),o=i(5),a=i(14),l=i(503),c=i(468),u=i(521),h=i(0),d=(i(9),i(12)),f=(i(6),i(1)),p=i(2),m=i(22),_=(i(3),i(10),i(11),i(416));let g=n=class extends c.a{writeLevels(e,t,i){for(const i in e){const e=this.levels[i];return void(t.stops=e)}}clone(){return new n({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(_.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(_.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Object(d.a)(this.levels)})}};Object(h.a)([Object(f.b)()],g.prototype,"levels",void 0),Object(h.a)([Object(m.a)("levels")],g.prototype,"writeLevels",null),g=n=Object(h.a)([Object(p.a)("esri.views.2d.engine.LevelDependentSizeVariable")],g);const y=o.a.getLogger("esri.views.2d.layers.support.clusterUtils");r.a.add("esri-cluster-arcade-enabled",1);const v=Object(r.a)("esri-cluster-arcade-enabled"),x=(e,t,i,n)=>{const r=t.clone();if(!w(r))return r;if(i.fields)for(const t of i.fields)T(e,t);if("visualVariables"in r){const t=(r.visualVariables||[]).filter(e=>"$view.scale"!==e.valueExpression),o=b(t);t.forEach(t=>{"rotation"===t.type?t.field?t.field=M(e,t.field,"avg_angle"):t.valueExpression&&(t.field=C(e,t.valueExpression,"avg_angle"),t.valueExpression=null):t.normalizationField?(t.field=M(e,t.field,"norm",t.normalizationField),t.normalizationField=null):t.field?t.field=M(e,t.field,"avg"):(t.field=C(e,t.valueExpression,"avg"),t.valueExpression=null)}),Object(s.g)(o)&&!O(t)&&(t.push(S(i,n)),r.dynamicClusterSize=!0),r.visualVariables=t}switch(r.type){case"simple":break;case"unique-value":r.field?r.field=M(e,r.field,"mode"):r.valueExpression&&(r.field=C(e,r.valueExpression,"mode"),r.valueExpression=null);break;case"class-breaks":r.normalizationField?(r.field=M(e,r.field,"norm",r.normalizationField),r.normalizationField=null):r.field?r.field=M(e,r.field,"avg"):(r.field=C(e,r.valueExpression,"avg"),r.valueExpression=null)}return r},b=e=>{for(const t of e)if("size"===t.type)return t;return null},O=e=>{for(const t of e)if("cluster_count"===t.field)return!0;return!1},S=(e,t)=>{const i=[new l.a({value:0,size:0}),new l.a({value:1})];if(Object(s.g)(t))return new c.a({field:"cluster_count",stops:[...i,new l.a({value:2,size:0})]});const n=Object.keys(t).reduce((n,r)=>({...n,[r]:[...i,new l.a({value:Math.max(2,t[r].minValue),size:e.clusterMinSize}),new l.a({value:Math.max(3,t[r].maxValue),size:e.clusterMaxSize})]}),{});return new g({field:"cluster_count",levels:n})},w=e=>{const t=t=>y.error(new a.a("Unsupported-renderer",t,{renderer:e}));if("unique-value"===e.type){if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===e.type){if(e.normalizationField){const i=e.normalizationType;if("field"!==i)return t("FeatureReductionCluster does not support a normalizationType of "+i),!1}}else if("simple"!==e.type)return t("FeatureReductionCluster does not support renderers of type "+e.type),!1;if(!v){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some(e=>!(!("valueExpression"in e)||!e.valueExpression)))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function T(e,t){const{name:i,outStatistic:n}=t,{onStatisticField:r,onStatisticValueExpression:s,statisticType:o}=n;if(s){const t=Object(u.a)(s.toLowerCase());e.push({name:i,outStatistic:{onStatisticField:t,onStatisticValueExpression:s,statisticType:o}})}else r?e.push({name:i,outStatistic:{onStatisticField:r,statisticType:o}}):y.error(new a.a("mapview-unsupported-field","Unable to handle field",{field:t}))}function C(e,t,i){const n=Object(u.a)(t),r="mode"===i?"cluster_type_"+n:"cluster_avg_"+n;return e.some(e=>e.name===r)||e.push({name:r,outStatistic:{onStatisticField:n,onStatisticValueExpression:t,statisticType:i}}),r}function M(e,t,i,n){if("cluster_count"===t||e.some(e=>e.name===t))return t;const r=function(e,t,i){switch(e){case"avg":case"avg_angle":return"cluster_avg_"+t;case"mode":return"cluster_type_"+t;case"norm":{const e=i,n="field",r=t.toLowerCase()+",norm:"+n+","+e.toLowerCase();return"cluster_avg_"+Object(u.a)(r)}}}(i,t,n);return e.some(e=>e.name===r)||("norm"===i?e.push({name:r,outStatistic:{onStatisticField:t,onStatisticNormalizationField:n,statisticType:i}}):e.push({name:r,outStatistic:{onStatisticField:t,statisticType:i}})),r}},543:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c}));var n=i(59),r=i(472),s=i(500);function o(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?o(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const i=t[0];if(!i)return null;const n=i.geometry;if(!n)return null;const r=i.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type?null:{geom:n,asFill:"CIMPolygonSymbol"===r.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function a(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of e)for(const e of s)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<n&&(n=e[1]),e[1]>r&&(r=e[1]);return[t,n,i,r]}function l(e){return e?e.rings?a(e.rings):e.paths?a(e.paths):Object(n.d)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function c(e,t,i,n,r){const[s,o,a,l]=e;if(a<s||l<o)return[0,0,0];const c=a-s,u=l-o,h=Math.floor(31.5),d=(128-2*(h+1))/Math.max(c,u),f=Math.round(c*d)+2*h,p=Math.round(u*d)+2*h;let m=1;t&&(m=p/d/(t.ymax-t.ymin));let _=0,g=0;if(n)if(r){if(t&&i&&t.ymax-t.ymin>0){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin);_=n.x/(i*e),g=n.y/i}}else _=n.x,g=n.y;return _=.5*(t.xmax+t.xmin)+_*(t.xmax-t.xmin),g=.5*(t.ymax+t.ymin)+g*(t.ymax-t.ymin),_-=s,g-=o,_*=d,g*=d,_+=h,g+=h,[m,_/f-.5,-(g/p-.5)]}function u(e){const t=(i=e.geom)?i.rings?i.rings:i.paths?i.paths:void 0!==i.xmin&&void 0!==i.ymin&&void 0!==i.xmax&&void 0!==i.ymax?[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]:null:null;var i;const n=function(e){let t=1/0,i=-1/0,n=1/0,s=-1/0;for(const r of e)for(const e of r)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<n&&(n=e[1]),e[1]>s&&(s=e[1]);return new r.a(t,n,i-t,s-n)}(t),s=Math.floor(31.5),o=(128-2*(s+1))/Math.max(n.width,n.height),a=Math.round(n.width*o)+2*s,l=Math.round(n.height*o)+2*s,c=[];for(const i of t)if(i&&i.length>1){const t=[];for(const e of i){let[i,r]=e;i-=n.x,r-=n.y,i*=o,r*=o,i+=s-.5,r+=s-.5,t.push([i,r])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}c.push(t)}const u=function(e,t,i,n){const r=t*i,s=new Array(r),o=n*n+1;for(let e=0;e<r;++e)s[e]=o;for(const r of e){const e=r.length;for(let o=1;o<e;++o){const e=r[o-1],a=r[o];let l,c,u,h;e[0]<a[0]?(l=e[0],c=a[0]):(l=a[0],c=e[0]),e[1]<a[1]?(u=e[1],h=a[1]):(u=a[1],h=e[1]);let d=Math.floor(l)-n,f=Math.floor(c)+n,p=Math.floor(u)-n,m=Math.floor(h)+n;d<0&&(d=0),f>t&&(f=t),p<0&&(p=0),m>i&&(m=i);const _=a[0]-e[0],g=a[1]-e[1],y=_*_+g*g;for(let n=d;n<f;n++)for(let r=p;r<m;r++){let o,l,c=(n-e[0])*_+(r-e[1])*g;c<0?(o=e[0],l=e[1]):c>y?(o=a[0],l=a[1]):(c/=y,o=e[0]+c*_,l=e[1]+c*g);const u=(n-o)*(n-o)+(r-l)*(r-l),h=(i-r-1)*t+n;u<s[h]&&(s[h]=u)}}}for(let e=0;e<r;++e)s[e]=Math.sqrt(s[e]);return s}(c,a,l,s);return e.asFill&&function(e,t,i,n,r){for(const s of e){const e=s.length;for(let o=1;o<e;++o){const e=s[o-1],a=s[o];let l,c,u,h;e[0]<a[0]?(l=e[0],c=a[0]):(l=a[0],c=e[0]),e[1]<a[1]?(u=e[1],h=a[1]):(u=a[1],h=e[1]);let d=Math.floor(l),f=Math.floor(c)+1,p=Math.floor(u),m=Math.floor(h)+1;d<n&&(d=n),f>t-n&&(f=t-n),p<n&&(p=n),m>i-n&&(m=i-n);for(let s=p;s<m;++s){if(e[1]>s==a[1]>s)continue;const o=(i-s-1)*t;for(let t=d;t<f;++t)t<(a[0]-e[0])*(s-e[1])/(a[1]-e[1])+e[0]&&(r[o+t]=-r[o+t]);for(let e=n;e<d;++e)r[o+e]=-r[o+e]}}}}(c,a,l,s,u),[h(u,s),a,l]}function h(e,t){const i=2*t,n=e.length,r=new Uint8Array(4*n);for(let t=0;t<n;++t){const n=.5-e[t]/i;Object(s.a)(n,r,4*t)}return r}},544:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return a}));var n=i(5),r=i(23);const s=n.a.getLogger("esri.renderers.visualVariables.support.utils"),o=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;const t=e.clone(),i=t.visualVariables.map(e=>l(e)?c(e):e);return t.visualVariables=i,t};function a(e){return e.map(e=>l(e)?c(e.clone()):e)}function l(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function c(e){return e.stops=function(e,t){return t.length<=8?t:(s.warn(`Found ${t.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),t.length>16?function(e,t){const[i,...n]=t,s=n.pop(),o=n[0].value,a=n[n.length-1].value,l=(a-o)/6,c=[];for(let i=o;i<a;i+=l){let s=0;for(;i>=n[s].value;)s++;const o=n[s],a=t[s-1],l=i-a.value,h=o.value===a.value?1:l/(o.value-a.value);if("color"===e){const e=n[s],r=t[s-1],o=e.color.clone();o.r=u(r.color.r,o.r,h),o.g=u(r.color.g,o.g,h),o.b=u(r.color.b,o.b,h),o.a=u(r.color.a,o.a,h),c.push({value:i,color:o,label:e.label})}else if("size"===e){const e=n[s],o=t[s-1],a=Object(r.j)(e.size),l=u(Object(r.j)(o.size),a,h);c.push({value:i,size:l,label:e.label})}else{const e=n[s],r=u(t[s-1].opacity,e.opacity,h);c.push({value:i,opacity:r,label:e.label})}}return[i,...c,s]}(e,t):function(e){const[t,...i]=e,n=i.pop();for(;i.length>6;){let e=0,t=0;for(let n=1;n<i.length;n++){const r=i[n-1],s=i[n],o=Math.abs(s.value-r.value);o>t&&(t=o,e=n)}i.splice(e,1)}return[t,...i,n]}(t))}(e.type,e.stops),e}function u(e,t,i){return(1-i)*e+i*t}},545:function(e,t,i){"use strict";function n(e,t,i){const n=t&&t.length,a=n?t[0]*i:e.length;let l=r(e,0,a,i,!0);const c=new Array;if(!l||l.next===l.prev)return c;let u,f,p,m,_;if(n&&(l=function(e,t,i,n){const o=new Array;for(let i=0,s=t.length;i<s;i++){const a=r(e,t[i]*n,i<s-1?t[i+1]*n:e.length,n,!1);a===a.next&&(a.steiner=!0),o.push(h(a))}o.sort(x);for(const e of o)d(e,i),i=s(i,i.next);return i}(e,t,l,i)),e.length>80*i){u=p=e[0],f=m=e[1];for(let t=i;t<a;t+=i){const i=e[t],n=e[t+1];u=Math.min(u,i),f=Math.min(f,n),p=Math.max(p,i),m=Math.max(m,n)}_=Math.max(p-u,m-f),_=0!==_?1/_:0}return o(l,c,i,u,f,_),c}function r(e,t,i,n,r){let s;if(r===m(e,t,i,n)>0)for(let r=t;r<i;r+=n)s=c(r,e[r],e[r+1],s);else for(let r=i-n;r>=t;r-=n)s=c(r,e[r],e[r+1],s);return s&&v(s,s.next)&&(u(s),s=s.next),s}function s(e,t=e){if(!e)return e;let i,n=e;do{if(i=!1,n.steiner||!v(n,n.next)&&0!==f(n.prev,n,n.next))n=n.next;else{if(u(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function o(e,t,i,n,r,c,h=0){if(!e)return;!h&&c&&(e=function e(t,i,n,r){for(let s;s!==t;s=s.next){if(s=s||t,null===s.z&&(s.z=y(s.x,s.y,i,n,r)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,e(t,i,n,r);s.prevZ=s.prev,s.nextZ=s.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){let t,i=1;for(;;){let n,r=e;e=null,t=null;let s=0;for(;r;){s++,n=r;let o=0;for(;o<i&&n;o++)n=n.nextZ;let a=i;for(;o>0||a>0&&n;){let i;0===o?(i=n,n=n.nextZ,a--):0!==a&&n?r.z<=n.z?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,o--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}r=n}if(t.nextZ=null,i*=2,s<2)return e}}(t)}(e,n,r,c));let d=e;for(;e.prev!==e.next;){const f=e.prev,p=e.next;if(c?l(e,n,r,c):a(e))t.push(f.index/i),t.push(e.index/i),t.push(p.index/i),u(e),e=p.next,d=p.next;else if((e=p)===d){h?1===h?o(e=b(e,t,i),t,i,n,r,c,2):2===h&&O(e,t,i,n,r,c):o(s(e),t,i,n,r,c,1);break}}}function a(e){const t=e.prev,i=e,n=e.next;if(f(t,i,n)>=0)return!1;let r=e.next.next;const s=r;let o=0;for(;r!==e.prev&&(0===o||r!==s);){if(o++,_(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&f(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,i,n){const r=e.prev,s=e,o=e.next;if(f(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=y(a,l,t,i,n),d=y(c,u,t,i,n);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=h&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&_(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&f(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&_(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&f(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&_(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&f(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&_(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&f(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function c(e,t,i,n){const r=new T(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function u(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function h(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function d(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===o)return s.prev;const a=s,l=s.x,c=s.y;let u,h=1/0;for(i=s.next;i!==a;)n>=i.x&&i.x>=l&&n!==i.x&&_(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),(u<h||u===h&&i.x>s.x)&&g(i,e)&&(s=i,h=u)),i=i.next;return s}(e,t)){const i=w(t,e);s(i,i.next)}}function f(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function p(e,t,i,n){return!!(v(e,t)&&v(i,n)||v(e,n)&&v(i,t))||f(e,t,i)>0!=f(e,t,n)>0&&f(i,n,e)>0!=f(i,n,t)>0}function m(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}function _(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function g(e,t){return f(e.prev,e,e.next)<0?f(e,t,e.next)>=0&&f(e,e.prev,t)>=0:f(e,t,e.prev)<0||f(e,e.next,t)<0}function y(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e,t){return e.x===t.x&&e.y===t.y}function x(e,t){return e.x-t.x}function b(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!v(r,s)&&p(r,n,n.next,s)&&g(r,s)&&g(s,r)&&(t.push(r.index/i),t.push(n.index/i),t.push(s.index/i),u(n),u(n.next),n=e=s),n=n.next}while(n!==e);return n}function O(e,t,i,n,r,a){let l=e;do{let e=l.next.next;for(;e!==l.prev;){if(l.index!==e.index&&S(l,e)){let c=w(l,e);return l=s(l,l.next),c=s(c,c.next),o(l,t,i,n,r,a),void o(c,t,i,n,r,a)}e=e.next}l=l.next}while(l!==e)}function S(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&p(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&g(e,t)&&g(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)}function w(e,t){const i=new T(e.index,e.x,e.y),n=new T(t.index,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}i.d(t,"a",(function(){return n}));class T{constructor(e,t,i){this.index=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},546:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return r}));var n=i(415);function r(e,t,i){l.trackDistance=null!=t.trackDistance&&t.trackDistance,l.wrapDistance=null!=t.wrapDistance?t.wrapDistance:65535,l.thin=null!=t.thin&&t.thin,l.initialDistance=null!=t.initialDistance?t.initialDistance:0,l.enableOuterBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,l.outerBisectorAutoSplitThreshold=null!=t.outerBisectorAutoSplitThreshold?t.outerBisectorAutoSplitThreshold:0,l.enableInnerBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,l.innerBisectorAutoSplitThreshold=null!=t.innerBisectorAutoSplitThreshold?t.innerBisectorAutoSplitThreshold:0,a=e,c=i,m=0,u=0,h=0,d=!1,f=null,p=null,_.currentVertex.x=null,_.currentVertex.y=null,_.distance=l.initialDistance;const n=a[0],r=a[a.length-1];_.canSplit=!1,_.closed=n.x===r.x&&n.y===r.y,a.length<2||2===a.length&&_.closed||(l.thin?l.trackDistance?function(){for(g(),y(),b(1);u-h>l.wrapDistance||m<a.length;)g(),y(),b(2),c.bridge(_),_.leftExit0=_.rightExit0,_.leftExit2=_.rightExit2}():function(){for(;m<a.length;){if(m>0&&(_.inbound.x=_.outbound.x,_.inbound.y=_.outbound.y),m<a.length-1){_.outbound.x=a[m+1].x-a[m].x,_.outbound.y=a[m+1].y-a[m].y;const e=Math.sqrt(_.outbound.x*_.outbound.x+_.outbound.y*_.outbound.y);_.distance+=e,_.outbound.x/=e,_.outbound.y/=e}else _.outbound.x=_.inbound.x,_.outbound.y=_.inbound.y;0===m&&(_.inbound.x=_.outbound.x,_.inbound.y=_.outbound.y),_.currentVertex.x=a[m].x,_.currentVertex.y=a[m].y,_.prevNormal.x=-_.inbound.y,_.prevNormal.y=_.inbound.x,_.nextNormal.x=-_.outbound.y,_.nextNormal.y=_.outbound.x,0===m?(c.vertex(_),_.leftEntry0=_.entry0,_.leftEntry2=_.entry2,_.leftExit0=_.exit0,_.leftExit2=_.exit2):(c.vertex(_),_.rightEntry0=_.entry0,_.rightEntry2=_.entry2,_.rightExit0=_.exit0,_.rightExit2=_.exit2,c.bridge(_),_.leftExit0=_.rightExit0,_.leftExit2=_.rightExit2),++m}}():l.enableOuterBisectorSplit||l.outerBisectorAutoSplitThreshold>0||l.enableInnerBisectorSplit||l.innerBisectorAutoSplitThreshold>0?(_.canSplit=!0,function(){for(g(),v(),_.splitInner=_.gapInner=_.splitOuter=_.gapOuter=!1,x(1),_.closure0=_.leftEntry0,_.closure1=_.leftEntry1,_.closure2=_.leftEntry2;u-h>l.wrapDistance||m<a.length-1||m<a.length&&(!_.closed||l.trackDistance);)g(),v(),_.splitInner=_.gapInner=_.splitOuter=_.gapOuter=!1,x(2),c.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2;_.closed&&!l.trackDistance&&(_.rightEntry0=_.closure0,_.rightEntry1=_.closure1,_.rightEntry2=_.closure2,c.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2)}()):function(){for(g(),v(),x(1),_.closure0=_.leftEntry0,_.closure1=_.leftEntry1,_.closure2=_.leftEntry2;u-h>l.wrapDistance||m<a.length-1||m<a.length&&(!_.closed||l.trackDistance);)g(),v(),x(2),c.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2;_.closed&&!l.trackDistance&&(_.rightEntry0=_.closure0,_.rightEntry1=_.closure1,_.rightEntry2=_.closure2,c.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2)}())}function s(){a=null,c=null}function o(){if(_.cosine<l.innerBisectorAutoSplitThreshold){_.splitInner=!0,_.gapInner=!0;const e=Math.max(l.innerBisectorAutoSplitThreshold,_.cosine),t=Math.sqrt(1-e*e)/e;_.leftInner.x=_.nextNormal.x+_.sign*t*_.outbound.x,_.leftInner.y=_.nextNormal.y+_.sign*t*_.outbound.y,_.rightInner.x=_.prevNormal.x-_.sign*t*_.inbound.x,_.rightInner.y=_.prevNormal.y-_.sign*t*_.inbound.y}else l.enableInnerBisectorSplit&&(_.splitInner=!0,_.gapInner=!1,_.leftInner.x=_.rightInner.x=_.bisector.x/_.cosine,_.leftInner.y=_.rightInner.y=_.bisector.y/_.cosine);if(_.cosine<l.outerBisectorAutoSplitThreshold){_.splitOuter=!0,_.gapOuter=!0;const e=Math.max(l.outerBisectorAutoSplitThreshold,_.cosine),t=Math.sqrt(1-e*e)/e;_.leftOuter.x=_.prevNormal.x-_.sign*t*_.inbound.x,_.leftOuter.y=_.prevNormal.y-_.sign*t*_.inbound.y,_.rightOuter.x=_.nextNormal.x+_.sign*t*_.outbound.x,_.rightOuter.y=_.nextNormal.y+_.sign*t*_.outbound.y}else l.enableOuterBisectorSplit&&(_.splitOuter=!0,_.gapOuter=!1,_.leftOuter.x=_.rightOuter.x=_.bisector.x/_.cosine,_.leftOuter.y=_.rightOuter.y=_.bisector.y/_.cosine)}let a;const l={};let c,u,h,d,f,p,m=void 0;const _=new class{constructor(){this.closed=void 0,this.isFirstVertex=void 0,this.isLastVertex=void 0,this.isCap=void 0,this.currentVertex={x:void 0,y:void 0},this.inbound={x:void 0,y:void 0},this.outbound={x:void 0,y:void 0},this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.bisector={x:void 0,y:void 0},this.leftInner={x:void 0,y:void 0},this.rightInner={x:void 0,y:void 0},this.leftOuter={x:void 0,y:void 0},this.rightOuter={x:void 0,y:void 0}}};function g(){if(d)return _.distance=0,_.isCap=_.isFirstVertex=_.isLastVertex=!1,void(d=!1);if(0===u)if(_.isFirstVertex=0===m,p=a[m],0===m){if(u=0,_.closed){_.inbound.x=p.x-a[a.length-2].x,_.inbound.y=p.y-a[a.length-2].y;const e=Math.sqrt(_.inbound.x*_.inbound.x+_.inbound.y*_.inbound.y);_.inbound.x/=e,_.inbound.y/=e}}else _.inbound.x=p.x-f.x,_.inbound.y=p.y-f.y,u=Math.sqrt(_.inbound.x*_.inbound.x+_.inbound.y*_.inbound.y),_.inbound.x/=u,_.inbound.y/=u;if(_.distance+u-h<=l.wrapDistance){if(m<a.length-1){_.outbound.x=a[m+1].x-p.x,_.outbound.y=a[m+1].y-p.y;const e=Math.sqrt(_.outbound.x*_.outbound.x+_.outbound.y*_.outbound.y);_.outbound.x/=e,_.outbound.y/=e}else if(_.closed){_.outbound.x=a[1].x-p.x,_.outbound.y=a[1].y-p.y;const e=Math.sqrt(_.outbound.x*_.outbound.x+_.outbound.y*_.outbound.y);_.outbound.x/=e,_.outbound.y/=e}else _.outbound.x=_.inbound.x,_.outbound.y=_.inbound.y;return 0!==m||_.closed||(_.inbound.x=_.outbound.x,_.inbound.y=_.outbound.y),++m,_.isLastVertex=m===a.length,_.isCap=!_.closed&&(_.isFirstVertex||_.isLastVertex),_.distance+=u-h,u=0,h=0,d=_.distance+u-h===l.wrapDistance,_.currentVertex.x=p.x,_.currentVertex.y=p.y,f=p,void(p=null)}_.outbound.x=_.inbound.x,_.outbound.y=_.inbound.y,h+=l.wrapDistance-_.distance,_.distance=l.wrapDistance,d=!0;const e=h/u;_.currentVertex.x=(1-e)*f.x+e*p.x,_.currentVertex.y=(1-e)*f.y+e*p.y}function y(){_.prevNormal.x=-_.inbound.y,_.prevNormal.y=_.inbound.x,_.nextNormal.x=-_.outbound.y,_.nextNormal.y=_.outbound.x}function v(){y(),_.bisector.x=_.prevNormal.x+_.nextNormal.x,_.bisector.y=_.prevNormal.y+_.nextNormal.y;const e=Math.sqrt(_.bisector.x*_.bisector.x+_.bisector.y*_.bisector.y);if(e<.001)return _.bisector.x=void 0,_.bisector.y=void 0,_.cosine=0,void(_.sign=void 0);_.bisector.x/=e,_.bisector.y/=e,_.cosine=_.bisector.x*_.nextNormal.x+_.bisector.y*_.nextNormal.y,_.sign=_.prevNormal.x*_.nextNormal.y-_.prevNormal.y*_.nextNormal.x>=0?1:-1}function x(e){c.vertex(_),1===e?(_.leftEntry0=_.entry0,_.leftEntry1=_.entry1,_.leftEntry2=_.entry2,_.leftExit0=_.exit0,_.leftExit1=_.exit1,_.leftExit2=_.exit2):2===e&&(_.rightEntry0=_.entry0,_.rightEntry1=_.entry1,_.rightEntry2=_.entry2,_.rightExit0=_.exit0,_.rightExit1=_.exit1,_.rightExit2=_.exit2)}function b(e){c.vertex(_),1===e?(_.leftEntry0=_.entry0,_.leftEntry2=_.entry2,_.leftExit0=_.exit0,_.leftExit2=_.exit2):2===e&&(_.rightEntry0=_.entry0,_.rightEntry2=_.entry2,_.rightExit0=_.exit0,_.rightExit2=_.exit2)}class O{constructor(e,t){this.writeVertex=e,this.writeTriangle=t,this.capType=0,this.joinType=2,this.miterLimitCosine=Object(n.b)(2),this.roundLimitCosine=Math.cos(23*Math.PI/180),this.almostParallelCosine=.97,this.radsPerSlice=.8,this.textured=!1,this.joinOnUTurn=!1}vertex(e){const t=2===this.joinType?this.miterLimitCosine:this.roundLimitCosine,i=e.isCap&&0!==this.capType;let n=!1;e.cosine>this.almostParallelCosine?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):e.cosine<1-this.almostParallelCosine?(n=!e.isCap&&this.joinOnUTurn,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.canSplit?(o(),e.sign>0?(e.splitInner?(e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.leftInner.x,e.leftInner.y,0,-1,e.distance),e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.rightInner.x,e.rightInner.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(n=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.splitOuter?(n=n||e.gapOuter,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.leftOuter.x,-e.leftOuter.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.rightOuter.x,-e.rightOuter.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.splitInner?(e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.leftInner.x,-e.leftInner.y,0,1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.rightInner.x,-e.rightInner.y,0,1,e.distance)):e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(n=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.splitOuter?(n=n||e.gapOuter,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.leftOuter.x,e.leftOuter.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.rightOuter.x,e.rightOuter.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance))):e.sign>0?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(n=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(n=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance));const r=e.canSplit&&(e.splitInner||e.splitOuter);let s;if(s=e.entry1=e.exit1=r||n||i?this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,0,0,0,0,e.distance):null,n&&1!==this.joinType)this.writeTriangle(s,e.sign>0?e.exit2:e.entry0,e.sign>0?e.entry2:e.exit0);else if(i&&1===this.capType||n&&1===this.joinType){let t,i,n,r,o,a;if(e.isCap){const s=Math.PI;o=Math.ceil(s/this.radsPerSlice),a=s/o,e.isFirstVertex?(t=e.prevNormal.x,i=e.prevNormal.y,n=e.entry0,r=e.entry2):e.isLastVertex&&(t=-e.nextNormal.x,i=-e.nextNormal.y,n=e.exit2,r=e.exit0)}else{const s=2*Math.acos(e.cosine);o=Math.ceil(s/this.radsPerSlice),a=s/o,t=e.sign>0?-e.prevNormal.x:e.nextNormal.x,i=e.sign>0?-e.prevNormal.y:e.nextNormal.y,n=e.sign>0?e.entry2:e.exit0,r=e.sign>0?e.exit2:e.entry0}const l=Math.cos(a),c=Math.sin(a),u=c*t+l*i;let h,d;t=l*t-c*i,i=u;for(let a=0;a<o;++a){if(h=d,a<o-1)if(e.isCap){const n=e.isFirstVertex?-1:1;d=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,t,i,n,0,e.distance)}else d=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,t,i,0,e.sign,e.distance);this.writeTriangle(0===a?n:h,s,a===o-1?r:d);const u=c*t+l*i;t=l*t-c*i,i=u}}else if(i&&2===this.capType){const t=e.isFirstVertex?1:-1;let i,n;this.textured?(i=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-t*e.inbound.x,e.prevNormal.y-t*e.inbound.y,-t,-1,e.distance),n=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-t*e.inbound.x,-e.prevNormal.y-t*e.inbound.y,-t,1,e.distance)):(i=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-t*e.inbound.x,e.prevNormal.y-t*e.inbound.y,0,-1,e.distance),n=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-t*e.inbound.x,-e.prevNormal.y-t*e.inbound.y,0,1,e.distance)),t>0?(this.writeTriangle(s,e.entry2,n),this.writeTriangle(s,n,i),this.writeTriangle(s,i,e.entry0)):(this.writeTriangle(s,n,e.exit2),this.writeTriangle(s,i,n),this.writeTriangle(s,e.exit0,i))}}bridge(e){this.writeTriangle(e.leftExit0,e.rightEntry0,null!=e.leftExit1?e.leftExit1:e.leftExit2),this.writeTriangle(e.rightEntry0,null!=e.rightEntry1?e.rightEntry1:e.rightEntry2,null!=e.leftExit1?e.leftExit1:e.leftExit2),null!=e.leftExit1&&null!=e.rightEntry1?(this.writeTriangle(e.leftExit1,e.rightEntry1,e.leftExit2),this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)):null!=e.leftExit1?this.writeTriangle(e.leftExit1,e.rightEntry2,e.leftExit2):null!=e.rightEntry1&&this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)}}},547:function(e,t,i){"use strict";i.d(t,"b",(function(){return v}));var n=i(4),r=(i(9),i(8)),s=i(5),o=i(14),a=i(7),l=i(69),c=i(522),u=i(417),h=i(396),d=i(398),f=i(494),p=i(540);const m=s.a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),_=Object(f.b)(f.a,m),g=e=>(2147483648&e)>>>31,y=e=>2147483647&e;function v(e){return 1===g(e)}const x={sharedArrayBuffer:Object(n.a)("esri-shared-array-buffer"),oesTextureFloat:Object(n.a)("esri-webgl-texture-float"),maxTextureSize:Object(n.a)("esri-webgl-max-texture-size"),atomics:Object(n.a)("esri-atomics")};function b(e,t){return i=>t(e(i))}class O{constructor(e,t,i,n){this.size=0,this.texelSize=4;const{pixelType:r,layout:s,textureOnly:o}=n;this.textureOnly=o||!1,this.pixelType=r,this._ctype=t,this.layout=s,this._resetRange(),this._shared=e,this.size=i,o||(this.data=this._initData(r,i,e,t))}get buffer(){return Object(r.a)(this.data,e=>e.buffer)}unsetComponentAllTexels(e,t){const i=Object(r.m)(this.data);for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const i=Object(r.m)(this.data);for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,i){const n=Object(r.m)(this.data);for(const r of i)n[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(e,t,i){Object(r.m)(this.data)[i*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(e,t,i){Object(r.m)(this.data)[i*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(e,t){const i=y(e);return Object(r.m)(this.data)[i*this.texelSize+t]}setData(e,t,i){const n=y(e),r=1<<t;0!=(this.layout&r)?(this.data[n*this.texelSize+t]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)):m.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):Object(n.a)("esri-2d-debug")&&m.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")}unlock(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):Object(n.a)("esri-2d-debug")&&m.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e,this._shared,this._ctype),i=Object(r.m)(this.data);t.set(i),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,i=this.texelSize;if(e>t)return null;this._resetRange();const n=!(this._shared||"local"===this._ctype),s=this.pixelType,o=this.layout,a=Object(r.m)(this.data);return a.slice?{start:e,end:t,data:n&&a.slice(e*i,(t+1)*i)||null,pixelType:s,layout:o}:n?{start:e,end:t,data:new(Object(d.i)(this.pixelType))(Array.prototype.slice.call(this.data,e*i,(t+1)*i)),pixelType:s,layout:o}:{start:e,end:t,data:null,pixelType:s,layout:o}}_initData(e,t,i,n){const r=i&&"local"!==n?SharedArrayBuffer:ArrayBuffer,s=Object(d.i)(e),o=new s(new r(t*t*4*s.BYTES_PER_ELEMENT));for(let e=0;e<o.length;e+=4)o[e+1]=255;return o}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}t.a=class{constructor(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(h.o),this._targetType=0,this._abortController=Object(a.c)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const t=x.oesTextureFloat?5126:5121;_(`Creating AttributeStore ${x.sharedArrayBuffer?"with":"without"} shared memory`),Object(n.a)("esri-2d-debug")&&x.sharedArrayBuffer&&!x.atomics&&m.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,t){const i=Object(c.a)(this._schema,t);if(i&&(Object(n.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",i),e.storage.data=!0,this._schema=t,this._attributeComputeMap.clear(),!Object(r.g)(t))){switch(t.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(const e of t.mapping)this._bindAttribute(e)}}onTileData(e,t){if(Object(r.g)(t.addOrUpdate))return;const i=t.addOrUpdate.getCursor();for(;i.next();){const e=i.getDisplayId();this.setAttributeData(e,i)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=Object(a.c)()}async setHighlight(e,t){const i=this._getBlock(0),n=t.map(e=>y(e));i.lock(),i.unsetComponentAllTexels(0,1),i.setComponent(0,1,n),i.unlock(),this._idsToHighlight.clear();for(const t of e)this._idsToHighlight.add(t);await this.sendUpdates()}async updateFilters(e,t){const{config:i,service:r,spatialReference:s}=t,{filters:o}=i,l=o.map((e,t)=>this._updateFilter(e,t,r,s));(await Object(a.a)(l)).some(e=>e)&&(e.storage.filters=!0,Object(n.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(e,t,i,n){const r=y(e);this._ensureSizeForTexel(r),this._getBlock(t).setData(e,i,n)}getData(e,t,i){return this._getBlock(t).getData(e,i)}getHighlightFlag(e){return this._idsToHighlight.has(e)?h.l:0}setAttributeData(e,t){const i=y(e);if(this._ensureSizeForTexel(i),this._getBlock(0).setData(i,0,this.getFilterFlags(t)),this._targetType!==g(e))return;const n=this._attributeComputeMap,r=x.oesTextureFloat?1:2;n.size&&n.forEach((e,n)=>{const s=n*r%4,o=Math.floor(n*r/4),a=this._getBlock(o+h.b),c=e(t);if(x.oesTextureFloat)a.setData(i,s,c);else if(c===h.p)a.setData(i,s,255),a.setData(i,s+1,255);else{const e=Object(l.c)(Math.round(c),-32767,32766)+32768,t=255&e,n=(65280&e)>>8;a.setData(i,s,t),a.setData(i,s+1,n)}})}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(a.g)(),this._nextUpdate.promise;const e={blocks:this._blocks.map(e=>Object(r.h)(e)?e.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>e.resolve())}},i=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),i}).catch(e=>Object(a.b)(e)?(this._createResourcesPromise=null,this._createResources()):(m.error(new o.a("mapview-attribute-store","Encountered an error during client update",e)),Object(a.r)())),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){let t;if(null!=e.fieldIndex)e.normalizationField&&m.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),t=t=>t.getComputedNumericAtIndex(e.fieldIndex);else{if(!e.field)return void(Object(n.a)("esri-2d-debug")&&console.error("Unable to create evaluator. Found neither a field nor fieldIndex in",e));t=e.normalizationField?t=>{const i=t.readAttribute(e.normalizationField);return i?t.readAttribute(e.field)/i:null}:t=>t.readAttribute(e.field)}e.valueRepresentation&&(t=b(t,t=>Object(p.b)(t,e.valueRepresentation))),this._attributeComputeMap.set(e.binding,b(t,e=>null===e||isNaN(e)||e===1/0?h.p:e))}_createResources(){if(Object(r.h)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(h.a),_("Initializing AttributeStore");const e={shared:x.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(r.j)(this._blocks,e=>({textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}))},t=this._client.initialize(e,this._signal).catch(e=>{Object(a.b)(e)?this._createResourcesPromise=null:m.error(new o.a("mapview-attribute-store","Encountered an error during client initialization",e))});return this._createResourcesPromise=t,t.then(()=>Object(r.g)(this._createResourcesPromise)?this._createResources():void 0),t}_getBlock(e){const t=this._blocks[e];if(Object(r.h)(t))return t;_("Initializing AttributeBlock at index "+e);const i=x.sharedArrayBuffer,n=this._client.type,s=new O(i,n,this._size,this._blockDescriptors[e]);return this._blocks[e]=s,this._createResourcesPromise=null,s}_expand(){if(this._size<x.maxTextureSize){const e=this._size<<=1;return _("Expanding block size to",e,this._blocks),Object(r.e)(this._blocks,t=>t.expand(e)),this._createResourcesPromise=null,this._size=e,0}return m.error(new o.a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(e,t,i,n){const s=this._filters[t],o=Object(r.h)(s)&&s.hash;if(!s&&!e)return!1;if(o===JSON.stringify(e))return!1;if(Object(r.g)(e)){const e=1<<t+1,i=this._getBlock(0);return this._filters[t]=null,i.setComponentAllTexels(0,e),this.sendUpdates(),!0}const a=await this._getFilter(t,i);return await a.update(e,n),!0}async _getFilter(e,t){const n=this._filters[e];if(Object(r.h)(n))return n;const{default:s}=await i.e(75).then(i.bind(null,586)),o=new s({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new u.a(t.fields)});return this._filters[e]=o,o}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){let t=0;const i=(n=e.getDisplayId(),1===g(n)?254:255);var n;for(let n=0;n<this._filters.length;n++){const s=!!(i&1<<n),o=this._filters[n];t|=(!s||Object(r.g)(o)||o.check(e)?1:0)<<n}let s=0;if(this._idsToHighlight.size){const t=e.getObjectId();s=this.getHighlightFlag(t)}return t<<1|s}}},549:function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var n=i(396),r=i(550),s=i(436);const o={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],samplingMode:9729,mips:!1},trilinear:{defines:[],samplingMode:9987,mips:!0}};var a=class extends s.a{constructor(){super(...arguments),this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:{a_position:0,a_texcoord:1}}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:e},t){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(514,t.stencilRef,255)}draw(e,t){const{context:i,renderingOptions:s,painter:a}=e;if(!t.source)return;e.timeline.begin(this.name),this._quad||(this._quad=new r.a(i,[0,0,1,0,0,1,1,1]));const l=((e,t,i)=>{if("dynamic"===i.samplingMode){const{state:i}=e,n=t.resolution/t.pixelRatio/i.resolution,r=Math.round(e.pixelRatio)!==e.pixelRatio,s=n>1.05||n<.95;return i.rotation||s||r||t.isSourceScaled||t.rotation?o.bilinear:o.nearest}return o[i.samplingMode]})(e,t,s),c=a.materialManager.getProgram(e,this._desc,l.defines);t.updateTexture(e),t.setSamplingProfile(l),t.bind(e,n.w),i.bindProgram(c),c.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),c.setUniform1i("u_texture",n.w),c.setUniform2fv("u_coordScale",t.coordScale),this._quad.draw(),e.timeline.end(this.name)}},l=i(460),c=i(470),u=i(398),h=i(568),d=class extends s.a{constructor(){super(...arguments),this._color=Object(c.b)(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:e}){e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setFaceCullingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,0,255)}draw(e,t){const{context:i,state:n}=e;this._program||(this._program=Object(l.a)(i,h.a));const r=this._program,s=Object(u.f)("clip",{geometry:[{location:0,name:"a_pos",count:2,type:5122}]}),o=t.getVAO(i,n,s.attributes,s.bufferLayouts);i.bindProgram(this._program),r.setUniform2fv("u_coord_range",[1,1]),r.setUniform4fv("u_color",this._color),r.setUniformMatrix3fv("u_dvsMat3",n.displayMat3),i.bindVAO(o),i.drawElements(4,o.indexBuffer.size,5125,0),i.bindVAO()}},f=i(538),p=i(534),m=i(216),_=(i(404),i(405)),g=i(406),y=i(407),v=(i(408),i(409),i(411),i(402)),x=i(397),b=i(614);class O extends s.a{constructor(){super(...arguments),this._color=Object(c.b)(1,0,0,1),this._patternMatrix=Object(m.b)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._program&&(this._program.dispose(),this._program=null),this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:i,styleLayerId:r}=e;this._loadWGLResources(i);const s=e.displayLevel,o=e.styleLayer,a=e.painter.getVectorTileProgramCach(),l=o.getPaintValue("background-color",s),c=o.getPaintValue("background-opacity",s),u=o.getPaintValue("background-pattern",s),h=void 0!==u,d=l[3]*c,f=1|window.devicePixelRatio,p=e.spriteMosaic;let m;const _=f>n.G?2:1,g=e.drawPhase===x.c.HITTEST,y=(g?1:0)<<1|(h?1:0),b=this._programOptions;b.id=g,b.pattern=h;const O=a.getProgram(0,y,b);if(i.bindVAO(this._vao),i.bindProgram(O),h){if(m=p.getMosaicItemPosition(u,!0),!m)return;O.setUniform1f("u_opacity",c),O.setUniform2f("u_pattern_tl",m.tl[0],m.tl[1]),O.setUniform2f("u_pattern_br",m.br[0],m.br[1]),O.setUniform1i("u_texture",n.I),p.bind(i,9729,m.page,n.I)}else this._color[0]=d*l[0],this._color[1]=d*l[1],this._color[2]=d*l[2],this._color[3]=d,O.setUniform4fv("u_color",this._color);if(O.setUniform1f("u_depth",o.z||0),g){const e=Object(v.c)(r+1);O.setUniform4fv("u_id",e)}for(const e of t){if(O.setUniform1f("u_coord_range",e.coordRange[0]),O.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),h){const t=Math.max(Math.pow(2,Math.round(s)-e.key.level),1),i=_*e.size[0]*t,n=i/m.size[0],r=i/m.size[1];this._patternMatrix[0]=n,this._patternMatrix[4]=r,O.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(514,e.stencilRef,255),i.drawArrays(5,0,4)}}_loadWGLResources(e){if(this._program&&this._vao)return;const t=Object(l.a)(e,b.a);if(!t)return;const i=new Int8Array([0,0,1,0,0,1,1,1]),n=_.a.createVertex(e,35044,i),r=new y.a(e,b.a.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:n});this._program=t,this._vao=r}}var S=i(8);const w=[1,1,1,1];class T extends s.a{constructor(){super(...arguments),this._color=Object(c.a)(),this._strokeColor=Object(c.a)(),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:i,state:n,drawPhase:r,styleLayerId:s}=e,o=e.displayLevel,a=e.styleLayer,l=e.painter.getVectorTileProgramCach(),c=a.hasDataDrivenRadius?1:a.getPaintValue("circle-radius",o),u=a.hasDataDrivenColor?w:a.getPaintValue("circle-color",o),h=a.hasDataDrivenOpacity?1:a.getPaintValue("circle-opacity",o),d=a.hasDataDrivenStrokeWidth?1:a.getPaintValue("circle-stroke-width",o),f=a.hasDataDrivenStrokeColor?w:a.getPaintValue("circle-stroke-color",o),p=a.hasDataDrivenStrokeOpacity?1:a.getPaintValue("circle-stroke-opacity",o),m=a.hasDataDrivenBlur?0:a.getPaintValue("circle-blur",o);let _=h*u[3];this._color[0]=_*u[0],this._color[1]=_*u[1],this._color[2]=_*u[2],this._color[3]=_,_=p*f[3],this._strokeColor[0]=_*f[0],this._strokeColor[1]=_*f[1],this._strokeColor[2]=_*f[2],this._strokeColor[3]=_;const g=a.getPaintValue("circle-translate",o),y=a.getPaintValue("circle-translate-anchor",o),b=r===x.c.HITTEST,O=b?1:0,T=this._programOptions;T.id=b;const C=l.getProgram(5,O,T);if(i.bindProgram(C),C.setUniformMatrix3fv("u_displayMat3",1===y?n.displayMat3:n.displayViewMat3),C.setUniform2fv("u_circleTranslation",g),C.setUniform1f("u_depth",a.z),C.setUniform1f("u_radius",c),C.setUniform4fv("u_color",this._color),C.setUniform1f("u_blur",m),C.setUniform1f("u_stroke_width",d),C.setUniform4fv("u_stroke_color",this._strokeColor),C.setUniform1f("u_antialiasingWidth",1.2),b){const e=Object(v.c)(s+1);C.setUniform4fv("u_id",e)}for(const e of t){if(!e.layerData[s])continue;const t=e.layerData[s];t.prepareForRendering(i,l);const n=t.circleVertexArrayObject;Object(S.g)(n)||(i.bindVAO(n),C.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),i.setStencilFunction(514,e.stencilRef,255),i.drawElements(4,t.circleIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),e.triangleCount+=t.circleIndexCount/3)}}}const C=[1,1,1,1];class M extends s.a{constructor(){super(...arguments),this._color=Object(c.a)(),this._outlineColor=Object(c.a)(),this._fillProgramOptions={id:!1,dd:!1,pattern:!1},this._outlineProgramOptions={id:!1,dd:!1},this._patternMatrix=Object(m.b)()}dispose(){}drawMany(e,t){const{displayLevel:i,drawPhase:n,renderPass:r,styleLayerId:s}=e,o=e.styleLayer,a=o.getPaintValue("fill-pattern",i),l=o.hasDataDrivenColor?C:o.getPaintValue("fill-color",i),c=o.hasDataDrivenOpacity?1:o.getPaintValue("fill-opacity",i),u=c*l[3],h=void 0!==a||u<1||o.hasDataDrivenFill;if(h&&"opaque"===r)return;let d;this._color[0]=u*l[0],this._color[1]=u*l[1],this._color[2]=u*l[2],this._color[3]=u,n===x.c.HITTEST&&(d=Object(v.c)(s+1));const f=o.getPaintValue("fill-translate",i),p=o.getPaintValue("fill-translate-anchor",i);this._drawFill(e,s,o,t,f,p,a,h,d),this._drawOutline(e,s,o,t,f,p,a,d,c)}_drawFill(e,t,i,r,s,o,a,l,c){const{context:u,displayLevel:h,drawPhase:d,pixelRatio:f,renderPass:p,spriteMosaic:m,state:_}=e;if(!l&&"translucent"===p)return;const g=void 0!==a,y=f>n.G?2:1,v=i.hasDataDrivenFill,b=e.painter.getVectorTileProgramCach();let O;const w=d===x.c.HITTEST,T=(w?1:0)<<2|(v?1:0)<<1|(g?1:0),C=this._fillProgramOptions;C.id=w,C.dd=v,C.pattern=g;const M=b.getProgram(1,T,C);if(u.bindProgram(M),g){if(O=m.getMosaicItemPosition(a,!0),!O)return void u.bindProgram();M.setUniform2f("u_pattern_tl",O.tl[0],O.tl[1]),M.setUniform2f("u_pattern_br",O.br[0],O.br[1]),M.setUniform1i("u_texture",n.I),m.bind(u,9729,O.page,n.I)}M.setUniformMatrix3fv("u_displayMat3",1===o?_.displayMat3:_.displayViewMat3),M.setUniform2fv("u_fillTranslation",s),M.setUniform1f("u_depth",i.z+152587890625e-16),M.setUniform4fv("u_color",this._color),w&&M.setUniform4fv("u_id",c);for(const e of r){if(!e.layerData[t])continue;const i=e.layerData[t];i.prepareForRendering(u,b);const n=i.fillVertexArrayObject;if(!Object(S.g)(n)){if(u.bindVAO(n),M.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),g){const t=Math.max(Math.pow(2,Math.round(h)-e.key.level),1),i=e.coordRange[0]/(y*e.size[0]*t),n=1/(O.size[0]*i),r=1/(O.size[1]*i);this._patternMatrix[0]=n,this._patternMatrix[4]=r,M.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}u.setStencilFunction(514,e.stencilRef,255),u.drawElements(4,i.fillIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*i.fillIndexStart),e.triangleCount+=i.fillIndexCount/3}}}_drawOutline(e,t,i,n,r,s,o,a,l){const{context:c,displayLevel:u,drawPhase:h,renderPass:d,pixelRatio:f,state:p}=e;if("opaque"===d)return;const m=void 0!==o;if(!(i.getPaintValue("fill-antialias",u)&&!m||i.hasDataDrivenOutlineColor))return;const _=e.painter.getVectorTileProgramCach(),g=i.hasDataDrivenOutline;if(i.outlineUsesFillColor){if(1!==this._color[3])return;this._outlineColor[0]=this._color[0],this._outlineColor[1]=this._color[1],this._outlineColor[2]=this._color[2],this._outlineColor[3]=this._color[3]}else{const e=i.hasDataDrivenOutlineColor?C:i.getPaintValue("fill-outline-color",u),t=l*e[3];this._outlineColor[0]=t*e[0],this._outlineColor[1]=t*e[1],this._outlineColor[2]=t*e[2],this._outlineColor[3]=t}const y=.75/f,v=h===x.c.HITTEST,b=(v?1:0)<<1|(g?1:0),O=this._outlineProgramOptions;O.id=v,O.dd=g;const w=_.getProgram(2,b,O);c.bindProgram(w),w.setUniformMatrix3fv("u_displayMat3",1===s?p.displayMat3:p.displayViewMat3),w.setUniform2fv("u_fillTranslation",r),w.setUniform1f("u_depth",i.z+152587890625e-16),w.setUniform1f("u_outline_width",y),w.setUniform4fv("u_color",this._outlineColor),v&&w.setUniform4fv("u_id",a);for(const e of n){if(!e.layerData[t])continue;const i=e.layerData[t];i.prepareForRendering(c,_);const n=i.outlineVertexArrayObject;Object(S.g)(n)||(c.bindVAO(n),w.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),c.setStencilFunction(514,e.stencilRef,255),c.drawElements(4,i.outlineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*i.outlineIndexStart),e.triangleCount+=i.outlineIndexCount/3)}}}var I=i(260);Math.PI;const j=[1,1,1,1];class E extends s.a{constructor(){super(...arguments),this._color=Object(c.a)(),this._dashArray=Object(I.a)(),this._programOptions={id:!1,dd:!1,pattern:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:r,state:s,drawPhase:o,styleLayerId:a}=e,l=e.styleLayer,c=e.painter.getVectorTileProgramCach(),u=l.getPaintValue("line-translate",r),h=l.getPaintValue("line-translate-anchor",r),d=l.getPaintValue("line-pattern",r),f=void 0!==d,p=1/e.pixelRatio,m=l.getPaintValue("line-blur",r),_=l.hasDataDrivenColor?j:l.getPaintValue("line-color",r),g=l.hasDataDrivenOpacity?1:l.getPaintValue("line-opacity",r),y=l.hasDataDrivenWidth?1:l.getPaintValue("line-width",r),b=g*_[3];this._color[0]=b*_[0],this._color[1]=b*_[1],this._color[2]=b*_[2],this._color[3]=b;const O=l.hasDataDrivenLine,w=o===x.c.HITTEST;let T;w&&(T=Object(v.c)(a+1));const C=(w?1:0)<<2|(O?1:0)<<1|(f?1:0),M=this._programOptions;M.id=w,M.dd=O,M.pattern=f;const I=c.getProgram(3,C,M);if(i.bindProgram(I),I.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),I.setUniformMatrix3fv("u_displayMat3",1===h?s.displayMat3:s.displayViewMat3),I.setUniform2fv("u_lineTranslation",u),I.setUniform1f("u_depth",l.z),I.setUniform1f("u_blur",m),I.setUniform1f("u_antialiasing",p),I.setUniform4fv("u_color",this._color),I.setUniform1f("u_width",y),w&&I.setUniform4fv("u_id",T),f){const t=e.spriteMosaic,r=t.getMosaicItemPosition(d,!0);r&&(t.bind(i,9729,r.page,n.I),I.setUniform2f("u_pattern_tl",r.tl[0],r.br[1]),I.setUniform2f("u_pattern_br",r.br[0],r.tl[1]),I.setUniform2f("u_spriteSize",8*r.size[0],r.size[1]),I.setUniform1i("u_texture",n.I))}else{let e=l.getPaintValue("line-dasharray",r);e.length<2&&(e=[1,-1]);const t=8;this._dashArray[0]=t*e[0],this._dashArray[1]=t*e[1],I.setUniform2fv("u_dasharray",this._dashArray)}for(const e of t){if(!e.layerData[a])continue;const t=e.layerData[a];t.prepareForRendering(i,c);const n=t.lineVertexArrayObject;Object(S.g)(n)||(i.bindVAO(n),I.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),i.setStencilFunction(514,e.stencilRef,255),i.drawElements(4,t.lineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart),e.triangleCount+=t.lineIndexCount/3)}}}var P=i(569),D=i(448);const L=[1,1,1,1];class z extends s.a{constructor(){super(...arguments),this._iconProgramOptions={id:!1,dd:!1,sdf:!1},this._sdfProgramOptions={id:!1,dd:!1},this._spritesTextureSize=Object(I.a)(),this._haloColor=Object(c.a)(),this._sdfColor=Object(c.a)(),this._color=Object(c.a)()}dispose(){}drawMany(e,t){const{drawPhase:i,styleLayerId:n}=e,r=e.styleLayer;let s;i===x.c.HITTEST&&(s=Object(v.c)(n+1)),this._drawIcons(e,r,t,s),this._drawText(e,r,t,s)}_drawIcons(e,t,i,r){const{context:s,displayLevel:o,drawPhase:a,painter:l,state:c,styleLayerId:u}=e;let h,d=!1;for(const e of i)if(e.layerData[u]&&(h=e.layerData[u],h.iconPerPageElementsMap.size>0)){d=!0;break}if(!d)return;const f=t.hasDataDrivenIconSize?1:t.getLayoutValue("icon-size",o),p=t.hasDataDrivenIconColor?L:t.getPaintValue("icon-color",o),m=t.hasDataDrivenIconOpacity?1:t.getPaintValue("icon-opacity",o),_=t.getPaintValue("icon-translate",o),g=t.getPaintValue("icon-translate-anchor",o),y=l.getVectorTileProgramCach(),v=p[3]*m;this._color[0]=v*p[0],this._color[1]=v*p[1],this._color[2]=v*p[2],this._color[3]=v;let b=t.getLayoutValue("icon-rotation-alignment",o);2===b&&(b=1===t.getLayoutValue("symbol-placement",o)?0:1);const O=h.isIconSDF,w=t.hasDataDrivenIcon,T=a===x.c.HITTEST,C=(T?1:0)<<2|(w?1:0)<<1|(O?1:0),M=this._iconProgramOptions;M.id=T,M.dd=w,M.sdf=O;const I=y.getProgram(4,C,M);if(s.bindProgram(I),O){const e=t.getPaintValue("icon-halo-color",o),i=t.getPaintValue("icon-halo-width",o);I.setUniform4f("u_outlineColor",e[0],e[1],e[2],e[3]),I.setUniform1f("u_outlineSize",i)}I.setUniformMatrix3fv("u_displayViewMat3",0===b?c.displayViewMat3:c.displayMat3),I.setUniformMatrix3fv("u_displayMat3",1===g?c.displayMat3:c.displayViewMat3),I.setUniform2fv("u_iconTranslation",_),I.setUniform1f("u_depth",t.z),I.setUniform1f("u_mapRotation",Object(D.b)(c.rotation)),I.setUniform1f("u_keepUpright",0),I.setUniform1f("u_level",10*o),I.setUniform1i("u_texture",n.I),I.setUniform1f("u_size",f),I.setUniform4fv("u_color",this._color),I.setUniform1f("u_opacity",1),I.setUniform1f("u_fadeDuration",P.d/1e3),T&&I.setUniform4fv("u_id",r);for(const t of i){if(!t.layerData[u])continue;if(h=t.layerData[u],0===h.iconPerPageElementsMap.size)continue;h.prepareForRendering(s,y),h.updateOpacityInfo();const i=h.iconVertexArrayObject;Object(S.g)(i)||(s.bindVAO(i),I.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),I.setUniform1f("u_time",(performance.now()-h.lastOpacityUpdate)/1e3),h.iconPerPageElementsMap.forEach((i,n)=>{this._renderIconRange(e,I,i,n,t)}))}}_renderIconRange(e,t,i,r,s){const{context:o,spriteMosaic:a}=e;this._spritesTextureSize[0]=a.getWidth(r)/4,this._spritesTextureSize[1]=a.getHeight(r)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),a.bind(o,9729,r,n.I),o.setStencilTestEnabled(!0),o.setStencilFunction(516,255,255),o.setStencilWriteMask(0),o.drawElements(4,i[1],5125,Uint32Array.BYTES_PER_ELEMENT*i[0]),s.triangleCount+=i[1]/3}_drawText(e,t,i,r){const{context:s,displayLevel:o,drawPhase:a,glyphMosaic:l,painter:c,pixelRatio:u,state:h,styleLayerId:d}=e;let f,p=!1;for(const e of i)if(e.layerData[d]&&(f=e.layerData[d],f.glyphPerPageElementsMap.size>0)){p=!0;break}if(!p)return;let m=t.getLayoutValue("text-rotation-alignment",o);2===m&&(m=1===t.getLayoutValue("symbol-placement",o)?0:1);const _=0===m,g=t.getLayoutValue("text-keep-upright",o)&&_,y=a===x.c.HITTEST,v=.8*3/u,b=t.hasDataDrivenTextSize?1:t.getLayoutValue("text-size",o),O=t.hasDataDrivenTextColor?L:t.getPaintValue("text-color",o),w=t.hasDataDrivenTextOpacity?1:t.getPaintValue("text-opacity",o),T=t.getPaintValue("text-halo-color",o),C=t.getPaintValue("text-halo-width",o),M=3*t.getPaintValue("text-halo-blur",o),j=3*C,E=c.getVectorTileProgramCach(),z=O[3]*w;this._sdfColor[0]=z*O[0],this._sdfColor[1]=z*O[1],this._sdfColor[2]=z*O[2],this._sdfColor[3]=z;const A=T[3]*w;this._haloColor[0]=A*T[0],this._haloColor[1]=A*T[1],this._haloColor[2]=A*T[2],this._haloColor[3]=A,this._glyphTextureSize||(this._glyphTextureSize=Object(I.b)(l.width/4,l.height/4));const V=t.getPaintValue("text-translate",o),R=t.getPaintValue("text-translate-anchor",o),F=t.hasDataDrivenText,N=(y?1:0)<<1|(F?1:0),k=this._sdfProgramOptions;k.id=y,k.dd=F;const U=E.getProgram(6,N,k);s.bindProgram(U),U.setUniformMatrix3fv("u_displayViewMat3",0===m?h.displayViewMat3:h.displayMat3),U.setUniformMatrix3fv("u_displayMat3",1===R?h.displayMat3:h.displayViewMat3),U.setUniform2fv("u_textTranslation",V),U.setUniform1f("u_depth",t.z+152587890625e-16),U.setUniform2fv("u_mosaicSize",this._glyphTextureSize),U.setUniform1f("u_mapRotation",Object(D.b)(h.rotation)),U.setUniform1f("u_keepUpright",g?1:0),U.setUniform1f("u_level",10*o),U.setUniform1i("u_texture",n.H),U.setUniform1f("u_size",b),U.setUniform1f("u_antialiasingWidth",v),U.setUniform1f("u_opacity",1),U.setUniform1f("u_fadeDuration",P.d/1e3),y&&U.setUniform4fv("u_id",r);for(const e of i){if(!e.layerData[d])continue;if(f=e.layerData[d],0===f.glyphPerPageElementsMap.size)continue;f.prepareForRendering(s,E),f.updateOpacityInfo();const t=f.textVertexArrayObject;if(Object(S.g)(t))continue;s.bindVAO(t),U.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),s.setStencilTestEnabled(!0),s.setStencilFunction(516,255,255),s.setStencilWriteMask(0);const i=(performance.now()-f.lastOpacityUpdate)/1e3;U.setUniform1f("u_time",i),f.glyphPerPageElementsMap.forEach((t,i)=>{this._renderGlyphRange(s,t,i,l,U,T[3],C,M,j,e)})}}_renderGlyphRange(e,t,i,r,s,o,a,l,c,u){r.bind(e,9729,i,n.H),o>0&&a>0&&(s.setUniform4fv("u_color",this._haloColor),s.setUniform1f("u_halo",1),s.setUniform1f("u_edgeDistance",c),s.setUniform1f("u_edgeBlur",l),e.drawElements(4,t[1],5125,Uint32Array.BYTES_PER_ELEMENT*t[0]),u.triangleCount+=t[1]/3),this._sdfColor[3]>0&&(s.setUniform4fv("u_color",this._sdfColor),s.setUniform1f("u_halo",0),s.setUniform1f("u_edgeDistance",0),s.setUniform1f("u_edgeBlur",0),e.drawElements(4,t[1],5125,Uint32Array.BYTES_PER_ELEMENT*t[0]),u.triangleCount+=t[1]/3)}}var A=i(126),V=i(399),R=class extends s.a{prepareState({context:e},t,i){const n=i&&-1!==i.indexOf("id");e.setBlendingEnabled(!n),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(514,t.stencilRef,255)}draw(e,t,i){if(t.commitChanges(e),!t.visible)return;const n=this.getGeometryType(),r=t.getDisplayList(),s=t.getGeometry(n);s&&r&&(e.timeline.begin(this.name),r.byType(n,n=>{this.drawGeometry(e,t,n,s,i)}),e.timeline.end(this.name))}_getVAO(e,t,i,n){return n.vao||(n.vao=new y.a(e,i,t,n.vertexBufferMap,n.indexBuffer)),n.vao}_setSharedUniforms(e,t,i){e.setUniform1f("u_pixelRatio",t.pixelRatio),e.setUniformMatrix3fv("u_dvsMat3",i.transforms.dvs),e.setUniformMatrix3fv("u_displayViewMat3",t.state.displayViewMat3),e.setUniformMatrix4fv("u_insideEffectMat4",t.rendererInfo.insideEffect),e.setUniformMatrix4fv("u_outsideEffectMat4",t.rendererInfo.outsideEffect),e.setUniform1fv("u_insideOpacities",t.rendererInfo.insideOpacities),e.setUniform1fv("u_outsideOpacities",t.rendererInfo.outsideOpacities),e.setUniform1i("u_attributeTextureSize",t.attributeView.size),e.setUniform1i("u_attributeData0",n.s),e.setUniform1i("u_attributeData1",n.t),e.setUniform1i("u_attributeData2",n.u),e.setUniform1i("u_attributeData3",n.v)}},F=i(601),N=class extends s.a{constructor(){super(...arguments),this._desc={lut:{vsPath:"raster/lut",fsPath:"raster/lut",attributes:{a_position:0,a_texcoord:1}},stretch:{vsPath:"raster/stretch",fsPath:"raster/stretch",attributes:{a_position:0,a_texcoord:1}},hillshade:{vsPath:"raster/hillshade",fsPath:"raster/hillshade",attributes:{a_position:0,a_texcoord:1}}},this._rendererUniformInfos=new Map}dispose(){this._quad&&this._quad.dispose()}prepareState({context:e},t){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(514,t.stencilRef,255)}draw(e,t){if(!t.source)return;if(t.suspended)return;e.timeline.begin(this.name),t.updateTexture(e);const i=this.getShaderVariations(t),n=e.painter.materialManager.getProgram(e,this._desc[t.symbolizerParameters.type],i);this.drawWithProgram(e.context,n,t),e.timeline.end(this.name)}drawWithProgram(e,t,i,n=1,s=[0,0],o=!1){this._quad||(this._quad=new r.a(e,[0,0,1,0,0,1,1,1]));const{symbolizerParameters:a,transformGrid:l,width:c,height:u,opacity:h}=i,d=a.type;e.bindProgram(t);const f=this.getShaderVariations(i),p=this.getUniformInfos(d,e,t,f),{names:m,textures:_}=i.getTextures();Object(F.j)(e,t,m,_);const g=Object(F.d)(n,s),y=Object(F.f)(l,[c,u],[i.source.width,i.source.height],h,o);if(Object(F.k)(t,p,{u_coordScale:i.coordScale,u_dvsMat3:i.transforms.dvs,...g,...y}),a.colormap){const{colormap:e,colormapOffset:i}=a,n=Object(F.e)(e,i);Object(F.k)(t,p,n)}if("stretch"===a.type){const e=Object(F.h)(a);Object(F.k)(t,p,e)}else if("hillshade"===a.type){const e=Object(F.g)(a);Object(F.k)(t,p,e)}this._quad.draw()}getUniformInfos(e,t,i,n){const r=n.length>0?e+"-"+n.join("-"):e;if(this._rendererUniformInfos.has(r))return this._rendererUniformInfos.get(r);const s=Object(F.i)(t,i);return this._rendererUniformInfos.set(r,s),s}getShaderVariations(e){const t=[];return"cubic"===e.interpolation&&t.push("bicubic"),e.symbolizerParameters.colormap&&t.push("applyColormap"),e.transformGrid&&t.push("applyProjection"),t}};const k={marker:class extends R{dispose(){}getGeometryType(){return x.d.MARKER}drawGeometry(e,t,i,n,r){const{context:s,painter:o,rendererInfo:a,state:l}=e,{indexCount:c,indexFrom:h,materialKey:d}=i,f=V.d.load(d),{bufferLayouts:p,attributes:m}=(e=>Object(u.f)(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texCoords",count:2,type:5123},{location:3,name:"a_bitSetAndDistRatio",count:4,type:5121},{location:4,name:"a_id",count:4,type:5121},{location:5,name:"a_color",count:4,type:5121,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}))(f),_=o.materialManager.getMaterialProgram(e,f,"materials/icon",m,r),g=this._getVAO(s,p,m,n);s.bindProgram(_),s.bindVAO(g),f.textureBinding&&o.textureManager.bindTextures(s,_,f),this._setSharedUniforms(_,e,t);const y=f.vvRotation?l.displayViewMat3:l.displayMat3;if(_.setUniformMatrix3fv("u_displayMat3",y),f.vvSizeMinMaxValue&&_.setUniform4fv("u_vvSizeMinMaxValue",a.vvSizeMinMaxValue),f.vvSizeScaleStops&&_.setUniform1f("u_vvSizeScaleStopsValue",a.vvSizeScaleStopsValue),f.vvSizeFieldStops){const e=a.getSizeVVFieldStops(t.key.level);_.setUniform1fv("u_vvSizeFieldStopsValues",e.values),_.setUniform1fv("u_vvSizeFieldStopsSizes",e.sizes)}f.vvSizeUnitValue&&_.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",a.vvSizeUnitValueToPixelsRatio),f.vvColor&&(_.setUniform1fv("u_vvColorValues",a.vvColorValues),_.setUniform4fv("u_vvColors",a.vvColors)),f.vvOpacity&&(_.setUniform1fv("u_vvOpacityValues",a.vvOpacityValues),_.setUniform1fv("u_vvOpacities",a.vvOpacities)),f.vvRotation&&_.setUniform1f("u_vvRotationType","geographic"===a.vvMaterialParameters.vvRotationType?0:1),s.drawElements(4,c,5125,Uint32Array.BYTES_PER_ELEMENT*h),s.bindVAO(null)}},line:class extends R{dispose(){}getGeometryType(){return x.d.LINE}drawGeometry(e,t,i,n,r){const{context:s,painter:o,rendererInfo:a,requiredLevel:l}=e,{indexFrom:c,indexCount:h,materialKey:d}=i,f=V.c.load(d),{bufferLayouts:p,attributes:m}=(e=>Object(u.f)(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}))(f),_=o.materialManager.getMaterialProgram(e,f,"materials/line",m,r),g=this._getVAO(s,p,m,n),y=1/e.pixelRatio;s.bindProgram(_),s.bindVAO(g),this._setSharedUniforms(_,e,t),f.textureBinding&&o.textureManager.bindTextures(s,_,f);const v=Math.pow(2,l-t.key.level)/e.pixelRatio;if(_.setUniform1f("u_zoomFactor",v),_.setUniform1f("u_blur",0+y),_.setUniform1f("u_antialiasing",y),f.vvSizeMinMaxValue&&_.setUniform4fv("u_vvSizeMinMaxValue",a.vvSizeMinMaxValue),f.vvSizeScaleStops&&_.setUniform1f("u_vvSizeScaleStopsValue",a.vvSizeScaleStopsValue),f.vvSizeFieldStops){const e=a.getSizeVVFieldStops(t.key.level);_.setUniform1fv("u_vvSizeFieldStopsValues",e.values),_.setUniform1fv("u_vvSizeFieldStopsSizes",e.sizes)}f.vvSizeUnitValue&&_.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",a.vvSizeUnitValueToPixelsRatio),f.vvColor&&(_.setUniform1fv("u_vvColorValues",a.vvColorValues),_.setUniform4fv("u_vvColors",a.vvColors)),f.vvOpacity&&(_.setUniform1fv("u_vvOpacityValues",a.vvOpacityValues),_.setUniform1fv("u_vvOpacities",a.vvOpacities)),s.setFaceCullingEnabled(!0),s.setFrontFace(2305),s.setCullFace(1029),s.drawElements(4,h,5125,Uint32Array.BYTES_PER_ELEMENT*c),s.setFaceCullingEnabled(!1),s.bindVAO(null)}},fill:class extends R{constructor(){super(...arguments),this._dotTextureSize=0,this._dotTextures=null,this._dotSamplers=new Int32Array([n.A,n.B])}dispose(){this._disposeTextures()}getGeometryType(){return x.d.FILL}drawGeometry(e,t,i,r,s){const{context:o,painter:a,rendererInfo:l,requiredLevel:c}=e,{indexCount:h,indexFrom:d,materialKey:f}=i,p=V.a.load(f),{bufferLayouts:m,attributes:_}=(e=>Object(u.f)(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},...e.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],...e.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[]]}))(p),g=a.materialManager.getMaterialProgram(e,p,"materials/fill",_,s),y=this._getVAO(o,m,_,r);if(o.bindProgram(g),o.bindVAO(y),this._setSharedUniforms(g,e,t),p.textureBinding){a.textureManager.bindTextures(o,g,p);const i=1/Math.pow(2,c-t.key.level)/e.pixelRatio;g.setUniform1f("u_zoomFactor",i)}if(p.vvColor&&(g.setUniform1fv("u_vvColorValues",l.vvColorValues),g.setUniform4fv("u_vvColors",l.vvColors)),p.vvOpacity&&(g.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),g.setUniform1fv("u_vvOpacities",l.vvOpacities)),p.dotDensity){const i=n.F/l.ddDotSize,r=i*window.devicePixelRatio*i*window.devicePixelRatio,s=1/Math.pow(2,c-t.key.level),a=1/s*(1/s),u=l.ddDotScale?e.state.scale/l.ddDotScale:1;g.setUniform1f("u_tileZoomFactor",s),g.setUniform1f("u_tileDotsOverArea",r/(n.F*window.devicePixelRatio*n.F*window.devicePixelRatio)),g.setUniformMatrix4fv("u_dotColors",l.ddColors),g.setUniform4fv("u_isActive",l.ddActiveDots),g.setUniform4fv("u_dotBackgroundColor",l.ddBackgroundColor),g.setUniform1f("u_dotValue",Math.max(1,l.ddDotValue*u*a)),this._bindDotDensityTextures(o,g,l,i)}o.drawElements(4,h,5125,Uint32Array.BYTES_PER_ELEMENT*d),o.bindVAO(null)}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_bindDotDensityTextures(e,t,i,n){const r=this._createDotDensityTextures(e,n,i.ddSeed);t.setUniform1iv("u_dotTextures",this._dotSamplers);for(let t=0;t<r.length;t++)e.bindTexture(r[t],this._dotSamplers[t])}_createDotDensityTextures(e,t,i){if(this._dotTextureSize===t&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=t,this._seed=i),null===this._dotTextures){const n=new A.a(i);this._dotTextures=[this._allocDotDensityTexture(e,t,n),this._allocDotDensityTexture(e,t,n)]}return this._dotTextures}_allocDotDensityTexture(e,t,i){const n=new Float32Array(t*t*4);for(let e=0;e<n.length;e++)n[e]=i.getFloat();return new g.a(e,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:t,height:t},n)}},text:class extends R{dispose(){}getGeometryType(){return x.d.TEXT}drawGeometry(e,t,i,n,r){const{context:s,painter:o,rendererInfo:a,state:l}=e,{indexCount:c,indexFrom:h,materialKey:d}=i,f=V.f.load(d),{bufferLayouts:p,attributes:m}=(e=>Object(u.f)(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_haloColor",count:4,type:5121,normalized:!0},{location:4,name:"a_texFontSize",count:4,type:5121},{location:5,name:"a_aux",count:4,type:5120},{location:6,name:"a_vertexOffset",count:2,type:5122},{location:7,name:"a_texCoords",count:2,type:5123}]}))(f),_=o.materialManager.getMaterialProgram(e,f,"materials/text",m,r),g=this._getVAO(s,p,m,n);if(s.bindProgram(_),s.bindVAO(g),this._setSharedUniforms(_,e,t),o.textureManager.bindTextures(s,_,f),_.setUniformMatrix3fv("u_displayMat3",l.displayMat3),_.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3),f.vvSizeMinMaxValue&&_.setUniform4fv("u_vvSizeMinMaxValue",a.vvSizeMinMaxValue),f.vvSizeScaleStops&&_.setUniform1f("u_vvSizeScaleStopsValue",a.vvSizeScaleStopsValue),f.vvSizeFieldStops){const e=a.getSizeVVFieldStops(t.key.level);_.setUniform1fv("u_vvSizeFieldStopsValues",e.values),_.setUniform1fv("u_vvSizeFieldStopsSizes",e.sizes)}f.vvSizeUnitValue&&_.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",a.vvSizeUnitValueToPixelsRatio),f.vvColor&&(_.setUniform1fv("u_vvColorValues",a.vvColorValues),_.setUniform4fv("u_vvColors",a.vvColors)),f.vvOpacity&&(_.setUniform1fv("u_vvOpacityValues",a.vvOpacityValues),_.setUniform1fv("u_vvOpacities",a.vvOpacities)),f.vvRotation&&_.setUniform1f("u_vvRotationType","geographic"===a.vvMaterialParameters.vvRotationType?0:1),_.setUniform1f("u_isHalo",1),s.drawElements(4,c,5125,Uint32Array.BYTES_PER_ELEMENT*h),_.setUniform1f("u_isHalo",0),s.drawElements(4,c,5125,Uint32Array.BYTES_PER_ELEMENT*h),s.bindVAO(null)}},label:class extends R{dispose(){}getGeometryType(){return x.d.LABEL}drawGeometry(e,t,i,n,r){const{context:s,painter:o,state:a,rendererInfo:l}=e,{indexCount:c,indexFrom:h,materialKey:d}=i,f=V.b.load(d),p=f.mapAligned?1:0;if(!p&&Math.abs(t.key.level-Math.round(100*e.displayLevel)/100)>=1)return;const{bufferLayouts:m,attributes:_}=(e=>Object(u.f)(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_haloColor",count:4,type:5121,normalized:!0},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_glyphData",count:4,type:5121},{location:7,name:"a_vertexOffset",count:2,type:5122},{location:8,name:"a_texCoords",count:2,type:5123}]}))(f),g=o.materialManager.getMaterialProgram(e,f,"materials/label",_,r),y=this._getVAO(s,m,_,n);e.context.setStencilFunction(514,0,255),s.bindProgram(g),s.bindVAO(y),this._setSharedUniforms(g,e,t),o.textureManager.bindTextures(s,g,f);const v=1===p?a.displayViewMat3:a.displayMat3;if(f.vvSizeMinMaxValue&&g.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue),f.vvSizeScaleStops&&g.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue),f.vvSizeFieldStops){const e=l.getSizeVVFieldStops(t.key.level);g.setUniform1fv("u_vvSizeFieldStopsValues",e.values),g.setUniform1fv("u_vvSizeFieldStopsSizes",e.sizes)}f.vvSizeUnitValue&&g.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio),g.setUniform1f("u_mapRotation",Math.floor(a.rotation/360*254)),g.setUniform1f("u_mapAligned",p),g.setUniformMatrix3fv("u_displayMat3",v),g.setUniform1f("u_opacity",1),g.setUniform1f("u_zoomLevel",Math.round(10*e.displayLevel)),g.setUniform2fv("u_screenSize",e.state.size),g.setUniform1f("u_isHalo",1),s.drawElements(4,c,5125,Uint32Array.BYTES_PER_ELEMENT*h),g.setUniform1f("u_isHalo",0),s.drawElements(4,c,5125,Uint32Array.BYTES_PER_ELEMENT*h),s.bindVAO(null),s.setStencilTestEnabled(!0),s.setBlendingEnabled(!0)}},clip:d,stencil:p.a,bitmap:a,raster:N,tileInfo:f.a,vtlBackground:O,vtlFill:M,vtlLine:E,vtlCircle:T,vtlSymbol:z}},550:function(e,t,i){"use strict";i(404);var n=i(405),r=(i(406),i(407));i(408),i(409),i(411);t.a=class{constructor(e,t){this.rctx=e,this._vertexBuffer=n.a.createVertex(e,35044,new Uint16Array(t)),this._vao=new r.a(e,{a_position:0},{geometry:[{name:"a_position",count:2,type:5122,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}bind(){this._vao.bind()}unbind(){this._vao.unbind()}dispose(){this._vao.dispose(!1),this._vertexBuffer.dispose()}draw(){this.rctx.bindVAO(this._vao),this.rctx.drawArrays(5,0,4)}}},551:function(e,t,i){"use strict";function n(e){switch(e){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}i.d(t,"a",(function(){return n}))},553:function(e,t,i){"use strict";i.d(t,"a",(function(){return G}));var n=i(4),r=i(8),s=i(7),o=i(396),a=i(397),l=i(497),c=i(398),u=i(443),h=i(490);class d{constructor(e,t){this.data=e,this.stride=t}get vertexCount(){const e=this.stride/4,t=this.data.length/e;return t!==(0|t)&&console.debug("Corrupted stride"),t}transfer(e,t){const i=this.data.buffer();e.vertexCount=this.vertexCount,e.data=i,e.stride=this.stride,t.push(i)}}class f{constructor(e,t,i=!1){this.geometryType=e,this.indexVector=new u.a(Uint32Array,6*t),this.namedVectors={};const n=Object(c.k)(e,i);for(const e in n){const i=n[e];let r;switch(i%4){case 0:case 2:r=new u.a(Uint32Array,i*t);break;case 1:case 3:r=new u.a(Uint8Array,i*t)}this.namedVectors[e]=new d(r,i)}}get(e){return this.namedVectors[e].data}getVector(e){return this.namedVectors[e]}transfer(e,t){const i=this.indexVector.buffer(),n={};t.push(i);for(const e in this.namedVectors){const i=this.namedVectors[e];n[e]={},i.transfer(n[e],t)}e.geometryType=this.geometryType,e.indexBuffer=i,e.namedBuffers=n,this.destroy()}intoBuffers(){const e=h.a.fromVertexVectors(this);return this.destroy(),e}destroy(){this.indexVector=null,this.namedVectors=null}}var p=i(5),m=i(14),_=i(69),g=i(23),y=i(420),v=i(402),x=i(551),b=i(399),O=i(410),S=i(439),w=i(415);function T(e){return e.length-1}function C(e){let t=0;for(let i=0;i<T(e);i++)t+=M(e,i);return t}function M(e,t,i=1){const[n,r]=function(e,t){return e[t+1]}(e,t);return Math.sqrt(n*n+r*r)*i}class I{constructor(e,t,i,n,r){this._segments=e,this._index=t,this._distance=i,this._xStart=n,this._yStart=r,this._done=!1}static create(e){return new I(e,0,0,e[0][0],e[0][1])}clone(){return new I(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length);let i=Math.acos(t);return e>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<T(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const i=this.backwardLength;if(e<=i)return this._distance=(i-e)/this.length,this;let n=this.backwardLength;for(;this.prev();){if(n+this.length>e)return this._seekBackwards(e-n);n+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>e)return this.seek(e-i,t);i+=this.length}return this._distance=1,t?this:null}}function j(e,t,i){const n=C(e),r=I.create(e),s=n/2,o=(n-t)/2,a=Math.floor(o/t),l=s-a*t;r.seek(l);for(let e=-a;e<=a;e++)r.x<512&&r.x>=0&&r.y<512&&r.y>=0&&i(r.clone(),e,s+e*t,n),r.seek(t)}function E(e,t){const i=1e-6;if(t<=0)return;const n=e.length;if(n<3)return;const r=[];let s=0;r.push(0);for(let t=1;t<n;t++)s+=Object(w.a)(e[t],e[t-1]),r.push(s);t=Math.min(t,.2*s);const o=[];o.push(e[0][0]),o.push(e[0][1]);const a=e[n-1][0],l=e[n-1][1],c=Object(w.e)([0,0],e[0],e[1]);Object(w.d)(c),e[0][0]+=t*c[0],e[0][1]+=t*c[1],Object(w.e)(c,e[n-1],e[n-2]),Object(w.d)(c),e[n-1][0]+=t*c[0],e[n-1][1]+=t*c[1];for(let e=1;e<n;e++)r[e]+=t;r[n-1]+=t;const u=.5*t;for(let s=1;s<n-1;s++){let a=0,l=0,c=0;for(let n=s-1;n>=0&&!(r[n+1]<r[s]-u);n--){const o=u+r[n+1]-r[s],h=r[n+1]-r[n],d=r[s]-r[n]<u?1:o/h;if(Math.abs(d)<i)break;const f=d*d,p=d*o-.5*f*h,m=d*h/t,_=e[n+1],g=e[n][0]-_[0],y=e[n][1]-_[1];a+=m/p*(_[0]*d*o+.5*f*(o*g-h*_[0])-f*d*h*g/3),l+=m/p*(_[1]*d*o+.5*f*(o*y-h*_[1])-f*d*h*y/3),c+=m}for(let o=s+1;o<n&&!(r[o-1]>r[s]+u);o++){const n=u-r[o-1]+r[s],h=r[o]-r[o-1],d=r[o]-r[s]<u?1:n/h;if(Math.abs(d)<i)break;const f=d*d,p=d*n-.5*f*h,m=d*h/t,_=e[o-1],g=e[o][0]-_[0],y=e[o][1]-_[1];a+=m/p*(_[0]*d*n+.5*f*(n*g-h*_[0])-f*d*h*g/3),l+=m/p*(_[1]*d*n+.5*f*(n*y-h*_[1])-f*d*h*y/3),c+=m}o.push(a/c),o.push(l/c)}o.push(a),o.push(l);for(let t=0,i=0;t<n;t++)e[t][0]=o[i++],e[t][1]=o[i++]}var P=i(505);const D=p.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),L=function(e){const t=new Map;return e=>(t.has(e)||t.set(e,(e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})(e)),t.get(e))}(),z=e=>Math.floor(127*e+127),A=e=>Math.floor(10*e),V=e=>Math.round(e*(254/360)),R=(e,t)=>Object(v.a)(Math.round(8*e),Math.round(8*t));class F extends P.a{constructor(e,t,i,n){super(e,i.font.size,i.haloSize||0,i.color&&Object(O.d)(i.color)||0,i.haloColor&&Object(O.d)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,Object(x.a)(t.labelPlacement)?1:0,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this.geometryType=a.d.LABEL;const r=function(e,t){const i=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return Object(_.c)(i,0,25.5)}(t,n),s=function(e,t){const i=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return Object(_.c)(i,0,25.5)}(t,n),l=t.labelPlacement,[c,u]=Object(y.b)(l);this._xAlignD=c,this._yAlignD=u,this._minZoom=r,this._maxZoom=s,this._refPlacementPadding=Object(g.h)(i.haloSize)+o.D;const h=b.b.load(e);h.sdf=!0,this._materialKey=h.data}static fromLabelClass(e,t){if("center-along"===e.labelPlacement){const t=e.symbol;t.xoffset=0,t.yoffset=0,t.angle=0,t.font.decoration="none"}return new F(e.materialKey,e,e.symbol,t)}get _shapedBox(){return Object(r.m)(this._shapingInfo).bounds}bindReferenceTemplate(e){let t=Object(y.e)(this._xAlignD),i=Object(y.g)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(r.g)(e))return void(this._refSymbolAndPlacementOffset=Object(v.b)(0,0,z(t),z(i)));if("circle"===e.boundsType&&(t||i)){const e=Math.sqrt(t*t+i*i);t/=e,i/=e}const n=Math.max(e.height,e.width),s=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(v.b)(s,n,z(t),z(i)),this._referenceSize=n,this._refPlacementDirX=t,this._refPlacementDirY=i,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}writeMesh(e,t,i,n,s,o){if(Object(r.g)(this._shapingInfo))return;const a=new Array,l=this._shapingInfo,c="esriGeometryPolygon"===i.geometryType?i.readLegacyCentroid():i.readLegacyGeometry();if(c){switch(this.current={out:e,outVecs:t,outMetrics:a,inId:s,inShaping:l,zoomLevel:o},n){case"esriGeometryPolyline":this._placeLineLabels(c);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(c);break;default:((e,t="mapview-labeling")=>{D.error(new m.a(t,e))})("mapview-labeling",`Geometry of type ${n} is not supported`)}e.writeMetrics(this.current.outMetrics)}}_isVisible(e,t){const i=A(this.current.zoomLevel);return A(e)<=i&&i<=A(t)}_placePointLabels(e){const{out:t,outVecs:i,outMetrics:n,inId:r}=this.current;this._writeGlyphs(t,i,r,e,n)}_placeLineLabels(e){const t=function(e,t){const i=t;for(let t=0;t<e.length;t++){let n=e[t];const r=[];r.push(n[0]);for(let e=1;e<n.length;e++){let[t,i]=r[e-1];t+=n[e][0],i+=n[e][1],r.push([t,i])}E(r,i);const s=[];s.push(r[0]);for(let e=1;e<r.length;e++){const[t,i]=r[e-1],[n,o]=r[e],a=Math.round(n-t),l=Math.round(o-i);s.push([a,l])}e[t]=s,n=s}return e}(e.paths,this.current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),n=(this._shapedBox.width+128)/4;for(const e of t)j(e,n,i)}_placeSubdivGlyphs(e,t,i,n){const r=L(t),s=this._shapedBox.width/4,o=Math.min(i,n-i),a=Object(_.h)(o/(4+s/2)),l=0===t?a:Math.min(r,a),c=Math.max(this._minZoom,this.current.zoomLevel+2-l),u=this.current.zoomLevel-c,h=this._shapedBox.width/2*Math.pow(2,u);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,c):this._placeCurved(e,c,h)}_placeStraight(e,t){const{out:i,outVecs:n,outMetrics:r,inId:s}=this.current;this._writeGlyphs(i,n,s,e,r,t)}_placeCurved(e,t,i){const n={from:this.current.out.currentDisplayRecordCount(),count:-1},r=new S.a(this.current.inId,n,e.x,e.y,t),s=e.clone(),o=e.angle*(180/Math.PI)%360,a=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=V(o),this._placeFirst(s,r,t,1),this._placeBack(e,s,r,t,i,1),this._placeForward(e,s,r,t,i,1),this._outLineLabelAngle=V(a),this._placeFirst(s,r,t,0),this._placeBack(e,s,r,t,i,0),this._placeForward(e,s,r,t,i,0),r.range.count=this.current.out.currentDisplayRecordCount()-r.range.from,r.bounds&&this.current.outMetrics.push(r)}_placeBack(e,t,i,n,r,s){const o=e.clone();let a=e.backwardLength+0;for(;o.prev()&&!(a>=r);)this._placeOnSegment(o,t,i,a,n,-1,s),a+=o.length+0}_placeForward(e,t,i,n,r,s){const o=e.clone();let a=e.remainingLength+0;for(;o.next()&&!(a>=r);)this._placeOnSegment(o,t,i,a,n,1,s),a+=o.length+0}_placeFirst(e,t,i,n){const r=e,s=this.current.inShaping,o=s.glyphs,a=this.current.zoomLevel,{out:l,outVecs:c,inId:u}=this.current,h=R(r.x,r.y);for(const r of o){const o=r.x>s.bounds.x?n:1-n,d=o*e.remainingLength+(1-o)*e.backwardLength,f=Math.abs(r.x+r.width/2-s.bounds.x),p=Math.max(0,a+Object(_.h)(f/(d+0))),m=Math.max(i,p);r.maxZoom=25,r.angle=e.angle+(1-n)*Math.PI,r.minZoom=m,this._writeGlyph(l,c,r,u,h),n&&this._isVisible(r.minZoom,r.maxZoom)&&t.add(r.bounds,0,0)}}_placeOnSegment(e,t,i,n,r,s,o){const a=this.current.inShaping.glyphs,{out:l,outVecs:c,inId:u}=this.current,h=this.current.inShaping,d=this.current.zoomLevel,f=e.dx/e.length,p=e.dy/e.length,m={x:e.x+n*-s*f,y:e.y+n*-s*p},g=R(m.x,m.y);for(const f of a){const a=f.x>h.bounds.x?o:1-o;if(!(a&&1===s||!a&&-1===s))continue;const p=Math.abs(f.x+f.width/2-h.bounds.x),m=Math.max(0,d+Object(_.h)(p/n)-.1),y=Math.max(r,d+Object(_.h)(p/(n+e.length+0)));0!==m&&(f.angle=e.angle+(1-o)*Math.PI,f.minZoom=y,f.maxZoom=m,this._writeGlyph(l,c,f,u,g),o&&this._isVisible(f.minZoom,f.maxZoom)&&i.add(f.bounds,e.x-t.x,e.y-t.y))}}_writeGlyphs(e,t,i,n,s,o=this._minZoom){const a=this._shapingInfo;if(Object(r.g)(a))return;if(n.x<0||n.x>=512||n.y<0||n.y>=512)return;const l=e.currentDisplayRecordCount(),c=R(n.x+this._refOffsetX,n.y-this._refOffsetY),u=new S.a(i,{from:l,count:-1},n.x+this._refOffsetX,n.y-this._refOffsetY,o);for(const n of a.glyphs)n.minZoom=o,n.maxZoom=this._maxZoom,this._writeGlyph(e,t,n,i,c);u.range.count=e.currentDisplayRecordCount()-u.range.from,u.bounds=a.boundsT;const h=b.b.load(this._materialKey),d=this._refPlacementDirX,f=this._refPlacementDirY,p=h.vvSizeFieldStops||h.vvSizeMinMaxValue||h.vvSizeScaleStops||h.vvSizeUnitValue;u.setPlacementOffset(p,this._referenceSize,this._refPlacementPadding,d,f),s.push(u)}_writeGlyph(e,t,i,n,r){const s=b.e.load(this._materialKey);s.textureBinding=i.textureBinding;const o=t.indexVector.length,a=t.getVector("geometry").vertexCount,l=this._writeIndices(t),c=this._writeVertex(t,n,r,i);e.writeDisplayRecord(this.geometryType,s.data,a,c,o,l)}_writeVertexCommon(e,t,i,n){const r=this._color,s=this._haloColor,o=Object(v.b)(0,0,this._size,this._haloSize),a=Math.max(n.minZoom,this._minZoom),l=Math.min(n.maxZoom,this._maxZoom),c=Object(v.b)(A(a),A(l),this._outLineLabelAngle,0);e.push(i),e.push(t),e.push(r),e.push(s),e.push(o),e.push(this._refSymbolAndPlacementOffset),e.push(c)}}var N=F,k=i(508),U=i(512);class G{constructor(e,t,i){this._isDD=!1,this._geometryType=e,this._idField=t,this._templateStore=i}update(e,t){this._isDD="simple"===e.mesh.matcher.type&&e.mesh.matcher.isDotDensity,Object(r.h)(e.mesh.labels)&&this._setLabelTemplates(e.mesh.labels,t)}_setLabelTemplates(e,t){this._labelTemplates=e.map(e=>N.fromLabelClass(e,t))}get templates(){return this._templateStore}createMeshData(e){const t=new Array(5),i=this._labelTemplates&&this._labelTemplates.length>0,n="esriGeometryPolyline"===this._geometryType?o.k:o.j;return t[a.d.MARKER]=new f(a.d.MARKER,4*e),t[a.d.FILL]=new f(a.d.FILL,e,this._isDD),t[a.d.LINE]=new f(a.d.LINE,e),t[a.d.TEXT]=new f(a.d.TEXT,4*e),t[a.d.LABEL]=new f(a.d.LABEL,i?4*n:0),new l.a(t,{features:e,records:e,metrics:0})}async analyze(e,t,i,n,r){if(Object(s.e)(r))return;let o;"dictionary"===t.type&&(o=await t.analyze(this._idField,e.copy(),i,n,r));let a=0;for(;e.next();){let r;if(r=o?o[a++]:t.match(this._idField,e,this._geometryType,i,n),e.setGroupId(r),Object(U.b)(r)){const t=this._templateStore.getDynamicTemplateGroup(r);for(const r of t)r&&r.analyze&&r.analyze(this._templateStore,e,i,n)}}return this._templateStore.finalize(r)}async analyzeGraphics(e,t,i,n,r){if(Object(s.e)(r))return;const o=e.getCursor();for(t&&await t.analyze(this._idField,o.copy(),i,n,r);o.next();){let e=o.getGroupId();if(null!=e&&-1!==e||(e=t.match(this._idField,o,o.geometryType,i,n),o.setGroupId(e)),Object(U.b)(e)){const t=this._templateStore.getDynamicTemplateGroup(e);for(const e of t)e&&e.analyze&&e.analyze(this._templateStore,o,i,n)}o.setGroupId(e)}return this._templateStore.finalize(r)}writeGraphic(e,t){const i=t.getGroupId(),r=t.getDisplayId(),s=this._templateStore.getTemplateGroup(i),o=t.geometryType;if(null!=r){if(Object(U.b)(i))for(const e of s)e.bindFeature(t,null,null);if(s){e.writeDisplayObject(r,t.readGraphic().insertAfter);for(const i of s){if(!i)continue;const n=e.get(i.geometryType);i.writeMesh(e,n,t,o,r)}}}else Object(n.a)("esri-2d-debug")&&console.debug("Got null id for feature")}writeCursor(e,t,i,s,o,a){const l=t.getGroupId(),c=t.getDisplayId(),u=this._templateStore.getTemplateGroup(l);if(null==c)return void(Object(n.a)("esri-2d-debug")&&console.debug("Got null id for feature"));if(!u)return;if(e.writeDisplayObject(c,0),Object(U.b)(l))for(const e of u)e.bindFeature(t,i,s);for(const i of u){const n=e.get(i.geometryType);!i.needsPixelBuffer&&t.hasFilter()||i.writeMesh(e,n,t,this._geometryType,c)}const h=e.hasDisplayRecords();if(Object(r.h)(a)&&h){const i=a&&this._findLabelRef(u);this._writeLabels(e,t,c,a,i,o)}e.endDisplayObject()}_findLabelRef(e){for(const t of e)if(t instanceof k.a)return t;return null}_writeLabels(e,t,i,n,s,o){for(const a of n)if(Object(r.h)(a)&&a){const{glyphs:n,rtl:r,index:l}=a,c=this._labelTemplates[l],u=e.get(c.geometryType);c.bindReferenceTemplate(s),c.bindTextInfo(n,r),c.writeMesh(e,u,t,this._geometryType,i,o)}}}},554:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));class n{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}class r{constructor(e,t){this._mask=0,this._buf=e,this._mask=t}static fromBuffer(e,t){return new r(e,t)}static create(e,t=4294967295){const i=new Uint32Array(Math.ceil(e/32));return new r(i,t)}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}set(e){const t=this._mask&e,i=this._getIndex(t),n=1<<t%32;this._buf[i]|=n}unset(e){const t=this._mask&e,i=this._getIndex(t),n=1<<t%32;this._buf[i]&=4294967295^n}resize(e){const t=this._buf,i=new Uint32Array(Math.ceil(e/32));i.set(t),this._buf=i}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new r(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(let t=0;t<this._buf.length;t++){let i=this._buf[t],n=32*t;if(i)for(;i;)1&i&&e(n),i>>>=1,n++}}countSet(){let e=0;return this.forEachSet(t=>{e++}),e}}function s(e,t,i){if(!(e.length>t))for(;e.length<=t;)e.push(i)}class o{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new n,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const e=this._bitsets.length;return this._bitsets.push(r.create(this._allocatedSize,2147483647)),e+1}getBitset(e){return this._bitsets[e-1]}_expand(){this._allocatedSize<<=1;for(const e of this._bitsets)e.resize(this._allocatedSize)}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),s(this._numerics[e],t,0)}_ensureInstanceId(e){s(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),s(this._strings[e],t,null)}createDisplayId(e=!1){const t=this._idGenerator.createId();return t>this._allocatedSize&&this._expand(),((e,t)=>((t?2147483648:0)|e)>>>0)(t,e)}releaseDisplayId(e){for(const t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(2147483647&e)}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(2147483647&e,0)}setComputedNumeric(e,t,i){return this.setComputedNumericAtIndex(2147483647&e,i,0)}getComputedString(e,t){return this.getComputedStringAtIndex(2147483647&e,0)}setComputedString(e,t,i){return this.setComputedStringAtIndex(2147483647&e,0,i)}getComputedNumericAtIndex(e,t){const i=2147483647&e;return this._ensureNumeric(t,i),this._numerics[t][i]}setComputedNumericAtIndex(e,t,i){const n=2147483647&e;this._ensureNumeric(t,n),this._numerics[t][n]=i}getInstanceId(e){const t=2147483647&e;return this._ensureInstanceId(t),this._instanceIds[t]}setInstanceId(e,t){const i=2147483647&e;this._ensureInstanceId(i),this._instanceIds[i]=t}getComputedStringAtIndex(e,t){const i=2147483647&e;return this._ensureString(t,i),this._strings[t][i]}setComputedStringAtIndex(e,t,i){const n=2147483647&e;this._ensureString(t,n),this._strings[t][n]=i}getXMin(e){return this._bounds[4*(2147483647&e)]}getYMin(e){return this._bounds[4*(2147483647&e)+1]}getXMax(e){return this._bounds[4*(2147483647&e)+2]}getYMax(e){return this._bounds[4*(2147483647&e)+3]}setBounds(e,t){const i=t.readHydratedGeometry();if(!i||!i.coords.length)return!1;let n=1/0,r=1/0,o=-1/0,a=-1/0;i.forEachVertex((e,t)=>{n=Math.min(n,e),r=Math.min(r,t),o=Math.max(o,e),a=Math.max(a,t)});const l=2147483647&e;return s(this._bounds,4*l+4,0),this._bounds[4*l]=n,this._bounds[4*l+1]=r,this._bounds[4*l+2]=o,this._bounds[4*l+3]=a,!0}}},555:function(e,t,i){"use strict";i.d(t,"a",(function(){return z}));var n=i(7),r=i(259),s=i(224),o=i(517),a=i(513),l=i(4),c=i(8),u=i(5),h=i(14),d=i(396),f=(i(404),i(405),i(406)),p=(i(407),i(408),i(409)),m=(i(411),i(398)),_=i(494);const g=u.a.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),y=Object(_.b)(_.a,g),v=e=>2147483647&e;let x=!1;class b{constructor(e,t,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:n,pixelType:r,textureOnly:s}=e,o=Object(m.i)(r);this.shared=i,this.pixelType=r,this.size=t,this.textureOnly=s,s||(this.data=new o(Object(c.m)(n))),this._resetRange()}destroy(){Object(c.a)(this._texture,e=>e.dispose());for(const e in this._fbos)Object(c.a)(this._fbos[e],t=>{"0"===e&&t.detachColorTexture(),t.dispose()}),this._fbos[e]=null;this._texture=null}get _textureDesc(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}setData(e,t,i){const n=v(e),r=Object(c.m)(this.data),s=n*this.texelSize+t;!r||s>=r.length?Object(l.a)("esri-2d-debug")&&!x&&(g.error(new h.a("mapview-attributeStore","Attempted to set out of bounds index")),x=!0):(r[s]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n))}getData(e,t){if(Object(c.g)(this.data))return null;const i=v(e)*this.texelSize+t;return!this.data||i>=this.data.length?(Object(l.a)("esri-2d-debug")&&!x&&(g.error(new h.a("mapview-attributeStore","Attempted to read out of bounds index")),x=!0),null):this.data[i]}getTexture(e){return Object(c.n)(this._texture,()=>this._initTexture(e))}getFBO(e,t=0){if(Object(c.g)(this._fbos[t])){const i={colorTarget:0,depthStencilTarget:0},n=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new p.a(e,i,n)}return this._fbos[t]}get locked(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(l.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}updateTexture(e){if(!this.locked)try{const t=this.dirtyStart,i=this.dirtyEnd;if(t>i)return;this._resetRange();const n=Object(c.m)(this.data).buffer,r=this.getTexture(e),s=4,o=(t-t%this.size)/this.size,a=(i-i%this.size)/this.size,l=o,u=this.size,d=a,f=o*this.size*s,p=(u+d*this.size)*s-f,_=Object(m.i)(this.pixelType),y=_.BYTES_PER_ELEMENT;try{new _(n,f*y,p)}catch(e){console.debug(e)}const v=new _(n,f*y,p),x=this.size,b=d-l+1;if(b>this.size)return void g.error(new h.a("mapview-webgl","Out-of-bounds index when updating AttributeData"));r.updateData(0,0,l,x,b,v)}catch(e){console.debug(e)}}update(e){const{data:t,start:i,end:n}=e;if(Object(c.h)(t)){const n=this.data,r=i*this.texelSize;for(let i=0;i<t.length;i++){const s=1<<i%this.texelSize;e.layout&s&&(n[r+i]=t[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,n)}resize(e,t){const i=this.size;if(this.size=t,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const n=Object(m.i)(this.pixelType);this.destroy(),this.data=new n(Object(c.m)(e.buffer))}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(e){const t=new f.a(e,this._textureDesc,Object(c.n)(this.data,void 0));if(Object(c.h)(this._lastTexture)&&this._fbos[0]){const i=this._lastTexture.descriptor.width,n=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,o=this.getFBO(e),a=Object(m.j)(r),l=new(Object(m.i)(r))(new ArrayBuffer(i*n*a*this.texelSize)),c=e.getBoundFramebufferObject(),{x:u,y:h,width:d,height:f}=e.getViewport();e.bindFramebuffer(o),o.readPixels(0,0,i,n,s,r,l),t.updateData(0,0,0,2*i,n/2,l),e.setViewport(u,h,d,f),e.bindFramebuffer(c)}return this.destroy(),this._texture=t,this._texture}}class O{constructor(){this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(e){const{blocks:t,shared:i,size:n}=e;if(this.shared=i,this.size=n,y("Initializing AttributeStoreView",e),Object(c.g)(this._data))this._data=Object(c.j)(t,e=>new b(e,n,i));else for(let e=0;e<this._data.length;e++){const r=this._data[e],s=t[e];Object(c.h)(s)&&(Object(c.g)(r)?this._data[e]=new b(s,n,i):r.resize(s,n))}this._initialized=!0}destroy(){Object(c.a)(this._data,e=>Object(c.j)(e,e=>e.destroy())),Object(c.a)(this._defaultTexture,e=>e.dispose())}getBlock(e){return Object(c.g)(this._data)?null:this._data[e]}setLabelMinZoom(e,t){this.setData(e,0,1,t)}getLabelMinZoom(e){return this.getData(e,0,1,255)}getFilterFlags(e){return this.getData(e,0,0,0)}getVVSize(e){return this.getData(e,d.b,0,0)}getData(e,t,i,n){if(!this._data)return 0;const r=Object(c.m)(this._data)[t];if(Object(c.g)(r))return 0;const s=r.getData(e,i);return Object(c.h)(s)?s:n}setData(e,t,i,n){const r=Object(c.m)(this._data)[t];Object(c.m)(r).setData(e,i,n)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}async requestUpdate(e){if(this._pendingAttributeUpdate)return void g.error(new h.a("mapview-webgl","Tried to update attribute data with a pending update"));const t=Object(n.g)();return y("AttributeStoreView Update Requested",e),this._pendingAttributeUpdate={data:e,resolver:t},t.promise}update(){if(this._initialized&&Object(c.h)(this._pendingAttributeUpdate)){const{data:e,resolver:t}=this._pendingAttributeUpdate,i=Object(c.m)(this._data);for(let t=0;t<e.blocks.length;t++){const n=e.blocks[t],r=i[t];Object(c.a)(r,e=>Object(c.a)(n,i=>{y("Updating block "+t,i),e.update(i)}))}this._pendingAttributeUpdate=null,t()}}bindTextures(e){this.update();const t=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(t,d.s),e.bindTexture(t,d.t),e.bindTexture(t,d.u),void e.bindTexture(t,d.v);const i=Object(c.m)(this._data);this._locked&&!this._forceNextUpload||(Object(c.e)(i,t=>t.updateTexture(e)),this._forceNextUpload=!1),e.bindTexture(Object(c.k)(i[0],t,t=>t.getTexture(e)),d.s),e.bindTexture(Object(c.k)(i[1],t,t=>t.getTexture(e)),d.t),e.bindTexture(Object(c.k)(i[2],t,t=>t.getTexture(e)),d.u),e.bindTexture(Object(c.k)(i[3],t,t=>t.getTexture(e)),d.v)}_getDefaultTexture(e){if(Object(c.g)(this._defaultTexture)){const t={wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1};this._defaultTexture=new f.a(e,t,new Uint8Array(4))}return this._defaultTexture}}var S=i(483),w=i(35),T=i(23),C=i(50),M=i(403),I=i(539);function j(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let n=1;n<i;n++)if(e<t[n].value){const i=(e-t[n-1].value)/(t[n].value-t[n-1].value);return t[n-1].size+i*(t[n].size-t[n-1].size)}return t[i-1].size}function E(e,t,i=0){if(Object(c.g)(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r:n,g:r,b:s,a:o}=t;e[i+0]=n*o/255,e[i+1]=r*o/255,e[i+2]=s*o/255,e[i+3]=o}const P=(e,t,i)=>{const n=16*i;for(let i=n,r=0;i<Math.min(n+16,e.length);i++,r++)e[i]=t[r]},D=Object(I.b)();class L{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this.insideEffect=new Float32Array(16*d.o),this.insideOpacity=1,this.outsideEffect=new Float32Array(16*d.o),this.outsideOpacity=1,this.effectCount=0,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._buf0=new Float32Array(2),this._buf1=new Float32Array(2),this.symbolLevels.push(0);for(let e=0;e<d.o;e++)P(this.insideEffect,D,e),P(this.outsideEffect,D,e)}get insideOpacities(){return this._buf0[0]=1,this._buf0[1]=this.insideOpacity,this._buf0}get outsideOpacities(){return this._buf1[0]=0,this._buf1[1]=this.outsideOpacity,this._buf1}getSizeVVFieldStops(e){const t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return Object(c.n)(t.levels[e],()=>{let i=1/0,n=0;for(const r in t.levels){const t=parseFloat(r),s=Math.abs(e-t);s<i&&(i=s,n=t)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const r=e-n,s=Math.pow(2,r/2),o=Object(c.m)(t.levels[n]),a=new Float32Array(o.values);return a[2]*=s,a[3]*=s,{sizes:Object(c.m)(o.sizes),values:a}})}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){Object(c.h)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){switch(Object(c.h)(i)?(i.forEach((e,t)=>this._updateEffects(t,e)),this.effectCount=i.length):this.effectCount=0,this._vvInfo=t,e.type){case"dot-density":this._updateDotDensityInfo(e)}}getVariation(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:Object(l.a)("esri-webgl-texture-float")}}getVariationHash(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2}_updateEffects(e,t){const i=e+1;if(Object(c.h)(t)&&t.filter&&t.filter.enabled){this.outsideLabelsVisible=t.excludedLabelsVisible;const{parsedIncludedEffect:e,parsedExcludedEffect:n}=t;Object(c.h)(e)?(P(this.insideEffect,e.getColorMatrix(),i),this.insideOpacity=e.getOpacity()):(P(this.insideEffect,D,i),this.insideOpacity=1),Object(c.h)(n)?(P(this.outsideEffect,n.getColorMatrix(),i),this.outsideOpacity=n.getOpacity()):(P(this.outsideEffect,D,i),this.outsideOpacity=1)}else P(this.insideEffect,D,i),P(this.outsideEffect,D,i),this.insideOpacity=1,this.outsideOpacity=1}_updateVisualVariables(e,t){const i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,!e)return;const n=e.size;if(n){if(i.vvSizeEnabled=!0,n.minMaxValue){const e=n.minMaxValue;let i,r;if(Object(m.m)(e.minSize)&&Object(m.m)(e.maxSize))if(Object(m.n)(e.minSize)&&Object(m.n)(e.maxSize))i=Object(T.h)(e.minSize),r=Object(T.h)(e.maxSize);else{const n=t.scale;i=Object(T.h)(j(n,e.minSize.stops)),r=Object(T.h)(j(n,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,i,r])}if(n.scaleStops&&(this.vvSizeScaleStopsValue=Object(T.h)(j(t.scale,n.scaleStops.stops))),n.unitValue){const e=Object(C.c)(t.spatialReference)/M.a[n.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}n.fieldStops&&(this._vvSizeFieldStops=n.fieldStops)}const r=e.color;r&&(i.vvColorEnabled=!0,this.vvColorValues.set(r.values),this.vvColors.set(r.colors));const s=e.opacity;s&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(s.values),this.vvOpacities.set(s.opacities));const o=e.rotation;o&&(i.vvRotationEnabled=!0,i.vvRotationType=o.type)}_updateDotDensityInfo(e){const t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(let e=0;e<d.g;e++){const i=e>=t.length?new w.a([0,0,0,0]):t[e].color;E(this.ddColors,i,4*e)}for(let t=0;t<8;t++)this.ddActiveDots[t]=t<e.attributes.length?1:0;E(this.ddBackgroundColor,e.backgroundColor)}}class z extends S.a{constructor(e){super(e),this._rendererInfo=new L,this._materialItemsRequestQueue=new s.a,this.attributeView=new O}destroy(){this.removeAllChildren(),this.children.forEach(e=>e.destroy()),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,i){this._rendererInfo.setInfo(e,t,i),this.requestRender()}async getMaterialItems(e,t){if(!e||0===e.length)return null;const i=Object(n.g)();return this._materialItemsRequestQueue.push({items:e,abortOptions:t,resolver:i}),this.requestRender(),i.promise}onTileData(e,t){if(t.addOrUpdate&&"tileDisplayData"in t.addOrUpdate)e.setData(t);else{const i=t.addOrUpdate&&o.a.decode(t.addOrUpdate),n={...t,addOrUpdate:i};e.setData(n)}this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}doRender(e){if(e.context.capabilities.textureFloat,e.context.capabilities.vao,this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commitChanges(e);this._rendererInfo.update(e.state),this.attributeView.bindTextures(e.context),super.renderChildren(e)}createTile(e){const t=this._tileInfoView.getTileBounds(Object(r.d)(),e);return new a.a(e,t)}destroyTile(e){this.removeChild(e),e.destroy()}createRenderParams(e){return{...super.createRenderParams(e),rendererInfo:this._rendererInfo,attributeView:this.attributeView}}_processMaterialItemRequest(e,{items:t,abortOptions:i,resolver:r}){const{painter:s,pixelRatio:o}=e,a=t.map(e=>s.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,i));Object(n.a)(a).then(e=>{if(!this.stage)return void r.reject();const i=e.map((e,i)=>({id:t[i].id,mosaicItem:e}));r.resolve(i)},r.reject)}}},556:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var n=i(5),r=i(14),s=(i(9),i(7)),o=i(301),a=i(471),l=i(502),c=i(518),u=i(450);const h=n.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");class d{constructor(){this.type="feature",this._defaultResult=null}static async fromBasicRenderer(e,t,i){const n=new d;if(e.symbol){const r=await Object(c.a)(e.symbol,i),s=t.createTemplateGroup(r,null);n.setDefault(s)}return n}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}match(e,t,i,n,r){return this.getDefault()}async analyze(e,t,i,n,r){return null}}class f extends d{constructor(e,t,i,n){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=t,this._fieldIndex=n,this._field=e,this._normalizationInfo=i}static async fromCBRenderer(e,t,i){const{isMaxInclusive:n,normalizationField:r,normalizationTotal:o,normalizationType:a}=e,l=e.field,u=new f(l,n,{normalizationField:r,normalizationTotal:o,normalizationType:a},e.fieldIndex),h=await Object(c.a)(e.backgroundFillSymbol,i);await Object(s.a)(e.intervals.map(async e=>{const n=await Object(c.a)(e.symbol,i),r=await t.createTemplateGroup(n,h),s={min:e.min,max:e.max};u.add(s,r)}));const d=await Object(c.a)(e.defaultSymbol,i);if(d){const e=await t.createTemplateGroup(d,h);u.setDefault(e)}return u}add(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((e,t)=>e.interval.min-t.interval.min)}size(){return super.size()+this._intervals.length}match(e,t,i,n,r){if(null==this._fieldIndex&&!this._field)return this.getDefault();const s=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!s&&(null==s||isNaN(s)))return this.getDefault();for(let e=0;e<this._intervals.length;e++){const{interval:t,result:i}=this._intervals[e],n=s>=t.min,r=this._isMaxInclusive?s<=t.max:s<t.max;if(n&&r)return i}return this.getDefault()}_needsNormalization(){const e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}_getValueFromField(e){const t=e.readAttribute(this._field);if(!this._needsNormalization())return t;const{normalizationField:i,normalizationTotal:n,normalizationType:r}=this._normalizationInfo,s=!!i&&e.readAttribute(i);if(r)switch(r){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/n*100;default:return void h.error("Found unknown normalization type: "+r)}else h.error("Normalization is required, but no type was set!")}}class p extends d{constructor(e,t,i){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=i,this._fields=e,this._seperator=t||""}static async fromUVRenderer(e,t,i){const n=e.fieldDelimiter,r=[e.field];e.field2&&r.push(e.field2),e.field3&&r.push(e.field3);const o=await Object(c.a)(e.backgroundFillSymbol,i),a=new p(r,n,e.fieldIndex);await Object(s.a)(e.map.map(async e=>{const n=await Object(c.a)(e.symbol,i),r=await t.createTemplateGroup(n,o);"<Null>"===e.value?a.setNullResult(r):a.add(e.value,r)}));const l=await Object(c.a)(e.defaultSymbol,i);if(l){const e=await t.createTemplateGroup(l,o);a.setDefault(e)}return a}setNullResult(e){this._nullResult=e}add(e,t){this._resultsMap.set(e.toString(),t)}size(){return super.size()+this._resultsMap.size}match(e,t,i,n,r){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const s=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==s||""===s||"<Null>"===s))return this._nullResult;if(!s&&null==s)return this.getDefault();const o=s.toString();return this._resultsMap.has(o)?this._resultsMap.get(o):this.getDefault()}_getValueFromFields(e){const t=[];for(const i of this._fields){const n=e.readAttribute(i);t.push(n)}return t.join(this._seperator)}}class m extends d{constructor(e,t,i,n){super(),this.type="dictionary",this._renderer=e,this._fieldMap=e.fieldMap,this._templates=t,this._info=i,this._scaleFn=n}static async fromDictionaryRenderer(e,t,n){const r=(await Promise.all([i.e(3),i.e(95)]).then(i.bind(null,476))).default.fromJSON(e.renderer);r.fetchResources({spatialReference:n.spatialReference,fields:n.fields});const s=await async function(e,t){const i=e||1;if("number"==typeof i)return(e,t,n)=>i;const n=await Object(o.d)(i,t.spatialReference,t.fields);return(e,i,r)=>Object(l.a)(n,e,{$view:r},t.geometryType,i)||1}(r.scaleExpression,n);return new m(r,t,n,s)}async _analyzeFeature(e,t,i,n){const s=e.readLegacyFeature(),o={...i,spatialReference:this._info.spatialReference,abortOptions:n,fields:this._info.fields},l=this._scaleFn(s,t,i),d=await this._renderer.getSymbolAsync(s,o),f=Object(u.c)(d,this._renderer),p=await Object(c.a)(f,this._info,n);if("expanded-cim"!==p.type)return h.error(new r.a("mapview-bad-type",`Found unexpected type ${p.type} in dictionary response`)),null;for(const e of p.layers)e.scaleFactor=l,e.templateHash+="-"+l,"text"===e.type&&"string"==typeof e.text&&e.text.indexOf("[")>-1&&(e.text=Object(a.b)(this._fieldMap,e.text,e.cim.textCase));return this._templates.createTemplateGroup(p,null)}async analyze(e,t,i,n,r){const o=t.getCursor(),a=[];for(;o.next();)a.push(this._analyzeFeature(o,i,n,r));return Object(s.a)(a)}match(e,t,i,n,r){return null}}const _=n.a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");async function g(e,t,i){switch(e.type){case"simple":return d.fromBasicRenderer(e,t,i);case"map":return p.fromUVRenderer(e,t,i);case"interval":return f.fromCBRenderer(e,t,i);case"dictionary":return m.fromDictionaryRenderer(e,t,i);default:return _.error(new r.a("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}},557:function(e,t,i){"use strict";var n=i(4),r=i(83),s=i(147),o=i(188),a=i(465),l=i(79),c=i(36),u=i(259),h=i(312);class d{constructor(e,t){this.key=new s.a(0,0,0,0),this.bounds=Object(u.d)(),this.objectIds=new Set,this.key.set(t);const i=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.scale=i.scale,this.level=i.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return c.a.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){const e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new d(this.tileInfoView,this.key)}neighbor(e,t){const i=this.key.clone(),n=1<<i.level,r=i.col+e,s=i.row+t;return r<0?(i.col=r+n,i.world-=1):r>=n?(i.col=r-n,i.world+=1):i.col=r,i.row=s,new d(this.tileInfoView,i)}createChildTiles(){const e=this.key.getChildKeys(),t=l.a.acquire();for(let i=0;i<e.length;i++)t[i]=new d(this.tileInfoView,e[i]);return t}getQuantizationParameters(){return h.a.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}const f={added:[],removed:[]},p=new Set,m=new s.a(0,0,0,0);t.a=class extends r.a{constructor(e){super(),this._tiles=new Map,this._index=Object(a.a)(9,Object(n.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}intersections(e,t){const i="string"==typeof e?this.get(e):e;if(!i)return[];const n=t*i.resolution,r=i.bounds[0]-n,s=i.bounds[1]-n,o=i.bounds[2]+n,a=i.bounds[3]+n,l=[];for(const e of this._index.search({minX:r,minY:s,maxX:o,maxY:a})){const t=e.bounds.slice();t[0]=Math.max(t[0],r),t[1]=Math.max(t[1],s),t[2]=Math.min(t[2],o),t[3]=Math.min(t[3],a),t[2]-t[0]>0&&t[3]-t[1]>0&&l.push({bounds:t,tile:e})}return l}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const e=new d(this.tileScheme,i);this._tiles.set(i,e),this._index.insert(e),t.added.push(e)}for(const i of e.removed)if(this.has(i)){const e=this.get(i);this._tiles.delete(i),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach(e=>this.tiles.push(e)),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:i,lodInfo:n}=t,{level:r}=n;if(i.length>0)for(const{row:e,colFrom:t,colTo:s}of i)for(let i=t;i<=s;i++){const t=m.set(r,e,n.normalizeCol(i),n.getWorldForColumn(i)).id;if(p.add(t),!this.has(t)){const e=new d(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),f.added.push(e)}}for(let e=this.tiles.length-1;e>=0;e--){const t=this.tiles[e];p.has(t.id)||(this._tiles.delete(t.id),this.tiles.splice(e,1),this._index.remove(t),f.removed.push(t))}(f.added.length||f.removed.length)&&this.emit("update",f),o.a.pool.release(t),p.clear(),f.added.length=0,f.removed.length=0}}},558:function(e,t,i){"use strict";class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new n;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}t.a=n},559:function(e,t,i){"use strict";var n=i(0),r=i(4),s=(i(9),i(8)),o=(i(5),i(6),i(1)),a=i(2),l=(i(3),i(10),i(7)),c=(i(11),i(18)),u=i(34),h=i(28),d=i(154),f=i(95),p=i(59),m=i(217),_=i(23),g=i(259),y=i(125),v=i(479),x=i(112),b=i(90);class O{constructor(e=50,t=50){this._pool=new b.a(Map,void 0,e=>e.clear(),t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}static acquire(){return S.acquire()}static release(e){return S.release(e)}}const S=new O(100);var w=O,T=i(442),C=i(396),M=i(441),I=i(518),j=i(517),E=i(513),P=i(450),D=i(556),L=i(512),z=i(553),A=i(547),V=i(554),R=i(413),F=i(482),N=i(536);class k extends N.a{constructor(e,t){super(e,t,null)}static from(e){const t=F.a.createInstance(),i=[];for(const t of e){const e=Object(p.c)(t.geometry);Object(R.e)(i,[t],e,!1,!1,"uid")}return new k(t,i)}get geometryType(){const e=this._current;return e?e.geometryType:null}readGraphic(){return this._current}getCursor(){return this.copy()}copy(){const e=new k(this.instance,this._features);return this.copyInto(e),e}}var U=i(557),G=i(555),B=class extends G.a{get hasLabels(){return!1}get labelsVisible(){return!1}_renderGraphics(e,t){for(const i of this.children)i.isReady&&i.hasData&&(i.commitChanges(e),e.context.setStencilFunction(514,i.stencilRef,255),i._displayList.replay(e,i,t))}renderChildren(e){const{painter:t}=e;if(!this.children.some(e=>e.hasData))return;super.renderChildren(e),this._renderGraphics(e);const i=t.effects.highlight;i.bind(e),this._renderGraphics(e,i.defines),i.draw(e),i.unbind()}},H=i(60);let q=class extends c.a{constructor(e){super(e),this._queue=new Map,this._queueArray=[],this._onGoingGraphic=null,this._onGoingPromise=null,this._scheduledNextHandle=null,this._next=this._next.bind(this),this._finalize=this._finalize.bind(this)}get length(){return this._queueArray.length}get updating(){return this._queueArray.length>0||null!==this._onGoingPromise}cancel(e){if(this._onGoingGraphic&&this._onGoingGraphic.graphic===e&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null),this._queue.has(e)){const t=this._queue.get(e);this._queue.delete(e);const i=this._queueArray.indexOf(t);this._queueArray.slice(i,1)}this._scheduleNext(),this.notifyChange("updating")}clear(){this._queue.clear(),this._queueArray.length=0,this._onGoingPromise&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null),this._cancelNext(),this.notifyChange("updating")}has(e){return this._queue.has(e)}isOngoing(e){return this._onGoingGraphic&&this._onGoingGraphic.graphic===e}push(e,t){if(this._queue.has(e))return;const i={graphic:e,addOrUpdate:t};this._queueArray.push(i),this._queue.set(e,i),this._scheduleNext(),this.notifyChange("updating")}refresh(){this.reset()}reset(){const e=this._onGoingGraphic;if(e){const{graphic:t,addOrUpdate:i}=e;this.push(t,i)}}_finalize(){this._onGoingGraphic=null,this._ongoingAbortController=null,this._onGoingPromise=null,this.notifyChange("updating"),this._scheduleNext()}_cancelNext(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)}_scheduleNext(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=Object(H.b)(this._next))}_next(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingGraphic)return void(this._scheduledNextHandle=null);this._scheduledNextHandle=null;const e=this._peek(),{graphic:t,addOrUpdate:i}=e,n=Object(l.c)();this._queue.delete(t),this._onGoingGraphic=e,this._onGoingPromise=this.process(t,i,{signal:n.signal}),this._ongoingAbortController=n,this._onGoingPromise.then(this._finalize,this._finalize),this.notifyChange("updating")}_peek(){return 0===this._queueArray.length?null:this._queueArray.pop()}};Object(n.a)([Object(o.b)({readOnly:!0})],q.prototype,"length",null),Object(n.a)([Object(o.b)({readOnly:!0})],q.prototype,"updating",null),Object(n.a)([Object(o.b)({constructOnly:!0})],q.prototype,"process",void 0),q=Object(n.a)([Object(a.a)("esri.views.2d.layers.graphics.GraphicProcessingQueue")],q);var W=q,Y=i(452),X=i(74),Z=i(222),K=i(50),J=i(303),Q=i(465),$=i(313),ee=i(418),te=i(463);const ie=new ee.a,ne=new ee.a;function re(e){e.coords.length=0,e.lengths.length=0}class se{constructor(){this.bounds=Object(g.d)(),this.graphic=null,this.size=[0,0,0,0]}static acquire(e=null,t,i,n,r,s){let o;return 0===se._pool.length?o=new se:(o=se._pool.pop(),this._set.delete(o)),o.acquire(e,t,i,n,r,s),o}static release(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}static getCentroidQuantized(e,t){if(Object(p.g)(e.geometry)){const i=e.symbol;if(Object(s.g)(i))return null;if(Object(Y.g)(i.type)){const i=Object($.a)(e.geometry);return Object(te.b)(t,{},{x:i[0],y:i[1]},!1,!1)}}return null}acquire(e=null,t,i,n,r,s){e&&this.set(e,t,i,n,r,s)}release(){this.graphic=null,this.symbolResource=null,this.geometry=null}get symbol(){return this.symbolResource.symbol}set(e,t,i,n,r,s){this.graphic=e,this.geometry=i,this.symbolResource=t,this.updateBounds(n,r,s)}updateBounds(e,t,i){Object(Y.a)(this.bounds,this.size,this.symbolResource,this.geometry,e,t,i)}getGeometryQuantized(e){if(Object(p.g)(this.geometry)){const t=this.geometry.rings;if(1===t.length&&2===t[0].length)return Object(te.a)(e,{paths:[[t[0][0],t[0][1]]]})}else if(Object(p.h)(this.geometry))return re(ie),re(ne),Object(R.h)(ie,this.geometry),Object(R.q)(ne,ie,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",e.scale[0]),Object(R.u)(ie,ne,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",e),Object(R.o)(ie,this.geometry.hasZ,this.geometry.hasM);return Object(te.a)(e,this.geometry)}}se._pool=[],se._set=new Set;var oe=se;const ae={minX:0,minY:0,maxX:0,maxY:0},le=Object(g.d)(),ce=[];function ue(e,t,i,n,r){return ae.minX=t,ae.minY=i,ae.maxX=n,ae.maxY=r,e.search(ae)}const he=e=>{let t=class extends e{constructor(){super(...arguments),this.graphics=null,this.renderer=null,this.view=null}};return Object(n.a)([Object(o.b)()],t.prototype,"graphics",void 0),Object(n.a)([Object(o.b)()],t.prototype,"renderer",void 0),Object(n.a)([Object(o.b)()],t.prototype,"updating",void 0),Object(n.a)([Object(o.b)()],t.prototype,"view",void 0),t=Object(n.a)([Object(a.a)("esri.views.layers.GraphicsView")],t),t};function de(e,t,i){if(i.has(e))return i.get(e);const n={tile:t,addedOrModified:[],removed:[]};return i.set(e,n),n}let fe=class extends(he(Object(x.b)(Object(m.a)(c.a)))){constructor(e){super(e),this._storage=new V.a,this._displayIds=new Map,this._tiles=new Map,this._graphicStoreUpdate=!1,this._graphicsSet=new Set,this._matcher=Object(l.r)(null),this._tileUpdateSet=new Set,this._tilesToUpdate=new Map,this._graphicIdToAbortController=new Map,this._attached=!1,this._highlightIds=new Map,this._updatingGraphicsTimer=null,this._processing=!1,this._needsProcessing=!1,this._pendingUpdate={addOrModified:new Set,removed:new Set},this.lastUpdateId=-1,this.updateRequested=!1,this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this),this.addOrUpdateGraphic=this.addOrUpdateGraphic.bind(this),this._processAnalyzedGraphics=this._processAnalyzedGraphics.bind(this),this._graphicsChangeHandler=this._graphicsChangeHandler.bind(this)}_createMatcher(e,t){if(e){const i=Object(P.a)({indexCount:0,fields:{}},"feature",e);this._matcher=Object(D.a)(i,t,null)}}_createDisplayId(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}initialize(){this._tileStore=new U.a(this.view.featuresTilingScheme),this.container=new B(this.view.featuresTilingScheme),this._attributeStore=new A.a({type:"local",initialize:e=>Object(l.r)(this.container.attributeView.initialize(e)),update:e=>this.container.attributeView.requestUpdate(e),render:()=>this.container.requestRender()}),this._graphicStore=new class{constructor(e,t,i,n,s,o){this._graphics=n,this._onAdd=s,this._onRemove=o,this._index=Object(Q.a)(9,Object(r.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new Map,this._currentLevel=-1/0,this._tileInfoView=e,this._uidFieldName=i;const a=e.getClosestInfoForScale(t);a&&(this._currentLevel=a.level,this._resolution=this._tileInfoView.getTileResolution(a.level)),this._metersPerUnit=Object(K.b)(e.spatialReference)}hitTest(e,t,i,n,r){e=Object(J.b)(e,this._tileInfoView.spatialReference);const s=.5*n*i;le[0]=e-s,le[1]=t-s,le[2]=e+s,le[3]=t+s;const o=.5*n*(i+50),a=ue(this._index,e-o,t-o,e+o,t+o);if(!a||0===a.length)return[];const l={x:e,y:t},c=[];let u;for(const i of a)if(i.graphic.visible)switch(Object(p.c)(i.geometry)){case"esriGeometryPoint":{const e=i.symbol;if(!e)continue;const t=i.geometry,{x:s,y:o}=t,a=n*this._metersPerUnit;let u;switch(e.type){case"esriTS":u=Object(Y.d)(s,o,e,i.size,n,r);break;case"expanded-cim":u=Object(Y.b)(s,o,e,n,a,r);break;case"esriSMS":case"esriPMS":u=Object(Y.c)(s,o,e,n,a,r)}Object(X.g)(u,l)&&c.push(i)}break;case"esriGeometryPolyline":{const r=i.symbol;if(!r||!r.layers.length)continue;const s=r.layers[0];u=1.5*n*window.devicePixelRatio*Object(_.h)(s.width),Object(Y.h)(i.geometry,e,t,u)&&c.push(i)}break;case"esriGeometryEnvelope":{const e=i.geometry,t=Object(g.i)(e.xmin,e.ymin,e.xmax,e.ymax);Object(g.k)(t,le)&&c.push(i);break}case"esriGeometryPolygon":{if(Object(X.g)(i.geometry,l)){c.push(i);break}const e=Object(Z.b)(i.geometry);if(Math.abs(e.ymax-e.ymin)<5*n||Math.abs(e.xmax-e.xmin)<5*n){const t=Object(g.i)(e.xmin,e.ymin,e.xmax,e.ymax);Object(g.k)(t,le)&&c.push(i)}break}case"esriGeometryMultipoint":{const e=i.symbol;if(!e)continue;const t=i.geometry.points;let s;for(let o=0;o<t.length;o++)if(s="esriTS"===e.type?Object(Y.d)(t[o][0],t[o][1],e,i.size,n,r):Object(Y.c)(t[o][0],t[o][1],e,n,n*this._metersPerUnit,r),Object(X.g)(s,l)){c.push(i);break}break}}return c.sort((e,t)=>{const i=Object(Y.f)(e.graphic),n=Object(Y.f)(t.graphic);return i===n?t.zorder-e.zorder:i-n}),c.map(e=>e.graphic)}getGraphicsData(e,t,i){const n=ue(this._index,t.bounds[0],t.bounds[1],t.bounds[2],t.bounds[3]);if(0===n.length||0===i.length)return[];n.sort((e,t)=>e.zorder-t.zorder),n[0].insertAfter=-1;for(let e=1;e<n.length;e++)n[e].insertAfter=n[e-1].graphic.uid;n.sort((e,t)=>e.graphic.uid-t.graphic.uid),i.sort((e,t)=>e.uid-t.uid);let r,s=0,o=0;const a=[],l={originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]};for(const t of i){for(o=-2;s<n.length;)if(r=n[s],s++,t.uid===r.graphic.uid){o=r.insertAfter;break}if(!r.geometry||-2===o)continue;const i=r.getGeometryQuantized(l),c={...r.graphic.attributes};c[this._uidFieldName]=t.uid,null==r.groupId&&(r.groupId=e.createTemplateGroup(r.symbol,null)),a.push({centroid:oe.getCentroidQuantized(r,l),geometry:i,attributes:c,symbol:r.symbol,groupId:r.groupId,insertAfter:o})}return a}getGraphicData(e,t,i){const n=this._itemByGraphic.get(i);if(!n)return null;const r=ue(this._index,t.bounds[0],t.bounds[1],t.bounds[2],t.bounds[3]);r.sort((e,t)=>e.zorder-t.zorder);const s=r.indexOf(n),o=0===s||-1===s?-1:r[s-1].graphic.uid,a={originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]},l=n.getGeometryQuantized(a),c={...n.graphic.attributes};return c[this._uidFieldName]=i.uid,null==n.groupId&&(n.groupId=e.createTemplateGroup(n.symbol,null)),{centroid:oe.getCentroidQuantized(n,a),geometry:l,attributes:c,symbol:n.symbol,groupId:n.groupId,insertAfter:o}}queryTileData(e,t){const i=50*t.resolution,n=Object(g.m)(t.bounds,i,Object(g.d)()),r=ue(this._index,n[0],n[1],n[2],n[3]),s=[];return this._createTileGraphics(s,e,r,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]}),s}has(e){return this._itemByGraphic.has(e)}getBounds(e){return this._itemByGraphic.has(e)?this._itemByGraphic.get(e).bounds:null}addOrModify(e,t,i){if(!e)return;this.has(e)&&this.remove(e),this._onAdd(e);const n=oe.acquire(e,t,i,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference);return this._itemByGraphic.set(e,n),i&&this._index.insert(n),n.bounds}remove(e){if(!this._itemByGraphic.has(e))return;this._onRemove(e);const t=this._itemByGraphic.get(e);this._index.remove(t),this._itemByGraphic.delete(e)}updateZ(){const e=this._graphics.items;let t,i;for(let n=0;n<e.length;n++)i=e[n],t=this._itemByGraphic.get(i),t&&(t.zorder=n)}update(e,t,i){const n=this._itemByGraphic.get(e);n.groupId=null;const r=Object(g.b)(n.bounds);return n.size[0]=n.size[1]=0,this._index.remove(n),n.set(e,t,i,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),i&&this._index.insert(n),{oldBounds:r,newBounds:n.bounds}}updateLevel(e){if(this._currentLevel===e)return;this._currentLevel=e;const t=this._tileInfoView.getTileResolution(e);this._resolution=t,this._index.clear(),ce.length=0,this._itemByGraphic.forEach(e=>{e.updateBounds(this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),e.geometry&&ce.push(e)}),this._index.load(ce)}clear(){this._itemByGraphic.clear(),this._index.clear()}_createTileGraphics(e,t,i,n){const r=this._uidFieldName;let s,o,a,l;i.sort((e,t)=>e.zorder-t.zorder);for(let c=0;c<i.length;c++){a=i[c],s=a.graphic,o=a.getGeometryQuantized(n),l=0===c?-1:i[c-1].graphic.uid;const u={...a.graphic.attributes};u[r]=s.uid,null==a.groupId&&(a.groupId=t.createTemplateGroup(a.symbol,null)),e.push({centroid:oe.getCentroidQuantized(a,n),geometry:o,attributes:u,symbol:a.symbol,groupId:a.groupId,insertAfter:l})}}}(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,e=>{this._createDisplayId(e.uid),this._setFilterState(e.uid,e.visible)},e=>{const t=this._displayIds.get(e.uid);this._displayIds.delete(e.uid),this._storage.releaseDisplayId(t)}),this._graphicProcessingQueue=new W({process:this.addOrUpdateGraphic});const e=new L.a(this.container.getMaterialItems.bind(this.container),!0);this._createMatcher(this.renderer,e),this._meshFactory=new z.a(null,this.uid,e),this._templateStore=e,this.watch("renderer",t=>this._createMatcher(t,e)),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.graphics.items.length>0&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]}),this.handles.add(this.graphics.on("change",this._graphicsChangeHandler),"graphics"),this._attached=!0,this.notifyChange("updating")}),this.container.on("detach",()=>{this._graphicProcessingQueue&&this._graphicProcessingQueue.clear()})}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this.container.destroy(),this._set("graphics",null),this._graphicProcessingQueue&&(this._graphicProcessingQueue.destroy(),this._graphicProcessingQueue=null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null}get updating(){return!this._attached||null!==this._updatingGraphicsTimer||this._graphicProcessingQueue.updating||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}hitTest(e,t){if(!this.view||!this.view.position)return Object(l.r)();const i=this.view.toMap(Object(_.b)(e,t));return this.searchFeatures(i).then(e=>e&&e.length?e[0]:null)}searchFeatures(e,t=2){return Object(l.f)(i=>{i(this._graphicStore.hitTest(e.x,e.y,t,this.view.state.resolution,this.view.state.rotation))})}update(e){const t=e.state,i=this.view.featuresTilingScheme.getClosestInfoForScale(t.scale).level;this._graphicStore.updateLevel(i),this._tileStore.setViewState(t),this._graphicStoreUpdate=!0,this.updateRequested=!1}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}graphicUpdateHandler(e){const{graphic:t,property:i,newValue:n}=e,r=t;switch(i){case"attributes":break;case"geometry":case"symbol":this._graphicProcessingQueue.push(r,"update");break;case"visible":this._setFilterState(r.uid,n),this._attributeStore.sendUpdates()}}addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_updateHighlight(){const e=Object(y.b)(this._highlightIds),t=e.map(e=>this._displayIds.get(e));this._attributeStore.setHighlight(e,t)}_getIntersectingTiles(e){const t=this._graphicStore.getBounds(e);return t&&0!==Object(g.p)(t)&&0!==Object(g.j)(t)?this._tileStore.boundsIntersections(t):[]}_updateTile(e){const t=e.tile,i=this._getGraphicsData(this._templateStore,t,e.addedOrModified);return this._processGraphics(i).then(i=>(this._patchTile(t.key,{type:"update",addOrUpdate:i,remove:e.removed,end:!0}),i))}_patchTile(e,t){if(!this._tiles.has(e))return;const i=this._tiles.get(e);this.container.onTileData(i,t),this.container.requestRender()}_graphicsChangeHandler(e){for(const t of e.added)this._pendingUpdate.addOrModified.add(t);for(const t of e.moved)this._pendingUpdate.addOrModified.add(t);for(const t of e.removed)this._pendingUpdate.addOrModified.has(t)?this._pendingUpdate.addOrModified.delete(t):this._pendingUpdate.removed.add(t);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getFeaturesToUpdate(){const e={addOrModified:[],removed:[]};for(const t of this.graphics.items)this._pendingUpdate.addOrModified.has(t)&&e.addOrModified.push(t);return this._pendingUpdate.removed.forEach(t=>{this._graphicStore.has(t)&&e.removed.push(t)}),this._pendingUpdate.addOrModified.clear(),this._pendingUpdate.removed.clear(),e}async _updateGraphics(){this._processing=!0;const{addOrModified:e,removed:t}=this._getFeaturesToUpdate(),i=this._tilesToUpdate;let n;try{if(!this._graphicStoreUpdate){const e=this.view.state,t=this.view.featuresTilingScheme.getClosestInfoForScale(e.scale).level;this._graphicStore.updateLevel(t),this._tileStore.setViewState(e)}const r=[],s=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t];s[t]=i,this._graphicsSet.add(i),r.push(this.addGraphic(i))}for(const e of t){this._abortProcessingGraphic(e.uid);const t=this._getIntersectingTiles(e);for(const r of t)n=r.key.id,de(n,r,i).removed.push(this._displayIds.get(e.uid));this._graphicsSet.delete(e),this._graphicStore.remove(e)}let o;this._flipUpdatingGraphics(),await Object(l.a)(r);for(let e=0;e<s.length;e++){o=s[e];const t=this._getIntersectingTiles(o);for(const e of t)n=e.key.id,de(n,e,i).addedOrModified.push(o)}this._graphicStore.updateZ();const a=[];i.forEach(e=>a.push(this._updateTile(e))),await Object(l.a)(a)}catch(e){Object(r.a)("esri-2d-debug")&&console.debug("Encountered an error when updating graphics:",e)}i.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())}_getArcadeInfo(e){const t=(e.attributes?Object.keys(e.attributes):[]).map(t=>({name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"}));return Object(s.g)(e.geometry)?null:{geometryType:Object(p.c)(e.geometry),spatialReference:h.a.fromJSON(e.geometry.spatialReference),fields:t}}async _getSymbolForGraphic(e,t){return Object(s.h)(e.symbol)?e.symbol:Object(s.h)(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,abortOptions:t}):this._getNullSymbol(e)}async _getSymbolResources(e,t){if(!this.container.stage)return Object(l.r)(null);const i=this._getArcadeInfo(e),n=await this._getSymbolForGraphic(e,t),r=Object(P.c)(n),s=await Object(I.a)(r,i,t);if("esriTS"===s.type){const e=[],[t]=Object(M.a)(s.text);for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));const i={symbol:s,id:0,glyphIds:e},[{mosaicItem:n}]=await this.container.getMaterialItems([i]);return{symbol:s,mosaicItem:n}}return{symbol:s,mosaicItem:null}}async _projectAndNormalizeGeometry(e){if(Object(s.g)(e.geometry))return Object(l.r)(null);let t=e.geometry;if(Object(p.g)(t)){const e=t.rings;t.rings=e}else if(Object(p.h)(t)){const e=t.paths;t.paths=e}else Object(p.d)(t)&&(t=f.a.fromExtent(t));return Object(T.a)(t.spatialReference,this.view.spatialReference).then(()=>{const e=Object(Y.i)(t),i=Object(T.c)(e,t.spatialReference,this.view.spatialReference);return Object(d.a)(i),i})}_onTileUpdate(e){const t=Object(u.d)(this.view.spatialReference);if(e.added&&e.added.length>0)for(const i of e.added)this._addNewTile(i,t);if(e.removed&&e.removed.length>0)for(const t of e.removed)this._removeTile(t.key)}addOrUpdateGraphic(e,t,i){return this._addOrUpdateGraphic(e,t,i)}addGraphic(e){this._abortProcessingGraphic(e.uid);const t=Object(l.c)();this._graphicIdToAbortController.set(e.uid,t);const i={signal:t.signal};return this._addOrUpdateGraphic(e,"add",i).then(()=>{this._graphicIdToAbortController.delete(e.uid)}).catch(t=>{if(this._graphicIdToAbortController.delete(e.uid),!Object(l.b)(t))throw t})}_addOrUpdateGraphic(e,t,i){const n=this._projectAndNormalizeGeometry(e),r=this._getSymbolResources(e,i);return Object(l.a)([n,r]).then(([n,r])=>"add"===t?this._addProjectedGraphic(e,r,n):this._updateGraphic(e,r,n,i))}_addProjectedGraphic(e,t,i){this._graphicsSet.has(e)&&this._graphicStore.addOrModify(e,t,i)}_updateGraphic(e,t,i,n){if(!this._graphicStore.has(e)||Object(l.e)(n))return Object(l.r)();const{oldBounds:r,newBounds:s}=this._graphicStore.update(e,t,i),o=0===Object(g.p)(r)&&0===Object(g.j)(r),a=0===Object(g.p)(s)&&0===Object(g.j)(s),c=o?[]:this._tileStore.boundsIntersections(r),u=a?[]:this._tileStore.boundsIntersections(s),h=w.acquire();for(const t of c)h.set(t.key,{addOrUpdate:null,remove:[this._displayIds.get(e.uid)]});for(const t of u){const i=this._getGraphicData(this._templateStore,t,e);if(h.has(t.key)){const e=h.get(t.key);e.remove.length=0,e.addOrUpdate=i}else h.set(t.key,{addOrUpdate:i,remove:null})}const d=[];return h.forEach((e,t)=>{const i=this._processGraphics(e.addOrUpdate,n).then(i=>{this._patchTile(t,{type:"update",addOrUpdate:i,remove:e.remove,end:!0})});d.push(i)}),w.release(h),Object(l.a)(d).then(()=>{})}_addTile(e,t){const i=Object(g.d)();this.view.featuresTilingScheme.getTileBounds(i,e);const n=new E.a(e,i,!0),r={type:"update",clear:!0,addOrUpdate:t,remove:[],end:!0};this._tiles.set(e,n),this.container.addChild(n),n.setData(r)}_addNewTile(e,t){const i=this._graphicStore.queryTileData(this._templateStore,e);if(t){const n=Math.round((t.valid[1]-t.valid[0])/e.resolution);for(const e of i)e.geometry&&Object(p.f)(e.geometry)&&this._wrapPoints(e,n)}const n=e.key;this._tileUpdateSet.add(e.key),this.notifyChange("updating"),this._processGraphics(i).then(e=>{this._addTile(n,e),this._tileUpdateSet.delete(n),this.notifyChange("updating")}).catch(e=>{if(this._tileUpdateSet.delete(n),this.notifyChange("updating"),!Object(l.b)(e))throw e})}_removeTile(e){if(!this._tiles.has(e))return;const t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}_setFilterState(e,t){const i=this._displayIds.get(e),n=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(i,0,0,n|(t?C.i:0))}_getGraphicsData(e,t,i){const n=Object(u.d)(this.view.spatialReference),r=this._graphicStore.getGraphicsData(e,t,i);if(n){const e=Math.round((n.valid[1]-n.valid[0])/t.resolution);for(const t of r)t.geometry&&Object(p.f)(t.geometry)&&this._wrapPoints(t,e)}return r.sort((e,t)=>e.insertAfter-t.insertAfter),r}_getGraphicData(e,t,i){const n=this._graphicStore.getGraphicData(e,t,i),r=[n],s=Object(u.d)(this.view.spatialReference);if(s){const e=Math.round((s.valid[1]-s.valid[0])/t.resolution);n.geometry&&Object(p.f)(n.geometry)&&this._wrapPoints(n,e)}return r}_wrapPoints(e,t){const i=e.geometry;512===t?i.x<20?e.geometry={points:[[i.x,i.y],[t,0]]}:i.x>492&&(e.geometry={points:[[i.x,i.y],[-t,0]]}):i.x<-20?e.geometry={points:[[i.x,i.y],[t,0]]}:i.x>532&&(e.geometry={points:[[i.x,i.y],[-t,0]]})}async _processGraphics(e,t){if(!e||!e.length||!this._meshFactory)return null;const i=k.from(e),n=this._meshFactory;return await n.analyzeGraphics(i,await this._matcher,null,null,t),this._attributeStore.sendUpdates(),this._processAnalyzedGraphics(i)}_processAnalyzedGraphics(e){const t=this._meshFactory,i=t.createMeshData(e.getApproximateSize()),n=e.getCursor();for(;n.next();){const e=n.readGraphic();e.insertAfter=-1===e.insertAfter?-1:this._displayIds.get(e.insertAfter),e.displayId=this._displayIds.get(e.attributes[this.uid]),t.writeGraphic(i,n)}const r={};return i.encode(r,[]),j.a.decode(r)}_abortProcessingGraphic(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}_getNullSymbol(e){const t=e.geometry;return Object(p.h)(t)?v.d:Object(p.g)(t)||Object(p.d)(t)?v.c:v.b}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout(()=>{this._updatingGraphicsTimer=null,this.notifyChange("updating")},160),this.notifyChange("updating")}};Object(n.a)([Object(o.b)()],fe.prototype,"_graphicProcessingQueue",void 0),Object(n.a)([Object(o.b)({constructOnly:!0})],fe.prototype,"requestUpdateCallback",void 0),Object(n.a)([Object(o.b)({constructOnly:!0})],fe.prototype,"graphics",void 0),Object(n.a)([Object(o.b)({dependsOn:["_graphicProcessingQueue.updating"]})],fe.prototype,"updating",null),Object(n.a)([Object(o.b)()],fe.prototype,"view",void 0),Object(n.a)([Object(o.b)()],fe.prototype,"updateRequested",void 0),fe=Object(n.a)([Object(a.a)("esri.views.2d.layers.support.GraphicsView2D")],fe);var pe=fe;t.a=pe},560:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i(404),i(405),i(406),i(407),i(408),i(409),i(411);var n=i(567),r={background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color = texture2D(u_tex, v_uv);\n  gl_FragColor = color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position = vec4(a_pos, 0.0, 1.0);\n  v_uv = a_tex;\n}"},blend:{"blend.frag":"precision mediump float;\nuniform sampler2D u_layerTexture;\nuniform lowp float u_opacity;\nuniform lowp float u_inFadeOpacity;\n#ifndef NORMAL\nuniform sampler2D u_backbufferTexture;\n#endif\nvarying mediump vec2 v_uv;\nfloat rgb2v(in vec3 c) {\n  return max(c.x, max(c.y, c.z));\n}\nvec3 rgb2hsv(in vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n  vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(in vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 tint(in vec3 Cb, in vec3 Cs) {\n  float vIn = rgb2v(Cb);\n  vec3 hsvTint = rgb2hsv(Cs);\n  vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n  return hsv2rgb(hsvOut);\n}\nfloat overlay(in float Cb, in float Cs) {\n  return (1.0 - step(0.5, Cs)) * (1.0 - 2.0 * (1.0 - Cs ) * (1.0 - Cb)) + step(0.5, Cs) * (2.0 * Cs * Cb);\n}\nfloat colorDodge(in float Cb, in float Cs) {\n  return (Cb == 0.0) ? 0.0 : (Cs == 1.0) ? 1.0 : min(1.0, Cb / (1.0 - Cs));\n}\nfloat colorBurn(in float Cb, in float Cs) {\n return (Cb == 1.0) ? 1.0 : (Cs == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - Cb) / Cs);\n}\nfloat hardLight(in float Cb, in float Cs) {\n  return (1.0 - step(0.5, Cs)) * (2.0 * Cs * Cb) + step(0.5, Cs) * (1.0 - 2.0 * (1.0 - Cs) * (1.0 - Cb));\n}\nfloat reflectBlend(in float Cb, in float Cs) {\n\treturn (Cs == 1.0) ? Cs : min(Cb * Cb / (1.0 - Cs), 1.0);\n}\nfloat softLight(in float Cb, in float Cs) {\n  if (Cs <= 0.5) {\n    return Cb - (1.0 - 2.0 * Cs) * Cb * (1.0 - Cb);\n  }\n  if (Cb <= 0.25) {\n    return Cb + (2.0 * Cs - 1.0) * Cb * ((16.0 * Cb - 12.0) * Cb + 3.0);\n  }\n  return Cb + (2.0 * Cs - 1.0) * (sqrt(Cb) - Cb);\n}\nfloat vividLight(in float Cb, in float Cs) {\n  return (1.0 - step(0.5, Cs)) * colorBurn(Cb, 2.0 * Cs) + step(0.5, Cs) * colorDodge(Cb, (2.0 * (Cs - 0.5)));\n}\nfloat minv3(in vec3 c) {\n  return min(min(c.r, c.g), c.b);\n}\nfloat maxv3(in vec3 c) {\n  return max(max(c.r, c.g), c.b);\n}\nfloat lumv3(in vec3 c) {\n  return dot(c, vec3(0.3, 0.59, 0.11));\n}\nfloat satv3(vec3 c) {\n  return maxv3(c) - minv3(c);\n}\nvec3 clipColor(vec3 color) {\n  float lum = lumv3(color);\n  float mincol = minv3(color);\n  float maxcol = maxv3(color);\n  if (mincol < 0.0) {\n    color = lum + ((color - lum) * lum) / (lum - mincol);\n  }\n  if (maxcol > 1.0) {\n    color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);\n  }\n  return color;\n}\nvec3 setLum(vec3 cbase, vec3 clum) {\n  float lbase = lumv3(cbase);\n  float llum = lumv3(clum);\n  float ldiff = llum - lbase;\n  vec3 color = cbase + vec3(ldiff);\n  return clipColor(color);\n}\nvec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)\n{\n  float minbase = minv3(cbase);\n  float sbase = satv3(cbase);\n  float ssat = satv3(csat);\n  vec3 color;\n  if (sbase > 0.0) {\n    color = (cbase - minbase) * ssat / sbase;\n  } else {\n    color = vec3(0.0);\n  }\n  return setLum(color, clum);\n}\nvoid main() {\n  vec4 src = texture2D(u_layerTexture, v_uv);\n#ifdef NORMAL\n  gl_FragColor = src *  u_opacity;\n#else\n  vec4 dst = texture2D(u_backbufferTexture, v_uv);\n  vec3 Cs = src.a == 0.0 ? src.rgb : vec3(src.rgb / src.a);\n  vec3 Cb = dst.a == 0.0 ? dst.rgb : vec3(dst.rgb / dst.a);\n  float as = u_opacity * src.a;\n  float ab = dst.a;\n  #ifdef DESTINATION_OVER\n    gl_FragColor = vec4(as * Cs * (1.0 - ab) + ab * Cb, as + ab - as * ab);\n  #endif\n  #ifdef SOURCE_IN\n    vec4 color = vec4(as * Cs * ab, as * ab);\n    vec4 fadeColor = (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\n    gl_FragColor = color + fadeColor;\n  #endif\n  #ifdef DESTINATION_IN\n    vec4 color = vec4(ab * Cb * as, ab * as);\n    vec4 fadeColor = (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\n    gl_FragColor = color + fadeColor;\n  #endif\n  #ifdef SOURCE_OUT\n    gl_FragColor = vec4(as * Cs * (1.0 - ab), as * (1.0 - ab));\n  #endif\n  #ifdef DESTINATION_OUT\n    gl_FragColor = vec4(ab * Cb * (1.0 - as), ab * (1.0 - as));\n  #endif\n  #ifdef SOURCE_ATOP\n    gl_FragColor = vec4(as * Cs * ab + ab * Cb * (1.0 - as), ab);\n  #endif\n  #ifdef DESTINATION_ATOP\n    gl_FragColor = vec4(as * Cs * (1.0 - ab) + ab * Cb * as, as);\n  #endif\n  #ifdef XOR\n    gl_FragColor = vec4(as * Cs * (1.0 - ab) + ab * Cb * (1.0 - as),\n                        as * (1.0 - ab) + ab * (1.0 - as));\n  #endif\n  #ifdef MULTIPLY\n    gl_FragColor = vec4(as * Cs * ab * Cb + (1.0 - ab) * as * Cs + (1.0 - as) * ab * Cb,\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef SCREEN\n    gl_FragColor = vec4((Cs + Cb - Cs * Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef OVERLAY\n    vec3 f = vec3(overlay(Cb.r, Cs.r), overlay(Cb.g, Cs.g), overlay(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef DARKEN\n    gl_FragColor = vec4(min(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef LIGHTER\n    gl_FragColor = vec4(as * Cs + ab * Cb, as + ab);\n  #endif\n  #ifdef LIGHTEN\n    gl_FragColor = vec4(max(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef COLOR_DODGE\n    vec3 f = vec3(colorDodge(Cb.r, Cs.r), colorDodge(Cb.g, Cs.g), colorDodge(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef COLOR_BURN\n    vec3 f = vec3(colorBurn(Cb.r, Cs.r), colorBurn(Cb.g, Cs.g), colorBurn(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef HARD_LIGHT\n    vec3 f = vec3(hardLight(Cb.r, Cs.r), hardLight(Cb.g, Cs.g), hardLight(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef SOFT_LIGHT\n    vec3 f = vec3(softLight(Cb.r, Cs.r), softLight(Cb.g, Cs.g), softLight(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef DIFFERENCE\n    gl_FragColor = vec4(abs(Cb - Cs) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef EXCLUSION\n     vec3 f = Cs + Cb - 2.0 * Cs * Cb;\n     gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef INVERT\n    gl_FragColor = vec4((1.0 - Cb) * as * ab + Cb * ab * (1.0 - as), ab);\n  #endif\n  #ifdef VIVID_LIGHT\n    vec3 f = vec3(vividLight(Cb.r, Cs.r),\n                  vividLight(Cb.g, Cs.g),\n                  vividLight(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef HUE\n    vec3 f = setLumSat(Cs,Cb,Cb);\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef SATURATION\n    vec3 f = setLumSat(Cb,Cs,Cb);\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef COLOR\n    vec3 f = setLum(Cs,Cb);\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef LUMINOSITY\n    vec3 f = setLum(Cb,Cs);\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef PLUS\n    gl_FragColor = clamp(vec4(src.r + Cb.r, src.g + Cb.g, src.b + Cb.b, as + ab), 0.0, 1.0);\n  #endif\n  #ifdef MINUS\n     gl_FragColor = vec4(clamp(vec3(Cb.r - src.r, Cb.g - src.g, Cb.b - src.b), 0.0, 1.0), ab * as);\n  #endif\n  #ifdef AVERAGE\n     vec3 f = (Cb + Cs) / 2.0;\n     gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef REFLECT\n    vec3 f = vec3(reflectBlend(Cb.r, Cs.r),\n                  reflectBlend(Cb.g, Cs.g),\n                  reflectBlend(Cb.b, Cs.b));\n    gl_FragColor = vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n#endif\n}","blend.vert":"attribute vec2 a_position;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position = vec4(a_position , 0.0, 1.0);\n  v_uv = (a_position + 1.0) / 2.0;\n}"},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\n  float b = 1.0 / 6.0;\n  float v2 = v * v;\n  float v3 = v2 * v;\n  float w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\n  float w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\n  float w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\n  float w3 = b * v3;\n  return vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\n  vec4 w = computeWeights(v);\n  float g0 = w.x + w.y;\n  float g1 = w.z + w.w;\n  float h0 = 1.0 - (w.y / g0) + v;\n  float h1 = 1.0 + (w.w / g1) - v;\n  return vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 eX = vec2(1.0 / texSize.x, 0.0);\n  vec2 eY = vec2(0.0, 1.0 / texSize.y);\n  vec2 texel = coords * texSize - 0.5;\n  vec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\n  vec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\n  vec2 coords10 = coords + hgX.x * eX;\n  vec2 coords00 = coords - hgX.y * eX;\n  vec2 coords11 = coords10 + hgY.x * eY;\n  vec2 coords01 = coords00 + hgY.x * eY;\n  coords10 = coords10 - hgY.y * eY;\n  coords00 = coords00 - hgY.y * eY;\n  vec4 color00 = texture2D(sampler, coords00);\n  vec4 color10 = texture2D(sampler, coords10);\n  vec4 color01 = texture2D(sampler, coords01);\n  vec4 color11 = texture2D(sampler, coords11);\n  color00 = mix(color00, color01, hgY.z);\n  color10 = mix(color10, color11, hgY.z);\n  color00 = mix(color00, color10, hgX.z);\n  return color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 texelStart = floor(coords * texSize);\n  vec2 coord0 = texelStart / texSize;\n  vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\n  vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\n  vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\n  vec4 color0 = texture2D(sampler, coord0);\n  vec4 color1 = texture2D(sampler, coord1);\n  vec4 color2 = texture2D(sampler, coord2);\n  vec4 color3 = texture2D(sampler, coord3);\n  vec2 blend = fract(coords * texSize);\n  vec4 color01 = mix(color0, color1, blend.x);\n  vec4 color23 = mix(color2, color3, blend.x);\n  return mix(color01, color23, blend.y);\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\n  vec2 invSize = 1.0 / texSize;\n  vec2 texel = coords * texSize;\n  vec2 texel_i = floor(texel);\n  vec2 texel_frac = fract(texel);\n  vec4 colorP = texture2D(sampler, texel_i * invSize);\n  vec4 colorP1 = vec4(colorP);\n  vec4 colorP2 = vec4(colorP);\n  vec4 colorP3 = vec4(colorP);\n  vec4 colorP4 = vec4(colorP);\n  vec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\n  vec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\n  vec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\n  vec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\n  if (colorC == colorA && colorC != colorD && colorA != colorB) {\n    colorP1 = colorA;\n  }\n  if (colorA == colorB && colorA != colorC && colorB != colorD) {\n    colorP2 = colorB;\n  }\n  if (colorD == colorC && colorD != colorB && colorC != colorA) {\n    colorP3 = colorC;\n  }\n  if (colorB == colorD && colorB != colorA && colorD != colorC) {\n    colorP4 = colorD;\n  }\n  vec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\n  vec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\n  return mix(colorP12, colorP34, texel_frac.y);\n}"},fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include <materials/utils.glsl>\nvoid main()\n{\n#ifdef DELTA\n  vec4 texel = texture2D(u_sourceTexture, v_texcoord);\n  vec4 data0 = texture2D(u_maskTexture, v_texcoord);\n  float flags = data0.r * 255.0;\n  float groupMinZoom = data0.g * 255.0;\n  float isVisible = getFilterBit(flags, 0);\n  float wouldClip = step(groupMinZoom, u_zoomLevel);\n  float direction = wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\n  float dt = u_timeDelta / max(u_animationTime, 0.0001);\n  vec4 nextState = vec4(texel + direction * dt);\n  gl_FragColor =  vec4(nextState);\n#elif defined(UPDATE)\n  vec4 texel = texture2D(u_sourceTexture, v_texcoord);\n  gl_FragColor = texel;\n#endif\n}","integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord = a_pos;\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w = gauss4(i * u_direction.xy);\n  tot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight += w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w = gauss1(i * u_direction.xy);\n  tot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight += w;\n}\nvoid main(void) {\n  mediump float tot = 0.0;\n  mediump float weight = 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma = u_sigmas[3];\n  mediump float y = texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 = 0.5;\n  mediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d = (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance = clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d = estimateDistance();\n  gl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position = vec4(a_position, 0.0, 1.0);\n  v_texcoord = a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color = texture2D(u_readbackTexture, v_texCoord);\n  color = color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color = texture2D(u_maskTexture, v_texCoord);\n  lowp float gray = 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *= gray;\n  lowp vec4 overley_color = texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *= overley_color.a;\n  gl_FragColor = overley_color + (1.0 - overley_color.a) * color;\n}","magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord = a_pos;\n  vec2 coord = u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position = vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec4 id) {\n  highp vec4 texel = unpackDisplayIdTexel(id);\n  highp float size = float(u_attributeTextureSize);\n  highp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256 + int(texel.a) * 256 * 256 * 256);\n  highp float col = mod(u32, size);\n  highp float row = (u32 - col) / size;\n  highp float u = col / size;\n  highp float v = row / size;\n  return vec2(u, v);\n}\nhighp vec4 getAttributeData0(in highp vec4 id) {\n  vec2 coords = getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec4 id) {\n  highp vec2 coords = getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec4 id) {\n  highp vec2 coords = getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec4 id) {\n  highp vec2 coords = getAttributeDataCoords(id);\n  return texture2D(u_attributeData3, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic = v.x == 255.0 && v.y == 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float SIGNED_BYTE_TO_UNSIGNED = 128.0;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.0000001;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;","effects.glsl":"uniform highp mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform highp float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw = vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a = color.a;\n  for (int i = 1; i < EFFECT_COUNT + 1; i++) {\n    float bit = getFilterBit(filterFlags, i);\n    rgbw = u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    = u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw = vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a = color.a;\n  for (int i = 0; i < EFFECT_COUNT + 1; i++) {\n    float bit = getFilterBit(filterFlags, i);\n    rgbw = u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    = u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb = rgbw.rgb * a;\n  color.a = a;\n  pos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef HIGHLIGHT\n  pos.z += 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit = getFilterBit(filterFlags, 0);\n  pos.z += 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i = 1; i < EFFECT_COUNT + 1; i++) {\n    float bit = getFilterBit(filterFlags, i);\n    pos.z += 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp float v_flags;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef DOT_DENSITY\n#include <materials/effects.glsl>\n#endif\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\nvoid main() {\n#ifdef ID\n  gl_FragColor = v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) && !defined(HIGHLIGHT)\n  vec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 = v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 = step(0.0, difference0);\n  vec4 isPositive1 = step(0.0, difference1);\n  float weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero = step(weightSum, 0.0);\n  float greaterThanZero = 1.0 - lessThanEqZero ;\n  float divisor = (weightSum + lessThanEqZero);\n  vec4 weights0 = difference0 * isPositive0 / divisor;\n  vec4 weights1 = difference1 * isPositive1 / divisor;\n  vec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  vec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax = max(max4(difference0), max4(difference1));\n  float lessThanZero = step(diffMax, 0.0);\n  float greaterOrEqZero = 1.0 - lessThanZero;\n  vec4 isMax0 = step(diffMax, difference0);\n  vec4 isMax1 = step(diffMax, difference1);\n  vec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  vec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n  gl_FragColor = getEffectColor(preEffectColor, v_flags);\n#else\n  gl_FragColor = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a = 1.0;\n#endif\n}","fill.vert":"precision highp float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 = vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet = a_aux3.a;\n  v_color     = getColor(a_color, a_bitSet, 0);\n  v_opacity   = getOpacity();\n  v_id        = norm(a_id);\n  v_pos       = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n  v_flags     = getFilterFlags();\n#ifdef PATTERN\n  vec2 aux2 = (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  float width = u_zoomFactor * a_aux1.x * aux2.x;\n  float height = u_zoomFactor * a_aux1.y * aux2.y;\n  float angle = C_256_TO_RAD * a_aux3.z;\n  float sinA = sin(angle);\n  float cosA = cos(angle);\n  mat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n                           -sinA / width, cosA / height, 0,\n                            0,            0,             1);\n  vec2 symbolOffset = (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED) / vec2(width, height);\n  v_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\n  v_tlbr = a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\n  float size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n  gl_Position = vec4(applyFilter(v_color, v_pos, v_flags), 1.0);\n}"},icon:{"common.glsl":"uniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying highp float v_filters;\nvarying lowp float v_opacity;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <util/encoding.glsl>\n#include <materials/effects.glsl>\n#include <materials/constants.glsl>\n#include <materials/icon/common.glsl>\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  vec2 v_size = v_sizeTex.xy;\n  vec2 v_tex  = v_sizeTex.zw;\n#ifdef SDF\n  lowp vec4 fillPixelColor = v_color;\n  float d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size = max(v_size.x, v_size.y);\n  float dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth = v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth = max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth > 0.25) {\n    lowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize = min(outlineWidth, size);\n    outlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor = v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor = v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor = texture2D(u_texture, v_tex);\n   gl_FragColor = v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a = step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec4 a_bitSetAndDistRatio;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r = getSize(baseSize.y) / referenceSize;\n  baseSize.xy *= r;\n  offset.xy *= r;\n  float scaleSymbolProportionally = getBit(bitSet, 3);\n  outlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned = getBit(a_bitSet, 0);\n  vec3  offset       = getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\n  vec2  a_offset = a_vertexOffset / 16.0;\n  float a_outlineSize = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\n  float a_bitSet = a_bitSetAndDistRatio.z;\n  vec2 v_size = getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0, a_bitSet);\n  vec2 v_tex      = a_texCoords / u_mosaicSize;\n  v_color    = getColor(a_color, a_bitSet, 1);\n  v_opacity  = getOpacity();\n  v_id       = norm(a_id);\n  v_filters  = getFilterFlags();\n  v_pos      = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0) + getOffset(a_offset, a_bitSet);\n  v_sizeTex  = vec4(v_size.xy, v_tex.xy);\n#ifdef SDF\n  v_isThin   = getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor = v_isThin;\n  #else\n    v_overridingOutlineColor = 0.0;\n  #endif\n  v_outlineWidth = min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor = getEffectColor(a_outlineColor, v_filters);\n  v_distRatio = a_bitSetAndDistRatio.w / 126.0;\n#endif\n  gl_Position = vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHalo;\nuniform float u_zoomLevel;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle = angle * 360.0 / 254.0;\n  float mapAngle = u_mapRotation * 360.0 / 254.0;\n  float diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z = 0.0;\n  z += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_zoomLevel)));\n  z += u_mapAligned * 2.0 * step(90.0, diffAngle);\n  z += 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    = getMinZoom();\n  float glyphMinZoom    = a_glyphData.x;\n  float glyphMaxZoom    = a_glyphData.y;\n  float glyphAngle      = a_glyphData.z;\n  float a_minZoom          = max(groupMinZoom, glyphMinZoom);\n  float a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\n  vec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\n  float a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\n  float fontSize           = a_texAndSize.z;\n  float haloSize           = a_texAndSize.w * OUTLINE_SCALE;\n  vec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\n  float z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\n  float fontScale    = fontSize / SDF_FONT_SIZE;\n  float halfSize     = getSize(a_refSymbolSize) / 2.0;\n  float animation    = pow(getAnimationState(), vec4(2.0)).r;\n  v_color     = animation * ((1.0 - u_isHalo) * a_color + (u_isHalo * a_haloColor));\n  v_opacity   = 1.0;\n  v_tex       = a_texCoords / u_mosaicSize;\n  v_edgeDistanceOffset = u_isHalo * haloSize / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\n  vec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position = vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\nvarying highp vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/line/common.glsl>\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth = 15.5;\nconst float widthFactor = 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist = length(v_normal) * v_lineHalfWidth;\n  lowp float alpha = clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) && !defined(HIGHLIGHT)\n  mediump float lineHalfWidth = widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio = lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX = mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY = 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist = d * lineHalfWidth;\n  lowp vec4 fillPixelColor = v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor = fillPixelColor;\n#elif defined(PATTERN) && !defined(HIGHLIGHT)\n  mediump float lineHalfWidth = v_lineHalfWidth;\n  mediump float adjustedPatternWidth = v_patternSize.x * 2.0 * lineHalfWidth / v_patternSize.y;\n  mediump float relativeTexX = mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / adjustedPatternWidth, 1.0);\n  mediump float relativeTexY = 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexY, relativeTexX));\n  lowp vec4 color = texture2D(u_texture, texCoord);\n  gl_FragColor = v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor = v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a = step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include <materials/vcommon.glsl>\n#include <materials/line/common.glsl>\nconst float SCALE = 1.0 / 31.0;\nconst float WIDTH_SCALE = 1.0 / 1024.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth = a_aux.x * WIDTH_SCALE;\n  float lineWidth = 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth = max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) && !defined(HIGHLIGHT)\n  thinLineFactor *= 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          = a_segmentDirection.w;\n  float a_accumulatedDist = a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   = a_accumulatedDistanceAndHalfWidth.y * WIDTH_SCALE;\n  float aa                = 0.5 * u_antialiasing;\n  vec2  a_offset          = a_offsetAndNormal.xy;\n  float baseWidth = getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth = getLineHalfWidth(baseWidth, aa);\n  float z         = 2.0 * step(baseWidth, 0.0);\n  vec2  dist      = getDist(a_offset, halfWidth);\n  vec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0) + offset;\n  v_color         = getColor(a_color, a_bitSet, 0);\n  v_opacity       = getOpacity();\n  v_lineHalfWidth = halfWidth;\n  v_id            = norm(a_id);\n  v_normal        = a_offsetAndNormal.zw * SCALE;\n  v_pos           = vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          = a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   = vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance = a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position = vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  float SDF_CUTOFF = (2.0 / 8.0);\n  float SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\n  lowp float dist = texture2D(u_texture, v_tex).a;\n  mediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\n  edge /= 2.0;\n#endif\n  lowp float aa = v_antialiasingWidth;\n  lowp float alpha = smoothstep(edge - aa, edge + aa, dist);\n  gl_FragColor = alpha * v_color * v_opacity;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHalo;\nfloat getTextSize(inout vec2 offset, in float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\n   float ratio = baseSize / referenceSize;\n   baseSize = ratio * getSize(baseSize);\n#endif\n  return baseSize;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet      = a_aux.w;\n  float a_fontSize    = a_texFontSize.z;\n  vec2  a_offset      = a_vertexOffset * OFFSET_PRECISION;\n  vec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\n  float fontSize      = getTextSize(a_offset, a_fontSize, a_aux.z * a_aux.z / 256.0);\n  float scaleFactor   = fontSize / a_fontSize;\n  float fontScale     = fontSize / SDF_FONT_SIZE;\n  vec3  offset        = getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  mat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\n  v_color   = u_isHalo * a_haloColor + (1.0 - u_isHalo) * getColor(a_color, a_bitSet, 1);\n  v_opacity = getOpacity();\n  v_id      = norm(a_id);\n  v_tex     = a_texCoords / u_mosaicSize;\n  v_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\n  v_edgeDistanceOffset = u_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position =  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\n  return getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\n  return getBit(bitset, 0);\n}\nhighp vec4 unpackDisplayIdTexel(in highp vec4 bitset) {\n  float isAggregate = getBit(bitset.a, 7);\n  return (1.0 - isAggregate) * bitset + isAggregate * (vec4(bitset.rgba) - vec4(0.0, 0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\n  float r = mod(rshift(u32, 0), 255.0);\n  float g = mod(rshift(u32, 8), 255.0);\n  float b = mod(rshift(u32, 16), 255.0);\n  float a = mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /= 255.0;\n}\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\n  return (bytes - 127.0) / 127.0;\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/effects.glsl>\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba = getAttributeData2(a_id);\n#else\n  vec4 data0 = getAttributeData2(a_id);\n  vec4 data1 = getAttributeData3(a_id);\n  target.r = u88VVToFloat(data0.rg * 255.0);\n  target.g = u88VVToFloat(data0.ba * 255.0);\n  target.b = u88VVToFloat(data1.rg * 255.0);\n  target.a = u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   = getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\n  return ceil(getAttributeData0(a_id).x * 255.0);\n#else\n  return getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\n  return getAttributeData1(a_id);\n}\nfloat getMinZoom() {\n  vec4 data0 = getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio = (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue <= u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i = 1; i < VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] >= sizeValue) {\n      float f = (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\n  if (isNan(opacityValue)) {\n    return 1.0;\n  }\n  if (opacityValue <= u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i = 1; i < VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] >= opacityValue) {\n      float f = (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation = rotationValue;\n  if (u_vvRotationType == 1.0) {\n    rotation = 90.0 - rotation;\n  }\n  float angle = C_DEG_TO_RAD * rotation;\n  float sinA = sin(angle);\n  float cosA = cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation = rotationValue;\n  if (u_vvRotationType == 1.0) {\n    rotation = 90.0 - rotation;\n  }\n  float angle = C_DEG_TO_RAD * -rotation;\n  float sinA = sin(angle);\n  float cosA = cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked == 1.0) {\n    return fallback;\n  }\n  if (colorValue <= u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i = 1; i < VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] >= colorValue) {\n      float f = (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  float outSize = getVVStopsSize(vvSize, size);\n  return isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\n  float mirrorFactor = 1.2 - factor;\n  return mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\n  gl_FragColor = u_bloomStrength * (\n    lerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\n    lerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\n    lerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\n    lerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\n    lerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n  );\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\n    return 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\n  vec2 invSize = 1.0 / u_texSize;\n  float fSigma = float(SIGMA);\n  float weightSum = gaussianPdf(0.0, fSigma);\n  vec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\n  for (int i = 1; i < KERNEL_RADIUS; i ++) {\n    float x = float(i);\n    float w = gaussianPdf(x, fSigma);\n    vec2 uvOffset = u_direction * invSize * x;\n    vec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\n    vec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\n    pixelColorSum += (sample1 + sample2) * w;\n    weightSum += 2.0 * w;\n  }\n  gl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\n  vec4 texel = texture2D(u_texture, v_uv);\n  vec3 luma = vec3(0.299, 0.587, 0.114);\n  float v = dot(texel.xyz, luma);\n  vec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\n  float alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\n  gl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\n    return 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\n  vec2 invSize = 1.0 / u_texSize;\n  float fSigma = u_sigma;\n  float weightSum = gaussianPdf(0.0, fSigma);\n  vec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\n  for (int i = 1; i < KERNEL_RADIUS; i ++) {\n    float x = float(i);\n    float w = gaussianPdf(x, fSigma);\n    vec2 uvOffset = u_direction * invSize * x;\n    vec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\n    vec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\n    pixelColorSum += (sample1 + sample2) * w;\n    weightSum += 2.0 * w;\n  }\n  gl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\n    float samples[10];\n    samples[0] = -0.08;\n    samples[1] = -0.05;\n    samples[2] = -0.03;\n    samples[3] = -0.02;\n    samples[4] = -0.01;\n    samples[5] =  0.01;\n    samples[6] =  0.02;\n    samples[7] =  0.03;\n    samples[8] =  0.05;\n    samples[9] =  0.08;\n    vec2 dir = 0.5 - v_uv;\n    float dist = sqrt(dir.x * dir.x + dir.y * dir.y);\n    dir = dir / dist;\n    vec4 color = texture2D(u_colorTexture,v_uv);\n    vec4 sum = color;\n    for (int i = 0; i < 10; i++) {\n      sum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n    }\n    sum *= 1.0 / 11.0;\n    float t = dist * sampleStrength;\n    t = clamp(t, 0.0, 1.0);\n    gl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\n  vec4 minColor = texture2D(u_minColor, vec2(0.5));\n  vec4 maxColor = texture2D(u_maxColor, vec2(0.5));\n  vec4 color = texture2D(u_texture, v_uv);\n  vec3 minColorUnpremultiply = minColor.rgb / minColor.a;\n  vec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\n  vec3 colorUnpremultiply = color.rgb / color.a;\n  vec3 range = maxColorUnpremultiply - minColorUnpremultiply;\n  gl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\n  vec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\n  vec2 onePixel = vec2(1.0) / u_srcResolution;\n  vec2 uv = (srcPixel + 0.5) / u_srcResolution;\n  vec4 minColor = vec4(1.0);\n  vec4 maxColor = vec4(0.0);\n  for (int y = 0; y < CELL_SIZE; ++y) {\n    for (int x = 0; x < CELL_SIZE; ++x) {\n      vec2 offset = uv + vec2(x, y) * onePixel;\n      minColor = min(minColor, texture2D(u_minTexture, offset));\n      maxColor = max(maxColor, texture2D(u_maxTexture, offset));\n    }\n  }\n  gl_FragData[0] = minColor;\n  gl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nvarying vec2 v_uv;\nvoid main() {\n  vec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\n  vec4 blurColor = texture2D(u_blurTexture, v_uv);\n  gl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"},"drop-shadow.vert":"precision mediump float;\nattribute vec2 a_position;\nuniform highp mat3 u_displayViewMat3;\nuniform highp vec2 u_offset;\nvarying vec2 v_uv;\nvoid main() {\n  vec3 offset = u_displayViewMat3 * vec3(u_offset, 0.0);\n  gl_Position = vec4(a_position, 0.0, 1.0) + vec4(offset, 0.0);\n  v_uv = (a_position + 1.0) / 2.0;\n}"},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\n  G[0] = g0,\n  G[1] = g1,\n  G[2] = g2,\n  G[3] = g3,\n  G[4] = g4,\n  G[5] = g5,\n  G[6] = g6,\n  G[7] = g7,\n  G[8] = g8;\n  mat3 I;\n  float cnv[9];\n  vec3 sample;\n  for (float i = 0.0; i < 3.0; i++) {\n    for (float j = 0.0; j < 3.0; j++) {\n      sample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\n      I[int(i)][int(j)] = length(sample);\n    }\n  }\n  for (int i = 0; i < 9; i++) {\n    float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n    cnv[i] = dp3 * dp3;\n  }\n  float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\n  float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\n  gl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\n  mat3 I;\n  float cnv[2];\n  vec3 sample;\n  G[0] = g0;\n  G[1] = g1;\n  for (float i = 0.0; i < 3.0; i++) {\n    for (float j = 0.0; j < 3.0; j++) {\n      sample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\n      I[int(i)][int(j)] = length(sample);\n    }\n  }\n  for (int i = 0; i < 2; i++) {\n    float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n    cnv[i] = dp3 * dp3;\n  }\n  gl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\n  mat3 I;\n  float cnv[2];\n  vec3 sample;\n  G[0] = g0;\n  G[1] = g1;\n  for (float i = 0.0; i < 3.0; i++) {\n    for (float j = 0.0; j < 3.0; j++) {\n      sample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\n      I[int(i)][int(j)] = length(sample);\n    }\n  }\n  for (int i = 0; i < 2; i++) {\n    float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n    cnv[i] = dp3 * dp3;\n  }\n  vec4 color = texture2D(u_colorTexture, v_uv);\n  gl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\n  vec4 color = texture2D(u_colorTexture, v_uv);\n  vec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a = color.a;\n  gl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\n  gl_Position = vec4(a_position, 0.0, 1.0);\n  v_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\n#include <filtering/bicubic.glsl>\nvoid main() {\n#ifdef BICUBIC\n  vec4 color = sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\n  vec4 color = texture2D(u_texture, v_texcoord);\n#endif\n  gl_FragColor = vec4(color.rgb * color.a, color.a);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord = a_pos;\n  gl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_isFloatTexture;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\n  vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\n  targetLocation = projectPixelLocation(targetLocation);\n#endif\n  return targetLocation;\n}\nbool isOutside(vec2 coords){\n   if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\n     return true;\n   } else {\n     return false;\n   }\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\n  vec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#else\n  vec4 color = texture2D(u_image, pixelLocation);\n#endif\n  return color;\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\n  vec4 pixelValue = isFloat ? currentPixel * 255.0 : currentPixel;\n  float maxI = 255.0;\n  float mid = 128.0;\n  float c = u_contrastOffset;\n  float b = u_brightnessOffset;\n  vec4 v;\n  if (c > 0.0 && c < 100.0) {\n    v = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n  } else if (c <= 0.0 && c > -100.0) {\n    v = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n  } else if (c == 100.0) {\n    v = (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\n    v = (sign(v) + 1.0) / 2.0;\n  } else if (c == -100.0) {\n    v = vec4(mid, mid, mid, currentPixel.a);\n  }\n  return vec4(v.r / 255.0, v.g / 255.0, v.b / 255.0, currentPixel.a);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n  vec2 index_image = floor(coords * u_targetImageSize);\n  vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n  vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\n  vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n  vec2 srcLocation;\n  vec2 transform_location = index_transform + oneTransformPixel * 0.5;\n  if (pos.s <= pos.t) {\n    vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n    vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n    srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n  } else {\n    vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n    vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n    srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n  }\n  return srcLocation;\n}"},hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\n#include <raster/lut/colorize.glsl>\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n  if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {\n    return 0.0;\n  }\n  else {\n    return e;\n  }\n}\nvec3 rgb2hsv(vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n  vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\n  val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n  vec4 rgb = colorize(vec4(val, val, val, 1.0), 255.0);\n  vec3 hsv = rgb2hsv(rgb.xyz);\n  hsv.z = hillshade;\n  return vec4(hsv2rgb(hsv), 1.0) * rgb.a;\n}\nvoid main() {\n  vec2 pixelLocation = getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel = getPixel(pixelLocation);\n  if (currentPixel.a == 0.0) {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec2 axy = vec2(-1.0, -1.0);\n  vec2 bxy = vec2(0.0, -1.0);\n  vec2 cxy = vec2(1.0, -1.0);\n  vec2 dxy = vec2(-1.0, 0.0);\n  vec2 fxy = vec2(1.0, 0.0);\n  vec2 gxy = vec2(-1.0, 1.0);\n  vec2 hxy = vec2(0.0, 1.0);\n  vec2 ixy = vec2(1.0, 1.0);\n  vec2 onePixel = 1.0 / u_srcImageSize;\n  if (pixelLocation.s < onePixel.s) {\n    axy[0] = 1.0;\n    dxy[0] = 1.0;\n    gxy[0] = 1.0;\n  }\n  if (pixelLocation.t < onePixel.t) {\n    axy[1] = 1.0;\n    bxy[1] = 1.0;\n    cxy[1] = 1.0;\n  }\n  if (pixelLocation.s > 1.0 - onePixel.s) {\n    cxy[0] = -1.0;\n    fxy[0] = -1.0;\n    ixy[0] = -1.0;\n  }\n  if (pixelLocation.t > 1.0 - onePixel.t) {\n    gxy[1] = -1.0;\n    hxy[1] = -1.0;\n    ixy[1] = -1.0;\n  }\n  vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);\n  vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);\n  vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);\n  vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);\n  vec4 ve = texture2D(u_image, pixelLocation);\n  vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);\n  vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);\n  vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);\n  vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);\n  float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n  float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n  float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\n  float hillshade = 0.0;\n  if (u_hillshadeType == 0){\n\t   float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n     float z = (u_cosZs[0] + cosDelta) / dzd;\n     if (z < 0.0)  z = 0.0;\n\t   hillshade = z;\n  } else {\n\t  for (int k = 0; k < 6; k++) {\n\t\t float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n\t\t float z = (u_cosZs[k] + cosDelta) / dzd;\n\t\t if (z < 0.0) z = 0.0;\n     hillshade = hillshade + z * u_weights[k];\n\t\t if (k == 5) break;\n    }\n  }\n  float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n#ifdef APPLY_COLORMAP\n  gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\n  gl_FragColor = vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n}","hillshade.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord = a_pos;\n  gl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\n  float clrIndex = clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\n  vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n  vec4 color = texture2D(u_colormap, clrPosition);\n  vec4 result = vec4(color.rgb, color.a * currentPixel.a);\n  return result;\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\n#include <raster/lut/colorize.glsl>\nvoid main() {\n  vec2 pixelLocation = getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel = getPixel(pixelLocation);\n  vec4 result = colorize(currentPixel, 1.0);\n  gl_FragColor = vec4(result.xyz, 1.0) * result.a * u_opacity;\n}","lut.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord = a_pos * u_scale + u_offset;\n  gl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include <raster/lut/colorize.glsl>\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n  if (val >= maxCutOff) {\n    return maxOutput;\n  } else if (val <= minCutOff) {\n    return minOutput;\n  }\n  float stretchedVal;\n  if (useGamma) {\n  \tfloat tempf = 1.0;\n\t  float outRange = maxOutput - minOutput;\n\t  float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\n\t  if (gamma > 1.0) {\n      tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n    }\n    stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n  } else {\n    stretchedVal = minOutput + (val - minCutOff) * factor;\n  }\n  return stretchedVal;\n}\nvoid main() {\n  vec2 pixelLocation = getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel = getPixel(pixelLocation);\n  if (currentPixel.a == 0.0) {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  if (u_bandCount == 1) {\n    float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\n      vec4 result = colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\n      gl_FragColor = vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\n      gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n  } else {\n    float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n    float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n    float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n    gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n  }\n}","stretch.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord = a_pos * u_scale + u_offset;\n  gl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},stencil:{"stencil.frag":"void main() {\n  gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position = vec4(a_pos, 0.0, 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color = texture2D(u_texture, v_tex);\n  gl_FragColor = 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position = vec4(v_pos.xy, 0.0, 1.0);\n  v_tex = a_pos;\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}};const s=new n.a((function(e){let t=r;return e.split("/").forEach(e=>{t&&(t=t[e])}),t}));function o(e){return s.resolveIncludes(e)}},567:function(e,t,i){"use strict";t.a=class{constructor(e){this.readFile=e}resolveIncludes(e){return this.resolve(e)}resolve(e,t=new Map){if(t.has(e))return t.get(e);const i=this.read(e);if(!i)throw new Error("cannot find shader file "+e);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=n.exec(i);const s=[];for(;null!=r;)s.push({path:r[1],start:r.index,length:r[0].length}),r=n.exec(i);let o=0,a="";return s.forEach(e=>{a+=i.slice(o,e.start),a+=t.has(e.path)?"":this.resolve(e.path,t),o=e.start+e.length}),a+=i.slice(o),t.set(e,a),a}read(e){return this.readFile(e)}}},568:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(560);const r={name:"background",shaders:{vertexShader:Object(n.a)("background/background.vert"),fragmentShader:Object(n.a)("background/background.frag")},attributes:{a_pos:0}}},569:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return o}));const n=!0,r=32,s=1.5,o=200},582:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return u}));var n=i(455),r=i(539);class s{constructor(e,t,i){this.strength=e,this.radius=t,this.threshold=i,this.type="bloom"}interpolate(e,t,i){this.strength=h(e.strength,t.strength,i),this.radius=h(e.radius,t.radius,i),this.threshold=h(e.threshold,t.threshold,i)}clone(){return new s(this.strength,this.radius,this.threshold)}}class o{constructor(e,t){this.type=e,this.radius=t}interpolate(e,t,i){this.radius=Math.round(h(e.radius,t.radius,i))}clone(){return new o(this.type,this.radius)}}class a{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,i){this.amount=h(e.amount,t.amount,i),this._updateMatrix()}clone(){return new a(this.type,this.amount)}_updateMatrix(){const e=this._colorMatrix||Object(r.b)();switch(this.type){case"brightness":this._colorMatrix=((e,t)=>{const i=Object(n.d)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Object(n.b)(i,i)})(e,this.amount);break;case"contrast":this._colorMatrix=((e,t)=>{const i=Object(n.d)(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Object(n.b)(i,i)})(e,this.amount);break;case"grayscale":this._colorMatrix=((e,t)=>{const i=1-t,r=Object(n.d)(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Object(n.b)(r,r)})(e,this.amount);break;case"invert":this._colorMatrix=((e,t)=>{const i=1-2*t,r=Object(n.d)(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return Object(n.b)(r,r)})(e,this.amount);break;case"saturate":this._colorMatrix=((e,t)=>{const i=Object(n.d)(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Object(n.b)(i,i)})(e,this.amount);break;case"sepia":this._colorMatrix=((e,t)=>{const i=1-t,r=Object(n.d)(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Object(n.b)(r,r)})(e,this.amount)}}}class l{constructor(e,t,i,n){this.offsetX=e,this.offsetY=t,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,t,i){this.offsetX=h(e.offsetX,t.offsetX,i),this.offsetY=h(e.offsetY,t.offsetY,i),this.blurRadius=h(e.blurRadius,t.blurRadius,i),this.color[0]=Math.round(h(e.color[0],t.color[0],i)),this.color[1]=Math.round(h(e.color[1],t.color[1],i)),this.color[2]=Math.round(h(e.color[2],t.color[2],i)),this.color[3]=h(e.color[3],t.color[3],i)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}}class c{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,i){this.angle=h(e.angle,t.angle,i),this._updateMatrix()}clone(){return new c(this.angle)}_updateMatrix(){const e=this._colorMatrix||Object(r.b)();this._colorMatrix=((e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=Object(n.d)(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Object(n.b)(s,s)})(e,this.angle)}}class u{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,i){this.amount=h(e.amount,t.amount,i)}clone(){return new u(this.amount)}}function h(e,t,i){return e+(t-e)*i}},588:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(14),r=i(211),s=i(264),o=i(582),a=Object(r.b)((function(e){e.exports&&(e.exports=function(){function e(t,i,n,r){this.message=t,this.expected=i,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(e,Error),e.buildMessage=function(e,t){var i={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t,i="";for(t=0;t<e.parts.length;t++)i+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+i+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return i[e.type](e)}return"Expected "+function(e){var t,i,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=o(e[t]);if(n.sort(),n.length>0){for(t=1,i=1;t<n.length;t++)n[t-1]!==n[t]&&(n[i]=n[t],i++);n.length=i}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+r(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,i){i=void 0!==i?i:{};var n,r={},s={start:se},o=se,a=te("none"),l="none",c=$("none",!1),u=$(")",!1),h=$(",",!1),d=function(e,t){return t.length>0?function(e,t,i){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,i))}(e,t,3):[e]},f=te("whitespace"),p=/^[ \t\n\r]/,m=ee([" ","\t","\n","\r"],!1,!1),_=te("function"),g=$("(",!1),y=te("identifier"),v=/^[a-z\-]/,x=ee([["a","z"],"-"],!1,!1),b=te("percentage"),O=$("%",!1),S=te("length"),w=$("px",!1),T=$("cm",!1),C=$("mm",!1),M=$("in",!1),I=$("pt",!1),j=$("pc",!1),E=te("angle"),P=$("deg",!1),D=$("rad",!1),L=$("grad",!1),z=$("turn",!1),A=te("number"),V=te("color"),R=$("#",!1),F=/^[0-9a-fA-F]/,N=ee([["0","9"],["a","f"],["A","F"]],!1,!1),k=/^[+\-]/,U=ee(["+","-"],!1,!1),G=/^[0-9]/,B=ee([["0","9"]],!1,!1),H=$(".",!1),q=$("e",!1),W=0,Y=0,X=[{line:1,column:1}],Z=0,K=[],J=0;if("startRule"in i){if(!(i.startRule in s))throw new Error("Can't start parsing from rule \""+i.startRule+'".');o=s[i.startRule]}function Q(){return t.substring(Y,W)}function $(e,t){return{type:"literal",text:e,ignoreCase:t}}function ee(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function te(e){return{type:"other",description:e}}function ie(e){var i,n=X[e];if(n)return n;for(i=e-1;!X[i];)i--;for(n={line:(n=X[i]).line,column:n.column};i<e;)10===t.charCodeAt(i)?(n.line++,n.column=1):n.column++,i++;return X[e]=n,n}function ne(e,t){var i=ie(e),n=ie(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function re(e){W<Z||(W>Z&&(Z=W,K=[]),K.push(e))}function se(){var e;return(e=oe())===r&&(e=function(){var e,t;if(e=[],(t=ae())!==r)for(;t!==r;)e.push(t),t=ae();else e=r;return e}()),e}function oe(){var e,i;return J++,e=W,ce()!==r?(t.substr(W,4)===l?(i=l,W+=4):(i=r,0===J&&re(c)),i!==r&&ce()!==r?(Y=e,e=[]):(W=e,e=r)):(W=e,e=r),J--,e===r&&0===J&&re(a),e}function ae(){var e,i,n,s;return e=W,ce()!==r&&(i=function(){var e,i,n;return J++,e=W,(i=ue())!==r?(40===t.charCodeAt(W)?(n="(",W++):(n=r,0===J&&re(g)),n!==r?(Y=e,e=i=i):(W=e,e=r)):(W=e,e=r),J--,e===r&&(i=r,0===J&&re(_)),e}())!==r&&ce()!==r?((n=function(){var e,i,n,s,o,a,l,c;if(e=W,(i=le())!==r){for(n=[],s=W,(o=ce())!==r?(44===t.charCodeAt(W)?(a=",",W++):(a=r,0===J&&re(h)),a===r&&(a=null),a!==r&&(l=ce())!==r&&(c=le())!==r?s=o=[o,a,l,c]:(W=s,s=r)):(W=s,s=r);s!==r;)n.push(s),s=W,(o=ce())!==r?(44===t.charCodeAt(W)?(a=",",W++):(a=r,0===J&&re(h)),a===r&&(a=null),a!==r&&(l=ce())!==r&&(c=le())!==r?s=o=[o,a,l,c]:(W=s,s=r)):(W=s,s=r);n!==r?(Y=e,e=i=d(i,n)):(W=e,e=r)}else W=e,e=r;return e}())===r&&(n=null),n!==r&&ce()!==r?(41===t.charCodeAt(W)?(s=")",W++):(s=r,0===J&&re(u)),s!==r&&ce()!==r?(Y=e,e=function(e,t){return{type:"function",name:e,parameters:t||[]}}(i,n)):(W=e,e=r)):(W=e,e=r)):(W=e,e=r),e}function le(){var e,t;return e=W,(t=he())===r&&(t=de())===r&&(t=fe())===r&&(t=function(){var e,t;return J++,e=W,ce()!==r&&(t=me())!==r?(Y=e,e=function(e){return{value:e,unit:null}}(t)):(W=e,e=r),J--,e===r&&0===J&&re(A),e}()),t!==r&&(Y=e,t=function(e){return{type:"quantity",value:e.value,unit:e.unit}}(t)),(e=t)===r&&(e=W,(t=pe())!==r&&(Y=e,t=function(e){return{type:"color",colorType:e.type,value:e.value}}(t)),e=t),e}function ce(){var e,i;for(J++,e=[],p.test(t.charAt(W))?(i=t.charAt(W),W++):(i=r,0===J&&re(m));i!==r;)e.push(i),p.test(t.charAt(W))?(i=t.charAt(W),W++):(i=r,0===J&&re(m));return J--,e===r&&(i=r,0===J&&re(f)),e}function ue(){var e,i,n;if(J++,e=W,i=[],v.test(t.charAt(W))?(n=t.charAt(W),W++):(n=r,0===J&&re(x)),n!==r)for(;n!==r;)i.push(n),v.test(t.charAt(W))?(n=t.charAt(W),W++):(n=r,0===J&&re(x));else i=r;return i!==r&&(Y=e,i=Q()),J--,(e=i)===r&&(i=r,0===J&&re(y)),e}function he(){var e,i,n;return J++,e=W,ce()!==r&&(i=me())!==r?(37===t.charCodeAt(W)?(n="%",W++):(n=r,0===J&&re(O)),n!==r?(Y=e,e=function(e){return{value:e,unit:"%"}}(i)):(W=e,e=r)):(W=e,e=r),J--,e===r&&0===J&&re(b),e}function de(){var e,i,n;return J++,e=W,ce()!==r&&(i=me())!==r?("px"===t.substr(W,2)?(n="px",W+=2):(n=r,0===J&&re(w)),n!==r?(Y=e,e=function(e){return{value:e,unit:"px"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,ce()!==r&&(i=me())!==r?("cm"===t.substr(W,2)?(n="cm",W+=2):(n=r,0===J&&re(T)),n!==r?(Y=e,e=function(e){return{value:e,unit:"cm"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,ce()!==r&&(i=me())!==r?("mm"===t.substr(W,2)?(n="mm",W+=2):(n=r,0===J&&re(C)),n!==r?(Y=e,e=function(e){return{value:e,unit:"mm"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,ce()!==r&&(i=me())!==r?("in"===t.substr(W,2)?(n="in",W+=2):(n=r,0===J&&re(M)),n!==r?(Y=e,e=function(e){return{value:e,unit:"in"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,ce()!==r&&(i=me())!==r?("pt"===t.substr(W,2)?(n="pt",W+=2):(n=r,0===J&&re(I)),n!==r?(Y=e,e=function(e){return{value:e,unit:"pt"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,ce()!==r&&(i=me())!==r?("pc"===t.substr(W,2)?(n="pc",W+=2):(n=r,0===J&&re(j)),n!==r?(Y=e,e=function(e){return{value:e,unit:"pc"}}(i)):(W=e,e=r)):(W=e,e=r)))))),J--,e===r&&0===J&&re(S),e}function fe(){var e,i,n;return J++,e=W,(i=me())!==r?("deg"===t.substr(W,3)?(n="deg",W+=3):(n=r,0===J&&re(P)),n!==r?(Y=e,e=i=function(e){return{value:e,unit:"deg"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,(i=me())!==r?("rad"===t.substr(W,3)?(n="rad",W+=3):(n=r,0===J&&re(D)),n!==r?(Y=e,e=i=function(e){return{value:e,unit:"rad"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,(i=me())!==r?("grad"===t.substr(W,4)?(n="grad",W+=4):(n=r,0===J&&re(L)),n!==r?(Y=e,e=i=function(e){return{value:e,unit:"grad"}}(i)):(W=e,e=r)):(W=e,e=r),e===r&&(e=W,(i=me())!==r?("turn"===t.substr(W,4)?(n="turn",W+=4):(n=r,0===J&&re(z)),n!==r?(Y=e,e=i=function(e){return{value:e,unit:"turn"}}(i)):(W=e,e=r)):(W=e,e=r)))),J--,e===r&&(i=r,0===J&&re(E)),e}function pe(){var e,i,n,s;if(J++,e=W,35===t.charCodeAt(W)?(i="#",W++):(i=r,0===J&&re(R)),i!==r){if(n=[],F.test(t.charAt(W))?(s=t.charAt(W),W++):(s=r,0===J&&re(N)),s!==r)for(;s!==r;)n.push(s),F.test(t.charAt(W))?(s=t.charAt(W),W++):(s=r,0===J&&re(N));else n=r;n!==r?(Y=e,e=i={type:"hex",value:Q()}):(W=e,e=r)}else W=e,e=r;return e===r&&(e=W,(i=ae())!==r&&(Y=e,i=function(e){return{type:"function",value:e}}(i)),(e=i)===r&&(e=W,(i=ue())!==r&&(Y=e,i={type:"named",value:Q()}),e=i)),J--,e===r&&(i=r,0===J&&re(V)),e}function me(){var e,i,n,s,o,a,l,c;if(e=W,k.test(t.charAt(W))?(i=t.charAt(W),W++):(i=r,0===J&&re(U)),i===r&&(i=null),i!==r){for(n=W,s=[],G.test(t.charAt(W))?(o=t.charAt(W),W++):(o=r,0===J&&re(B));o!==r;)s.push(o),G.test(t.charAt(W))?(o=t.charAt(W),W++):(o=r,0===J&&re(B));if(s!==r)if(46===t.charCodeAt(W)?(o=".",W++):(o=r,0===J&&re(H)),o!==r){if(a=[],G.test(t.charAt(W))?(l=t.charAt(W),W++):(l=r,0===J&&re(B)),l!==r)for(;l!==r;)a.push(l),G.test(t.charAt(W))?(l=t.charAt(W),W++):(l=r,0===J&&re(B));else a=r;a!==r?n=s=[s,o,a]:(W=n,n=r)}else W=n,n=r;else W=n,n=r;if(n===r)if(n=[],G.test(t.charAt(W))?(s=t.charAt(W),W++):(s=r,0===J&&re(B)),s!==r)for(;s!==r;)n.push(s),G.test(t.charAt(W))?(s=t.charAt(W),W++):(s=r,0===J&&re(B));else n=r;if(n!==r){if(s=W,101===t.charCodeAt(W)?(o="e",W++):(o=r,0===J&&re(q)),o!==r)if(k.test(t.charAt(W))?(a=t.charAt(W),W++):(a=r,0===J&&re(U)),a===r&&(a=null),a!==r){if(l=[],G.test(t.charAt(W))?(c=t.charAt(W),W++):(c=r,0===J&&re(B)),c!==r)for(;c!==r;)l.push(c),G.test(t.charAt(W))?(c=t.charAt(W),W++):(c=r,0===J&&re(B));else l=r;l!==r?s=o=[o,a,l]:(W=s,s=r)}else W=s,s=r;else W=s,s=r;s===r&&(s=null),s!==r?(Y=e,e=i=parseFloat(Q())):(W=e,e=r)}else W=e,e=r}else W=e,e=r;return e}if((n=o())!==r&&W===t.length)return n;throw n!==r&&W<t.length&&re({type:"end"}),function(t,i,n){return new e(e.buildMessage(t,i),t,i,n)}(K,Z<t.length?t.charAt(Z):null,Z<t.length?ne(Z,Z+1):ne(Z,Z))}}}())}));function l(e){let t;try{t=e?a.parse(e):[]}catch(t){return{input:e,parsedFunctions:[],effects:[],error:new n.a("effect:invalid-syntax","Invalid filter syntax",{input:e,error:t})}}const i={input:e,parsedFunctions:t,effects:[],error:null};try{for(const e of t)i.effects.push(c(e))}catch(e){i.effects.length=0,i.error=e}return i}function c(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return u(e.parameters,1),1===e.parameters.length&&(t=m(e.parameters[0])),new o.c(e.name,t)}(e);case"opacity":return function(e){let t=1;return u(e.parameters,1),1===e.parameters.length&&(t=m(e.parameters[0])),new o.f(t)}(e);case"hue-rotate":return function(e){let t=0;var i;return u(e.parameters,1),1===e.parameters.length&&(function(e){if("quantity"!==e.type||(0!==e.value||null!==e.unit)&&null==f[e.unit])throw new n.a("effect:type-error","Expected <angle>, Actual: "+h(e),{term:e})}(i=e.parameters[0]),t=i.value*f[i.unit]||0),new o.e(t)}(e);case"radial-blur":case"blur":return function(e){let t=0;return u(e.parameters,1),1===e.parameters.length&&(t=_(e.parameters[0]),d(t,e.parameters[0])),new o.b(e.name,t)}(e);case"drop-shadow":return function(e){const t=[];let i;for(const r of e.parameters)if("color"===r.type){if(t.length&&Object.freeze(t),i)throw new n.a("effect:type-error","Accepts only one color",{});i=g(r)}else{const e=_(r);if(Object.isFrozen(t))throw new n.a("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&d(e,r)}if(t.length<2||t.length>3)throw new n.a("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new o.d(t[0],t[1],t[2]||0,i||y("black"))}(e);case"bloom":return function(e){let t=1,i=0,n=0;return u(e.parameters,3),e.parameters[0]&&(t=m(e.parameters[0])),e.parameters[1]&&(i=_(e.parameters[1]),d(i,e.parameters[1])),e.parameters[2]&&(n=m(e.parameters[2])),new o.a(t,i,n)}(e)}}catch(t){throw t.details.filter=e,t}throw new n.a("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function u(e,t){if(e.length>t)throw new n.a("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function h(e){return"color"===e.type?"<color>":p[e.unit]?"<length>":f[e.unit]?"<angle>":"%"===e.unit?"<percentage>":"<double>"}function d(e,t){if(e<0)throw new n.a("effect:type-error","Negative values are not allowed, Actual: "+e,{term:t})}const f={deg:1,grad:.9,rad:180/Math.PI,turn:360},p={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73};function m(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new n.a("effect:type-error","Expected <double> or <percentage>, Actual: "+h(e),{term:e})}(e);const t=e.value;return d(t,e),"%"===e.unit?.01*t:t}function _(e){return function(e){if("quantity"!==e.type||(0!==e.value||null!==e.unit)&&null==p[e.unit])throw new n.a("effect:type-error","Expected <length>, Actual: "+h(e),{term:e})}(e),e.value*p[e.unit]||0}function g(e){switch(e.colorType){case"hex":return Object(s.c)(e.value);case"named":return y(e.value);case"function":return function(e){if(u(e.parameters,4),v.test(e.name))return[m(e.parameters[0]),m(e.parameters[1]),m(e.parameters[2]),e.parameters[3]?m(e.parameters[3]):1];if(x.test(e.name))return Object(s.d)(function(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new n.a("effect:type-error","Expected <double>, Actual: "+h(e),{term:e})}(e),d(e.value,e),e.value}(e.parameters[0]),m(e.parameters[1]),m(e.parameters[2]),e.parameters[3]?m(e.parameters[3]):1);throw new n.a("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function y(e){const t=Object(s.b)(e);if(!t)throw new n.a("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return t}const v=/^rgba?/i,x=/^hsla?/i},601:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return a})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return u})),i.d(t,"i",(function(){return d})),i.d(t,"j",(function(){return p})),i.d(t,"k",(function(){return f}));i(404),i(405);var n=i(406);i(407),i(408),i(409),i(411);function r(e,t,i="nearest",r=!1){const s=!(r&&"u8"===t.pixelType),o=s?5126:5121,a=null==t.pixels||0===t.pixels.length?null:s?t.getAsRGBAFloat():t.getAsRGBA(),l={width:t.width,height:t.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===i||"cubic"===i?9729:9728,dataType:o,wrapMode:33071,flipped:!1};return new n.a(e,l,a)}function s(e,t){const i=4*t.size[0],r=t.size[1],s={width:i,height:r,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},o=new Float32Array(i*r*4);let a=0;for(let e=0;e<t.coefficients.length;e++)o[a++]=t.coefficients[e],e%3==2&&(o[a++]=1);return new n.a(e,s,o)}function o(e,t){const i={width:t.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1};return new n.a(e,i,t)}function a(e,t,i,n=1,r=!0,s=!1){return{u_flipY:r,u_isFloatTexture:s,u_applyTransform:!!e,u_opacity:n,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:i}}function l(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}}function c(e,t){return{u_scale:e,u_offset:t}}function u(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function h(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function d(e,t){const i=e.gl,n=t.glName,r=i.getProgramParameter(n,i.ACTIVE_UNIFORMS),s=new Map;let o;for(let e=0;e<r;e++)o=i.getActiveUniform(n,e),o&&s.set(o.name,{location:i.getUniformLocation(n,o.name),info:o});return s}function f(e,t,i){Object.keys(i).forEach(n=>{const r=t.get(n)||t.get(n+"[0]");r&&function(e,t,i,n){if(null===n||null==i)return!1;const{info:r}=n;switch(r.type){case 5126:r.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case 35664:e.setUniform2fv(t,i);break;case 35665:e.setUniform3fv(t,i);break;case 35666:e.setUniform4fv(t,i);break;case 35675:e.setUniformMatrix3fv(t,i);break;case 35676:e.setUniformMatrix4fv(t,i);break;case 5124:r.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case 35670:e.setUniform1i(t,i?1:0);break;case 35667:case 35671:e.setUniform2iv(t,i);break;case 35668:case 35672:e.setUniform3iv(t,i);break;case 35669:case 35673:e.setUniform4iv(t,i);break;default:;}}(e,n,i[n],r)})}function p(e,t,i,n){i.length===n.length&&(n.some(e=>null==e)||i.some(e=>null==e)||i.forEach((i,r)=>{t.setUniform1i(i,r),e.bindTexture(n[r],r)}))}},614:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return b}));i(404),i(405),i(406),i(407),i(408),i(409),i(411);var n=i(460),r=i(567),s={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos = mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = u_opacity * color;\n#else\n  gl_FragColor = u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist = length(v_offset);\n  mediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision = 0.25;\nconst float blurPrecision = 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color = a_color * u_color;\n  v_stroke_color = a_stroke_color * u_stroke_color;\n  v_stroke_width = a_data[1] * sizePrecision * u_stroke_width;\n  v_radius = a_data[2] * u_radius;\n  v_blur = max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset = offset;\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  mediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\n  gl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\n  mediump vec2 samplePos = mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = v_color[3] * color;\n#else\n  gl_FragColor = v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\n  gl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor = v_color;\n  float d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio = 0.248062016;\n  float size = max(v_size.x, v_size.y);\n  float dist = d * sofetEdgeRatio * size;\n  fillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize > 0.25) {\n    lowp vec4 outlinePixelColor = u_outlineColor;\n    const float outlineLimitRatio = (16.0 / 86.0);\n    float clampedOutlineSize = sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor = v_opacity * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor = texture2D(u_texture, v_tex);\n  gl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_opacity;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n  float modded = mod(a_opacityInfo, 128.0);\n  float targetOpacity = (a_opacityInfo - modded) / 128.0;\n  float startOpacity = modded / 127.0;\n  float interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\n  v_opacity = u_opacity * interpolatedOpacity;\n  mediump float a_angle         = a_levelInfo[1];\n  mediump float a_minLevel      = a_levelInfo[2];\n  mediump float a_maxLevel      = a_levelInfo[3];\n  mediump vec2 a_tex            = a_texAngleRange.xy;\n  mediump float delta_z = 0.0;\n  mediump float rotated = mod(a_angle + u_mapRotation, 256.0);\n  delta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z += 1.0 - step(a_minLevel, u_level);\n  delta_z += step(a_maxLevel, u_level);\n  delta_z += step(v_opacity, 0.0);\n  vec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\n  v_size = abs(offset);\n#ifdef SDF\n  offset = (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size = a_size * u_size;\n#else\n  mediump float icon_size = u_size;\n#endif\n  mediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(icon_size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\n  gl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_tex = a_tex.xy / u_mosaicSize;\n  v_opacity *= v_color.w;\n}"},line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio = 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist = length(v_normal) * v_lineHalfWidth;\n  lowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX = mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY = 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord = mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color = texture2D(u_texture, texCoord);\n  gl_FragColor = alpha * v_color[3] * color;\n#else\n  lowp float dashPos =  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha = clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha = max(sign(-v_dasharray.y), dashAlpha);\n  alpha *= dashAlpha;\n  gl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal = a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth = a_width * u_width;\n#else\n  v_lineHalfWidth = u_width;\n#endif\n  v_lineHalfWidth += u_antialiasing;\n  v_lineHalfWidth *= 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray = u_dasharray * a_width;\n#else\n  v_dasharray = u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist = v_lineHalfWidth * scale * a_offsetAndNormal.xy;\n  mediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) +  u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\n  gl_Position = vec4(pos.xy, u_depth, 1.0);\n  v_accumulatedDistance = a_accumulatedDistance.x;\n  v_blur = u_blur + u_antialiasing;\n  #ifdef DD\n    v_color = a_color * u_color;\n  #else\n    v_color = u_color;\n  #endif\n  #ifdef ID\n    v_id = u_id / 255.0;\n  #endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist = abs(v_normal.y);\n  lowp float alpha = smoothstep(1.0, 0.0, dist);\n  gl_FragColor = alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_normal = a_xnormal;\n  mediump vec2 dist = u_outline_width * scale * a_offset;\n  mediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\n  gl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist = texture2D(u_texture, v_tex).a;\n  mediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_opacity;\n  gl_FragColor = alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_opacity;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nvarying lowp float v_opacity;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nuniform highp float u_time;\nvoid main()\n{\n  float modded = mod(a_opacityInfo, 128.0);\n  float targetOpacity = (a_opacityInfo - modded) / 128.0;\n  float startOpacity = modded / 127.0;\n  float interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\n  v_opacity = u_opacity * interpolatedOpacity;\n  mediump float a_angle       = a_levelInfo[1];\n  mediump float a_minLevel    = a_levelInfo[2];\n  mediump float a_maxLevel    = a_levelInfo[3];\n  mediump vec2 a_tex           = a_texAngleRange.xy;\n  mediump float a_visMinAngle    = a_texAngleRange.z;\n  mediump float a_visMaxAngle    = a_texAngleRange.w;\n  mediump float delta_z = 0.0;\n  mediump float angle = mod(a_angle + u_mapRotation, 256.0);\n  if (a_visMinAngle < a_visMaxAngle)\n  {\n    delta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n  }\n  else\n  {\n    delta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n  }\n  delta_z += 1.0 - step(a_minLevel, u_level);\n  delta_z += step(a_maxLevel, u_level);\n  delta_z += step(v_opacity, 0.0);\n  v_tex = a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo > 0.5)\n  {\n    v_color = u_color;\n  }\n  else\n  {\n    v_color = a_color * u_color;\n  }\n#else\n  v_color = u_color;\n#endif\n#ifdef DD\n  v_size = a_size * u_size;\n#else\n  v_size = u_size;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_edgeDistance = edgePos - u_edgeDistance / v_size;\n  v_edgeWidth = (u_antialiasingWidth + u_edgeBlur) / v_size;\n  mediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * v_size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\n  gl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}};const o=new r.a((function(e){let t=s;return e.split("/").forEach(e=>{t&&(t=t[e])}),t}));function a(e){return o.resolveIncludes(e)}const l=e=>Object(n.b)({ID:e.id,PATTERN:e.pattern}),c={name:"background",shaders:e=>({vertexShader:l(e)+a("background/background.vert"),fragmentShader:l(e)+a("background/background.frag")}),attributes:{a_pos:0}},u=e=>Object(n.b)({ID:e.id}),h={name:"circle",shaders:e=>({vertexShader:u(e)+a("circle/circle.vert"),fragmentShader:u(e)+a("circle/circle.frag")}),attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}},d=e=>Object(n.b)({ID:e.id,DD:e.dd,PATTERN:e.pattern}),f={name:"fill",shaders:e=>({vertexShader:d(e)+a("fill/fill.vert"),fragmentShader:d(e)+a("fill/fill.frag")}),attributes:{a_pos:0,a_color:1}},p=e=>Object(n.b)({ID:e.id,DD:e.dd}),m={name:"outline",shaders:e=>({vertexShader:p(e)+a("outline/outline.vert"),fragmentShader:p(e)+a("outline/outline.frag")}),attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}},_=e=>Object(n.b)({ID:e.id,DD:e.dd,SDF:e.sdf}),g={name:"icon",shaders:e=>({vertexShader:_(e)+a("icon/icon.vert"),fragmentShader:_(e)+a("icon/icon.frag")}),attributes:{a_pos:0,a_vertexOffset:1,a_texAngleRange:2,a_levelInfo:3,a_color:4,a_size:5,a_opacityInfo:6}},y=e=>Object(n.b)({ID:e.id,DD:e.dd,PATTERN:e.pattern}),v={name:"line",shaders:e=>({vertexShader:y(e)+a("line/line.vert"),fragmentShader:y(e)+a("line/line.frag")}),attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}},x=e=>Object(n.b)({ID:e.id,DD:e.dd}),b={name:"text",shaders:e=>({vertexShader:x(e)+a("text/text.vert"),fragmentShader:x(e)+a("text/text.frag")}),attributes:{a_pos:0,a_vertexOffset:1,a_texAngleRange:2,a_levelInfo:3,a_color:4,a_size:5,a_opacityInfo:6}}},954:function(e,t,i){"use strict";i.r(t);var n=i(0),r=(i(4),i(9),i(5),i(6),i(1),i(2)),s=(i(3),i(10),i(7)),o=(i(11),i(21)),a=i(300),l=i(94),c=i(16),u=i(477),h=i(510),d=i(261),f=i(445),p=i(559),m=i(446);let _=class extends(Object(m.a)(f.a)){constructor(){super(...arguments),this._graphicsViewMap={},this._popupTemplates=new Map,this.graphicsViews=[]}hitTest(e,t){if(this.suspended||!this.graphicsViews.length)return Object(s.r)();const i=this.graphicsViews.reverse().map(i=>i.hitTest(e,t));return Object(s.a)(i).then(e=>e.filter((e,t)=>(e&&(e.popupTemplate=this._popupTemplates.get(this.graphicsViews[t]),e.layer=this.layer,e.sourceLayer=this.layer),!!e))[0]||null)}update(e){if(this.graphicsViews)for(const t of this.graphicsViews)t.processUpdate(e)}attach(){this.layer.featureCollections.forEach(e=>{const t=d.default.fromJSON(e.featureSet),i=new(o.a.ofType(l.a))(t.features);let n;if(this._graphicsViewMap[t.geometryType])n=this._graphicsViewMap[t.geometryType],n.graphics.addMany(i);else{const r=e.layerDefinition.drawingInfo,s=e.popupInfo?a.a.fromJSON(e.popupInfo):null,o=Object(h.a)(r.renderer);n=new p.a({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:i,renderer:o}),this._graphicsViewMap[t.geometryType]=n,this._popupTemplates.set(n,s),"polygon"!==t.geometryType||this.layer.polygonSymbol?"polyline"!==t.geometryType||this.layer.lineSymbol?"point"!==t.geometryType||this.layer.pointSymbol||(this.layer.pointSymbol=o.symbol):this.layer.lineSymbol=o.symbol:this.layer.polygonSymbol=o.symbol,this.graphicsViews.push(n),this.container.addChild(n.container)}}),this.handles.add([Object(c.a)(this.layer,"polygonSymbol",e=>{this._graphicsViewMap.polygon.renderer=new u.a({symbol:e})}),Object(c.a)(this.layer,"lineSymbol",e=>{this._graphicsViewMap.polyline.renderer=new u.a({symbol:e})}),Object(c.a)(this.layer,"pointSymbol",e=>{this._graphicsViewMap.point.renderer=new u.a({symbol:e})})])}detach(){this.container.removeAllChildren();for(const e of this.graphicsViews)e.destroy(),e.view=null,e.renderer=null;this.graphicsViews.length=0}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews)e.viewChange()}};_=Object(n.a)([Object(r.a)("esri.views.2d.layers.GeoRSSLayerView2D")],_);var g=_;t.default=g}}]);