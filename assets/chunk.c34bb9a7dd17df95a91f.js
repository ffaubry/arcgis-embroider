(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{403:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(5),s=(i(82),i(70)),a=i(50);i(414),i(55),i(66),i(85),i(111);r.a.getLogger("esri.renderers.support.utils");const n={inches:Object(a.a)(1,"meters","inches"),feet:Object(a.a)(1,"meters","feet"),"us-feet":Object(a.a)(1,"meters","us-feet"),yards:Object(a.a)(1,"meters","yards"),miles:Object(a.a)(1,"meters","miles"),"nautical-miles":Object(a.a)(1,"meters","nautical-miles"),millimeters:Object(a.a)(1,"meters","millimeters"),centimeters:Object(a.a)(1,"meters","centimeters"),decimeters:Object(a.a)(1,"meters","decimeters"),meters:Object(a.a)(1,"meters","meters"),kilometers:Object(a.a)(1,"meters","kilometers"),"decimal-degrees":1/Object(a.h)(1,"meters")};Object(s.a)("short-date")},412:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return y})),i.d(t,"i",(function(){return c})),i.d(t,"j",(function(){return p}));var r=i(44),s=i(75),a=i(299),n=i(166),o=i(212),l=i(447);const c={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;Object(r.a)(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer(e,t,i,r){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||Object(a.a)(this,"screenSizePerspectiveEnabled",{},r))&&(t[i]=e)}}}}}},h={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},u={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},p={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:s.f}}},d={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},b={value:null,type:l.a,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function y(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const m={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},f={...m,json:{...m.json,origins:{"web-document":{...m.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?Object(n.b)(t.layerDefinition.drawingInfo.transparency):void 0:Object(n.b)(t.drawingInfo.transparency)}}},v={type:o.a,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get(){var e,t;if(!(null==(e=this.layer)?void 0:e.timeInfo))return null;const i=null==(t=this.view)?void 0:t.timeExtent,r=this.layer.timeExtent,s=this.layer.useViewTime?i&&r?i.intersection(r):i||r:r;if(!s||s.isEmpty)return s;const a=this.layer.timeOffset,n=a?s.offset(-a.value,a.unit):s,o=this._get("timeExtent");return n.equals(o)?o:n}}},414:function(e,t,i){"use strict";var r,s=i(0),a=(i(4),i(9),i(5),i(6)),n=i(1),o=i(2),l=i(22),c=(i(3),i(10),i(11),i(15)),h=i(35);let u=r=class extends c.a{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=null==e?0:e}clone(){return new r({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};Object(s.a)([Object(n.b)({type:h.a,json:{type:[a.a],write:!0}})],u.prototype,"color",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],u.prototype,"label",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:{allowNull:!0}}})],u.prototype,"value",void 0),Object(s.a)([Object(l.a)("value")],u.prototype,"writeValue",null),u=r=Object(s.a)([Object(o.a)("esri.renderers.visualVariables.support.ColorStop")],u);var p=u;t.a=p},419:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return j}));var r=i(0),s=i(44),a=i(2),n=i(145),o=i(18),l=i(299),c=i(8),h=i(306),u=i(12),p=i(82);class d{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(n.a),this._values=new Map}clone(e){const t=new d,i=this._originStores[0];i&&i.forEach((e,i)=>{t.set(i,Object(u.a)(e),0)});for(let i=2;i<n.a;i++){const r=this._originStores[i];r&&r.forEach((r,s)=>{e&&e.has(s)||t.set(s,Object(u.a)(r),i)})}return t}get(e,t){const i=void 0===t?this._values:this._originStores[t];return i?i.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?Object(p.g)(t):[]}set(e,t,i=6){let r=this._originStores[i];if(r||(r=new Map,this._originStores[i]=r),r.set(e,t),!this._values.has(e)||Object(c.c)(this._propertyOriginMap.get(e))<=i){const r=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,i),r!==t}return!1}delete(e,t=6){const i=this._originStores[t];if(!i)return;const r=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let i=t-1;i>=0;i--){const t=this._originStores[i];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,i);break}}}return r}has(e,t){const i=void 0===t?this._values:this._originStores[t];return!!i&&i.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const i=this._originStores[t],r=i&&i.get(e),s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,t),s!==r}originOf(e){return this._propertyOriginMap.get(e)||0}forEach(e){this._values.forEach(e)}}var b=d;const y=e=>{let t=class extends e{constructor(...e){super(...e);const t=Object(c.c)(Object(s.a)(this)),i=t.metadatas,r=t.store,a=new b;t.store=a,r.keys().forEach(e=>{a.set(e,r.get(e),0)}),Object.keys(i).forEach(e=>{t.internalGet(e)&&a.set(e,t.internalGet(e),0)})}read(e,t){Object(h.a)(this,e,t)}getAtOrigin(e,t){const i=m(this),r=Object(n.d)(t);if("string"==typeof e)return i.get(e,r);const s={};return e.forEach(e=>{s[e]=i.get(e,r)}),s}originOf(e){return Object(n.b)(this.originIdOf(e))}originIdOf(e){return m(this).originOf(e)}revert(e,t){const i=m(this),r=Object(n.d)(t),a=Object(s.a)(this);let o;o="string"==typeof e?"*"===e?i.keys(r):[e]:e,o.forEach(e=>{a.propertyInvalidated(e),i.revert(e,r),a.propertyCommitted(e)})}};return t=Object(r.a)([Object(a.a)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function m(e){return Object(s.a)(e).store}let f=class extends(y(o.a)){};f=Object(r.a)([Object(a.a)("esri.core.ReadOnlyMultiOriginJSONSupport")],f);const v=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return g(this).delete(e,Object(n.d)(t))}write(e={},t){return Object(l.b)(this,e=e||{},t),e}setAtOrigin(e,t,i){Object(s.a)(this).setAtOrigin(e,t,Object(n.d)(i))}removeOrigin(e){const t=g(this),i=Object(n.d)(e),r=t.keys(i);for(const e of r)t.originOf(e)===i&&t.set(e,t.get(e,i),6)}updateOrigin(e,t){const i=g(this),r=Object(n.d)(t),s=this.get(e);for(let t=r+1;t<n.a;++t)i.delete(e,t);i.set(e,s,r)}toJSON(e){return this.write({},e)}};return t=Object(r.a)([Object(a.a)("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function g(e){return Object(s.a)(e).store}const O=e=>{let t=class extends(v(y(e))){constructor(...e){super(...e)}};return t=Object(r.a)([Object(a.a)("esri.core.MultiOriginJSONSupport")],t),t};let j=class extends(O(o.a)){};j=Object(r.a)([Object(a.a)("esri.core.MultiOriginJSONSupport")],j)},425:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r=i(0),s=(i(4),i(9),i(5)),a=(i(6),i(1)),n=i(33),o=i(2),l=i(22),c=i(14),h=i(3),u=(i(10),i(7)),p=(i(11),i(100)),d=i(305);const b=s.a.getLogger("esri.layers.mixins.PortalLayer"),y=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]}}destroy(){var e;null==(e=this.portalItem)||e.destroy(),this.portalItem=null}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,i){if(t.itemId)return new d.default({id:t.itemId,portal:i&&i.portal})}writePortalItem(e,t){e&&e.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem&&this.portalItem.id)try{const r=await i.e(82).then(i.bind(null,565));return Object(u.t)(t),await r.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)}catch(e){throw b.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const i=t&&t.portal,r=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||p.a.getDefault());return i&&r&&!Object(h.q)(r.restUrl,i.restUrl)?(t.messages&&t.messages.push(new c.a("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return Object(r.a)([Object(a.b)({type:d.default})],t.prototype,"portalItem",null),Object(r.a)([Object(n.a)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),Object(r.a)([Object(l.a)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),Object(r.a)([Object(a.b)()],t.prototype,"resourceReferences",void 0),t=Object(r.a)([Object(o.a)("esri.layers.mixins.PortalLayer")],t),t}},429:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(0),s=(i(4),i(9),i(5),i(6),i(1)),a=i(2),n=i(22),o=i(14),l=(i(3),i(10),i(11),i(306)),c=i(299);const h={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,VectorTileLayer:!0,WMS:!0,KML:!0,RasterDataLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,ArcGISFeatureLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0,CSV:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,VectorTileLayer:!0,WFS:!0,SubtypeGroupLayer:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};var u=i(412);const p=e=>{let t=class extends e{constructor(){super(...arguments),this.title="Layer"}writeListMode(e,t,i,r){(r&&"ground"===r.layerContainerType||e&&Object(c.a)(this,i,{},r))&&(t[i]=e)}writeOperationalLayerType(e,t,i,r){!e||r&&"tables"===r.layerContainerType||(t.layerType=e)}writeTitle(e,t){t.title=e||"Layer"}read(e,t){t&&(t.layer=this),Object(l.b)(this,e,t=>super.read(e,t),t)}write(e,t){if(t&&t.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,i=h[e];let r=i&&i[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(r=!1),!r)return t.messages&&t.messages.push(new o.a("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const i=super.write(e,{...t,layer:this}),r=!!t&&!!t.messages&&!!t.messages.filter(e=>e instanceof o.a&&"web-document-write:property-required"===e.name).length;return!this.url&&r?null:i}beforeSave(){}};return Object(r.a)([Object(s.b)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),Object(r.a)([Object(s.b)({json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}})],t.prototype,"listMode",void 0),Object(r.a)([Object(n.a)("listMode")],t.prototype,"writeListMode",null),Object(r.a)([Object(s.b)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),Object(r.a)([Object(n.a)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),Object(r.a)([Object(s.b)(u.e)],t.prototype,"opacity",void 0),Object(r.a)([Object(s.b)({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,allowNull:!0}},"portal-item":{write:!1}}}})],t.prototype,"title",void 0),Object(r.a)([Object(n.a)("title")],t.prototype,"writeTitle",null),Object(r.a)([Object(s.b)({type:Boolean,json:{name:"visibility",origins:{"web-document":{name:"visibility",default:!0},"portal-item":{name:"visibility",read:{source:["visible","visibility"]}}}}})],t.prototype,"visible",void 0),t=Object(r.a)([Object(a.a)("esri.layers.mixins.OperationalLayer")],t),t}},447:function(e,t,i){"use strict";var r,s=i(0),a=(i(4),i(9),i(8)),n=(i(5),i(6),i(1)),o=i(32),l=i(33),c=i(2),h=i(22),u=(i(3),i(10),i(11),i(15)),p=i(144);let d=r=class extends u.a{async collectRequiredFields(e,t){return Object(p.a)(e,t,this.expression)}clone(){return new r({expression:this.expression,title:this.title})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],d.prototype,"expression",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],d.prototype,"title",void 0),d=r=Object(s.a)([Object(c.a)("esri.layers.support.FeatureExpressionInfo")],d);var b=d,y=i(403);const m=function(){const e=Object.keys(y.a);return e.sort(),e}();var f;const v=Object(o.b)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),g=new o.a({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let O=f=class extends u.a{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write(null,r),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){return this._isOverridden("mode")?this._get("mode"):Object(a.h)(this.offset)||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new f({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};Object(s.a)([Object(n.b)({type:b,json:{write:!0}})],O.prototype,"featureExpressionInfo",void 0),Object(s.a)([Object(l.a)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],O.prototype,"readFeatureExpressionInfo",null),Object(s.a)([Object(h.a)("featureExpressionInfo",{featureExpressionInfo:{type:b},"featureExpression.value":{type:[0]}})],O.prototype,"writeFeatureExpressionInfo",null),Object(s.a)([Object(n.b)({type:v.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:v.jsonValues,read:v.read,write:{writer:v.write,isRequired:!0}}})],O.prototype,"mode",null),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],O.prototype,"offset",void 0),Object(s.a)([Object(n.b)({type:m,json:{type:String,read:g.read,write:g.write}})],O.prototype,"unit",null),O=f=Object(s.a)([Object(c.a)("esri.layers.support.ElevationInfo")],O);var j=O;t.a=j},462:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(0),s=(i(4),i(9),i(5)),a=(i(6),i(1)),n=i(2),o=(i(3),i(10),i(11),i(302));const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=Object(o.e)(this.url);if(e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",Object(o.f)(e,s.a.getLogger(this.declaredClass)))}};return Object(r.a)([Object(a.b)({dependsOn:["url"]})],t.prototype,"title",null),Object(r.a)([Object(a.b)({type:String})],t.prototype,"url",null),t=Object(r.a)([Object(n.a)("esri.layers.mixins.ArcGISService")],t),t}},519:function(e,t,i){"use strict";var r=i(520);t.a=class{constructor(e,t){this._storage=new r.c,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,i){this._storage.put(e,t,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}},520:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return l}));var r=i(78),s=i(153),a=i(125);const n=-3;class o{constructor(e,t,i){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)}put(e,t,i,r=0){this._storage.put(this._namespace+e,t,i,r)}get(e){const t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){const t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class l{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new s.a}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs=this._removeFuncs.filter(t=>t[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,i,r){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==t&&this._notifyRemoved(e,s.entry)),i>this._maxSize)return void this._notifyRemoved(e,t);if(void 0===t)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const a=1+Math.max(r,-3)- -3;this._db.set(e,{entry:t,size:i,lifetime:a,lives:a}),this._size+=i,this._checkSizeLimit()}updateSize(e,t,i){const r=this._db.get(e);r&&r.entry===t&&(this._size-=r.size,i>this._maxSize?this._notifyRemoved(e,t):(r.size=i,this._size+=i,this._checkSizeLimit()))}pop(e){const t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){const t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach((e,s)=>{const a=e.lifetime;i[a]=(i[a]||0)+e.size,this._users.forEachSimple(i=>{const a=i.namespace;if(Object(r.e)(s,a)){const i=t[a]||0;t[a]=i+e.size}})});const s={};this._users.forEachSimple(e=>{const i=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){const r=t[i]||0;t[i]=r,s[i]=Math.round(100*e.hitRate)+"%"}else s[i]="0%"});const a=Object.keys(t);a.forEach(e=>t[e]=t[e]/this._size*100),a.sort((e,i)=>t[i]-t[e]),a.forEach(i=>e[i]=Math.round(t[i])+"% / "+s[i]);for(let t=i.length-1;t>=0;--t){const r=i[t];r&&(e["Priority "+(t+-3-1)]=Math.round(r/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEachSimple(e=>e.resetHitRate())}clear(e){this._db.forEach((t,i)=>{Object(r.e)(i,e)&&(this._size-=t.size,this._db.delete(i),this._notifyRemoved(i,t.entry))})}clearAll(){this._db.forEach((e,t)=>this._notifyRemoved(t,e.entry)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemoved(e,t){this._removeFuncs.forEach(i=>{Object(r.e)(e,i[0])&&i[1](t)})}_checkSizeLimit(){this._size<=this._maxSize||Object(a.d)(this._db,(e,t)=>(this._db.delete(t),e.lives<=1?(this._size-=e.size,this._notifyRemoved(t,e.entry)):(--e.lives,this._db.set(t,e)),this._size<=.9*this.maxSize))}}},566:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var r=i(0),s=(i(4),i(9),i(5)),a=i(1),n=i(38),o=i(2),l=i(14),c=i(3),h=(i(10),i(7)),u=i(65),p=(i(11),i(153)),d=i(60),b=i(18),y=i(43),m=i(16),f=i(519),v=i(12),g=i(82);class O{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,s=i>>3,a=this._tileAvailabilityBitSet;return s<0||s>a.length?"unknown":a[s]&1<<r?"available":"unavailable"}_updateFromData(e){const t=this.location.width,i=this.location.height;let r=!0,s=!0;const a=Math.ceil(t*i/8),n=new Uint8Array(a);let o=0;for(let t=0;t<e.length;t++){const i=t%8;e[t]?(s=!1,n[o]|=1<<i):r=!1,7===i&&++o}s?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)}static fromDefinition(e,t){const i=e.service.request||u.default,{row:r,col:s,width:a,height:n}=e,o={query:{f:"json"}};return t=t?{...o,...t}:o,i(function(e){let t;if("vector-tile"===e.service.type)t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}(e),t).then(e=>e.data).catch(e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:r,left:s,width:a,height:n},valid:!0,data:Object(g.b)(a*n,0)};throw e}).then(e=>{if(e.location&&(e.location.top!==r||e.location.left!==s||e.location.width!==a||e.location.height!==n))throw new l.a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:r,left:s,width:a,height:n}});return O.fromJSON(e)})}static fromJSON(e){O.validateJSON(e);const t=new O;return t.location=Object.freeze(Object(v.a)(e.location)),t._updateFromData(e.data),Object.freeze(t)}static validateJSON(e){if(!e||!e.location)throw new l.a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new l.a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new l.a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new l.a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new l.a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function j(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}var _;const w=s.a.getLogger("esri.layers.support.TilemapCache");let S=_=class extends b.a{constructor(e){super(e),this._handles=new y.a,this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=u.default,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new f.a(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],()=>this._initializeTilemapDefinition()),Object(m.a)(this,"layer.tileInfo.lods",e=>this._initializeAvailableLevels(e),!0)]),this._initializeTilemapDefinition()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}castLevels(e){return e<=2?(w.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Object(h.h)(new l.a("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,s);if(a)return Object(h.r)(a);const n=r&&r.signal;return r={...r,signal:null},Object(h.f)((e,t)=>{Object(h.o)(n,()=>t(Object(h.d)()));const i=j(s);let a=this._pendingTilemapRequests[i];if(!a){a=O.fromDefinition(s,r).then(e=>(this._tilemapCache.put(i,e,e.byteSize),e));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=a,a.then(e,e)}a.then(e,t)})}getAvailability(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}getAvailabilityUpsample(e,t,i,r){r.level=e,r.row=t,r.col=i;const s=this.layer.tileInfo;for(s.updateTileInfo(r);;){const e=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==e)return e;if(!s.upsampleTile(r))return"unavailable"}}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(e=>e).then(r=>{if(r instanceof O){const s=r.getAvailability(t,i);return"unavailable"===s?Object(h.h)(new l.a("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):s}if(Object(h.b)(r))throw r;return"unknown"}):Object(h.h)(new l.a("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,s){r.level=e,r.row=t,r.col=i;const a=this.layer.tileInfo;a.updateTileInfo(r);const n=this.fetchAvailability(e,t,i,s).catch(e=>{if(Object(h.b)(e))throw e;if(a.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e});return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,s,n),n}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,s,a){if(!this._prefetchingEnabled)return;const n="prefetch-"+e;if(this._handles.has(n))return;const o=Object(h.c)();a.then(()=>o.abort(),()=>o.abort());let l=!1;const c={remove(){l||(l=!0,o.abort())}};this._handles.add(c,n);try{await Object(d.c)(10,o.signal)}catch{}if(l||(l=!0,this._handles.remove(n)),Object(h.e)(o))return;const u={id:e,level:t,row:i,col:r},p={...s,signal:o.signal},b=this.layer.tileInfo;for(let e=0;_._prefetches.length<_._maxPrefetch&&b.upsampleTile(u);++e){const e=this.fetchAvailability(u.level,u.row,u.col,p);_._prefetches.push(e);const t=()=>{_._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Object(c.B)(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const s=j(r);return this._tilemapCache.get(s)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach(e=>this._availableLevels[e.level]=!0)}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};S._maxPrefetch=4,S._prefetches=new p.a({initialSize:_._maxPrefetch}),Object(r.a)([Object(a.b)({constructOnly:!0,type:Number})],S.prototype,"levels",void 0),Object(r.a)([Object(n.a)("levels")],S.prototype,"castLevels",null),Object(r.a)([Object(a.b)({readOnly:!0,dependsOn:["levels"],type:Number})],S.prototype,"size",null),Object(r.a)([Object(a.b)({constructOnly:!0,type:Number})],S.prototype,"cacheByteSize",void 0),Object(r.a)([Object(a.b)({constructOnly:!0})],S.prototype,"layer",void 0),Object(r.a)([Object(a.b)({constructOnly:!0})],S.prototype,"request",void 0),S=_=Object(r.a)([Object(o.a)("esri.layers.support.TilemapCache")],S)},581:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(304);const s={type:r.a,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:a}}}}};function a(e,t,i,s){if(!e)return null;const{minScale:a,maxScale:n,minLOD:o,maxLOD:l}=t;if(null!=o&&null!=l)return s&&s.ignoreMinMaxLOD?r.a.fromJSON(e):r.a.fromJSON({...e,lods:e.lods.filter(({level:e})=>null!=e&&e>=o&&e<=l)});if(0!==a&&0!==n){const t=e=>Math.round(1e4*e)/1e4,i=a?t(a):1/0,s=n?t(n):-1/0;return r.a.fromJSON({...e,lods:e.lods.filter(e=>{const r=t(e.scale);return r<=i&&r>=s})})}return r.a.fromJSON(e)}},619:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(0),s=(i(4),i(9),i(5),i(6),i(1)),a=i(33),n=i(2),o=(i(3),i(10),i(11),i(28)),l=(i(54),i(581)),c=i(566);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new c.a({layer:this}):null}};return Object(r.a)([Object(s.b)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Object(r.a)([Object(s.b)()],t.prototype,"minScale",void 0),Object(r.a)([Object(a.a)("service","minScale")],t.prototype,"readMinScale",null),Object(r.a)([Object(s.b)()],t.prototype,"maxScale",void 0),Object(r.a)([Object(a.a)("service","maxScale")],t.prototype,"readMaxScale",null),Object(r.a)([Object(s.b)({type:o.a})],t.prototype,"spatialReference",void 0),Object(r.a)([Object(s.b)({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),Object(r.a)([Object(s.b)(l.b)],t.prototype,"tileInfo",void 0),Object(r.a)([Object(s.b)()],t.prototype,"tilemapCache",void 0),Object(r.a)([Object(a.a)("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),Object(r.a)([Object(s.b)()],t.prototype,"version",void 0),t=Object(r.a)([Object(n.a)("esri.layers.mixins.ArcGISCachedService")],t),t}},689:function(e,t,i){"use strict";i.r(t);var r=i(0),s=(i(4),i(9),i(8)),a=i(5),n=(i(6),i(1)),o=i(229),l=i(33),c=i(2),h=i(14),u=i(3),p=(i(10),i(7)),d=i(65),b=(i(11),i(215)),y=i(419),m=i(150),f=i(462),v=i(412),g=i(429),O=i(425),j=i(619),_=i(307);const w=a.a.getLogger("esri.views.3d.support.WorkerHandle");class S extends class{constructor(e,t,i,r={}){this._methodName=t,this._promise=Object(_.b)(e,{...r,scheduler:i}).then(e=>{void 0===this._thread?(this._thread=e,this._promise=null):e.close()}),this._promise.catch(t=>w.error(`Failed to initialize ${e} worker: ${t}`))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t=null){if(this._thread){const i=this.getTransferList(e);return this._thread.invoke(this._methodName,e,{transferList:i,signal:t})}return this._promise?this._promise.then(()=>(Object(p.t)(t),this.invoke(e,t))):Object(p.h)(null)}broadcast(e,t){return this._thread?Object(p.a)(this._thread.broadcast(t,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,t)):Object(p.h)()}get promise(){return this._promise}}{constructor(e){super("LercWorker","_decode",e,{strategy:"dedicated"}),this.scheduler=e}decode(e,t,i){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},i):Object(p.r)(null)}getTransferList(e){return[e.buffer]}}const I=new Map;const L=a.a.getLogger("esri.layers.ElevationLayer");let x=class extends(Object(j.a)(Object(f.a)(Object(g.a)(Object(O.a)(Object(y.a)(b.a)))))){constructor(...e){super(...e),this.copyright=null,this.heightModelInfo=null,this.path=null,this.opacity=1,this.operationalLayerType="ArcGISTiledElevationServiceLayer",this.sourceJSON=null,this.type="elevation",this.url=null,this.version=null,this._lercDecoder=function(e){let t=I.get(e);return t||(t={instance:new S(e),ref:0},I.set(e,t)),++t.ref,t.instance}()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){(function(e){if(null==e)return;const t=e.scheduler,i=I.get(t);i&&--i.ref<=0&&(i.instance.destroy(),I.delete(t))})(this._lercDecoder),this._lercDecoder=null}set minScale(e){this.constructed&&L.warn(this.declaredClass+".minScale support has been removed (since 4.5)")}get minScale(){}set maxScale(e){this.constructed&&L.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")}get maxScale(){}readVersion(e,t){let i=t.currentVersion;return i||(i=9.3),i}load(e){const t=Object(s.h)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:e=>{for(let t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new h.a("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).then(()=>this._fetchImageService(t),()=>this._fetchImageService(t))),Object(p.r)(this)}fetchTile(e,t,i,r={}){null!=r&&"number"==typeof r&&(Object(o.a)(L,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),r={noDataValue:r});const s={responseType:"array-buffer",signal:r.signal},a={noDataValue:r.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(e,t,i,r)).then(()=>Object(d.default)(this.getTileUrl(e,t,i),s)).then(e=>this._lercDecoder.decode(e.data,a,r.signal)).then(e=>({values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}))}getTileUrl(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,s=Object(u.B)({...this.parsedUrl.query,blankTile:!r&&null});return`${this.parsedUrl.path}/tile/${e}/${t}/${i}${s?"?"+s:""}`}queryElevation(e,t){return this._importElevationQuery().then(i=>(new i.ElevationQuery).query(this,e,t))}createElevationSampler(e,t){return this._importElevationQuery().then(i=>(new i.ElevationQuery).createSampler(this,e,t))}_fetchTileAvailability(e,t,i,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,r):Object(p.r)("unknown")}async _fetchImageService(e){if(this.sourceJSON)return this.sourceJSON;const t={query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:e},i=await Object(d.default)(this.parsedUrl.path,t);i.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=i.data,this.read(i.data,{origin:"service",url:this.parsedUrl})}_importElevationQuery(){return i.e(29).then(i.bind(null,994))}};Object(r.a)([Object(n.b)({json:{read:{source:"copyrightText"}}})],x.prototype,"copyright",void 0),Object(r.a)([Object(n.b)({readOnly:!0,type:m.a})],x.prototype,"heightModelInfo",void 0),Object(r.a)([Object(n.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],x.prototype,"path",void 0),Object(r.a)([Object(n.b)({type:["show","hide"]})],x.prototype,"listMode",void 0),Object(r.a)([Object(n.b)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],x.prototype,"minScale",null),Object(r.a)([Object(n.b)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],x.prototype,"maxScale",null),Object(r.a)([Object(n.b)({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],x.prototype,"opacity",void 0),Object(r.a)([Object(n.b)({type:["ArcGISTiledElevationServiceLayer"]})],x.prototype,"operationalLayerType",void 0),Object(r.a)([Object(n.b)()],x.prototype,"sourceJSON",void 0),Object(r.a)([Object(n.b)({json:{read:!1},value:"elevation",readOnly:!0})],x.prototype,"type",void 0),Object(r.a)([Object(n.b)(v.j)],x.prototype,"url",void 0),Object(r.a)([Object(n.b)()],x.prototype,"version",void 0),Object(r.a)([Object(l.a)("version",["currentVersion"])],x.prototype,"readVersion",null),x=Object(r.a)([Object(c.a)("esri.layers.ElevationLayer")],x);var T=x;t.default=T}}]);